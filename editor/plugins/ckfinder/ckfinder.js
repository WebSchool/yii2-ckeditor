var CKFinder=function(){function __internalInit(e){return(e=e||{}).demoMessage="This is a demo version of CKFinder 3",e.hello="Hello fellow cracker! We are really sad that you are trying to crack our application - we put lots of effort to create it. Would you like to get a free CKFinder license? Feel free to submit your translation! http://docs.cksource.com/ckfinder3/#!/guide/dev_translations",e.isDemo=!0,e}function internalCKFinderInit(e,t,i){var n=t.getElementsByTagName("head")[0],r=t.createElement("script");r[r.innerText?"innerText":"innerHTML"]=i+".CKFinder._setup( window, document );CKFinder.start("+JSON.stringify(e)+");",n.appendChild(r)}function configOrDefault(e,t){return e||t}function createUrlParams(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return"?"+t.join("&")}function extendObject(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function getCookie(e){e=e.toLowerCase();for(var t=window.document.cookie.split(";"),i=0;i<t.length;i++){var n=t[i].split("="),r=decodeURIComponent(n[0].trim().toLowerCase()),o=n.length>1?n[1]:"";if(r===e)return decodeURIComponent(o)}return null}function setCookie(e,t){window.document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/"}function updateIOSConfig(e,t){e._iosWidgetHeight=parseInt(getComputedStyle(t).height),e._iosWidgetWidth=parseInt(getComputedStyle(t).width)}function checkOnInit(e,t){var i=t.navigator.userAgent;if((i.indexOf("MSIE ")>0||i.indexOf("Trident/")>0||i.indexOf("Edge/")>0)&&t.addEventListener("ckfinderReady",function(e){setTimeout(function(){var t=e.detail.ckfinder,i=getCookie("ckCsrfToken");i||setCookie("ckCsrfToken",i=t.request("csrf:getToken")),t.request("internal:csrf:setParentWindowToken",{token:i})},1e3)}),e&&!e._omitCheckOnInit&&"function"==typeof e.onInit){var n=e.onInit;delete e.onInit,t.addEventListener("ckfinderReady",function(t){e._initCalled||(e._initCalled=!0,n(t.detail.ckfinder))})}}function S(e){for(var t="",i=e.charCodeAt(0),n=1;n<e.length;++n)t+=String.fromCharCode(e.charCodeAt(n)^n+i&127);return t}function isIE9(){var e,t=-1;return"Microsoft Internet Explorer"==navigator.appName&&(e=navigator.userAgent,null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))),9===t}var connectors={php:"core/connector/php/connector.php",net:"/ckfinder/connector"},connector="php",basePath=function(){if(parent&&parent.CKFinder&&parent.CKFinder.basePath)return parent.CKFinder.basePath;var e,t,i,n=document.getElementsByTagName("script");for(e=0;e<n.length&&(!(i=void 0!==(t=n[e]).getAttribute.length?t.src:t.getAttribute("src"))||-1===i.split("/").slice(-1)[0].indexOf("ckfinder.js"));e++);return i.split("/").slice(0,-1).join("/")+"/"}(),Modal={open:function(e){function t(e,t,i){t.forEach(function(t){e.addEventListener(t,i)})}function i(e,t,i){t.forEach(function(t){e.removeEventListener(t,i)})}function n(e){return 0===e.type.indexOf("touch")?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:document.all?window.event.clientX:e.pageX,y:document.all?window.event.clientX:e.pageY}}function r(e){var t=n(e);g=t.x;var i=(p=t.y)-C;w.style.left=g-b+"px",w.style.top=(i<0?0:i)+"px"}function o(e){var t,i,r=n(e);f?(t=l-(F-r.x),i=d-(x-r.y),t>200&&(I.style.width=t+"px"),i>200&&(I.style.height=i+"px")):h&&(t=l+(F-r.x),i=d-(x-r.y),t>200&&(I.style.width=t+"px",w.style.left=b-(F-r.x)+"px"),i>200&&(I.style.height=i+"px"))}function s(){K.parentNode===I&&I.removeChild(K),f=!1,h=!1,i(document,["mousemove","touchmove"],o),i(document,["mouseup","touchend"],s)}function a(e){e.preventDefault();var i=n(e);F=i.x,x=i.y,l=I.clientWidth,d=I.clientHeight,I.appendChild(K),t(document,["mousemove","touchmove"],o),t(document,["mouseup","touchend"],s)}if(e=e||{},!Modal.div){Modal.heightAdded=48,Modal.widthAdded=2;var l,d,c=Math.min(configOrDefault(e.width,1e3),window.innerWidth-Modal.widthAdded),u=Math.min(configOrDefault(e.height,700),window.innerHeight-Modal.heightAdded),f=!1,h=!1,g=0,p=0,m=e.width,v=e.height;e.width=e.height="100%";var w=Modal.div=document.createElement("div");w.id="ckf-modal",w.style.position="fixed",w.style.top=(document.documentElement.clientHeight-Modal.heightAdded)/2-u/2+"px",w.style.left=(document.documentElement.clientWidth-Modal.widthAdded)/2-c/2+"px",w.style.background="#fff",w.style.border="1px solid #aaa",w.style.boxShadow="3px 3px 5px rgba(0,0,0,0.2)",w.style.borderTopLeftRadius=w.style.borderTopRightRadius="5px",w.style.zIndex=8999,w.innerHTML='<div id="ckf-modal-header" style="cursor: move; border-top-left-radius:5px; border-top-right-radius:5px; background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2Y3ZjdmNyIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNhZGFkYWQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);border-bottom:1px solid #c9c9c9;height:35px !important;"><a style="float: right; padding: 7px 10px 0 !important; margin: 0 !important; font-family: Arial, sans-serif !important; font-weight:bold; font-size: 20px !important; line-height: 20px !important; text-decoration: none !important; color: #888 !important;" id="ckf-modal-close" href="#">×</a></div><div id="ckf-modal-body" style="position: relative;width: '+c+"px; height: "+u+'px"></div><div id="ckf-modal-footer" style="height: 10px !important; background: #f3f3f3"><span id="ckf-modal-resize-handle-sw" style="cursor: sw-resize; width: 7px; height: 7px; display: block; float: left; border-left: 3px solid #ddd; border-bottom: 3px solid #ddd;"></span><span id="ckf-modal-resize-handle-se" style="cursor: se-resize; width: 7px; height: 7px; display: block; float: right; border-right: 3px solid #ddd; border-bottom: 3px solid #ddd;"></span></div>',document.body.appendChild(w),CKFinder.widget("ckf-modal-body",e),Modal.footer=document.getElementById("ckf-modal-footer"),window.addEventListener("orientationchange",function(){Modal.maximized||setTimeout(function(){c=Math.min(configOrDefault(m,1e3),document.documentElement.clientWidth-Modal.widthAdded),u=Math.min(configOrDefault(v,700),document.documentElement.clientHeight-Modal.heightAdded);var e=document.getElementById("ckf-modal-body");e.style.width=c+"px",e.style.height=u+"px",w.style.top=(document.documentElement.clientHeight-Modal.heightAdded)/2-u/2+"px",w.style.left=(document.documentElement.clientWidth-Modal.widthAdded)/2-c/2+"px"},100)}),t(document.getElementById("ckf-modal-close"),["click","touchend"],function(e){e.stopPropagation(),e.preventDefault(),Modal.close()});var y=Modal.header=document.getElementById("ckf-modal-header"),b=w.offsetLeft,C=w.offsetTop;t(y,["mousedown","touchstart"],function(e){e.preventDefault(),!0;var i=n(e);g=i.x,p=i.y,b=g-w.offsetLeft,C=p-w.offsetTop,I.appendChild(K),t(document,["mousemove","touchmove"],r)}),t(y,["mouseup","touchend"],function(){!1,K.parentNode===I&&I.removeChild(K),i(document,["mousemove","touchmove"],r)});var F,x,k=document.getElementById("ckf-modal-resize-handle-se"),M=document.getElementById("ckf-modal-resize-handle-sw"),I=Modal.body=document.getElementById("ckf-modal-body"),K=document.createElement("div");K.style.position="absolute",K.style.top=K.style.right=K.style.bottom=K.style.left=0,K.style.zIndex=1e5,t(k,["mousedown","touchstart"],function(e){f=!0,a(e)}),t(M,["mousedown","touchstart"],function(e){b=w.offsetLeft,h=!0,a(e)})}},close:function(){Modal.div&&(document.body.removeChild(Modal.div),Modal.div=null,Modal.maximized&&(document.documentElement.style.overflow=Modal.preDocumentOverflow,document.documentElement.style.width=Modal.preDocumentWidth,document.documentElement.style.height=Modal.preDocumentHeight))},maximize:function(e){e?(Modal.preDocumentOverflow=document.documentElement.style.overflow,Modal.preDocumentWidth=document.documentElement.style.width,Modal.preDocumentHeight=document.documentElement.style.height,document.documentElement.style.overflow="hidden",document.documentElement.style.width=0,document.documentElement.style.height=0,Modal.preLeft=Modal.div.style.left,Modal.preTop=Modal.div.style.top,Modal.preWidth=Modal.body.style.width,Modal.preHeight=Modal.body.style.height,Modal.preBorder=Modal.div.style.border,Modal.div.style.left=Modal.div.style.top=Modal.div.style.right=Modal.div.style.bottom=0,Modal.body.style.width="100%",Modal.body.style.height="100%",Modal.div.style.border="",Modal.header.style.display="none",Modal.footer.style.display="none",Modal.maximized=!0):(document.documentElement.style.overflow=Modal.preDocumentOverflow,document.documentElement.style.width=Modal.preDocumentWidth,document.documentElement.style.height=Modal.preDocumentHeight,Modal.div.style.right=Modal.div.style.bottom="",Modal.div.style.left=Modal.preLeft,Modal.div.style.top=Modal.preTop,Modal.div.style.border=Modal.preBorder,Modal.body.style.width=Modal.preWidth,Modal.body.style.height=Modal.preHeight,Modal.header.style.display="block",Modal.footer.style.display="block",Modal.maximized=!1)}},_r=/(window|S("A0&5j4"))/,ckfPopupWindow;return{basePath:basePath,connector:connector,_connectors:connectors,modal:function(e){return"close"===e?Modal.close():"visible"===e?!!Modal.div:"maximize"===e?Modal.maximize(!0):"minimize"===e?Modal.maximize(!1):void Modal.open(e)},config:function(e){CKFinder._config=e},widget:function(e,t){function i(e){return e+(/^[0-9]+$/.test(e)?"px":"")}if(t=t||{},!e)throw'No "id" option defined in CKFinder.widget() call.';var n="border:none;";n+="width:"+i(configOrDefault(t.width,"100%"))+";",n+="height:"+i(configOrDefault(t.height,"400"))+";";var r=document.createElement("iframe");r.src="",r.setAttribute("style",n),r.setAttribute("seamless","seamless"),r.setAttribute("scrolling","auto"),r.setAttribute("tabindex",configOrDefault(t.tabindex,0)),r.attachEvent?r.attachEvent("onload",function(){internalCKFinderInit(t,r.contentDocument,"parent")}):r.onload=function(){/iPad|iPhone|iPod/.test(navigator.platform)&&(updateIOSConfig(t,r),r.contentWindow.addEventListener("ckfinderReady",function(e){e.detail.ckfinder.on("ui:resize",function(e){updateIOSConfig(e.finder.config,r)},null,null,1)})),internalCKFinderInit(t,r.contentDocument,"parent")};var o=document.getElementById(e);if(!o)throw'CKFinder.widget(): could not find element with id "'+e+'".';o.innerHTML="",o.appendChild(r),checkOnInit(t,r.contentWindow)},popup:function(e){function t(){ckfPopupWindow&&((i=ckfPopupWindow.document).open(),i.write('<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>CKFinder 3 - File Browser</title></head><body><script src="'+window.CKFinder.basePath+'ckfinder.js" charset="utf-8"><\/script><script>window.isCKFinderPopup=true;window.onload=function() {    CKFinder.start( window.opener.CKFinder._popupOptions );}<\/script></body></html>'),i.close(),ckfPopupWindow.focus())}e=e||{},window.CKFinder._popupOptions=e;var i,n=isIE9()?window.CKFinder.basePath+"ckfinder.html":"about:blank",r="location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes";r+=",width="+configOrDefault(e.width,1e3),r+=",height="+configOrDefault(e.height,700),r+=",top=50",r+=",left=100",void 0===ckfPopupWindow||ckfPopupWindow.closed||ckfPopupWindow.close();try{var o="CKFPopup"+Date.now();ckfPopupWindow=window.open(n,o,r,!0)}catch(e){return}return/iPad|iPhone|iPod/.test(navigator.platform)?setTimeout(t,100):t(),ckfPopupWindow},start:function(e){if(!e){var t=window.opener,i={};e={};var n=window.location.search.substring(1);if(n)for(var r=n.split("&"),o=0;o<r.length;++o){var s=r[o].split("=");i[s[0]]=s[1]||null}if(i.popup&&(window.isCKFinderPopup=!0),t&&i.configId&&t.CKFinder&&t.CKFinder._popupOptions){var a=decodeURIComponent(i.configId);(e=t.CKFinder._popupOptions[a]||{})._omitCheckOnInit=!0}}CKFinder._setup(window,document),checkOnInit(e,window),CKFinder.start(e)},setupCKEditor:function(e,t,i){function n(e){if(/^(http(s)?:)?\/\/.+/i.test(e))return e;0!==e.indexOf("/")&&(e="/"+e);var t=window.parent?window.parent.location:window.location;return t.protocol+"//"+t.host+e}if(e){e.config.filebrowserBrowseUrl=window.CKFinder.basePath+"ckfinder.html",i=extendObject({command:"QuickUpload",type:"Files"},i),t=extendObject(window.CKFinder._config||{},t);var r=window.CKFinder._connectors[window.CKFinder.connector];"/"!==r.charAt(0)&&(r=window.CKFinder.basePath+r),r=n(r),Object.keys(t).length&&(window.CKFinder._popupOptions||(window.CKFinder._popupOptions={}),t._omitCheckOnInit=!0,window.CKFinder._popupOptions[e.name]=t,e.config.filebrowserBrowseUrl+="?popup=1&configId="+encodeURIComponent(e.name),t.connectorPath&&(r=n(t.connectorPath))),e.config.filebrowserUploadUrl=r+createUrlParams(i)}else{for(var o in CKEDITOR.instances)CKFinder.setupCKEditor(CKEDITOR.instances[o]);CKEDITOR.on("instanceCreated",function(e){CKFinder.setupCKEditor(e.editor)})}},_setup:function(window,document){var CKFinder;window.CKFinder=window.CKFinder||{},window.CKFinder.connector=connector,window.CKFinder._connectors=connectors,window.CKFinder.basePath=function(){if(window.parent&&window.parent.CKFinder&&window.parent.CKFinder.basePath)return window.parent.CKFinder.basePath;for(var e,t,i=document.getElementsByTagName("script"),n=0;n<i.length&&(!(t=void 0!==(e=i[n]).getAttribute.length?e.src:e.getAttribute("src"))||-1===t.split("/").slice(-1)[0].indexOf("ckfinder.js"));n++);return t.split("/").slice(0,-1).join("/")+"/"}(),function(){var requirejs,require,define;CKFinder&&CKFinder.requirejs||(CKFinder?require=CKFinder:CKFinder={},function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){!i&&hasProp(e,r)||(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e,t,i){var n,r,o,s,a,l,d,c,u,f,h=t&&t.split("/"),g=C.map,p=g&&g["*"];if(e&&(l=(e=e.split("/")).length-1,C.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&g&&(h||p)){e:for(o=(r=e.split("/")).length;o>0;o-=1){if(a=r.slice(0,o).join("/"),h)for(s=h.length;s>0;s-=1)if((n=getOwn(g,h.slice(0,s).join("/")))&&(n=getOwn(n,a))){d=n,c=o;break e}!u&&p&&getOwn(p,a)&&(u=getOwn(p,a),f=o)}!d&&u&&(d=u,c=f),d&&(r.splice(0,c,d),e=r.join("/"))}return getOwn(C.pkgs,e)||e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===w.contextName)return t.parentNode.removeChild(t),!0})}function n(e){var t=getOwn(C.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),w.require.undef(e),w.makeRequire(null,{skipMap:!0})([e]),!0}function r(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function o(e,i,n,o){var s,a,l,d,c=null,u=i?i.name:null,f=e,h=!0,g="";return e||(h=!1,e="_@r"+(V+=1)),c=(d=r(e))[0],e=d[1],c&&(c=t(c,u,o),a=getOwn(I,c)),e&&(c?g=a&&a.normalize?a.normalize(e,function(e){return t(e,u,o)}):-1===e.indexOf("!")?t(e,u,o):e:(c=(d=r(g=t(e,u,o)))[0],g=d[1],n=!0,s=w.nameToUrl(g))),{prefix:c,name:g,parentMap:i,unnormalized:!!(l=!c||a||n?"":"_unnormalized"+(S+=1)),url:s,originalName:f,isDefine:h,id:(c?c+"!"+g:g)+l}}function s(e){var t=e.id,i=getOwn(F,t);return i||(i=F[t]=new w.Module(e)),i}function a(e,t,i){var n=e.id,r=getOwn(F,n);!hasProp(I,n)||r&&!r.defineEmitComplete?(r=s(e)).error&&"error"===t?i(r.error):r.on(t,i):"defined"===t&&i(I[n])}function l(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(F,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function d(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(w.defQueueMap[t]=!0),M.push(e)}),globalDefQueue=[])}function c(e){delete F[e],delete x[e]}function u(){var e,t,r=1e3*C.waitSeconds,o=r&&w.startTime+r<(new Date).getTime(),s=[],a=[],d=!1,c=!0;if(!m){if(m=!0,eachProp(x,function(e){var r=e.map,l=r.id;if(e.enabled&&(r.isDefine||a.push(e),!e.error))if(!e.inited&&o)n(l)?(t=!0,d=!0):(s.push(l),i(l));else if(!e.inited&&e.fetched&&r.isDefine&&(d=!0,!r.prefix))return c=!1}),o&&s.length)return(e=makeError("timeout","Load timeout for modules: "+s,null,s)).contextName=w.contextName,l(e);c&&each(a,function(e){!function e(t,i,n){var r=t.map.id;t.error?t.emit("error",t.error):(i[r]=!0,each(t.depMaps,function(r,o){var s=r.id,a=getOwn(F,s);!a||t.depMatched[o]||n[s]||(getOwn(i,s)?(t.defineDep(o,I[s]),t.check()):e(a,i,n))}),n[r]=!0)}(e,{},{})}),o&&!t||!d||!isBrowser&&!isWebWorker||b||(b=setTimeout(function(){b=0,u()},50)),m=!1}}function f(e){hasProp(I,e[0])||s(o(e[0],null,!0)).init(e[1],e[2])}function h(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function g(e){var t=e.currentTarget||e.srcElement;return h(t,w.onScriptLoad,"load","onreadystatechange"),h(t,w.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function p(){var e;for(d();M.length;){if(null===(e=M.shift())[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));f(e)}w.defQueueMap={}}var m,v,w,y,b,C={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},F={},x={},k={},M=[],I={},K={},E={},V=1,S=1;return y={require:function(e){return e.require?e.require:e.require=w.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?I[e.map.id]=e.exports:e.exports=I[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(C.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(v=function(e){this.events=getOwn(k,e.id)||{},this.map=e,this.shim=getOwn(C.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,w.startTime=(new Date).getTime();var e=this.map;return this.shim?void w.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;K[e]||(K[e]=!0,w.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){try{r=w.execCb(i,o,n,r)}catch(t){e=t}if(this.map.isDefine&&void 0===r&&((t=this.module)?r=t.exports:this.usingExports&&(r=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else r=o;if(this.exports=r,this.map.isDefine&&!this.ignore&&(I[i]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(w,this.map,s)}c(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(w.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,i=e.id,n=o(e.prefix);this.depMaps.push(n),a(n,"defined",bind(this,function(n){var r,d,u,f=getOwn(E,this.map.id),h=this.map.name,g=this.map.parentMap?this.map.parentMap.name:null,p=w.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(h=n.normalize(h,function(e){return t(e,g,!0)})||""),a(d=o(e.prefix+"!"+h,this.map.parentMap),"defined",bind(this,function(e){this.map.normalizedMap=d,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((u=getOwn(F,d.id))&&(this.depMaps.push(d),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):f?(this.map.url=w.nameToUrl(f),void this.load()):((r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],eachProp(F,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&c(e.map.id)}),l(e)}),r.fromText=bind(this,function(t,n){var a=e.name,d=o(a),c=useInteractive;n&&(t=n),c&&(useInteractive=!1),s(d),hasProp(C.config,i)&&(C.config[a]=C.config[i]);try{req.exec(t)}catch(e){return l(makeError("fromtexteval","fromText eval for "+i+" failed: "+e,e,[i]))}c&&(useInteractive=!0),this.depMaps.push(d),w.completeLoad(a),p([a],r)}),void n.load(e.name,p,r,C))})),w.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){x[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(y,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,a(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?a(e,"error",bind(this,this.errback)):this.events.error&&a(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,n=F[i],hasProp(y,i)||!n||n.enabled||w.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(F,e.id);t&&!t.enabled&&w.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(w={config:C,contextName:e,registry:F,defined:I,urlFetched:K,defQueue:M,defQueueMap:{},Module:v,makeModuleMap:o,nextTick:req.nextTick,onError:l,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=C.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(C[t]||(C[t]={}),mixin(C[t],e,!0,!0)):C[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(E[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=w.makeShimExports(e)),t[i]=e}),C.shim=t),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(C.paths[t]=e.location),C.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(F,function(e,t){e.inited||e.map.unnormalized||(e.map=o(t,null,!0))}),(e.deps||e.callback)&&w.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(n,r){function a(t,i,d){var c,f;return r.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof t?isFunction(i)?l(makeError("requireargs","Invalid require call"),d):n&&hasProp(y,t)?y[t](F[n.id]):req.get?req.get(w,t,n,a):(c=o(t,n,!1,!0).id,hasProp(I,c)?I[c]:l(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(n?"":". Use require([])")))):(p(),w.nextTick(function(){p(),(f=s(o(null,n))).skipMap=r.skipMap,f.init(t,i,d,{enabled:!0}),u()}),a)}return r=r||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var i,r=e.lastIndexOf("."),o=e.split("/")[0];return-1!==r&&(!("."===o||".."===o)||r>1)&&(i=e.substring(r,e.length),e=e.substring(0,r)),w.nameToUrl(t(e,n&&n.id,!0),i,!0)},defined:function(e){return hasProp(I,o(e,n,!1,!0).id)},specified:function(e){return e=o(e,n,!1,!0).id,hasProp(I,e)||hasProp(F,e)}}),n||(a.undef=function(e){d();var t=o(e,n,!0),r=getOwn(F,e);r.undefed=!0,i(e),delete I[e],delete K[t.url],delete k[e],eachReverse(M,function(t,i){t[0]===e&&M.splice(i,1)}),delete w.defQueueMap[e],r&&(r.events.defined&&(k[e]=r.events),c(e))}),a},enable:function(e){getOwn(F,e.id)&&s(e).enable()},completeLoad:function(e){var t,i,r,o=getOwn(C.shim,e)||{},s=o.exports;for(d();M.length;){if(null===(i=M.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);f(i)}if(w.defQueueMap={},r=getOwn(F,e),!t&&!hasProp(I,e)&&r&&!r.inited){if(!(!C.enforceDefine||s&&getGlobal(s)))return n(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));f([e,o.deps||[],o.exportsFn])}u()},nameToUrl:function(e,t,i){var n,r,o,s,a,l,d=getOwn(C.pkgs,e);if(d&&(e=d),l=getOwn(E,e))return w.nameToUrl(l,t,i);if(req.jsExtRegExp.test(e))s=e+(t||"");else{for(n=C.paths,o=(r=e.split("/")).length;o>0;o-=1)if(a=getOwn(n,r.slice(0,o).join("/"))){isArray(a)&&(a=a[0]),r.splice(0,o,a);break}s=r.join("/"),s=("/"===(s+=t||(/^data\:|\?/.test(s)||i?"":".js")).charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":C.baseUrl)+s}return C.urlArgs?s+(-1===s.indexOf("?")?"?":"&")+C.urlArgs:s},load:function(e,t){req.load(w,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=g(e);w.completeLoad(t.id)}},onScriptError:function(e){var t=g(e);if(!n(t.id)){var i=[];return eachProp(F,function(e,n){0!==n.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&i.push(n),!0})}),l(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}}).require=w.makeRequire(),w}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!(void 0===window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,o,s=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=n):e=[]),o&&o.context&&(s=o.context),(r=getOwn(contexts,s))||(r=contexts[s]=req.s.newContext(s)),o&&r.configure(o),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var n=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=e.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(e,t,i){var n,r=e&&e.config||{};if(isBrowser)return n=req.createNode(r,t,i),r.onNodeCreated&&r.onNodeCreated(n,r,t,i),n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(n){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,n,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&((n=currentlyAddingScript||getInteractiveScript())&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,i]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),CKFinder.requirejs=requirejs,CKFinder.require=require,CKFinder.define=define)}(),CKFinder.define("requireLib",function(){}),function(){function e(e,t,i){for(var n=(i||0)-1,r=e?e.length:0;++n<r;)if(e[n]===t)return n;return-1}function t(t,i){var n=typeof i;if(t=t.cache,"boolean"==n||null==i)return t[i]?0:-1;"number"!=n&&"string"!=n&&(n="object");var r="number"==n?i:m+i;return t=(t=t[n])&&t[r],"object"==n?t&&e(t,i)>-1?0:-1:t?0:-1}function i(e){var t=this.cache,i=typeof e;if("boolean"==i||null==e)t[e]=!0;else{"number"!=i&&"string"!=i&&(i="object");var n="number"==i?e:m+e,r=t[i]||(t[i]={});"object"==i?(r[n]||(r[n]=[])).push(e):r[n]=!0}}function n(e){return e.charCodeAt(0)}function r(e,t){for(var i=e.criteria,n=t.criteria,r=-1,o=i.length;++r<o;){var s=i[r],a=n[r];if(s!==a){if(s>a||void 0===s)return 1;if(s<a||void 0===a)return-1}}return e.index-t.index}function o(e){var t=-1,n=e.length,r=e[0],o=e[n/2|0],s=e[n-1];if(r&&"object"==typeof r&&o&&"object"==typeof o&&s&&"object"==typeof s)return!1;var a=l();a.false=a.null=a.true=a.undefined=!1;var d=l();for(d.array=e,d.cache=a,d.push=i;++t<n;)d.push(e[t]);return d}function s(e){return"\\"+j[e]}function a(){return h.pop()||[]}function l(){return g.pop()||{array:null,cache:null,criteria:null,false:!1,index:0,null:!1,number:null,object:null,push:null,string:null,true:!1,undefined:!1,value:null}}function d(e){e.length=0,h.length<w&&h.push(e)}function c(e){var t=e.cache;t&&c(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,g.length<w&&g.push(e)}function u(e,t,i){t||(t=0),void 0===i&&(i=e?e.length:0);for(var n=-1,r=i-t||0,o=Array(r<0?0:r);++n<r;)o[n]=e[t+n];return o}var f,h=[],g=[],p=0,m=+new Date+"",v=75,w=40,y=" \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",b=/\b__p \+= '';/g,C=/\b(__p \+=) '' \+/g,F=/(__e\(.*?\)|\b__t\)) \+\n'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,k=/\w*$/,M=/^\s*function[ \n\r\t]+\w/,I=/<%=([\s\S]+?)%>/g,K=RegExp("^["+y+"]*0+(?=.$)"),E=/($^)/,V=/\bthis\b/,S=/['\n\r\t\u2028\u2029\\]/g,T=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],_=0,q="[object Arguments]",R="[object Array]",z="[object Boolean]",P="[object Date]",D="[object Function]",O="[object Number]",B="[object Object]",A="[object RegExp]",H="[object String]",N={};N[D]=!1,N[q]=N[R]=N[z]=N[P]=N[O]=N[B]=N[A]=N[H]=!0;var U={leading:!1,maxWait:0,trailing:!1},L={configurable:!1,enumerable:!1,value:null,writable:!1},$={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},j={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},W=$[typeof window]&&window||this,G=$[typeof exports]&&exports&&!exports.nodeType&&exports,X=$[typeof module]&&module&&!module.nodeType&&module,J=X&&X.exports===G&&G,Y=$[typeof global]&&global;!Y||Y.global!==Y&&Y.window!==Y||(W=Y);var Q=function i(h){function g(e){return e&&"object"==typeof e&&!Tt(e)&&ht.call(e,"__wrapped__")?e:new w(e)}function w(e,t){this.__chain__=!!t,this.__wrapped__=e}function j(e){function t(){if(n){var e=u(n);gt.apply(e,arguments)}if(this instanceof t){var o=X(i.prototype),s=i.apply(o,e||arguments);return ve(s)?s:o}return i.apply(r,e||arguments)}var i=e[0],n=e[2],r=e[4];return St(t,e),t}function G(e,t,i,n,r){if(i){var o=i(e);if(void 0!==o)return o}if(!ve(e))return e;var s=st.call(e);if(!N[s])return e;var l=Et[s];switch(s){case z:case P:return new l(+e);case O:case H:return new l(e);case A:return(o=l(e.source,k.exec(e))).lastIndex=e.lastIndex,o}var c=Tt(e);if(t){var f=!n;n||(n=a()),r||(r=a());for(var h=n.length;h--;)if(n[h]==e)return r[h];o=c?l(e.length):{}}else o=c?u(e):Dt({},e);return c&&(ht.call(e,"index")&&(o.index=e.index),ht.call(e,"input")&&(o.input=e.input)),t?(n.push(e),r.push(o),(c?Me:At)(e,function(e,s){o[s]=G(e,t,i,n,r)}),f&&(d(n),d(r)),o):o}function X(e,t){return ve(e)?yt(e):{}}function J(e,t,i){if("function"!=typeof e)return Ne;if(void 0===t||!("prototype"in e))return e;var n=e.__bindData__;if(void 0===n&&(Vt.funcNames&&(n=!e.name),!(n=n||!Vt.funcDecomp))){var r=ut.call(e);Vt.funcNames||(n=!M.test(r)),n||(n=V.test(r),St(e,n))}if(!1===n||!0!==n&&1&n[1])return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)};case 4:return function(i,n,r,o){return e.call(t,i,n,r,o)}}return Ae(e,t)}function Y(e){function t(){var e=l?s:this;if(r){var g=u(r);gt.apply(g,arguments)}if((o||c)&&(g||(g=u(arguments)),o&&gt.apply(g,o),c&&g.length<a))return n|=16,Y([i,f?n:-4&n,g,null,s,a]);if(g||(g=arguments),d&&(i=e[h]),this instanceof t){e=X(i.prototype);var p=i.apply(e,g);return ve(p)?p:e}return i.apply(e,g)}var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=1&n,d=2&n,c=4&n,f=8&n,h=i;return St(t,e),t}function Z(i,n){var r=-1,s=le(),a=i?i.length:0,l=a>=v&&s===e,d=[];if(l){var u=o(n);u?(s=t,n=u):l=!1}for(;++r<a;){var f=i[r];s(n,f)<0&&d.push(f)}return l&&c(n),d}function ee(e,t,i,n){for(var r=(n||0)-1,o=e?e.length:0,s=[];++r<o;){var a=e[r];if(a&&"object"==typeof a&&"number"==typeof a.length&&(Tt(a)||fe(a))){t||(a=ee(a,t,i));var l=-1,d=a.length,c=s.length;for(s.length+=d;++l<d;)s[c++]=a[l]}else i||s.push(a)}return s}function te(e,t,i,n,r,o){if(i){var s=i(e,t);if(void 0!==s)return!!s}if(e===t)return 0!==e||1/e==1/t;var l=typeof t;if(!(e!=e||e&&$[typeof e]||t&&$[l]))return!1;if(null==e||null==t)return e===t;var c=st.call(e),u=st.call(t);if(c==q&&(c=B),u==q&&(u=B),c!=u)return!1;switch(c){case z:case P:return+e==+t;case O:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case A:case H:return e==tt(t)}var f=c==R;if(!f){var h=ht.call(e,"__wrapped__"),g=ht.call(t,"__wrapped__");if(h||g)return te(h?e.__wrapped__:e,g?t.__wrapped__:t,i,n,r,o);if(c!=B)return!1;var p=e.constructor,m=t.constructor;if(p!=m&&!(me(p)&&p instanceof p&&me(m)&&m instanceof m)&&"constructor"in e&&"constructor"in t)return!1}var v=!r;r||(r=a()),o||(o=a());for(var w=r.length;w--;)if(r[w]==e)return o[w]==t;var y=0;if(s=!0,r.push(e),o.push(t),f){if(w=e.length,y=t.length,(s=y==w)||n)for(;y--;){var b=w,C=t[y];if(n)for(;b--&&!(s=te(e[b],C,i,n,r,o)););else if(!(s=te(e[y],C,i,n,r,o)))break}}else Bt(t,function(t,a,l){if(ht.call(l,a))return y++,s=ht.call(e,a)&&te(e[a],t,i,n,r,o)}),s&&!n&&Bt(e,function(e,t,i){if(ht.call(i,t))return s=--y>-1});return r.pop(),o.pop(),v&&(d(r),d(o)),s}function ie(e,t,i,n,r){(Tt(t)?Me:At)(t,function(t,o){var s,a,l=t,d=e[o];if(t&&((a=Tt(t))||Ht(t))){for(var c=n.length;c--;)if(s=n[c]==t){d=r[c];break}var u;s||(i&&(u=void 0!==(l=i(d,t)))&&(d=l),u||(d=a?Tt(d)?d:[]:Ht(d)?d:{}),n.push(t),r.push(d),u||ie(d,t,i,n,r))}else i&&void 0===(l=i(d,t))&&(l=t),void 0!==l&&(d=l);e[o]=d})}function ne(e,t){return e+ct(Kt()*(t-e+1))}function re(i,n,r){var s=-1,l=le(),u=i?i.length:0,f=[],h=!n&&u>=v&&l===e,g=r||h?a():f;for(h&&(l=t,g=o(g));++s<u;){var p=i[s],m=r?r(p,s,i):p;(n?!s||g[g.length-1]!==m:l(g,m)<0)&&((r||h)&&g.push(m),f.push(p))}return h?(d(g.array),c(g)):r&&d(g),f}function oe(e){return function(t,i,n){var r={};i=g.createCallback(i,n,3);var o=-1,s=t?t.length:0;if("number"==typeof s)for(;++o<s;){var a=t[o];e(r,a,i(a,o,t),t)}else At(t,function(t,n,o){e(r,t,i(t,n,o),o)});return r}}function se(e,t,i,n,r,o){var s=1&t,a=4&t,l=16&t,d=32&t;if(!(2&t||me(e)))throw new it;l&&!i.length&&(t&=-17,l=i=!1),d&&!n.length&&(t&=-33,d=n=!1);var c=e&&e.__bindData__;return c&&!0!==c?((c=u(c))[2]&&(c[2]=u(c[2])),c[3]&&(c[3]=u(c[3])),!s||1&c[1]||(c[4]=r),!s&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),l&&gt.apply(c[2]||(c[2]=[]),i),d&&vt.apply(c[3]||(c[3]=[]),n),c[1]|=t,se.apply(null,c)):(1==t||17===t?j:Y)([e,t,i,n,r,o])}function ae(e){return qt[e]}function le(){var t=(t=g.indexOf)===Re?e:t;return t}function de(e){return"function"==typeof e&&at.test(e)}function ce(e){var t,i;return!!(e&&st.call(e)==B&&(t=e.constructor,!me(t)||t instanceof t))&&(Bt(e,function(e,t){i=t}),void 0===i||ht.call(e,i))}function ue(e){return Rt[e]}function fe(e){return e&&"object"==typeof e&&"number"==typeof e.length&&st.call(e)==q||!1}function he(e,t,i){var n=_t(e),r=n.length;for(t=J(t,i,3);r--;){var o=n[r];if(!1===t(e[o],o,e))break}return e}function ge(e){var t=[];return Bt(e,function(e,i){me(e)&&t.push(i)}),t.sort()}function pe(e){for(var t=-1,i=_t(e),n=i.length,r={};++t<n;){var o=i[t];r[e[o]]=o}return r}function me(e){return"function"==typeof e}function ve(e){return!(!e||!$[typeof e])}function we(e){return"number"==typeof e||e&&"object"==typeof e&&st.call(e)==O||!1}function ye(e){return"string"==typeof e||e&&"object"==typeof e&&st.call(e)==H||!1}function be(e){for(var t=-1,i=_t(e),n=i.length,r=We(n);++t<n;)r[t]=e[i[t]];return r}function Ce(e,t,i){var n=-1,r=le(),o=e?e.length:0,s=!1;return i=(i<0?kt(0,o+i):i)||0,Tt(e)?s=r(e,t,i)>-1:"number"==typeof o?s=(ye(e)?e.indexOf(t,i):r(e,t,i))>-1:At(e,function(e){if(++n>=i)return!(s=e===t)}),s}function Fe(e,t,i){var n=!0;t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o&&(n=!!t(e[r],r,e)););else At(e,function(e,i,r){return n=!!t(e,i,r)});return n}function xe(e,t,i){var n=[];t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o;){var s=e[r];t(s,r,e)&&n.push(s)}else At(e,function(e,i,r){t(e,i,r)&&n.push(e)});return n}function ke(e,t,i){t=g.createCallback(t,i,3);var n,r=-1,o=e?e.length:0;if("number"!=typeof o)return At(e,function(e,i,r){if(t(e,i,r))return n=e,!1}),n;for(;++r<o;){var s=e[r];if(t(s,r,e))return s}}function Me(e,t,i){var n=-1,r=e?e.length:0;if(t=t&&void 0===i?t:J(t,i,3),"number"==typeof r)for(;++n<r&&!1!==t(e[n],n,e););else At(e,t);return e}function Ie(e,t,i){var n=e?e.length:0;if(t=t&&void 0===i?t:J(t,i,3),"number"==typeof n)for(;n--&&!1!==t(e[n],n,e););else{var r=_t(e);n=r.length,At(e,function(e,i,o){return i=r?r[--n]:--n,t(o[i],i,o)})}return e}function Ke(e,t,i){var n=-1,r=e?e.length:0;if(t=g.createCallback(t,i,3),"number"==typeof r)for(var o=We(r);++n<r;)o[n]=t(e[n],n,e);else o=[],At(e,function(e,i,r){o[++n]=t(e,i,r)});return o}function Ee(e,t,i){var r=-1/0,o=r;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Tt(e))for(var s=-1,a=e.length;++s<a;){var l=e[s];l>o&&(o=l)}else t=null==t&&ye(e)?n:g.createCallback(t,i,3),Me(e,function(e,i,n){var s=t(e,i,n);s>r&&(r=s,o=e)});return o}function Ve(e,t,i,n){if(!e)return i;var r=arguments.length<3;t=g.createCallback(t,n,4);var o=-1,s=e.length;if("number"==typeof s)for(r&&(i=e[++o]);++o<s;)i=t(i,e[o],o,e);else At(e,function(e,n,o){i=r?(r=!1,e):t(i,e,n,o)});return i}function Se(e,t,i,n){var r=arguments.length<3;return t=g.createCallback(t,n,4),Ie(e,function(e,n,o){i=r?(r=!1,e):t(i,e,n,o)}),i}function Te(e){var t=-1,i=e?e.length:0,n=We("number"==typeof i?i:0);return Me(e,function(e){var i=ne(0,++t);n[t]=n[i],n[i]=e}),n}function _e(e,t,i){var n;t=g.createCallback(t,i,3);var r=-1,o=e?e.length:0;if("number"==typeof o)for(;++r<o&&!(n=t(e[r],r,e)););else At(e,function(e,i,r){return!(n=t(e,i,r))});return!!n}function qe(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=-1;for(t=g.createCallback(t,i,3);++o<r&&t(e[o],o,e);)n++}else if(null==(n=t)||i)return e?e[0]:f;return u(e,0,Mt(kt(0,n),r))}function Re(t,i,n){if("number"==typeof n){var r=t?t.length:0;n=n<0?kt(0,r+n):n||0}else if(n){var o=Pe(t,i);return t[o]===i?o:-1}return e(t,i,n)}function ze(e,t,i){if("number"!=typeof t&&null!=t){var n=0,r=-1,o=e?e.length:0;for(t=g.createCallback(t,i,3);++r<o&&t(e[r],r,e);)n++}else n=null==t||i?1:kt(0,t);return u(e,n)}function Pe(e,t,i,n){var r=0,o=e?e.length:r;for(t=(i=i?g.createCallback(i,n,1):Ne)(t);r<o;){var s=r+o>>>1;i(e[s])<t?r=s+1:o=s}return r}function De(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(i=g.createCallback(i,n,3)),re(e,t,i)}function Oe(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,i=e?Ee($t(e,"length")):0,n=We(i<0?0:i);++t<i;)n[t]=$t(e,t);return n}function Be(e,t){var i=-1,n=e?e.length:0,r={};for(t||!n||Tt(e[0])||(t=[]);++i<n;){var o=e[i];t?r[o]=t[i]:o&&(r[o[0]]=o[1])}return r}function Ae(e,t){return arguments.length>2?se(e,17,u(arguments,2),null,t):se(e,1,null,null,t)}function He(e,t,i){var n,r,o,s,a,l,d,c=0,u=!1,h=!0;if(!me(e))throw new it;if(t=kt(0,t)||0,!0===i){var g=!0;h=!1}else ve(i)&&(g=i.leading,u="maxWait"in i&&(kt(t,i.maxWait)||0),h="trailing"in i?i.trailing:h);var p=function(){var i=t-(Wt()-s);if(i<=0){r&&dt(r);var u=d;r=l=d=f,u&&(c=Wt(),o=e.apply(a,n),l||r||(n=a=null))}else l=pt(p,i)},m=function(){l&&dt(l),r=l=d=f,(h||u!==t)&&(c=Wt(),o=e.apply(a,n),l||r||(n=a=null))};return function(){if(n=arguments,s=Wt(),a=this,d=h&&(l||!g),!1===u)var i=g&&!l;else{r||g||(c=s);var f=u-(s-c),v=f<=0;v?(r&&(r=dt(r)),c=s,o=e.apply(a,n)):r||(r=pt(m,f))}return v&&l?l=dt(l):l||t===u||(l=pt(p,t)),i&&(v=!0,o=e.apply(a,n)),!v||l||r||(n=a=null),o}}function Ne(e){return e}function Ue(e,t,i){var n=!0,r=t&&ge(t);t&&(i||r.length)||(null==i&&(i=t),o=w,t=e,e=g,r=ge(t)),!1===i?n=!1:ve(i)&&"chain"in i&&(n=i.chain);var o=e,s=me(o);Me(r,function(i){var r=e[i]=t[i];s&&(o.prototype[i]=function(){var t=this.__chain__,i=this.__wrapped__,s=[i];gt.apply(s,arguments);var a=r.apply(e,s);if(n||t){if(i===a&&ve(a))return this;(a=new o(a)).__chain__=t}return a})})}function Le(){}function $e(e){return function(t){return t[e]}}function je(){return this.__wrapped__}var We=(h=h?Q.defaults(W.Object(),h,Q.pick(W,T)):W).Array,Ge=h.Boolean,Xe=h.Date,Je=h.Function,Ye=h.Math,Qe=h.Number,Ze=h.Object,et=h.RegExp,tt=h.String,it=h.TypeError,nt=[],rt=Ze.prototype,ot=h._,st=rt.toString,at=et("^"+tt(st).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),lt=Ye.ceil,dt=h.clearTimeout,ct=Ye.floor,ut=Je.prototype.toString,ft=de(ft=Ze.getPrototypeOf)&&ft,ht=rt.hasOwnProperty,gt=nt.push,pt=h.setTimeout,mt=nt.splice,vt=nt.unshift,wt=function(){try{var e={},t=de(t=Ze.defineProperty)&&t,i=t(e,e,e)&&t}catch(e){}return i}(),yt=de(yt=Ze.create)&&yt,bt=de(bt=We.isArray)&&bt,Ct=h.isFinite,Ft=h.isNaN,xt=de(xt=Ze.keys)&&xt,kt=Ye.max,Mt=Ye.min,It=h.parseInt,Kt=Ye.random,Et={};Et[R]=We,Et[z]=Ge,Et[P]=Xe,Et[D]=Je,Et[B]=Ze,Et[O]=Qe,Et[A]=et,Et[H]=tt,w.prototype=g.prototype;var Vt=g.support={};Vt.funcDecomp=!de(h.WinRTError)&&V.test(i),Vt.funcNames="string"==typeof Je.name,g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:I,variable:"",imports:{_:g}},yt||(X=function(){function e(){}return function(t){if(ve(t)){e.prototype=t;var i=new e;e.prototype=null}return i||h.Object()}}());var St=wt?function(e,t){L.value=t,wt(e,"__bindData__",L),L.value=null}:Le,Tt=bt||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&st.call(e)==R||!1},_t=xt?function(e){return ve(e)?xt(e):[]}:function(e){var t,i=e,n=[];if(!i)return n;if(!$[typeof e])return n;for(t in i)ht.call(i,t)&&n.push(t);return n},qt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Rt=pe(qt),zt=et("("+_t(Rt).join("|")+")","g"),Pt=et("["+_t(qt).join("")+"]","g"),Dt=function(e,t,i){var n,r=e,o=r;if(!r)return o;var s=arguments,a=0,l="number"==typeof i?2:s.length;if(l>3&&"function"==typeof s[l-2])var d=J(s[--l-1],s[l--],2);else l>2&&"function"==typeof s[l-1]&&(d=s[--l]);for(;++a<l;)if((r=s[a])&&$[typeof r])for(var c=-1,u=$[typeof r]&&_t(r),f=u?u.length:0;++c<f;)o[n=u[c]]=d?d(o[n],r[n]):r[n];return o},Ot=function(e,t,i){var n,r=e,o=r;if(!r)return o;for(var s=arguments,a=0,l="number"==typeof i?2:s.length;++a<l;)if((r=s[a])&&$[typeof r])for(var d=-1,c=$[typeof r]&&_t(r),u=c?c.length:0;++d<u;)void 0===o[n=c[d]]&&(o[n]=r[n]);return o},Bt=function(e,t,i){var n,r=e,o=r;if(!r)return o;if(!$[typeof r])return o;for(n in t=t&&void 0===i?t:J(t,i,3),r)if(!1===t(r[n],n,e))return o;return o},At=function(e,t,i){var n,r=e,o=r;if(!r)return o;if(!$[typeof r])return o;t=t&&void 0===i?t:J(t,i,3);for(var s=-1,a=$[typeof r]&&_t(r),l=a?a.length:0;++s<l;)if(!1===t(r[n=a[s]],n,e))return o;return o},Ht=ft?function(e){if(!e||st.call(e)!=B)return!1;var t=e.valueOf,i=de(t)&&(i=ft(t))&&ft(i);return i?e==i||ft(e)==i:ce(e)}:ce,Nt=oe(function(e,t,i){ht.call(e,i)?e[i]++:e[i]=1}),Ut=oe(function(e,t,i){(ht.call(e,i)?e[i]:e[i]=[]).push(t)}),Lt=oe(function(e,t,i){e[i]=t}),$t=Ke,jt=xe,Wt=de(Wt=Xe.now)&&Wt||function(){return(new Xe).getTime()},Gt=8==It(y+"08")?It:function(e,t){return It(ye(e)?e.replace(K,""):e,t||0)};return g.after=function(e,t){if(!me(t))throw new it;return function(){if(--e<1)return t.apply(this,arguments)}},g.assign=Dt,g.at=function(e){for(var t=arguments,i=-1,n=ee(t,!0,!1,1),r=t[2]&&t[2][t[1]]===e?1:n.length,o=We(r);++i<r;)o[i]=e[n[i]];return o},g.bind=Ae,g.bindAll=function(e){for(var t=arguments.length>1?ee(arguments,!0,!1,1):ge(e),i=-1,n=t.length;++i<n;){var r=t[i];e[r]=se(e[r],1,null,null,e)}return e},g.bindKey=function(e,t){return arguments.length>2?se(t,19,u(arguments,2),null,e):se(t,3,null,null,e)},g.chain=function(e){return(e=new w(e)).__chain__=!0,e},g.compact=function(e){for(var t=-1,i=e?e.length:0,n=[];++t<i;){var r=e[t];r&&n.push(r)}return n},g.compose=function(){for(var e=arguments,t=e.length;t--;)if(!me(e[t]))throw new it;return function(){for(var t=arguments,i=e.length;i--;)t=[e[i].apply(this,t)];return t[0]}},g.constant=function(e){return function(){return e}},g.countBy=Nt,g.create=function(e,t){var i=X(e);return t?Dt(i,t):i},g.createCallback=function(e,t,i){var n=typeof e;if(null==e||"function"==n)return J(e,t,i);if("object"!=n)return $e(e);var r=_t(e),o=r[0],s=e[o];return 1!=r.length||s!=s||ve(s)?function(t){for(var i=r.length,n=!1;i--&&(n=te(t[r[i]],e[r[i]],null,!0)););return n}:function(e){var t=e[o];return s===t&&(0!==s||1/s==1/t)}},g.curry=function(e,t){return se(e,4,null,null,null,t="number"==typeof t?t:+t||e.length)},g.debounce=He,g.defaults=Ot,g.defer=function(e){if(!me(e))throw new it;var t=u(arguments,1);return pt(function(){e.apply(f,t)},1)},g.delay=function(e,t){if(!me(e))throw new it;var i=u(arguments,2);return pt(function(){e.apply(f,i)},t)},g.difference=function(e){return Z(e,ee(arguments,!0,!0,1))},g.filter=xe,g.flatten=function(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i="function"!=typeof t&&n&&n[t]===e?null:t,t=!1),null!=i&&(e=Ke(e,i,n)),ee(e,t)},g.forEach=Me,g.forEachRight=Ie,g.forIn=Bt,g.forInRight=function(e,t,i){var n=[];Bt(e,function(e,t){n.push(t,e)});var r=n.length;for(t=J(t,i,3);r--&&!1!==t(n[r--],n[r],e););return e},g.forOwn=At,g.forOwnRight=he,g.functions=ge,g.groupBy=Ut,g.indexBy=Lt,g.initial=function(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=r;for(t=g.createCallback(t,i,3);o--&&t(e[o],o,e);)n++}else n=null==t||i?1:t||n;return u(e,0,Mt(kt(0,r-n),r))},g.intersection=function(){for(var i=[],n=-1,r=arguments.length,s=a(),l=le(),u=l===e,f=a();++n<r;){var h=arguments[n];(Tt(h)||fe(h))&&(i.push(h),s.push(u&&h.length>=v&&o(n?i[n]:f)))}var g=i[0],p=-1,m=g?g.length:0,w=[];e:for(;++p<m;){var y=s[0];if(h=g[p],(y?t(y,h):l(f,h))<0){for(n=r,(y||f).push(h);--n;)if(((y=s[n])?t(y,h):l(i[n],h))<0)continue e;w.push(h)}}for(;r--;)(y=s[r])&&c(y);return d(s),d(f),w},g.invert=pe,g.invoke=function(e,t){var i=u(arguments,2),n=-1,r="function"==typeof t,o=e?e.length:0,s=We("number"==typeof o?o:0);return Me(e,function(e){s[++n]=(r?t:e[t]).apply(e,i)}),s},g.keys=_t,g.map=Ke,g.mapValues=function(e,t,i){var n={};return t=g.createCallback(t,i,3),At(e,function(e,i,r){n[i]=t(e,i,r)}),n},g.max=Ee,g.memoize=function(e,t){if(!me(e))throw new it;var i=function(){var n=i.cache,r=t?t.apply(this,arguments):m+arguments[0];return ht.call(n,r)?n[r]:n[r]=e.apply(this,arguments)};return i.cache={},i},g.merge=function(e){var t=arguments,i=2;if(!ve(e))return e;if("number"!=typeof t[2]&&(i=t.length),i>3&&"function"==typeof t[i-2])var n=J(t[--i-1],t[i--],2);else i>2&&"function"==typeof t[i-1]&&(n=t[--i]);for(var r=u(arguments,1,i),o=-1,s=a(),l=a();++o<i;)ie(e,r[o],n,s,l);return d(s),d(l),e},g.min=function(e,t,i){var r=1/0,o=r;if("function"!=typeof t&&i&&i[t]===e&&(t=null),null==t&&Tt(e))for(var s=-1,a=e.length;++s<a;){var l=e[s];l<o&&(o=l)}else t=null==t&&ye(e)?n:g.createCallback(t,i,3),Me(e,function(e,i,n){var s=t(e,i,n);s<r&&(r=s,o=e)});return o},g.omit=function(e,t,i){var n={};if("function"!=typeof t){var r=[];Bt(e,function(e,t){r.push(t)});for(var o=-1,s=(r=Z(r,ee(arguments,!0,!1,1))).length;++o<s;){var a=r[o];n[a]=e[a]}}else t=g.createCallback(t,i,3),Bt(e,function(e,i,r){t(e,i,r)||(n[i]=e)});return n},g.once=function(e){var t,i;if(!me(e))throw new it;return function(){return t?i:(t=!0,i=e.apply(this,arguments),e=null,i)}},g.pairs=function(e){for(var t=-1,i=_t(e),n=i.length,r=We(n);++t<n;){var o=i[t];r[t]=[o,e[o]]}return r},g.partial=function(e){return se(e,16,u(arguments,1))},g.partialRight=function(e){return se(e,32,null,u(arguments,1))},g.pick=function(e,t,i){var n={};if("function"!=typeof t)for(var r=-1,o=ee(arguments,!0,!1,1),s=ve(e)?o.length:0;++r<s;){var a=o[r];a in e&&(n[a]=e[a])}else t=g.createCallback(t,i,3),Bt(e,function(e,i,r){t(e,i,r)&&(n[i]=e)});return n},g.pluck=$t,g.property=$e,g.pull=function(e){for(var t=arguments,i=0,n=t.length,r=e?e.length:0;++i<n;)for(var o=-1,s=t[i];++o<r;)e[o]===s&&(mt.call(e,o--,1),r--);return e},g.range=function(e,t,i){e=+e||0,null==t&&(t=e,e=0);for(var n=-1,r=kt(0,lt((t-e)/((i="number"==typeof i?i:+i||1)||1))),o=We(r);++n<r;)o[n]=e,e+=i;return o},g.reject=function(e,t,i){return t=g.createCallback(t,i,3),xe(e,function(e,i,n){return!t(e,i,n)})},g.remove=function(e,t,i){var n=-1,r=e?e.length:0,o=[];for(t=g.createCallback(t,i,3);++n<r;){var s=e[n];t(s,n,e)&&(o.push(s),mt.call(e,n--,1),r--)}return o},g.rest=ze,g.shuffle=Te,g.sortBy=function(e,t,i){var n=-1,o=Tt(t),s=e?e.length:0,u=We("number"==typeof s?s:0);for(o||(t=g.createCallback(t,i,3)),Me(e,function(e,i,r){var s=u[++n]=l();o?s.criteria=Ke(t,function(t){return e[t]}):(s.criteria=a())[0]=t(e,i,r),s.index=n,s.value=e}),s=u.length,u.sort(r);s--;){var f=u[s];u[s]=f.value,o||d(f.criteria),c(f)}return u},g.tap=function(e,t){return t(e),e},g.throttle=function(e,t,i){var n=!0,r=!0;if(!me(e))throw new it;return!1===i?n=!1:ve(i)&&(n="leading"in i?i.leading:n,r="trailing"in i?i.trailing:r),U.leading=n,U.maxWait=t,U.trailing=r,He(e,t,U)},g.times=function(e,t,i){e=(e=+e)>-1?e:0;var n=-1,r=We(e);for(t=J(t,i,1);++n<e;)r[n]=t(n);return r},g.toArray=function(e){return e&&"number"==typeof e.length?u(e):be(e)},g.transform=function(e,t,i,n){var r=Tt(e);if(null==i)if(r)i=[];else{var o=e&&e.constructor,s=o&&o.prototype;i=X(s)}return t&&(t=g.createCallback(t,n,4),(r?Me:At)(e,function(e,n,r){return t(i,e,n,r)})),i},g.union=function(){return re(ee(arguments,!0,!0))},g.uniq=De,g.values=be,g.where=jt,g.without=function(e){return Z(e,u(arguments,1))},g.wrap=function(e,t){return se(t,16,[e])},g.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var i=arguments[e];if(Tt(i)||fe(i))var n=n?re(Z(n,i).concat(Z(i,n))):i}return n||[]},g.zip=Oe,g.zipObject=Be,g.collect=Ke,g.drop=ze,g.each=Me,g.eachRight=Ie,g.extend=Dt,g.methods=ge,g.object=Be,g.select=xe,g.tail=ze,g.unique=De,g.unzip=Oe,Ue(g),g.clone=function(e,t,i,n){return"boolean"!=typeof t&&null!=t&&(n=i,i=t,t=!1),G(e,t,"function"==typeof i&&J(i,n,1))},g.cloneDeep=function(e,t,i){return G(e,!0,"function"==typeof t&&J(t,i,1))},g.contains=Ce,g.escape=function(e){return null==e?"":tt(e).replace(Pt,ae)},g.every=Fe,g.find=ke,g.findIndex=function(e,t,i){var n=-1,r=e?e.length:0;for(t=g.createCallback(t,i,3);++n<r;)if(t(e[n],n,e))return n;return-1},g.findKey=function(e,t,i){var n;return t=g.createCallback(t,i,3),At(e,function(e,i,r){if(t(e,i,r))return n=i,!1}),n},g.findLast=function(e,t,i){var n;return t=g.createCallback(t,i,3),Ie(e,function(e,i,r){if(t(e,i,r))return n=e,!1}),n},g.findLastIndex=function(e,t,i){var n=e?e.length:0;for(t=g.createCallback(t,i,3);n--;)if(t(e[n],n,e))return n;return-1},g.findLastKey=function(e,t,i){var n;return t=g.createCallback(t,i,3),he(e,function(e,i,r){if(t(e,i,r))return n=i,!1}),n},g.has=function(e,t){return!!e&&ht.call(e,t)},g.identity=Ne,g.indexOf=Re,g.isArguments=fe,g.isArray=Tt,g.isBoolean=function(e){return!0===e||!1===e||e&&"object"==typeof e&&st.call(e)==z||!1},g.isDate=function(e){return e&&"object"==typeof e&&st.call(e)==P||!1},g.isElement=function(e){return e&&1===e.nodeType||!1},g.isEmpty=function(e){var t=!0;if(!e)return t;var i=st.call(e),n=e.length;return i==R||i==H||i==q||i==B&&"number"==typeof n&&me(e.splice)?!n:(At(e,function(){return t=!1}),t)},g.isEqual=function(e,t,i,n){return te(e,t,"function"==typeof i&&J(i,n,2))},g.isFinite=function(e){return Ct(e)&&!Ft(parseFloat(e))},g.isFunction=me,g.isNaN=function(e){return we(e)&&e!=+e},g.isNull=function(e){return null===e},g.isNumber=we,g.isObject=ve,g.isPlainObject=Ht,g.isRegExp=function(e){return e&&"object"==typeof e&&st.call(e)==A||!1},g.isString=ye,g.isUndefined=function(e){return void 0===e},g.lastIndexOf=function(e,t,i){var n=e?e.length:0;for("number"==typeof i&&(n=(i<0?kt(0,n+i):Mt(i,n-1))+1);n--;)if(e[n]===t)return n;return-1},g.mixin=Ue,g.noConflict=function(){return h._=ot,this},g.noop=Le,g.now=Wt,g.parseInt=Gt,g.random=function(e,t,i){var n=null==e,r=null==t;if(null==i&&("boolean"==typeof e&&r?(i=e,e=1):r||"boolean"!=typeof t||(i=t,r=!0)),n&&r&&(t=1),e=+e||0,r?(t=e,e=0):t=+t||0,i||e%1||t%1){var o=Kt();return Mt(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return ne(e,t)},g.reduce=Ve,g.reduceRight=Se,g.result=function(e,t){if(e){var i=e[t];return me(i)?e[t]():i}},g.runInContext=i,g.size=function(e){var t=e?e.length:0;return"number"==typeof t?t:_t(e).length},g.some=_e,g.sortedIndex=Pe,g.template=function(e,t,i){var n=g.templateSettings;e=tt(e||""),i=Ot({},i,n);var r,o=Ot({},i.imports,n.imports),a=_t(o),l=be(o),d=0,c=i.interpolate||E,u="__p += '",h=et((i.escape||E).source+"|"+c.source+"|"+(c===I?x:E).source+"|"+(i.evaluate||E).source+"|$","g");e.replace(h,function(t,i,n,o,a,l){return n||(n=o),u+=e.slice(d,l).replace(S,s),i&&(u+="' +\n__e("+i+") +\n'"),a&&(r=!0,u+="';\n"+a+";\n__p += '"),n&&(u+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),u+="';\n";var p=i.variable,m=p;m||(u="with ("+(p="obj")+") {\n"+u+"\n}\n"),u=(r?u.replace(b,""):u).replace(C,"$1").replace(F,"$1;"),u="function("+p+") {\n"+(m?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}";var v="\n/*\n//# sourceURL="+(i.sourceURL||"/lodash/template/source["+_+++"]")+"\n*/";try{var w=Je(a,"return "+u+v).apply(f,l)}catch(e){throw e.source=u,e}return t?w(t):(w.source=u,w)},g.unescape=function(e){return null==e?"":tt(e).replace(zt,ue)},g.uniqueId=function(e){var t=++p;return tt(null==e?"":e)+t},g.all=Fe,g.any=_e,g.detect=ke,g.findWhere=ke,g.foldl=Ve,g.foldr=Se,g.include=Ce,g.inject=Ve,Ue(function(){var e={};return At(g,function(t,i){g.prototype[i]||(e[i]=t)}),e}(),!1),g.first=qe,g.last=function(e,t,i){var n=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var o=r;for(t=g.createCallback(t,i,3);o--&&t(e[o],o,e);)n++}else if(null==(n=t)||i)return e?e[r-1]:f;return u(e,kt(0,r-n))},g.sample=function(e,t,i){if(e&&"number"!=typeof e.length&&(e=be(e)),null==t||i)return e?e[ne(0,e.length-1)]:f;var n=Te(e);return n.length=Mt(kt(0,t),n.length),n},g.take=qe,g.head=qe,At(g,function(e,t){var i="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,n){var r=this.__chain__,o=e(this.__wrapped__,t,n);return r||null!=t&&(!n||i&&"function"==typeof t)?new w(o,r):o})}),g.VERSION="2.4.2",g.prototype.chain=function(){return this.__chain__=!0,this},g.prototype.toString=function(){return tt(this.__wrapped__)},g.prototype.value=je,g.prototype.valueOf=je,Me(["join","pop","shift"],function(e){var t=nt[e];g.prototype[e]=function(){var e=this.__chain__,i=t.apply(this.__wrapped__,arguments);return e?new w(i,e):i}}),Me(["push","reverse","sort","unshift"],function(e){var t=nt[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Me(["concat","slice","splice"],function(e){var t=nt[e];g.prototype[e]=function(){return new w(t.apply(this.__wrapped__,arguments),this.__chain__)}}),g}();"function"==typeof CKFinder.define&&"object"==typeof CKFinder.define.amd&&CKFinder.define.amd?(W._=Q,CKFinder.define("underscore",[],function(){return Q})):G&&X?J?(X.exports=Q)._=Q:G._=Q:W._=Q}.call(this),function(){function e(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var t,i={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,encodeHTMLSource:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(i,function(e){return t[e]||e}):""}}};t=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof CKFinder.define&&CKFinder.define.amd?CKFinder.define("doT",[],function(){return i}):t.doT=i;var n={start:"'+(",end:")+'",startencode:"'+encodeHTML("},r={start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("},o=/$^/;i.template=function(s,a,l){var d,c,u=(a=a||i.templateSettings).append?n:r,f=0;s=a.use||a.define?function e(t,i,n){return("string"==typeof i?i:i.toString()).replace(t.define||o,function(e,i,r,o){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in n||(":"===r?(t.defineParams&&o.replace(t.defineParams,function(e,t,r){n[i]={arg:t,text:r}}),i in n||(n[i]=o)):new Function("def","def['"+i+"']="+o)(n)),""}).replace(t.use||o,function(i,r){t.useParams&&(r=r.replace(t.useParams,function(e,t,i,r){if(n[i]&&n[i].arg&&r)return e=(i+":"+r).replace(/'|\\/g,"_"),n.__exp=n.__exp||{},n.__exp[e]=n[i].text.replace(new RegExp("(^|[^\\w$])"+n[i].arg+"([^\\w$])","g"),"$1"+r+"$2"),t+"def.__exp['"+e+"']"}));var o=new Function("def","return "+r)(n);return o?e(t,o,n):o})}(a,s,l||{}):s,s=("var out='"+(a.strip?s.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):s).replace(/'|\\/g,"\\$&").replace(a.interpolate||o,function(t,i){return u.start+e(i)+u.end}).replace(a.encode||o,function(t,i){return d=!0,u.startencode+e(i)+u.end}).replace(a.conditional||o,function(t,i,n){return i?n?"';}else if("+e(n)+"){out+='":"';}else{out+='":n?"';if("+e(n)+"){out+='":"';}out+='"}).replace(a.iterate||o,function(t,i,n,r){return i?(f+=1,c=r||"i"+f,i=e(i),"';var arr"+f+"="+i+";if(arr"+f+"){var "+n+","+c+"=-1,l"+f+"=arr"+f+".length-1;while("+c+"<l"+f+"){"+n+"=arr"+f+"["+c+"+=1];out+='"):"';} } out+='"}).replace(a.evaluate||o,function(t,i){return"';"+e(i)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),d&&(a.selfcontained||!t||t._encodeHTML||(t._encodeHTML=i.encodeHTMLSource(a.doNotSkipEncoded)),s="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+i.encodeHTMLSource.toString()+"("+(a.doNotSkipEncoded||"")+"));"+s);try{return new Function(a.varname,s)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+s),e}},i.compile=function(e,t){return i.template(e,null,t)}}(),function(e,t){if("function"==typeof CKFinder.define&&CKFinder.define.amd)CKFinder.define("backbone",["underscore","jquery","exports"],function(i,n,r){e.Backbone=t(e,r,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");t(e,exports,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,i,n){var r=e.Backbone,o=[],s=o.slice;t.VERSION="1.1.2",t.$=n,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(e,t,i){return d(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,n){if(!d(this,"once",e,[t,n])||!t)return this;var r=this,o=i.once(function(){r.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,n)},off:function(e,t,n){var r,o,s,a,l,c,u,f;if(!this._events||!d(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(l=0,c=(a=e?[e]:i.keys(this._events)).length;l<c;l++)if(e=a[l],s=this._events[e]){if(this._events[e]=r=[],t||n)for(u=0,f=s.length;u<f;u++)o=s[u],(t&&t!==o.callback&&t!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!d(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&c(i,t),n&&c(n,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var o=!t&&!n;for(var s in n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e),r)(e=r[s]).off(t,n,this),(o||i.isEmpty(e._events))&&delete this._listeningTo[s];return this}},l=/\s+/,d=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)e[t].apply(e,[r,i[r]].concat(n));return!1}if(l.test(i)){for(var o=i.split(l),s=0,a=o.length;s<a;s++)e[t].apply(e,[o[s]].concat(n));return!1}return!0},c=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}};i.each({listenTo:"on",listenToOnce:"once"},function(e,t){a[t]=function(t,n,r){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=i.uniqueId("l"))]=t,r||"object"!=typeof n||(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,i.extend(t,a);var u=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(u.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,o,s,a,l,d,c,u;if(null==e)return this;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;for(r in s=n.unset,l=n.silent,a=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o)t=o[r],i.isEqual(u[r],t)||a.push(r),i.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete u[r]:u[r]=t;if(!l){a.length&&(this._pending=n);for(var f=0,h=a.length;f<h;f++)this.trigger("change:"+a[f],this,u[a[f]],n)}if(d)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var o in e)i.isEqual(r[o],t=e[o])||((n||(n={}))[o]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return!!t.set(t.parse(i,e),e)&&(n&&n(t,i,e),void t.trigger("sync",t,i,e))},_(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,o,s,a=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=i.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=i.extend({},a,r)),void 0===n.parse&&(n.parse=!0);var l=this,d=n.success;return n.success=function(e){l.attributes=a;var t=l.parse(e,n);return n.wait&&(t=i.extend(r||{},t)),!(i.isObject(t)&&!l.set(t,n))&&(d&&d(l,e,n),void l.trigger("sync",l,e,n))},_(this,n),"patch"===(o=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=r),s=this.sync(o,this,n),r&&n.wait&&(this.attributes=a),s},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;_(this,e);var o=this.sync("delete",this,e);return e.wait||r(),o},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||T();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});i.each(["keys","values","pairs","invert","pick","omit"],function(e){u.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}});var f=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},h={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};i.extend(f.prototype,a,{model:u,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,g))},remove:function(e,t){var n,r,o,s,a=!i.isArray(e);for(t||(t={}),n=0,r=(e=a?[e]:i.clone(e)).length;n<r;n++)(s=e[n]=this.get(e[n]))&&(delete this._byId[s.id],delete this._byId[s.cid],o=this.indexOf(s),this.models.splice(o,1),this.length--,t.silent||(t.index=o,s.trigger("remove",s,this,t)),this._removeReference(s,t));return a?e[0]:e},set:function(e,t){(t=i.defaults({},t,h)).parse&&(e=this.parse(e,t));var n=!i.isArray(e);e=n?e?[e]:[]:i.clone(e);var r,o,s,a,l,d,c,f=t.at,g=this.model,p=this.comparator&&null==f&&!1!==t.sort,m=i.isString(this.comparator)?this.comparator:null,v=[],w=[],y={},b=t.add,C=t.merge,F=t.remove,x=!(p||!b||!F)&&[];for(r=0,o=e.length;r<o;r++){if(s=(l=e[r]||{})instanceof u?a=l:l[g.prototype.idAttribute||"id"],d=this.get(s))F&&(y[d.cid]=!0),C&&(l=l===a?a.attributes:l,t.parse&&(l=d.parse(l,t)),d.set(l,t),p&&!c&&d.hasChanged(m)&&(c=!0)),e[r]=d;else if(b){if(!(a=e[r]=this._prepareModel(l,t)))continue;v.push(a),this._addReference(a,t)}a=d||a,!x||!a.isNew()&&y[a.id]||x.push(a),y[a.id]=!0}if(F){for(r=0,o=this.length;r<o;++r)y[(a=this.models[r]).cid]||w.push(a);w.length&&this.remove(w,t)}if(v.length||x&&x.length)if(p&&(c=!0),this.length+=v.length,null!=f)for(r=0,o=v.length;r<o;r++)this.models.splice(f+r,0,v[r]);else{x&&(this.models.length=0);var k=x||v;for(r=0,o=k.length;r<o;r++)this.models.push(k[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,o=v.length;r<o;r++)(a=v[r]).trigger("add",a,this,t);(c||x&&x.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},_(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof u)return e;(t=t?i.clone(t):{}).collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});i.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],function(e){f.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}});i.each(["groupBy","countBy","sortBy","indexBy"],function(e){f.prototype[e]=function(t,n){var r=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,r,n)}});var p=t.View=function(e){this.cid=i.uniqueId("view"),e||(e={}),i.extend(this,i.pick(e,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},m=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];i.extend(p.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var r=t.match(m),o=r[1],s=r[2];n=i.bind(n,this),o+=".delegateEvents"+this.cid,""===s?this.$el.on(o,n):this.$el.on(o,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,r){var o=y[e];i.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||T()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1),"PATCH"===s.type&&w&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=t.ajax(i.extend(s,r));return n.trigger("request",n,l,r),l};var w=!(void 0===window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),y={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var b=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,F=/(\(\?)?:\w+/g,x=/\*\w+/g,k=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(b.prototype,a,{initialize:function(){},route:function(e,n,r){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return t.history.route(e,function(i){var s=o._extractParameters(e,i);o.execute(r,s),o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),t.history.trigger("route",o,n,s)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(k,"\\$&").replace(C,"(?:$1)?").replace(F,function(e,t){return t?e:"([^/?]+)"}).replace(x,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),void 0!==window&&(this.location=window.location,this.history=window.history)},I=/^[#\/]|\s+$/g,K=/^\/+|\/+$/g,E=/msie [\w.]+/,V=/\/$/,S=/#.*$/;M.started=!1,i.extend(M.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(V,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(I,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,o=E.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);if(this.root=("/"+this.root+"/").replace(K,"/"),o&&this._wantsHashChange){var s=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(I,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),i.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(S,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new M;u.extend=f.extend=b.extend=p.extend=M.extend=function(e,t){var n,r=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,t);var o=function(){this.constructor=n};return o.prototype=r.prototype,n.prototype=new o,e&&i.extend(n.prototype,e),n.__super__=r.prototype,n};var T=function(){throw new Error('A "url" property or function must be specified')},_=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t}),CKFinder.define("CKFinder/Config",[],function(){"use strict";return{id:"",configPath:"config.js",language:"",languages:{az:1,bg:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,"de-ch":1,el:1,en:1,eo:1,es:1,"es-mx":1,et:1,eu:1,fa:1,fi:1,fr:1,gu:1,he:1,hi:1,hr:1,hu:1,it:1,ja:1,ko:1,ku:1,lt:1,lv:1,nb:1,nl:1,nn:1,no:1,pl:1,"pt-br":1,ro:1,ru:1,sk:1,sl:1,sr:1,sv:1,tr:1,uk:1,"uz-cyrl":1,"uz-latn":1,vi:1,"zh-cn":1,"zh-tw":1},defaultLanguage:"en",removeModules:"",plugins:"",tabIndex:0,resourceType:null,type:null,startupPath:"",startupFolderExpanded:!0,readOnly:!1,readOnlyExclude:"",connectorPath:"",connectorLanguage:"php",pass:"",connectorInfo:"",dialogMinWidth:"18em",dialogMinHeight:"4em",dialogFocusItem:!0,dialogOverlaySwatch:!1,loaderOverlaySwatch:!1,width:"100%",height:400,fileIcons:{default:"unknown.png",folder:"directory.png","7z":"7z.png",accdb:"access.png",avi:"video.png",bmp:"image.png",css:"css.png",csv:"csv.png",doc:"msword.png",docx:"msword.png",flac:"audio.png",gif:"image.png",gz:"tar.png",htm:"html.png",html:"html.png",jpeg:"image.png",jpg:"image.png",js:"javascript.png",log:"log.png",mp3:"audio.png",mp4:"video.png",odg:"draw.png",odp:"impress.png",ods:"calc.png",odt:"writer.png",ogg:"audio.png",opus:"audio.png",pdf:"pdf.png",php:"php.png",png:"image.png",ppt:"powerpoint.png",pptx:"powerpoint.png",rar:"rar.png",README:"readme.png",rtf:"rtf.png",sql:"sql.png",tar:"tar.png",tiff:"image.png",txt:"plain.png",wav:"audio.png",weba:"audio.png",webm:"video.png",xls:"excel.png",xlsx:"excel.png",zip:"zip.png"},fileIconsPath:"skins/core/file-icons/",fileIconsSizes:"256,128,64,48,32,22,16",defaultDisplayFileName:!0,defaultDisplayDate:!0,defaultDisplayFileSize:!0,defaultViewType:"thumbnails",defaultSortBy:"name",defaultSortByOrder:"asc",listViewIconSize:22,compactViewIconSize:22,thumbnailDelay:50,thumbnailDefaultSize:150,thumbnailMinSize:null,thumbnailMaxSize:null,thumbnailSizeStep:2,thumbnailClasses:{120:"small",180:"medium"},chooseFiles:!1,chooseFilesOnDblClick:!0,chooseFilesClosePopup:!0,resizeImages:!0,rememberLastFolder:!0,skin:"moono",swatch:"a",displayFoldersPanel:!0,jquery:"libs/jquery.js",jqueryMobile:"libs/jquery.mobile.js",jqueryMobileStructureCSS:"libs/jquery.mobile.structure.css",jqueryMobileIconsCSS:"",iconsCSS:"",themeCSS:"",coreCSS:"skins/core/ckfinder.css",primaryPanelWidth:"",secondaryPanelWidth:"",cors:!1,corsSelect:!1,editImageMode:"",editImageAdjustments:["brightness","contrast","exposure","saturation","sepia","sharpen"],editImagePresets:["clarity","herMajesty","nostalgia","pinhole","sunrise","vintage"],autoCloseHTML5Upload:5,uiModeThreshold:48}}),CKFinder.define("CKFinder/Event",[],function(){"use strict";function e(){}function t(e){var t=e.getPrivate&&e.getPrivate()||e._ev||(e._ev={});return t.events||(t.events={})}function i(e){this.name=e,this.listeners=[]}function n(e){var n=t(this);return n[e]||(n[e]=new i(e))}return i.prototype={getListenerIndex:function(e){for(var t=0,i=this.listeners;t<i.length;t++)if(i[t].fn===e)return t;return-1}},e.prototype={on:function(e,t,i,r,o){function s(n,o,s,l){var d={name:e,sender:this,finder:n,data:o,listenerData:r,stop:s,cancel:l,removeListener:a};return!1!==t.call(i,d)&&d.data}function a(){u.removeListener(e,t)}var l,d,c=n.call(this,e),u=this;if(c.getListenerIndex(t)<0){for(l=c.listeners,i||(i=this),isNaN(o)&&(o=10),s.fn=t,s.priority=o,d=l.length-1;d>=0;d--)if(l[d].priority<=o)return l.splice(d+1,0,s),{removeListener:a};l.unshift(s)}return{removeListener:a}},once:function(){var e=arguments[1];return arguments[1]=function(t){return t.removeListener(),e.apply(this,arguments)},this.on.apply(this,arguments)},fire:function(){var e=0,i=function(){e=1},n=0,r=function(){n=1};return function(o,s,a){var l,d,c,u,f=t(this)[o],h=e,g=n;if(e=0,n=0,f&&(c=f.listeners).length)for(c=c.slice(0),l=0;l<c.length;l++){if(f.errorProof)try{u=c[l].call(this,a,s,i,r)}catch(e){}else u=c[l].call(this,a,s,i,r);if(!1===u?n=1:void 0!==u&&(s=u),e||n)break}return d=!n&&(void 0===s||s),e=h,n=g,d}}(),fireOnce:function(e,i,n){var r=this.fire(e,i,n);return delete t(this)[e],r},removeListener:function(e,i){var n,r=t(this)[e];r&&((n=r.getListenerIndex(i))>=0&&r.listeners.splice(n,1))},removeAllListeners:function(){var e,i=t(this);for(e in i)delete i[e]},hasListeners:function(e){var i=t(this)[e];return i&&i.listeners.length>0}},e}),CKFinder.define("CKFinder/Util/Util",["underscore"],function(e){"use strict";return{url:function(e){return/^(http(s)?:)?\/\/.+/i.test(e)?e:CKFinder.require.toUrl(e)},asyncArrayTraverse:function(e,t,i){var n,r=0;i||(i=null),t=t.bind(i),(n=function(){for(var i,o=0,s=(new Date).getTime();;){if(!(i=e.item?e.item(r):e[r])||!1===t(i,r,e))return;if(r+=1,(o+=1)>=10&&(new Date).getTime()-s>50)return setTimeout(n,50)}}).call()},isPopup:function(){return window!==window.parent&&!!window.opener||window.isCKFinderPopup},isModal:function(){return window.parent.CKFinder&&window.parent.CKFinder.modal&&window.parent.CKFinder.modal("visible")},isWidget:function(){return window!==window.parent&&!window.opener},toGet:function(t){var i="";return e.forOwn(t,function(e,n){i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n])}),i.substring(1)},cssEntities:function(e){return e.replace(/\(/g,"&#92;&#40;").replace(/\)/g,"&#92;&#41;")},jsCssEntities:function(e){return e.replace(/\(/g,"%28").replace(/\)/g,"%29")},getUrlParams:function(){var e={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,n){e[i]=n}),e},parentFolder:function(e){return e.split("/").slice(0,-1).join("/")},isShortcut:function(t,i){var n=i.split("+"),r=!!t.ctrlKey||!!t.metaKey,o=!!t.altKey,s=!!t.shiftKey,a=r===!!e.contains(n,"ctrl"),l=o===!!e.contains(n,"alt"),d=s===!!e.contains(n,"shift");return a&&l&&d},randomString:function(e,t){t||(t="abcdefghijklmnopqrstuvwxyz0123456789");for(var i="",n=0;n<e;n++)i+=t.charAt(Math.floor(Math.random()*t.length));return i},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}}}),CKFinder.define("CKFinder/Util/Lang",["underscore","jquery","ckf_global"],function(e,t,i){"use strict";function n(e,t,n,o){e||(e=r.getSupportedLanguage(navigator.userLanguage||navigator.language,n)),n[t]||(t="en");var s,a="lang/"+t+".json";n[e]&&(s="lang/"+e+".json"),s||(s=a),i.require(["text!"+i.require.toUrl(s)+"?ver=i42irv"],function(t){o(e,JSON.parse(t))},function(){o(e)})}var r={loadPluginLang:function(t,n,r,o){var s,a=r.lang.split(",");if(e.indexOf(a,t)>=0)s=t;else{if(!(e.indexOf(a,n)>=0))return void o({});s=n}i.require(["text!"+i.require.toUrl(r.path)+"lang/"+s+".json"],function(e){var t;try{t=JSON.parse(e)}catch(e){t={}}o(t)},function(){o({})})},init:function(i){var r=new t.Deferred;return n(i.language,i.defaultLanguage,i.languages,function(t,i){if(i){var n=i;n.formatDate=function(){var e="['"+n.units.dateAmPm.join("','")+"']",t=n.units.dateFormat.replace(/dd|mm|yyyy|hh|HH|MM|aa|d|m|yy|h|H|M|a/g,function(t){return"',"+{d:"day.replace(/^0/,'')",dd:"day",m:"month.replace(/^0/,'')",mm:"month",yy:"year.substr(2)",yyyy:"year",H:"hour.replace(/^0/,'')",HH:"hour",h:"parseInt( hour ) === 0 && parseInt( minute ) === 0 ? '12' : ( ( hour <= 12 ? hour : ( ( hour - 12 ) + 100 ).toString().substr( 1 ) ).replace(/^0/,'') )",hh:"parseInt( hour ) === 0 && parseInt( minute ) === 0 ? '12' : ( ( hour <= 12 ? hour : ( ( hour - 12 ) + 100 ).toString().substr( 1 ) ) )",M:"minute.replace(/^0/,'')",MM:"minute",a:e+"[ hour < 12 ? 0 : 1 ].charAt(0)",aa:e+"[ hour < 12 ? 0 : 1 ]"}[t]+",'"});return t=(t="'"+t+"'").replace(/('',)|,''$/g,""),new Function("year","month","day","hour","minute","return ["+t+'].join("");')}(),n.formatDateString=function(t){return t=t||"",e.isNumber(t)&&(t=t.toString()),t.length<12?"":n.formatDate(t.substr(0,4),t.substr(4,2),t.substr(6,2),t.substr(8,2),t.substr(10,2))},n.formatFileSize=function(e){var t=1024,i=t*t,r=i*t;return e>=r?n.units.gb.replace("{size}",(e/r).toFixed(1)):e>=i?n.units.mb.replace("{size}",(e/i).toFixed(1)):e>=t?n.units.kb.replace("{size}",(e/t).toFixed(1)):"{size} B".replace("{size}",e)},n.formatTransfer=function(e){return n.units.sizePerSecond.replace("{size}",n.formatFileSize(parseInt(e)))},n.formatFilesCount=function(e){return n.files[1===e?"countOne":"countMany"].replace("{count}",e)},r.resolve(n)}else r.reject()}),r.promise()},getSupportedLanguage:function(e,t){if(!e)return!1;var i=e.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),n=i[1],r=i[2];return t[n+"-"+r]?n=n+"-"+r:t[n]||(n=!1),n}};return r}),CKFinder.define("CKFinder/Util/KeyCode",{up:38,down:40,left:37,right:39,backspace:8,tab:9,enter:13,space:32,escape:27,end:35,home:36,delete:46,menu:93,slash:191,a:65,r:82,u:85,f2:113,f5:116,f7:118,f8:119,f9:120,f10:121}),CKFinder.define("CKFinder/UI/UIHacks",["underscore","jquery","CKFinder/Util/KeyCode","ckf-jquery-mobile"],function(e,t,i){"use strict";function n(){e.forEach(["transition"],function(e){(function(e){var t=(document.body||document.documentElement).style;if("string"==typeof t[e])return!0;var i=["Moz","webkit","Webkit","Khtml","O","ms"];e=e.charAt(0).toUpperCase()+e.substr(1);for(var n=0;n<i.length;n++)if("string"==typeof t[i[n]+e])return!0;return!1})(e)&&t("body").addClass("ckf-feature-css-"+e)})}function r(e){var i=void 0===document.documentMode,n=window.chrome;i&&!n?t(window).on("focusin",function(t){t.target===window&&setTimeout(function(){e.fire("ui:focus",null,e)},s)}).on("focusout",function(t){t.target===window&&e.fire("ui:blur",null,e)}):window.addEventListener?(window.addEventListener("focus",function(){setTimeout(function(){e.fire("ui:focus",null,e)},s)},!1),window.addEventListener("blur",function(){e.fire("ui:blur",null,e)},!1)):(window.attachEvent("focus",function(){setTimeout(function(){e.fire("ui:focus",null,e)},s)}),window.attachEvent("blur",function(){e.fire("ui:blur",null,e)}))}function o(e,t,i){t&&e.removeClass("ckf-ui-mode-"+t),e.addClass("ckf-ui-mode-"+i)}var s=300;return{init:function(e){n(),r(e);var s=t("body");s.attr({"data-theme":e.config.swatch,role:"application"}),navigator.userAgent.toLowerCase().indexOf("trident/")>-1&&s.addClass("ckf-ie"),t("html").attr({dir:e.lang.dir,lang:e.lang.langCode}),"ltr"!==e.lang.dir&&s.addClass("ckf-rtl"),e.setHandler("ui:getMode",function(){var i,n,r=window.matchMedia?function(){return void 0===n&&(n="(max-width: "+e.config.uiModeThreshold+"em)"),window.matchMedia(n).matches}:function(){return void 0===i&&(i=parseFloat(t("body").css("font-size"))*e.config.uiModeThreshold),window.innerWidth<=i};return function(){return r.call(this)?"mobile":"desktop"}}());var a=e.request("ui:getMode");o(s,null,a),t(window).bind("throttledresize",function(){var t=e.request("ui:getMode"),i=a!==t;i&&(o(s,a,t),a=t),e.fire("ui:resize",{modeChanged:i,mode:a},e)});var l=t.event.special.swipe.start;t.event.special.swipe.start=function(e){var t=l(e);return t.ckfOrigin=e.originalEvent.type,t},t(window).bind("swipeleft",function(t){0!==t.swipestart.ckfOrigin.indexOf("mouse")&&e.fire("ui:swipeleft",{evt:t},e)}),t(window).bind("swiperight",function(t){0!==t.swipestart.ckfOrigin.indexOf("mouse")&&e.fire("ui:swiperight",{evt:t},e)}),e.setHandler("closePopup",function(){e.util.isPopup()?window.close():window.top&&window.top.CKFinder&&window.top.CKFinder.modal&&window.top.CKFinder.modal("close")}),t(document).on("selectstart","[draggable]",function(e){e.preventDefault(),e.dragDrop&&e.dragDrop()}),e.once("app:ready",function(e){e.finder.request("key:listen",{key:i.space}),e.finder.on("keydown:"+i.space,function(e){e.data.evt.preventDefault()})})}}}),CKFinder.define("CKFinder/Plugins/Plugin",["underscore","jquery","backbone"],function(e,t,i){"use strict";function n(){}return n.extend=i.Model.extend,e.extend(n.prototype,{addCss:function(e){t("<style>").text(e).appendTo("head")},init:function(){}}),n}),CKFinder.define("CKFinder/Plugins/Plugins",["underscore","jquery","backbone","CKFinder/Plugins/Plugin","CKFinder/Util/Lang"],function(e,t,i,n,r){"use strict";function o(e,t,i){function n(){t.init(e),e._plugins.add(t),i.loaded=!0,e.fire("plugin:ready",{plugin:t},e)}return t.path=e.util.parentFolder(i.url)+"/",t.lang?void r.loadPluginLang(e.lang.langCode,e.config.defaultLanguage,t,function(t){t.name&&t.values&&(e.lang[t.name]=t.values),n()}):void n()}return i.Collection.extend({load:function(t){function i(){var i=e.countBy(r,"loaded");i.undefined||(t.fire("plugin:allReady",null,t),i.false&&e.forEach(e.where(r,{loaded:!1}),function(e){t.fire("plugin:loadError",{configKey:e.config,url:e.url})}))}var r=[],s=t.config.plugins;return s.length<1?void t.fire("plugin:allReady",null,t):(e.isString(s)&&(s=s.split(",")),e.forEach(s,function(e){var t=e;-1===e.search("/")&&(t=CKFinder.require.toUrl("plugins/"+e+"/"+e+".js")),r.push({config:e,url:t,loaded:void 0})}),t.on("plugin:ready",function(){i()}),void e.forEach(r,function(e){CKFinder.require([e.url],function(i){var r=n.extend(i);o(t,new r,e)},function(){e.loaded=!1,i()})}))}})}),CKFinder.define("CKFinder/Modules/CsrfTokenManager/CsrfTokenManager",[],function(){"use strict";function e(){if(n)return n;var e=function(e){e=e.toLowerCase();for(var t=window.document.cookie.split(";"),i=0;i<t.length;i++){var n=t[i].split("="),r=decodeURIComponent(n[0].trim().toLowerCase()),o=n.length>1?n[1]:"";if(r===e)return decodeURIComponent(o)}return""}(t);return e.length!=i&&(e=function(e){var t="abcdefghijklmnopqrstuvwxyz0123456789",i=[],n="";if(window.crypto&&window.crypto.getRandomValues)i=new Uint8Array(e),window.crypto.getRandomValues(i);else for(var r=0;r<e;r++)i.push(Math.floor(256*Math.random()));for(var o=0;o<i.length;o++){var s=t.charAt(i[o]%t.length);n+=Math.random()>.5?s.toUpperCase():s}return n}(i),function(e,t){window.document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/"}(t,e)),e}var t="ckCsrfToken",i=40,n=null;return function(t){t.setHandler("csrf:getToken",e),t.setHandler("internal:csrf:setParentWindowToken",function(e){n=e.token})}}),CKFinder.define("CKFinder/Modules/Connector/Transport",["jquery","underscore"],function(e,t){"use strict";function i(e,t){this.url=e,this.config=t,this.onDone=n,this.onFail=n,this.request=null}var n=function(){};return i.prototype.done=function(e){this.onDone=e},i.prototype.fail=function(e){this.onFail=e},i.prototype.send=function(){window.XMLHttpRequest?function(i){var n,r;r=null,(n=new XMLHttpRequest).open(i.config.type,i.url,!0),n.onreadystatechange=function(){4===this.readyState&&i.onDone(this.responseText)},n.onerror=function(){i.onFail()},t.isFunction(i.config.uploadProgress)&&n.upload&&(n.upload.onprogress=i.config.uploadProgress),t.isFunction(i.config.uploadEnd)&&n.upload&&(n.upload.onload=i.config.uploadEnd),"post"===i.config.type&&(r=e.param(t.extend(i.config.post)),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),n.send(r),i.request=n}(this):function(t){var i,r;i=new XDomainRequest,r=null,"post"===t.config.type&&(r=e.param(t.config.post)),i.open(t.config.type,t.url),i.onload=function(){t.onDone(this.responseText)},i.onprogress=n,i.ontimeout=n,i.onerror=function(){t.onFail()},t.request=i,setTimeout(function(){i.send(r)},0)}(this)},i.prototype.abort=function(){this.request&&this.request.abort()},i}),CKFinder.define("CKFinder/Modules/Connector/Connector",["underscore","jquery","ckf_global","CKFinder/Modules/Connector/Transport"],function(e,t,i,n){"use strict";function r(t,i,n){var r=this.finder,o=r.config,s={command:t,lang:r.lang.langCode},a=o.connectorInfo;if(n&&(s.type=n.get("resourceType"),s.currentFolder=n.getPath(),s.hash=n.getHash()),o.pass.length){var l=o.pass.split(",");e.forEach(l,function(e){s[e]=r.config[e]})}o.id&&(s.id=o.id);var d=this.baseUrl+"?"+r.util.toGet(e.extend(s,i));return a.length>0&&(d+="&"+a),d}function o(i){var o=this.finder,a=i.name,l=t.Deferred(),d={name:a,response:{error:{number:109}}};if(e.has(i,"context")&&(d.context=i.context),o.fire("command:before",i,o)&&o.fire("command:before:"+a,i,o)){var c=e.extend({type:"get",post:{}},i),u={};u.type=c.type,"post"===c.type&&(c.post.ckCsrfToken=o.request("csrf:getToken"),u.post=c.sendPostAsJson?{jsonData:JSON.stringify(c.post)}:c.post),c.uploadProgress&&(u.uploadProgress=c.uploadProgress),c.uploadEnd&&(u.uploadEnd=c.uploadEnd);var f=r.call(this,a,i.params,i.folder),h=new n(f,u);return h.done(function(t){var n,r,c=!1;try{r=JSON.parse(t),n={name:a,response:r,rawResponse:t},c=!0}catch(e){var u=d;return u.response.error.message=t,s(a,u,o),void l.reject(u)}c&&l.resolve(r),e.has(i,"context")&&(n.context=i.context),!r||r.error?o.fire("command:error:"+a,n,o)&&(i.context&&i.context.silentConnectorErrors||o.fire("command:error",n,o)):o.fire("command:ok:"+a,n,o),o.fire("command:after",n,o),o.fire("command:after:"+a,n,o)}),h.fail(function(){s(a,d,o),l.reject(d)}),h.send(),i.returnTransport?h:l.promise()}}function s(e,t,i){i.fire("command:error:"+e,t,i)&&i.fire("command:error",t,i),i.fire("command:after",t,i),i.fire("command:after:"+e,t,i)}return function(e){function t(e){if(/^(http(s)?:)?\/\/.+/i.test(e))return e;0!==e.indexOf("/")&&(e="/"+e);var t=window.parent?window.parent.location:window.location;return t.protocol+"//"+t.host+e}var n=e.config;this.finder=e,this.config=n,n.connectorPath?this.baseUrl=t(n.connectorPath):(this.baseUrl=i._connectors[i.connector],"/"!==this.baseUrl.charAt(0)&&(this.baseUrl=i.require.toUrl("./"+this.baseUrl)),this.baseUrl=t(this.baseUrl)),e.setHandlers({"command:send":{callback:o,context:this},"command:url":{callback:function(e){return r.call(this,e.command,e.params,e.folder)},context:this}})}}),function(e,t){if("function"==typeof CKFinder.define&&CKFinder.define.amd)CKFinder.define("marionette",["backbone","underscore"],function(i,n){return e.Marionette=e.Mn=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";!function(e,t){var i=e.ChildViewContainer;e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===i)return delete this._indexByCustom[t],!0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});return t.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"],function(e){i.prototype[e]=function(){var i=[t.values(this._views)].concat(t.toArray(arguments));return t[e].apply(t,i)}}),i}(0,t),e.ChildViewContainer.VERSION="0.1.11",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};e.Wreqr.VERSION="1.3.6",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){this.getCommands(e).instances.push(t)},clearCommands:function(e){this.getCommands(e).instances=[]}}),i}(),n.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var i=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,i):this.storage.addCommand(e,i)},_executeCommands:function(e,i,n){var r=this.storage.getCommands(e);t.each(r.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n,t),n.RequestResponse=function(e,t){return n.Handlers.extend({request:function(e){if(this.hasHandler(e))return this.getHandler(e).apply(this,t.rest(arguments))}})}(0,t),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(i){var n=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var r="vent"===e?"on":"setHandler";t.each(i,function(i,o){this[e][r](o,t.bind(i,n))},this)}}}),n}(),n.radio=function(e,t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,i,n){return function(r){var o=e._getChannel(r)[i];return o[n].apply(o,t.rest(arguments))}};return new i}(n,t),e.Wreqr}(t,i);var n=e.Marionette,r=e.Mn,o=t.Marionette={};o.VERSION="2.4.7",o.noConflict=function(){return e.Marionette=n,e.Mn=r,this},t.Marionette=o,o.Deferred=t.$.Deferred,o.extend=t.Model.extend,o.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},o.mergeOptions=function(e,t){e&&i.extend(this,i.pick(e,t))},o.getOption=function(e,t){if(e&&t)return e.options&&void 0!==e.options[t]?e.options[t]:e[t]},o.proxyGetOption=function(e){return o.getOption(this,e)},o._getValue=function(e,t,n){return i.isFunction(e)&&(e=n?e.apply(t,n):e.call(t)),e},o.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},o.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},o.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){return e[o.normalizeUIString(n,t)]=i,e},{})},o.normalizeUIValues=function(e,t,n){return i.each(e,function(r,s){i.isString(r)?e[s]=o.normalizeUIString(r,t):i.isObject(r)&&i.isArray(n)&&(i.extend(r,o.normalizeUIValues(i.pick(r,n),t)),i.each(n,function(e){var n=r[e];i.isString(n)&&(r[e]=o.normalizeUIString(n,t))}))}),e},o.actAsCollection=function(e,t){i.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(n){e[n]=function(){var e=[i.values(i.result(this,t))].concat(i.toArray(arguments));return i[n].apply(i,e)}})};var s=o.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._console="undefined"!=typeof console?console:{},s._warn=function(){return(s._console.warn||s._console.log||function(){}).apply(s._console,arguments)},s._cache={},o._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,r,o){var s=arguments.length<3;s&&(r=(o=r)[0]);var a,l=n["on"+r.replace(t,e)];return i.isFunction(l)&&(a=l.apply(n,s?i.rest(o):o)),i.isFunction(n.trigger)&&(s+o.length>1?n.trigger.apply(n,s?o:[r].concat(i.drop(o,0))):n.trigger(r)),a}}(),o.triggerMethod=function(e){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(e){return(i.isFunction(e.triggerMethod)?e.triggerMethod:o.triggerMethod).apply(e,i.rest(arguments))},o.MonitorDOMRefresh=function(e){function t(){e._isShown&&e._isRendered&&o.isNodeAttached(e.el)&&o.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:function(){e._isShown=!0,t()},render:function(){e._isRendered=!0,t()}}))},function(e){function t(t,n,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=t[i];if(!o)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,r,o)})}function n(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];e.stopListening(t,n,r)})}function o(e,t,i,n){e.stopListening(t,i,n)}function s(t,n,r,o,s){if(n&&r){if(!i.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),i.each(r,function(e,r){i.isFunction(e)?o(t,n,r,e):s(t,n,r,e)})}}e.bindEntityEvents=function(e,i,r){s(e,i,r,n,t)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,o,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o);var a=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(e,t){i.isObject(e)?e=(t=e).message:t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,a),i.pick(t,a)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption}),o.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,t.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),o.MonitorDOMRefresh(e);var n=t||{},r=e!==this.currentView,s=!!n.preventDestroy,a=!!n.forceShow,l=!!this.currentView,d=r&&!s,c=r||a;if(l&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&r&&delete this.currentView._parent,d?this.empty():l&&c&&this.currentView.off("destroy",this.empty,this),c){e.once("destroy",this.empty,this),e._parent=this,this._renderView(e),l&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),o.triggerMethodOn(e,"before:show",e,this,t),l&&this.triggerMethod("swapOut",this.currentView,this,t);var u=o.isNodeAttached(this.el),f=[],h=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return u&&h.triggerBeforeAttach&&(f=this._displayedViews(e),this._triggerAttach(f,"before:")),this.attachHtml(e),this.currentView=e,u&&h.triggerAttach&&(f=this._displayedViews(e),this._triggerAttach(f)),l&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),o.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){o.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,o._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=!!(e||{}).preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),i||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,i&&this.$el.contents().detach(),this):this},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,r=i.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new n(r)},_buildRegionFromRegionClass:function(e){return new e}}),o.RegionManager=o.Controller.extend({constructor:function(e){this._regions={},this.length=0,o.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=o._getValue(e,this,arguments),i.reduce(e,function(e,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[r]=this.addRegion(r,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof o.Region?t:o.Region.buildRegion(t,o.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new o.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,i){var n=t.$(e);if(!n.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return n.html()},compileTemplate:function(e,t){return i.template(e,t)}}),o.Renderer={render:function(e,t){if(!e)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(i.isFunction(e)?e:o.TemplateCache.get(e))(t)}},o.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=i.bind(this.render,this),e=o._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=o.Behaviors(this),t.View.call(this,this.options),o.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=o._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e,t){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return o.normalizeUIValues(e,r||n,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=o._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),l=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,a,l),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.defaults({},e,{preventDefault:!0,stopPropagation:!0}),n=i.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,i)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=o._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=o._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;n<r;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var n=this._parentLayoutView();if(n){var r=o.getOption(n,"childViewEventPrefix")+":"+e,s=[this].concat(t);o._triggerMethod(n,r,s);var a=o.getOption(n,"childEvents");a=o._getValue(a,n);var l=n.normalizeMethods(a);l&&i.isFunction(l[e])&&l[e].apply(n,s)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof o.LayoutView)return e;e=e._parent}},normalizeMethods:o.normalizeMethods,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(!1!==e){if(!e)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=o.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&o.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,n){var r=i.drop(arguments,3);i.each(e,function(e){o.triggerMethodOn.apply(e,[e,n,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,n){var r=void 0!==n.at&&(n.index||t.indexOf(e));if((this.getOption("filter")||!1===r)&&(r=i.indexOf(this._filteredSortedModels(r),e)),this._shouldAddChild(e,r)){this.destroyEmptyView();var o=this.getChildView(e);this.addChild(e,o,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){o.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){o.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels();if(!t.length&&this._showingEmptyView)return this;if(i.some(t,function(t){return!e.findByModel(t)}))this.render();else{var n=i.map(t,function(t,i){var n=e.findByModel(t);return n._index=i,n.el}),r=e.filter(function(e){return!i.contains(n,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(n),i.each(r,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){o.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels();i.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();i.each(t,function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},_filteredSortedModels:function(e){var t,n=this.getViewComparator(),r=this.collection.models;(e=Math.min(Math.max(e,0),r.length-1),n)&&(e&&(t=r[e],r=r.slice(0,e).concat(r.slice(e+1))),r=this._sortModelsBy(r,n),t&&r.splice(e,0,t));return this.getOption("filter")&&(r=i.filter(r,function(e,t){return this._shouldAddChild(e,t)},this)),r},_sortModelsBy:function(e,t){return"string"==typeof t?i.sortBy(e,function(e){return e.get(t)},this):1===t.length?i.sortBy(e,t,this):e.sort(i.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n,r=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(s)&&(s=s.call(this,e,this._emptyViewIndex));var a=this.buildChildView(e,t,s);a._parent=this,this.proxyChildEvents(a),a.once("render",function(){this._isShown&&o.triggerMethodOn(a,"before:show",a),r&&this._triggerBeforeAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(a),this.renderChildView(a,this._emptyViewIndex),r&&this._triggerAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"attach")),this._isShown&&o.triggerMethodOn(a,"show",a)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,i){this.getOption("sort")&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var r=new t(i.extend({model:e},n));return o.MonitorDOMRefresh(r),r},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return i.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i;return this.getOption("sort")&&t<this.children.length-1&&(i=this.children.find(function(e){return e._index===t+1})),!!i&&(i.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(t.checkEmpty)||(n=t.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),void 0!==o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(i.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){return this.getOption("childView")||this.constructor},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){this.getChildViewContainer(e).append(t)},_insertAfter:function(e){this.getChildViewContainer(this,e).append(e.el)},_appendReorderedChildren:function(e){this.getChildViewContainer(this).append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var i,n=o.getOption(e,"childViewContainer");if(n){var r=o._getValue(n,e);if((i="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r)).length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(!0===this.getOption("destroyImmediate")&&this.$el.remove(),this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t,n){var r=this.getRegion(e);return r.show.apply(r,i.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=o._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=o._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),this.ui=i.extend({},i.result(t,"ui"),i.result(this,"ui")),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),o.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(s)),n):{}}function n(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){return new n(this,t).buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={};return t.each(n,function(i,n){var a={},l=t.clone(t.result(i,"events"))||{};l=e.normalizeUIKeys(l,r(i));var d=0;t.each(l,function(e,r){var s=r.match(o),l=s[1]+"."+[this.cid,n,d++," "].join("")+s[2],c=t.isFunction(e)?e:i[e];c&&(a[l]=t.bind(c,i))},this),s=t.extend(s,a)},this),s}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var o=new(i.getBehaviorClass(n,r))(n,e),s=i.parseBehaviors(e,t.result(o,"behaviors"));return[o].concat(s)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(s[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=t.clone(t.result(i,"triggers"))||{};o=e.normalizeUIKeys(o,r(i)),t.each(o,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var r=e[n];if(!r)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(r,e))},mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),o.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=o.Module.getClass(t),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=o.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var r=e,o=i.drop(arguments,3),s=(t=t.split(".")).length,a=[];return a[s-1]=n,i.each(t,function(t,i){var s=r;r=this._getModule(s,t,e,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(e,t,n,r,o){var s=i.extend({},r),a=this.getClass(r),l=e[t];return l||(l=new a(t,n,s),e[t]=l,e.submodules[t]=l),l},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,o)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,!!i.isUndefined(n)||n):!i.isObject(e)||(n=e.startWithParent,!!i.isUndefined(n)||n)},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o}),CKFinder.define("CKFinder/Views/Base/Common",["underscore","marionette"],function(e,t){"use strict";return{proto:{getTemplate:function(){var e=t.getOption(this,"template"),i=t.getOption(this,"imports"),n=this.name;return this.finder.templateCache.has(n)?this.finder.templateCache.get(n):this.finder.templateCache.compile(n,e,i)},mixinTemplateHelpers:function(i){i=i||{};var n=this.getOption("templateHelpers");return n=t._getValue(n,this),e.extend(i,{lang:this.finder.lang,config:this.finder.config},n)}},util:{construct:function(e){if(!this.name){if(!e.name)throw"name parameter must be specified";this.name=e.name}if(!this.finder){if(!e.finder)throw"Finder parameter must be specified for view: "+this.name;this.finder=e.finder}this.finder.fire("view:"+this.name,{view:this},this.finder)}}}}),CKFinder.define("CKFinder/Views/Base/CompositeView",["underscore","marionette","CKFinder/Views/Base/Common"],function(e,t,i){"use strict";var n=t.CompositeView;return n.extend(i.proto).extend({constructor:function(e){i.util.construct.call(this,e),n.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))},buildChildView:function(t,i,n){return new i(e.extend({model:t,finder:this.finder},n))},attachBuffer:function(e,t){this.getChildViewContainer(e).append(t),this.triggerMethod("attachBuffer")}})}),CKFinder.define("CKFinder/Views/Base/ItemView",["marionette","CKFinder/Views/Base/Common"],function(e,t){"use strict";var i=e.ItemView;return i.extend(t.proto).extend({constructor:function(e){t.util.construct.call(this,e),i.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))}})}),CKFinder.define("text",["module"],function(e){"use strict";function t(e,t){return void 0===e||""===e?t:e}function i(e,i,n,r){if(i===r)return!0;if(e===n){if("http"===e)return t(i,"80")===t(r,"80");if("https"===e)return t(i,"443")===t(r,"443")}return!1}var n,r,o,s,a,l=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,f=u&&location.protocol&&location.protocol.replace(/\:/,""),h=u&&location.hostname,g=u&&(location.port||void 0),p={},m=e.config&&e.config()||{};return n={version:"2.0.15",strip:function(e){if(e){var t=(e=e.replace(d,"")).match(c);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=l[t];try{e=new ActiveXObject(i)}catch(e){}if(e){l=[i];break}}return e},parseName:function(e){var t,i,n,r=!1,o=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),i=e.substring(o+1)):t=e,-1!==(o=(n=i||t).indexOf("!"))&&(r="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:t=n),{moduleName:t,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,o){var s,a,l,d=n.xdRegExp.exec(e);return!d||(s=d[2],l=(a=(a=d[3]).split(":"))[1],a=a[0],(!s||s===t)&&(!a||a.toLowerCase()===r.toLowerCase())&&(!l&&!a||i(s,l,t,o)))},finishLoad:function(e,t,i,r){i=t?n.strip(i):i,m.isBuild&&(p[e]=i),r(i)},load:function(e,t,i,r){if(!r||!r.isBuild||r.inlineText){m.isBuild=r&&r.isBuild;var o=n.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),a=t.toUrl(s),l=m.useXhr||n.useXhr;return 0===a.indexOf("empty:")?void i():void(!u||l(a,f,h,g)?n.get(a,function(t){n.finishLoad(e,o.strip,t,i)},function(e){i.error&&i.error(e)}):t([s],function(e){n.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)}))}i()},write:function(e,t,i,r){if(p.hasOwnProperty(t)){var o=n.jsEscape(p[t]);i.asModule(e+"!"+t,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,t,i,r,o){var s=n.parseName(t),a=s.ext?"."+s.ext:"",l=s.moduleName+a,d=i.toUrl(s.moduleName+a)+".js";n.load(l,i,function(t){var i=function(e){return r(d,e)};i.asModule=function(e,t){return r.asModule(e,d,t)},n.write(e,l,i,o)},o)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(r=require.nodeRequire("fs"),n.get=function(e,t,i){try{var n=r.readFileSync(e,"utf8");"\ufeff"===n[0]&&(n=n.substring(1)),t(n)}catch(e){i&&i(e)}}):"xhr"===m.env||!m.env&&n.createXhr()?n.get=function(e,t,i,r){var o,s=n.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);m.onXhr&&m.onXhr(s,e),s.onreadystatechange=function(n){var r,o;4===s.readyState&&((r=s.status||0)>399&&r<600?((o=new Error(e+" HTTP status: "+r)).xhr=s,i&&i(o)):t(s.responseText),m.onXhrComplete&&m.onXhrComplete(s,e))},s.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?n.get=function(e,t){var i,n,r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),a="";try{for(i=new java.lang.StringBuffer,(n=s.readLine())&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=s.readLine());)i.append(o),i.append(n);a=String(i.toString())}finally{s.close()}t(a)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,s=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in o,n.get=function(e,t){var i,n,r,l={};a&&(e=e.replace(/\//g,"\\")),r=new FileUtils.File(e);try{(i=o["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream)).init(r,1,0,!1),(n=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream)).init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),n.readString(i.available(),l),n.close(),i.close(),t(l.value)}catch(e){throw new Error((r&&r.path||"")+": "+e)}}),n}),CKFinder.define("text!CKFinder/Templates/ContextMenu/ContextMenuItem.dot",[],function(){return'{{? it.divider }}{{??}}\n\t<a tabindex="-1" class="ui-btn {{? !it.isActive }}ui-state-disabled {{?}}{{? it.icon }}ui-btn-icon-{{? it.lang.dir === \'ltr\' }}left{{??}}right{{?}} ui-icon-{{= it.icon }}{{?}}" {{? !it.isActive }}aria-disabled="true"{{?}} data-ckf-name="{{= it.name }}" {{? it.linkAttributes }}{{~ it.linkAttributes :attribute}}{{=attribute.name}}="{{=attribute.value}}"{{~}}{{?}}>\n\t\t{{= it.label }}\n\t</a>\n{{?}}\n'}),CKFinder.define("CKFinder/Modules/ContextMenu/Views/ContextMenuView",["underscore","jquery","CKFinder/Views/Base/CompositeView","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/ContextMenu/ContextMenuItem.dot","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";return i.extend({name:"ContextMenu",template:"<ul></ul>",childViewContainer:"ul",emptyView:n.extend({name:"ContextMenuEmpty",template:'<div class="ckf-message"></div>'}),initialize:function(i){function n(t){var n=t.model.get("action"),r=t.evt;e.isFunction(n)&&(r.stopPropagation(),r.preventDefault(),n(i.forView)),setTimeout(function(){s.destroy()},10)}function r(e){!s||s.$el.find(e.target).length||s.isDestroyed||s.destroy()}var s=this,a=t(document),l="mousedown contextmenu",d=i.position,c=i.positionToEl;if(!d&&c){var u=c.get(0).getBoundingClientRect();d={x:u.left+c.width()/2,y:u.top+c.height()/2}}s.$el.attr("data-theme",s.finder.config.swatch),s.on("destroy",function(){a.off(l,r),s.$el.length&&s.$el.remove()}),s.on("render",function(){s.$el.find("ul").listview(),t(".ui-popup-container").remove(),s.$el.popup().popup("open"),s.$el.find(".ui-btn:first").focus(),d&&d.x&&d.y&&s.$el.popup("reposition",function(e,t){var i=e.x,n=e.y,r=t.height(),o=t.width();return{x:parseInt(i+(window.innerWidth<i+o?-1:1)*o/2,10),y:parseInt(n+(window.innerHeight<n+r?-1:1)*r/2+document.body.scrollTop,10)}}(d,s.$el)),setTimeout(function(){a.one(l,r)},0)}),s.on("childview:itemclicked",function(e,t){s.destroy(),n(t)}),s.on("childview:itemkeydown",function(t,i){var r,a,l=i.evt;l.keyCode===o.up&&(l.stopPropagation(),l.preventDefault(),(r=s.$el.find("a").not(".ui-state-disabled"))[(a=e.indexOf(r,t.$el.find("a").get(0))-1)>=0?a:r.length-1].focus()),l.keyCode===o.down&&(l.stopPropagation(),l.preventDefault(),(r=s.$el.find("a").not(".ui-state-disabled"))[(a=e.indexOf(r,t.$el.find("a").get(0))+1)<=r.length-1?a:0].focus()),l.keyCode!==o.enter&&l.keyCode!==o.space||(s.destroy(),t.model.get("isActive")&&n(i)),l.keyCode===o.escape&&(l.stopPropagation(),l.preventDefault(),s.destroy())})},getChildView:function(e){var t={contextmenu:function(e){e.preventDefault(),e.stopPropagation()}};e.get("divider")||(t["click a"]=function(e){this.trigger("itemclicked",{evt:e,view:this,model:this.model})},t["keydown a"]=function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})});var i={name:"ContextMenuItem",finder:this.finder,template:r,events:t,tagName:"li",modelEvents:{"change:active":"render"}};return e.get("divider")&&(i.attributes={"data-role":"list-divider"}),n.extend(i)}})}),CKFinder.define("CKFinder/Modules/ContextMenu/ContextMenu",["underscore","backbone","CKFinder/Modules/ContextMenu/Views/ContextMenuView"],function(e,t,i){"use strict";function n(e){var n=this,r=n.finder,o=new t.Collection,s={groups:o,context:e.context};if(r.fire("contextMenu",s,r)&&r.fire("contextMenu:"+e.name,s,r)){o.forEach(function(i){var n=new t.Collection;r.fire("contextMenu:"+e.name+":"+i.get("name"),{items:n,context:e.context},r),i.set("items",n)});var a=new t.Collection;o.forEach(function(e){var t=e.get("items");t.length&&(a.length&&a.add({divider:!0}),a.add(t.models))}),n.lastView&&n.lastView.destroy();var l=!(!e.evt||!e.evt.clientX)&&{x:e.evt.clientX,y:e.evt.clientY},d=e.positionToEl?e.positionToEl:null;r.request("focus:remember"),n.lastView=new i({finder:r,className:"ckf-contextmenu",collection:a,position:l,positionToEl:d,forView:e.view}),n.lastView.on("destroy",function(){r.request("focus:restore")}),n.lastView.render()}}return function(e){function t(){i.lastView&&i.lastView.destroy()}this.finder=e,e.setHandler("contextMenu",n,this);var i=this;e.on("ui:blur",t),e.on("ui:resize",t),e.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.showContextMenu,shortcuts:"{shift}+{f10}"})},null,null,50)}}),CKFinder.define("CKFinder/Models/FoldersCollection",["backbone","CKFinder/Models/Folder"],function(e,t){"use strict";return e.Collection.extend({model:t,initialize:function(){this.on("change:name",this.sort)},comparator:function(e,t){return e.get("name").localeCompare(t.get("name"))}})}),CKFinder.define("CKFinder/Models/Folder",["backbone","CKFinder/Models/FoldersCollection"],function(e,t){"use strict";return e.Model.extend({defaults:{name:"",hasChildren:!1,resourceType:"",isRoot:!1,parent:null,isPending:!1,"view:isFolder":!0},initialize:function(){function e(){o.set("hasChildren",!!o.get("children").length)}this.set("name",this.get("name").toString(),{silent:!0}),this.set("children",new t,{silent:!0});var i=this.get("children");i.on("change",e),i.on("remove",e),this.on("change:children",function(t,i){i&&(i.on("change",e),i.on("remove",e))});var n=this.get("allowedExtensions");n&&"string"==typeof n&&this.set("allowedExtensions",n.split(","),{silent:!0});var r=this.get("allowedExtensions");r&&"string"==typeof r&&this.set("allowedExtensions",n.split(","),{silent:!0});var o=this},getPath:function(e){var t,i;return i=(t=this.get("parent"))?t.getPath(e).toString()+this.get("name")+"/":"/",this.get("isRoot")&&e&&e.full&&(i=this.get("resourceType")+":"+i),i},getHash:function(){return this.has("hash")?this.get("hash"):this.get("parent").getHash()},getUrl:function(){if(this.has("url"))return this.get("url");var e=this.get("parent");if(!e)return!1;var t=e.getUrl();return t&&t+encodeURIComponent(this.get("name"))+"/"},isPath:function(e,t){return e===this.getPath()&&t===this.get("resourceType")},getResourceType:function(){for(var e=this;!e.get("isRoot");)e=e.get("parent");return e}},{isValidName:function(e){return!/[\\\/:\*\?"<>\|]/.test(e)}})}),CKFinder.define("text!CKFinder/Templates/Folders/FolderNameDialogTemplate.dot",[],function(){return'<form action="#">\n\t<label>\n\t\t{{! it.dialogMessage }}\n\t\t<input name="newFolderName" value="{{! it.folderName }}" tabindex="1" aria-required="true" dir="auto">\n\t</label>\n</form>\n<p class="error-message"></p>\n'}),CKFinder.define("CKFinder/Modules/Folders/Views/FolderNameDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/Folder","text!CKFinder/Templates/Folders/FolderNameDialogTemplate.dot"],function(e,t,i){"use strict";return e.extend({name:"FolderNameDialogView",template:i,ui:{error:".error-message",folderName:'input[name="newFolderName"]'},events:{"input @ui.folderName":function(){var e=this.ui.folderName.val().toString().trim();t.isValidName(e)?this.model.unset("error"):this.model.set("error",this.finder.lang.errors.folderInvalidCharacters),this.model.set("folderName",e)},submit:function(e){this.trigger("submit:form"),e.preventDefault()}},modelEvents:{"change:error":function(e,t){t?(this.ui.error.show(),this.ui.error.html(t)):this.ui.error.hide()}}})}),CKFinder.define("CKFinder/Modules/CreateFolder/CreateFolder",["backbone","CKFinder/Modules/Folders/Views/FolderNameDialogView"],function(e,t){"use strict";function i(e){var t=e.data.context.folder;e.finder.request("loader:hide"),e.data.response.error||(t.set("hasChildren",!0),e.finder.once("command:after:GetFolders",function e(i){i.data.context.parent.cid===t.cid&&(i.data.response.error||t.trigger("ui:expand"),i.finder.removeListener("command:after:GetFolders",e))}),e.finder.request("command:send",{name:"GetFolders",folder:t,context:{parent:t}},null,null,30))}return function(n){n.setHandler("folder:create",function(i){var r=i.parent,o=i.newFolderName;if(o)n.request("loader:show",{text:n.lang.common.pleaseWait}),n.request("command:send",{name:"CreateFolder",type:"post",folder:r,params:{newFolderName:o},context:{folder:r}});else{var s=new e.Model({dialogMessage:n.lang.folders.newNameLabel,folderName:i.newFolderName,error:!1}),a=n.request("dialog",{view:new t({finder:n,model:s}),name:"CreateFolder",title:n.lang.common.newNameDialogTitle,context:{parent:r}});s.on("change:error",function(e,t){t?a.disableButton("ok"):a.enableButton("ok")})}}),n.on("dialog:CreateFolder:ok",function(e){var t=e.data.view.model;if(!t.get("error")){var i=t.get("folderName");e.finder.request("dialog:destroy"),n.request("folder:create",{parent:e.data.context.parent,newFolderName:i})}}),n.on("contextMenu:folder:edit",function(e){var t=e.finder,i=e.data.context.folder;e.data.items.add({name:"CreateFolder",label:t.lang.folders.newSubfolder,isActive:i.get("acl").folderCreate,icon:"ckf-folder-add",action:function(){t.request("folder:create",{parent:i})}})}),n.on("toolbar:reset:Main:folder",function(e){var t=e.data.folder;t.get("acl").folderCreate&&e.data.toolbar.push({type:"button",name:"CreateFolder",priority:70,icon:"ckf-folder-add",label:e.finder.lang.folders.newSubfolder,action:function(){n.request("folder:create",{parent:t})}})}),n.on("command:after:CreateFolder",i)}}),CKFinder.define("text!CKFinder/Templates/DeleteFile/DeleteFileError.dot",[],function(){return"{{? it.msg }}<p>{{= it.msg }}</p>{{?}}\n<ul>\n{{~ it.errors :error }}<li>{{= error }}</li>{{~}}\n</ul>\n"}),CKFinder.define("CKFinder/Modules/DeleteFile/DeleteFile",["underscore","backbone","text!CKFinder/Templates/DeleteFile/DeleteFileError.dot","CKFinder/Util/KeyCode"],function(e,t,i,n){"use strict";function r(e){var t,i=this.finder,n=e.files; var n0 = null; if (n[0]) n0 = n[0]; else n0 = n.models[0]; return n0.get("folder").get("acl").fileDelete?(t=n.length>1?i.lang.files.deleteConfirmation.replace("{count}",n.length):i.lang.files.fileDeleteConfirmation.replace("{name}",function(){return i.util.escapeHtml(n[0].get("name"))}),void i.request("dialog:confirm",{name:"DeleteFileConfirm",msg:t,context:{files:n}})):void i.request("dialog:info",{msg:i.lang.errors.deleteFilePermissions})}function o(e){e.finder.request("folder:getActive").get("acl").fileDelete&&e.data.toolbar.push({type:"button",name:"DeleteFiles",priority:10,icon:"ckf-file-delete",label:e.finder.lang.common.delete,action:function(){e.finder.request("files:delete",{files:e.finder.request("files:getSelected").toArray()})}})}function s(e){var t=this.finder,i=t.request("files:getSelected"),n=i.length>1;e.data.items.add({name:"DeleteFiles",label:t.lang.common.delete,isActive:e.data.context.file.get("folder").get("acl").fileDelete,icon:"ckf-file-delete",action:function(){t.request("files:delete",{files:n?i:[e.data.context.file]})}})}function a(i){var n=i.data.context.files,r=[],o=i.finder;n instanceof t.Collection&&(n=n.toArray()),e.forEach(n,function(e){var t=e.get("folder");r.push({name:e.get("name"),type:t.get("resourceType"),folder:t.getPath()})});var s=o.request("folder:getActive");o.request("loader:show",{text:o.lang.common.pleaseWait}),o.request("command:send",{name:"DeleteFiles",type:"post",post:{files:r},sendPostAsJson:!0,folder:s,context:{files:n}})}function l(t){var i=t.data.response;t.finder.request("loader:hide"),i.error||(e.forEach(t.data.context.files,function(e){e.get("folder").get("children").remove(e)}),t.finder.fire("files:deleted",{files:t.data.context.files},t.finder))}function d(n){var r=n.data.response;if(r.error.number===c){n.cancel();var o=!!r.deleted,s=n.finder.lang.errors.codes[c],a=[];e.forEach(r.error.errors,function(e){a.push(e.name+": "+n.finder.lang.errors.codes[e.number]),117===e.number&&(o=!0)}),n.finder.request("dialog",{name:"DeleteFilesErrors",title:n.finder.lang.errors.operationCompleted,template:i,templateModel:new t.Model({deleted:r.deleted,errors:a,msg:s}),buttons:["okClose"]}),o&&n.finder.request("folder:refreshFiles")}}var c=302;return function(e){this.finder=e,e.setHandler("files:delete",r,this),e.on("dialog:DeleteFileConfirm:ok",a),e.on("command:after:DeleteFiles",l),e.on("command:error:DeleteFiles",d),e.on("contextMenu:file",function(e){e.data.groups.add({name:"delete"})},null,null,40),e.on("contextMenu:file:delete",s,this),e.on("toolbar:reset:Main:file",o),e.on("toolbar:reset:Main:files",o),function(e){e.on("file:keydown",function(t){if(t.data.evt.keyCode===n.delete&&e.util.isShortcut(t.data.evt,"")){var i=e.request("files:getSelected"),r=i.length>1?i.toArray():[t.data.file];e.request("files:delete",{files:r})}}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.delete,shortcuts:"{del}"})},null,null,30)}(e)}}),CKFinder.define("CKFinder/Modules/DeleteFolder/DeleteFolder",["CKFinder/Util/KeyCode"],function(e){"use strict";function t(t){t.on("folder:keydown",function(i){i.data.folder.get("isRoot")||i.data.evt.keyCode===e.delete&&i.finder.util.isShortcut(i.data.evt,"")&&(i.data.evt.preventDefault(),i.data.evt.stopPropagation(),t.request("folder:delete",{folder:i.data.folder}))}),t.on("shortcuts:list:folders",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.folders.delete,shortcuts:"{del}"})},null,null,30)}return function(e){e.on("dialog:DeleteFolderConfirm:ok",function(t){var i=t.data.context.folder;e.request("loader:show",{text:e.lang.common.pleaseWait}),e.request("command:send",{name:"DeleteFolder",type:"post",folder:i,context:{folder:i}},e)}),e.on("command:after:DeleteFolder",function(t){var i=t.data.response,n=t.data.context.folder;if(e.request("loader:hide"),!i.error){var r=n.get("parent");n.unset("parent"),r.get("children").remove(n),e.request("folder:getActive").cid===n.cid&&e.request("folder:select",{folder:r}),e.fire("folder:deleted",{folder:n})}}),e.on("toolbar:reset:Main:folder",function(t){var i=t.data.folder;!i.get("isRoot")&&i.get("acl").folderDelete&&t.data.toolbar.push({type:"button",name:"DeleteFolder",priority:20,icon:"ckf-folder-delete",label:t.finder.lang.common.delete,action:function(){e.request("folder:delete",{folder:i})}})}),e.on("contextMenu:folder",function(e){e.data.groups.add({name:"delete"})},null,null,20),e.on("contextMenu:folder:delete",function(e){var t=e.finder,i=e.data.context.folder,n=i.get("isRoot"),r=i.get("acl");e.data.items.add({name:"DeleteFolder",label:t.lang.common.delete,isActive:!n&&r.folderDelete,icon:"ckf-folder-delete",action:function(){t.request("folder:delete",{folder:i})}})}),e.setHandler("folder:delete",function(t){var i=t.folder;e.request("dialog:confirm",{name:"DeleteFolderConfirm",context:{folder:i},msg:e.lang.folders.deleteConfirmation.replace("{name}",function(){return e.util.escapeHtml(i.get("name"))})})}),t(e)}}),CKFinder.define("CKFinder/Views/Base/LayoutView",["marionette","CKFinder/Views/Base/Common"],function(e,t){"use strict";return e.LayoutView.extend(t.proto).extend({constructor:function(i){t.util.construct.call(this,i),e.LayoutView.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))}})}),CKFinder.define("CKFinder/Views/Base/CollectionView",["underscore","marionette","CKFinder/Views/Base/Common"],function(e,t,i){"use strict";var n=t.CollectionView;return n.extend(i.proto).extend({constructor:function(e){i.util.construct.call(this,e),n.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))},buildChildView:function(t,i,n){return new i(e.extend({model:t,finder:this.finder},n))}})}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogButtonView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";return t.extend({name:"DialogButton",tagName:"button",template:"{{= it.label }}",attributes:{tabindex:1},events:{click:function(){this.trigger("button")},keydown:function(t){t.keyCode!==e.enter&&t.keyCode!==e.space||(t.preventDefault(),this.trigger("button"))}},onRender:function(){this.$el.attr("data-inline",!0).attr("data-ckf-button",this.model.get("name"))}})}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogButtonsView",["underscore","backbone","CKFinder/Views/Base/CollectionView","CKFinder/Modules/Dialogs/Views/DialogButtonView"],function(e,t,i,n){"use strict";function r(i,n){var r=new t.Collection;return e.forEach(i,function(t){var i=e.isString(t)?t:t.name;r.push(e.extend({icons:{},label:i,name:i,event:i.toLocaleLowerCase()},e.isString(t)?n[i]:t))}),r}return i.extend({name:"DialogButtons",childView:n,initialize:function(e){this.collection=r(e.buttons,{ok:{label:this.finder.lang.common.ok,icons:{primary:"ui-icon-check"}},okClose:{label:this.finder.lang.common.ok,icons:{primary:"ui-icon-check"},event:"ok"},cancel:{label:this.finder.lang.common.cancel,icons:{primary:"ui-icon-close"}}})}})}),CKFinder.define("text!CKFinder/Templates/Dialogs/DialogLayout.dot",[],function(){return'{{? it.title }}<div data-role="header" class="ui-title"><h1>{{= it.title }}</h1></div>{{?}}\n<div id="ckf-dialog-contents-{{= it.id }}" class="ckf-dialog-contents {{= it.contentClassName }}"></div>\n{{? it.hasButtons }}<div class="ui-content ckf-dialog-buttons" id="ckf-dialog-buttons-{{= it.id }}"></div>{{?}}\n'}),CKFinder.define("CKFinder/Modules/Dialogs/Views/DialogView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Dialogs/Views/DialogButtonsView","text!CKFinder/Templates/Dialogs/DialogLayout.dot"],function(e,t,i,n,r,o){"use strict";return n.extend({template:o,className:"ckf-dialog",ui:{title:".ui-title:first"},attributes:{role:"dialog"},regions:function(e){return{contents:"#ckf-dialog-contents-"+e.id,buttons:"#ckf-dialog-buttons-"+e.id}},initialize:function(){this.listenTo(this.contents,"show",function(){this.$el.trigger("create")},this),t(".ui-popup-container").remove()},onRender:function(){var t="ckf-dialog-label-"+e.uniqueId();this.$el.attr("data-theme",this.finder.config.swatch).attr("aria-labelledby",t).attr("aria-describedby",this.regions.contents.replace("#","")).appendTo("body"),this.options.ariaLabelId&&this.$el.attr("aria-labelledby",this.$el.attr("aria-labelledby")+" "+this.regions.contents.replace("#","")),this.ui.title.attr({id:t,"aria-live":"polite"}),this.contents.show(this.getOption("innerView")),this._addButtons(),this.$el.trigger("create"),this.$el.popup(this._getUiConfig()),this.$el.parent().addClass("ui-dialog-popup");try{this.$el.popup("open",this.options.uiOpen||{})}catch(e){}this.$el.find('.ckf-dialog-buttons button[data-ckf-button="okClose"],.ckf-dialog-buttons button[data-ckf-button="ok"]').first().focus();var n=this.getOption("focusItem");if(n){var r=e.isString(n)?n:"input, textarea, select",o=this.$el.find(r).first();o.length&&o.focus()}return this.options.restrictHeight&&this.restrictHeight(),this.$el.on("keydown",function(e){e.keyCode!==i.tab&&e.stopPropagation()}),this},onDestroy:function(){try{this.$el.popup("close"),this.$el.off("keydown"),this.$el.remove()}catch(e){}},getButton:function(e){return this.$el.popup("widget").find('button[data-ckf-button="'+e+'"]')},enableButton:function(e){this.getButton(e).removeClass("ui-state-disabled").attr("aria-disabled","false")},disableButton:function(e){this.getButton(e).addClass("ui-state-disabled").attr("aria-disabled","true")},restrictHeight:function(){if(!this.isDestroyed){var e=t(window).height()-this.ui.title.outerHeight()-this.buttons.$el.outerHeight()-this.$el.parent().position().top-20;this.contents.$el.css("max-height",parseInt(e,10)+"px")}},_fixTopOffset:function(){var e=this.$el.parent().css("top"),t=parseInt(e)-(window.scrollY||window.pageYOffset);this.$el.parent().css("top",t)},_addButtons:function(){var e=this.getOption("buttons");if(e){var t=this,i=new r({finder:this.finder,buttons:e});this.listenTo(i,"childview:button",function(e){var i=e.model.get("event"),n=e.model.get("name");"cancel"!==n&&"okClose"!==n||t.destroy(),t.finder.fire("dialog:"+t.getOption("dialog")+":"+i,t.getOption("clickData"),t.finder)}),this.buttons.show(i)}},_getUiConfig:function(){function t(e,t,i){n[e]&&n[e].apply(t,i)}var i=this,n={},r=this.getOption("uiOptions");r&&e.forEach(["create","afterclose","beforeposition"],function(e){n[e]=r[e],delete r[e]});var o={create:function(){i.contents.$el.css({minWidth:i.getOption("minWidth"),minHeight:i.getOption("minHeight"),maxHeight:window.innerHeight}),t("create",this,arguments)},afterclose:function(){i.destroy(),i.finder.fire("dialog:close:"+i.getOption("dialog"),{context:i.context,me:i}),t("afterclose",this,arguments)},afteropen:function(){i._fixTopOffset(),t("afteropen",this,arguments)},beforeposition:function(e,n){r&&r.positionTo&&(delete n.x,delete n.y,n.positionTo=r.positionTo),setTimeout(function(){i.options.restrictHeight&&i.restrictHeight()},0),t("beforeposition",this,arguments)}},s=i.finder.config.dialogOverlaySwatch;return s&&(o.overlayTheme=e.isBoolean(s)?i.finder.config.swatch:s),e.extend(o,r)}})}),CKFinder.define("CKFinder/Views/MessageView",["underscore","backbone","CKFinder/Views/Base/ItemView"],function(e,t,i){"use strict";return i.extend({name:"MessageView",className:"ckf-message",template:'<span id="{{= it.id }}">{{= it.msg }}</span>',initialize:function(i){this.model=new t.Model({msg:i.msg,id:i.id?i.id:e.uniqueId()})}})}),CKFinder.define("CKFinder/Modules/Dialogs/Dialogs",["underscore","jquery","backbone","CKFinder/Util/KeyCode","CKFinder/Modules/Dialogs/Views/DialogView","CKFinder/Views/Base/ItemView","CKFinder/Views/MessageView"],function(e,t,i,n,r,o,s){"use strict";function a(t){var i=this.finder;if(f(),!t.name)throw"Name parameter must be specified for dialog";var n=!!e.isUndefined(t.captureFormSubmit)||t.captureFormSubmit,o=c(t,i,n),s=u(i,t,o),a=new r(s);return i.request("focus:remember"),a.on("destroy",function(){i.request("focus:restore")}),n&&a.listenTo(o,"submit:form",function(){return i.fire("dialog:"+t.name+":ok",s.clickData,i),!1}),a.render(),i.request("focus:trap",{node:a.$el}),a}function l(t){var i=e.uniqueId("ckf-message-"),n=e.extend({name:"Info",buttons:["okClose"],view:new s({msg:t.msg,finder:this.finder,id:i}),transition:"flip",ariaLabelId:i},t);return a.call(this,n)}function d(t){var i=e.uniqueId("ckf-message-"),n=e.extend({name:"Confirm",buttons:["okClose","cancel"],title:this.finder.lang.common.messageTitle,view:new s({msg:t.msg,finder:this.finder,id:i}),ariaLabelId:i},t);return a.call(this,n)}function c(e,t,i){var n;if(e.view)n=e.view;else{var r={name:e.name,finder:t,template:e.template};i&&(r.triggers={"submit form":{event:"submit:form",preventDefault:!0,stopPropagation:!1}}),n=new(o.extend(r))({model:e.templateModel})}return n}function u(t,n,r){var o={context:n.context,finder:t,name:"Dialog",dialog:n.name,id:e.uniqueId("ckf"),minWidth:n.minWidth?n.minWidth:t.config.dialogMinWidth,minHeight:n.minHeight?n.minHeight:t.config.dialogMinHeight,focusItem:e.isUndefined(n.focusItem)?t.config.dialogFocusItem:n.focusItem,buttons:e.isUndefined(n.buttons)?["ok","cancel"]:n.buttons,captureFormSubmit:!!e.isUndefined(n.captureFormSubmit)||n.captureFormSubmit,restrictHeight:!e.isUndefined(n.restrictHeight)&&n.restrictHeight,uiOptions:n.uiOptions};return n.ariaLabelId&&(o.ariaLabelId=n.ariaLabelId),o.model=new i.Model({id:o.id,title:n.title,hasButtons:!e.isUndefined(o.buttons),contentClassName:e.isUndefined(n.contentClassName)?" ui-content":!1===n.contentClassName?"":" "+n.contentClassName}),o.clickData={model:n.templateModel,view:r,context:n.context},o.innerView=r,o}function f(){t(".ckf-dialog").popup("close"),t(".ui-popup-container").remove()}return function(e){this.finder=e,e.setHandlers({dialog:{callback:a,context:this},"dialog:info":{callback:l,context:this},"dialog:confirm":{callback:d,context:this},"dialog:destroy":f}),e.request("key:listen",{key:n.escape}),e.on("keyup:27",function(e){var i;t(".ckf-dialog").length&&((i=e.data.evt).preventDefault(),i.stopPropagation(),f())},null,null,20)}}),CKFinder.define("text!CKFinder/Templates/EditImage/EditImageLayout.dot",[],function(){return'<div class="ckf-ei-wrapper">\n\t<div id="ckf-ei-preview" class="ckf-ei-preview"></div>\n\t<div id="ckf-ei-actions" class="ckf-ei-controls ui-body-{{= it.swatch }}"></div>\n</div>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/EditImageLayout",["CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/EditImage/EditImageLayout.dot"],function(e,t){"use strict";return e.extend({name:"EditImageLayout",template:t,regions:{preview:"#ckf-ei-preview",actions:"#ckf-ei-actions"},templateHelpers:function(){return{swatch:this.finder.config.swatch}},onActionsExpand:function(){this.preview.$el.addClass("ckf-ei-preview-reduced")},onActionsCollapse:function(){this.preview.$el.removeClass("ckf-ei-preview-reduced")}})}),CKFinder.define("text!CKFinder/Templates/EditImage/ImagePreview.dot",[],function(){return'<canvas class="ckf-ei-canvas"></canvas>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ImagePreviewView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/ImagePreview.dot"],function(e,t){"use strict";return e.extend({name:"ImagePreview",template:t,ui:{canvas:".ckf-ei-canvas"}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Action.dot",[],function(){return'<div data-role="collapsible" data-collapsed-icon="{{= it.icon}}" data-expanded-icon="{{= it.icon}}" data-iconpos="right" data-inset="false" tabindex="-1">\n    <h4 id="{{= it.id }}-tab" class="ckf-ei-action-title" role="tab" aria-controls="{{= it.id }}-tabpanel">{{= it.title }}</h4>\n    <div class="ckf-ei-action-controls"></div>\n</div>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ActionView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/EditImage/Action.dot"],function(e,t,i,n,r){"use strict";return n.extend({name:"ActionView",template:r,className:"ckf-ei-action",ui:{heading:".ckf-ei-action-title",controls:".ckf-ei-action-controls"},regions:{action:".ckf-ei-action-controls"},events:{collapsiblecollapse:function(){this.model.get("tool").trigger("collapse"),this.ui.heading.attr("aria-expanded","false").find(".ui-btn").removeClass("ui-btn-active"),this.trigger("collapse"),this.isExpanded=!1,this.ui.controls.find("[tabindex]").attr("tabindex","-1")},collapsibleexpand:function(){this.model.get("tool").trigger("expand"),this.ui.heading.attr("aria-expanded","true").find(".ui-btn").addClass("ui-btn-active"),this.trigger("expand"),this.isExpanded=!0,this.ui.controls.find("[tabindex]").attr("tabindex",this.model.get("tabindex"))},collapsiblecreate:function(){this.$el.find(".ui-collapsible-heading-toggle").attr("tabindex",this.model.get("tabindex")),this.ui.heading.attr("aria-expanded","false"),this.isExpanded=!1;var e=this.model.get("id");this.$el.find(".ui-collapsible-content").attr({id:e+"-tabpanel",role:"tabpanel","aria-labelledby":e+"-tab"})},"keydown .ui-collapsible-heading-toggle":function(e){if(e.keyCode===i.space||e.keyCode===i.enter){e.stopPropagation(),e.preventDefault();var t=this.$el.find(".ui-collapsible").collapsible("option","collapsed")?"expand":"collapse";this.$el.find(".ui-collapsible").collapsible(t)}},"keydown [tabindex]":function(e){e.keyCode===i.tab&&(!this.isExpanded&&e.target===this.ui.heading.find(".ui-collapsible-heading-toggle").get(0)||this.ui.controls.find("[tabindex]").last().get(0)===e.target)&&this.trigger("tabRequest",e)}},initialize:function(){this.model.set("id",e.uniqueId())},collapse:function(){this.$el.find(".ui-collapsible").collapsible("collapse")},onRender:function(){this.action.show(this.model.get("tool").getView(this.finder)),this.$el.attr("data-ckf-ei-tool",this.model.get("tool").get("name"))}})}),CKFinder.define("CKFinder/Modules/EditImage/Views/ActionsView",["jquery","CKFinder/Views/Base/CollectionView","CKFinder/Modules/EditImage/Views/ActionView"],function(e,t,i){"use strict";function n(t,i){var n="desktop"===t;e(".ckf-ei-controls .ui-collapsible-heading-toggle").toggleClass("ui-corner-all ui-btn-icon-notext",!n).toggleClass("ltr"===i.lang.dir?"ui-btn-icon-left":"right",n)}function r(e){e.data.modeChanged&&n(e.data.mode,e.finder)}return t.extend({name:"ActionsView",attributes:{"data-role":"collapsibleset",role:"tablist"},childView:i,childViewContainer:"#ckf-edit-image-actions",childEvents:{expand:function(e){this.children.forEach(function(t){t.cid===e.cid||t.ui.heading.hasClass("ui-collapsible-heading-collapsed")||t.collapse()})},tabRequest:function(e,t){this.finder.util.isShortcut(t,"")&&this.children.last()!==e&&this.finder.request("focus:next",{node:e.$el.find("[tabindex]").not('[tabindex="-1"]').last(),event:t})}},initialize:function(){var t=this.finder;this.collection.on("imageData:ready",function(){n(t.request("ui:getMode"),t),e.mobile.resetActivePageHeight()}),t.on("ui:resize",r)},onDestroy:function(){this.finder.removeListener("ui:resize",r)},focusFirst:function(){this.$el.find(".ui-collapsible-heading-toggle").first().focus()}})}),CKFinder.define("CKFinder/Modules/EditImage/Models/EditImageData",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{file:null,caman:null,imagePreview:"",fullImagePreview:"",actions:null},initialize:function(){this.set("actions",new e.Collection)}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/Tool",["backbone"],function(e){"use strict";return e.Model.extend({getActionData:function(){return new e.Model({})},saveDeferred:function(e,t){return t},getView:function(e){var t=new(this.get("viewClass"))({finder:e,model:this.getActionData()});return this.set("view",t),t}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Crop.dot",[],function(){return'<div class="ckf-ei-crop-controls-inputs">\n\t<label>\n\t\t{{= it.lang.editImage.keepAspectRatio }}\n\t\t<input name="ckfCropKeepAspectRatio" tabindex="{{= it.tabindex }}" type="checkbox"{{? it.keepAspectRatio }} checked="checked"{{?}} data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">\n\t</label>\n\t<button id="ckf-ei-crop-apply" tabindex="{{= it.tabindex }}" data-icon="ckf-tick" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.editImage.apply }}</button>\n</div>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/CropView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Crop.dot"],function(e,t,i){"use strict";return t.extend({name:"CropView",template:i,className:"ckf-ei-crop-controls",ui:{keepAspectRatio:'input[name="ckfCropKeepAspectRatio"]',apply:"#ckf-ei-crop-apply"},triggers:{"click @ui.apply":"apply"},events:{"change @ui.keepAspectRatio":function(e){e.stopPropagation(),e.preventDefault(),this.model.set("keepAspectRatio",this.ui.keepAspectRatio.is(":checked"))},"keyup @ui.keepAspectRatio":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||(t.preventDefault(),t.stopPropagation(),this.ui.keepAspectRatio.prop("checked",!this.ui.keepAspectRatio.is(":checked")).checkboxradio("refresh").trigger("change"))},"keydown @ui.apply":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||this.trigger("apply")}}})}),CKFinder.define("text!CKFinder/Templates/EditImage/CropBox.dot",[],function(){return'<div class="ckf-ei-crop">\n\t<div class="ckf-ei-crop-resize" tabindex="{{= it.tabindex + 1 }}"></div>\n\t<div class="ckf-ei-crop-info"></div>\n</div>'}),CKFinder.define("CKFinder/Modules/EditImage/Views/CropBoxView",["jquery","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/CropBox.dot"],function(e,t,i){"use strict";return t.extend({name:"CropBoxView",className:"ckf-ei-crop-wrap",template:i,ui:{cropBox:".ckf-ei-crop",cropResize:".ckf-ei-crop-resize",cropInfo:".ckf-ei-crop-info"},events:{"vmousedown @ui.cropBox":"onMouseDown","vmouseup @ui.cropBox":"onMouseUp","vmousedown @ui.cropResize":"onMouseDownOnResize","vmouseup @ui.cropResize":"onMouseUpOnResize"},modelEvents:{change:"updatePosition","change:keepAspectRatio":function(){if(this.model.get("keepAspectRatio")){var e=this.model.get("renderHeight"),t=this.model.get("maxRenderHeight"),i=this.model.get("maxRenderWidth"),n=t-this.model.get("renderY"),r=i-this.model.get("renderX");e>n&&(e=n);var o=parseInt(e*i/t,10);o>r&&(o=r,e=parseInt(o*t/i,10)),this.model.set({renderWidth:o,renderHeight:e})}}},onRender:function(){var e;e=this.model.get("canvas"),this.$el.css({width:this.model.get("maxRenderWidth"),height:this.model.get("maxRenderHeight")}),this.ui.cropBox.css({backgroundImage:"url("+e.toDataURL()+")",backgroundSize:this.model.get("maxRenderWidth")+"px "+this.model.get("maxRenderHeight")+"px"}),this.updatePosition()},onMouseDown:function(t){var i=this;t.stopPropagation(),e(window).on("vmousemove",{model:i.model,view:i,moveStart:{x:t.clientX-i.model.get("renderX"),y:t.clientY-i.model.get("renderY")}},i.mouseMove),e(window).one("vmouseup",function(){i.onMouseUp()})},onMouseUp:function(t){t&&t.stopPropagation(),e(window).off("vmousemove",this.mouseMove)},mouseMove:function(e){var t,i,n,r,o,s,a,l;t=e.data.model,i=e.data.view.ui.cropBox,n=e.clientX-e.data.moveStart.x,r=e.clientY-e.data.moveStart.y,o=i.outerWidth(),s=i.outerHeight(),n=(n=n<0?0:n)>(a=t.get("maxRenderWidth")-o)?a:n,r=(r=r<0?0:r)>(l=t.get("maxRenderHeight")-s)?l:r,t.set({renderX:n,renderY:r})},onMouseDownOnResize:function(t){var i=this;t.stopPropagation(),e(window).on("vmousemove",{model:i.model,view:i,moveStart:{x:t.clientX-i.model.get("renderWidth"),y:t.clientY-i.model.get("renderHeight")}},i.mouseResize),e(window).one("vmouseup",function(){i.onMouseUpOnResize()})},onMouseUpOnResize:function(){e(window).off("vmousemove",this.mouseResize)},mouseResize:function(e){var t,i,n,r,o,s;i=(t=e.data.model).get("minCrop"),n=e.clientX-e.data.moveStart.x,r=e.clientY-e.data.moveStart.y,o=t.get("maxRenderWidth")-t.get("renderX"),s=t.get("maxRenderHeight")-t.get("renderY"),r=r<i?i:r,n=n<i?i:n,t.get("keepAspectRatio")&&(n=parseInt(r*t.get("maxRenderWidth")/t.get("maxRenderHeight"),10)),n=n>o?o:n,r=r>s?s:r,t.set({renderWidth:n,renderHeight:r})},updatePosition:function(){var e=this.model.get("renderX"),t=this.model.get("renderY"),i=(this.ui.cropBox.outerWidth()-this.ui.cropBox.width())/2;this.ui.cropBox.css({top:t+"px",left:e+"px",width:this.model.get("renderWidth")-2*i+"px",height:this.model.get("renderHeight")-2*i+"px",backgroundPosition:-e-i+"px "+(-t-i)+"px"}),this.ui.cropInfo.text(this.model.get("width")+"x"+this.model.get("height")),this.ui.cropInfo.attr("data-ckf-position",this.model.get("x")+","+this.model.get("y"))}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/CropTool",["backbone","jquery","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/CropView","CKFinder/Modules/EditImage/Views/CropBoxView"],function(e,t,i,n,r){"use strict";return i.extend({defaults:{name:"Crop",viewClass:n,view:null,isVisible:!1},initialize:function(){function i(e){var t,i,n;n=e.get("renderWidth"),i=e.get("renderHeight"),t=e.get("imageWidth")/e.get("maxRenderWidth"),e.set("width",parseInt(n*t,10)),e.set("height",parseInt(i*t,10)),e.set("x",parseInt(e.get("renderX")*t,10)),e.set("y",parseInt(e.get("renderY")*t,10))}function n(){r.get("isVisible")&&(r.closeCropBox(),r.openCropBox())}this.viewModel=new e.Model({x:0,y:0,width:0,height:0,renderWidth:0,renderHeight:0,maxWidth:0,maxHeight:0,imageWidth:0,imageHeight:0,keepAspectRatio:!1,tabindex:this.get("tabindex")}),this.viewModel.on("change:renderWidth",i),this.viewModel.on("change:renderHeight",i),this.viewModel.on("change:renderX",i),this.viewModel.on("change:renderY",i),this.collection.on("imageData:ready",function(){var e,i,n,r,o,s;s=(e=this.get("editImageData")).get("caman").renderingCanvas,i=t(s).width(),n=t(s).height(),r=parseInt(i/2,10),o=parseInt(n/2,10),this.viewModel.set({canvas:e.get("caman").renderingCanvas,minCrop:10,x:e.get("imageWidth"),y:e.get("imageHeight"),renderX:parseInt((i-r)/2,10),renderY:parseInt((n-o)/2,10),width:e.get("imageWidth"),height:e.get("imageHeight"),renderWidth:r,renderHeight:o,maxRenderWidth:i,maxRenderHeight:n,imageWidth:e.get("imageInfo").width,imageHeight:e.get("imageInfo").height}),this.get("view").on("apply",function(){this.cropView()},this)},this),this.on("expand",this.openCropBox,this),this.on("collapse",this.closeCropBox,this);var r=this;this.collection.on("tool:reset:after",n),this.collection.on("ui:resize",n)},cropView:function(){var e=this.get("editImageData"),t=e.get("caman").renderingCanvas.width/this.viewModel.get("maxRenderWidth");e.get("caman").crop(parseInt(t*this.viewModel.get("renderWidth"),10),parseInt(t*this.viewModel.get("renderHeight"),10),parseInt(t*this.viewModel.get("renderX"),10),parseInt(t*this.viewModel.get("renderY"),10)),this.collection.requestThrottler();var i=!1;e.get("actions").forEach(function(e){"Rotate"===e.get("tool")&&(i=!i)}),t=(i?e.get("imageHeight"):e.get("imageWidth"))/this.viewModel.get("maxRenderWidth"),e.get("actions").push({tool:this.get("name"),data:{width:parseInt(t*this.viewModel.get("renderWidth"),10),height:parseInt(t*this.viewModel.get("renderHeight"),10),x:parseInt(t*this.viewModel.get("renderX"),10),y:parseInt(t*this.viewModel.get("renderY"),10)}}),this.closeCropBox()},openCropBox:function(){var e=this.get("editImageData").get("caman").renderingCanvas,i=t(e).width(),n=t(e).height(),o=parseInt(i/2,10),s=parseInt(n/2,10);this.viewModel.set({maxRenderWidth:i,maxRenderHeight:n,renderWidth:o,renderHeight:s,renderX:parseInt((i-o)/2,10),renderY:parseInt((n-s)/2,10)}),this.cropBox=new r({finder:this.collection.finder,model:this.viewModel}),this.cropBox.render().$el.appendTo(t(this.get("editImageData").get("caman").renderingCanvas).parent()),this.set("isVisible",!0)},closeCropBox:function(){this.cropBox&&this.cropBox.destroy(),this.set("isVisible",!1)},saveDeferred:function(e,i){var n,r;return r=(n=new t.Deferred).promise(),i.then(function(t){t.crop(e.width,e.height,e.x,e.y).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Rotate.dot",[],function(){return'<div class="ckf-ei-rotate-controls-inputs">\n\t<button id="ckf-ei-rotate-anticlockwise" tabindex="{{= it.tabindex }}" data-icon="ckf-rotate-left" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.editImage.rotateAntiClockwise }}</button>\n\t<button id="ckf-ei-rotate-clockwise" tabindex="{{= it.tabindex }}" data-icon="ckf-rotate-right" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.editImage.rotateClockwise }}</button>\n</div>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/RotateView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Rotate.dot"],function(e,t,i){"use strict";return t.extend({name:"RotateView",template:i,ui:{clockwise:"#ckf-ei-rotate-clockwise",antiClockwise:"#ckf-ei-rotate-anticlockwise"},events:{"click @ui.clockwise":"onClockwise","click @ui.antiClockwise":"onAntiClockwise","keydown @ui.clockwise":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||this.onClockwise()},"keydown @ui.antiClockwise":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||this.onAntiClockwise()}},onClockwise:function(){this.model.unset("lastRotationAngle",{silent:!0}),this.model.set("lastRotationAngle",90)},onAntiClockwise:function(){this.model.unset("lastRotationAngle",{silent:!0}),this.model.set("lastRotationAngle",-90)}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/RotateTool",["jquery","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/RotateView"],function(e,t,i,n){"use strict";return i.extend({defaults:{name:"Rotate",viewClass:n,view:null,rotationApplied:!1},initialize:function(){function e(){var e=i.get("editImageData").get("actions");e.remove(e.where({tool:i.get("name")})),i.viewModel.set("angle",0),i.viewModel.set("lastRotationAngle",0)}var i=this;this.viewModel=new t.Model({angle:0,lastRotationAngle:0,tabindex:this.get("tabindex")}),this.viewModel.on("change:lastRotationAngle",function(e,t){this.get("editImageData").get("actions").push({tool:this.get("name"),data:t}),this.set("rotationApplied",!1),this.collection.requestThrottler()},this),this.collection.on("throttle",function(e){this.get("rotationApplied")||(e.rotate(this.viewModel.get("lastRotationAngle")),e.render(),this.set("rotationApplied",!0))},this),this.collection.on("tool:reset:"+this.get("name"),e),this.collection.on("tool:reset:all",e)},saveDeferred:function(t,i){var n,r;return r=(n=new e.Deferred).promise(),i.then(function(e){e.rotate(t).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Adjust.dot",[],function(){return'{{~ it.filters: filter }}\n<div class="ckf-ei-filter">\n\t<label class="ckf-ei-filter-icon ui-btn ui-btn-icon-left ui-icon-{{= filter.icon }}" for="{{= filter.name }}">{{= filter.label }}</label>\n\t<input class="ckf-ei-filter-slider" name="{{= filter.name }}" id="{{= filter.name }}" min="{{= filter.config.min }}"\n\t\t   max="{{= filter.config.max }}" step="{{= filter.config.step }}" value="{{= filter.config.init }}" type="range"\n\t\t   data-filter="{{= filter.name }}" data-initial="{{= filter.config.init }}" tabindex="{{= it.tabindex }}">\n</div>\n{{~}}\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/AdjustView",["jquery","backbone","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Adjust.dot"],function(e,t,i,n){"use strict";return i.extend({isSliding:!1,applyFilterInterval:null,lastFilterEvent:null,name:"AdjustView",template:n,events:{"slidestart .ckf-ei-filter-slider":"onSlideStart","slidestop .ckf-ei-filter-slider":"onSlideStop","change .ckf-ei-filter-slider":"onFilter","keyup .ckf-ei-filter-slider":"onFilter"},initialize:function(){this.model.get("activeFilters").on("reset",function(){this.render()},this)},onSlideStart:function(){this.isSliding=!0},onSlideStop:function(e){this.isSliding=!1,this.applyFilters(e)},onRender:function(){this.$el.trigger("create")},onFilter:function(e){var t=this;t.isSliding||(this.lastFilterEvent=e,this.applyFilterInterval||(this.applyFilterInterval=setInterval(function(){Date.now()-t.lastFilterEvent.timeStamp>100&&(t.applyFilters(t.lastFilterEvent),clearInterval(t.applyFilterInterval),t.applyFilterInterval=null)},100)))},applyFilters:function(i){var n,r,o;o=this.model.get("activeFilters"),r=e(i.currentTarget).data("filter"),(n=o.where({filter:r})[0])||(n=new t.Model({filter:r}),o.push(n)),n.set("value",e(i.currentTarget).val())}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/AdjustTool",["jquery","backbone","underscore","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/AdjustView"],function(e,t,i,n,r){"use strict";return n.extend({defaults:function(){var e=this.collection.finder.config,t=i.filter([{name:"brightness",icon:"ckf-brightness",config:{min:-100,max:100,step:1,init:0}},{name:"contrast",icon:"ckf-contrast",config:{min:-100,max:100,step:1,init:0}},{name:"saturation",icon:"ckf-saturation",config:{min:-100,max:100,step:1,init:0}},{name:"vibrance",icon:"ckf-vibrance",config:{min:-100,max:100,step:1,init:0}},{name:"exposure",icon:"ckf-exposure",config:{min:-100,max:100,step:1,init:0}},{name:"hue",icon:"ckf-hue",config:{min:0,max:100,step:1,init:0}},{name:"sepia",icon:"ckf-sepia",config:{min:0,max:100,step:1,init:0}},{name:"gamma",icon:"ckf-gamma",config:{min:0,max:10,step:.1,init:1}},{name:"noise",icon:"ckf-noise",config:{min:0,max:100,step:1,init:0}},{name:"clip",icon:"ckf-clip",config:{min:0,max:100,step:1,init:0}},{name:"sharpen",icon:"ckf-sharpen",config:{min:0,max:100,step:1,init:0}},{name:"stackBlur",icon:"ckf-blur",config:{min:0,max:20,step:1,init:0}}],function(t){return i.contains(e.editImageAdjustments,t.name)});return{name:"Adjust",viewClass:r,view:null,filters:t}},initialize:function(){function e(){var e=i.get("editImageData").get("actions");e.remove(e.where({tool:i.get("name")})),n.reset()}var i=this,n=new t.Collection;n.on("add",function(){i.collection.resetTool("Presets")}),i.collection.on("tool:reset:"+i.get("name"),e),i.collection.on("tool:reset:all",e),n.on("change",function(){var e,n,r;n=(r=i.get("editImageData").get("actions")).where({tool:i.get("name")})[0],e=this.toJSON(),n||(n=new t.Model({tool:i.get("name")}),r.push(n)),n.set("data",e),i.collection.requestThrottler()});var r=new t.Model({filters:this.get("filters"),activeFilters:n,tabindex:this.get("tabindex")});this.on("change:editImageData",function(e,t){r.set("file",t.get("file"))}),this.collection.on("throttle",function(e){n.length&&n.clone().forEach(function(t){e[t.get("filter")](parseFloat(t.get("value")))})}),this.viewModel=r,this.activeFilters=n},getActionData:function(){return this.viewModel},saveDeferred:function(t,i){var n=new e.Deferred,r=n.promise();return i.then(function(i){e.each(t,function(e,t){i[t.filter](parseFloat(t.value))}),i.render(function(){n.resolve(this)})}),r}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Presets.dot",[],function(){return'{{~ it.presets: preset }}\n<button class="ckf-ei-preset" data-preset="{{= preset.name }}" tabindex="{{= it.tabindex }}">\n\t<img class="ckf-ei-preset-preview" alt="{{= preset.label }}" /> {{= preset.label }}\n</button>\n{{~}}\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/PresetsView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Presets.dot"],function(e,t,i,n,r){"use strict";var o=240;return n.extend({name:"PresetsView",template:r,events:{"click .ckf-ei-preset":"onPreset","keydown .ckf-ei-preset":function(e){e.keyCode!==i.space&&e.keyCode!==i.enter||this.onPreset(e)}},onRender:function(){var i,n,r=this.model.get("file");this.finder.config.initConfigInfo.thumbs&&(e.forEach(this.finder.config.initConfigInfo.thumbs,function(e){var t=parseInt(e.split("x")[0]);!n&&t>=o&&(n=t)}),n&&(i=this.finder.request("file:getThumb",{file:r})));i&&this.finder.config.initConfigInfo.thumbs||(i=this.finder.request("image:previewUrl",{file:r,maxWidth:o,maxHeight:80,noCache:!0}));var s=this.model.get("Caman"),a=e.uniqueId("ckf-"),l=t("<canvas>").attr("id",a).attr("width",o).attr("height",o).css("display","none").appendTo("body"),d=this.$el.find(".ckf-ei-preset").toArray();!function e(){var n,r;d.length?(n=t(d.shift()),r=n.data("preset"),s("#"+a,i,function(){this.revert(!1),this[r]().render(function(){n.find("img").attr("src",this.toBase64()),e()})})):l.remove()}()},onPreset:function(e){this.model.set("active",t(e.currentTarget).data("preset"))}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/PresetsTool",["jquery","underscore","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/PresetsView"],function(e,t,i,n,r){"use strict";return n.extend({defaults:function(){var e,i,n;return e=this.collection.finder.config,i=[{name:"clarity"},{name:"concentrate"},{name:"crossProcess"},{name:"glowingSun"},{name:"grungy"},{name:"hazyDays"},{name:"hemingway"},{name:"herMajesty"},{name:"jarques"},{name:"lomo"},{name:"love"},{name:"nostalgia"},{name:"oldBoot"},{name:"orangePeel"},{name:"pinhole"},{name:"sinCity"},{name:"sunrise"},{name:"vintage"}],n=t.filter(i,function(i){return t.contains(e.editImagePresets,i.name)}),{name:"Presets",viewClass:r,view:null,presets:n}},initialize:function(){function e(){var e=t.get("editImageData").get("actions");n.set("active",null),e.remove(e.where({tool:t.get("name")}))}var t=this,n=new i.Model({Caman:this.get("Caman"),active:null,presets:this.get("presets"),tabindex:this.get("tabindex")});n.on("change:active",function(e,i){var n;i&&(t.collection.resetTool("Adjust"),(n=t.get("editImageData").get("actions")).remove(n.where({tool:t.get("name")})),n.push({tool:t.get("name"),data:i}),t.collection.requestThrottler())}),t.collection.on("throttle",function(e){var i=t.viewModel.get("active");i&&e[i]()}),t.collection.on("tool:reset:"+t.get("name"),e),t.collection.on("tool:reset:all",e),this.on("change:editImageData",function(e,t){n.set("file",t.get("file"))}),this.viewModel=n},saveDeferred:function(t,i){var n,r;return r=(n=new e.Deferred).promise(),i.then(function(e){e[t]().render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("text!CKFinder/Templates/EditImage/Resize.dot",[],function(){return'<div class="ui-grid-a">\n\t<div class="ckf-ei-resize-controls-inputs">\n\t\t<input name="ckfResizeWidth" value="{{= it.displayWidth }}" tabindex="{{= it.tabindex }}">\n\t\t<p class="ckf-ei-resize-controls-text">x</p>\n\t\t<input name="ckfResizeHeight" value="{{= it.displayHeight }}" tabindex="{{= it.tabindex }}">\n\t\t<p class="ckf-ei-resize-controls-text">{{= it.lang.units.pixelShort}}</p>\n\t</div>\n</div>\n<label>\n\t{{= it.lang.editImage.keepAspectRatio }}\n\t<input type="checkbox" tabindex="{{= it.tabindex }}" name="ckfResizeKeepAspectRatio" {{? it.keepAspectRatio }}checked="checked"{{?}} data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">\n</label>\n<button id="ckf-ei-resize-apply" tabindex="{{= it.tabindex }}" data-icon="ckf-tick" data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}">{{= it.lang.editImage.apply }}</button>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ResizeView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/EditImage/Resize.dot"],function(e,t,i){"use strict";return t.extend({name:"ResizeView",template:i,className:"ckf-ei-resize-controls",ui:{width:'input[name="ckfResizeWidth"]',height:'input[name="ckfResizeHeight"]',keepAspectRatio:'input[name="ckfResizeKeepAspectRatio"]',apply:"#ckf-ei-resize-apply"},triggers:{"click @ui.apply":"apply"},events:{"change @ui.width":"onWidth","change @ui.height":"onHeight","change @ui.keepAspectRatio":"onAspectRatio","keyup @ui.keepAspectRatio":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||(t.preventDefault(),t.stopPropagation(),this.ui.keepAspectRatio.prop("checked",!this.ui.keepAspectRatio.is(":checked")).checkboxradio("refresh").trigger("change"))},"keydown @ui.apply":function(t){t.keyCode!==e.space&&t.keyCode!==e.enter||this.trigger("apply")}},modelEvents:{"change:realWidth":"render","change:displayWidth":"setWidth","change:displayHeight":"setHeight"},onRender:function(){this.$el.trigger("create")},onAspectRatio:function(){var e=this.ui.keepAspectRatio.is(":checked");this.model.set("keepAspectRatio",e),e&&this.onWidth()},onWidth:function(){if(!this.dontRender&&!(this.model.get("displayWidth")<0)){var e=parseInt(this.ui.width.val(),10);(isNaN(e)||e<=0)&&(e=1);var t=this.model.get("realWidth");e>t&&(e=t);var i=this.model.get("displayHeight");if(this.model.get("keepAspectRatio")){var n=t/this.model.get("realHeight");i=parseInt(e/n,10)}i<=0&&(i=1),this.updateSizes(e,i)}},onHeight:function(){if(!this.dontRender&&!(this.model.get("displayHeight")<0)){var e=parseInt(this.ui.height.val(),10),t=this.model.get("realHeight");(isNaN(e)||e<=0)&&(e=1),e>t&&(e=t);var i=this.model.get("displayWidth");if(this.model.get("keepAspectRatio")){var n=this.model.get("realWidth")/t;i=parseInt(e*n,10)}i<=0&&(i=1),this.updateSizes(i,e)}},updateSizes:function(e,t){this.model.set({displayWidth:e,displayHeight:t}),this.dontRender=!0,this.ui.width.val(e),this.ui.height.val(t),this.dontRender=!1},setWidth:function(){this.ui.width.val(this.model.get("displayWidth"))},setHeight:function(){this.ui.height.val(this.model.get("displayHeight"))},focusButton:function(){this.ui.apply.focus()}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools/ResizeTool",["jquery","backbone","CKFinder/Modules/EditImage/Tools/Tool","CKFinder/Modules/EditImage/Views/ResizeView"],function(e,t,i,n){"use strict";var r=t.Model.extend({defaults:{realWidth:-1,realHeight:-1,displayWidth:-1,displayHeight:-1,renderWidth:-1,renderHeight:-1,maxRenderWidth:-1,maxRenderHeight:-1,keepAspectRatio:!0}});return i.extend({defaults:{name:"Resize",viewClass:n,view:null},initialize:function(){this.viewModel=new r({tabindex:this.get("tabindex")}),this.collection.on("imageData:ready",function(){var e=this.get("editImageData");this.viewModel.set({realWidth:e.get("imageWidth"),realHeight:e.get("imageHeight"),displayWidth:e.get("imageWidth"),displayHeight:e.get("imageHeight"),renderWidth:e.get("renderWidth"),renderHeight:e.get("renderHeight"),maxRenderWidth:e.get("renderWidth"),maxRenderHeight:e.get("renderHeight")}),this.get("view").on("apply",function(){this.resizeView()},this)},this),this.collection.on("tool:reset:all",function(){var e,t;t=(e=this.get("editImageData")).get("imageInfo"),this.viewModel.set({realWidth:t.width,realHeight:t.height,displayWidth:t.width,displayHeight:t.height,renderWidth:e.get("renderWidth"),renderHeight:e.get("renderHeight"),maxRenderWidth:e.get("renderWidth"),maxRenderHeight:e.get("renderHeight")})},this)},resizeView:function(){var e,t,i,n=this.viewModel,r=this.get("editImageData"),o=n.get("displayWidth"),s=n.get("displayHeight"),a=n.get("maxRenderWidth"),l=n.get("maxRenderHeight");s>l||o>a?(e=s>o?l/s:a/o,t=parseInt(e*s,10),i=parseInt(e*o,10)):(i=o,t=s),n.set({realWidth:o,realHeight:s}),r.get("actions").push({tool:this.get("name"),data:{width:o,height:s}}),r.set({imageWidth:o,imageHeight:s}),r.get("caman").resize({width:i,height:t}),this.collection.requestThrottler(),this.get("view").focusButton()},saveDeferred:function(t,i){var n=new e.Deferred,r=n.promise();return i.then(function(e){e.resize({width:t.width,height:t.height}).render(function(){n.resolve(this)})}),r},getActionData:function(){return this.viewModel}})}),CKFinder.define("CKFinder/Modules/EditImage/Tools",["underscore","jquery","backbone","CKFinder/Modules/EditImage/Tools/CropTool","CKFinder/Modules/EditImage/Tools/RotateTool","CKFinder/Modules/EditImage/Tools/AdjustTool","CKFinder/Modules/EditImage/Tools/PresetsTool","CKFinder/Modules/EditImage/Tools/ResizeTool"],function(e,t,i,n,r,o,s,a){"use strict";return i.Collection.extend({initialize:function(){this.needRender=!1,this.isRendering=!1,this.on("add",function(e){e.set("name",e.get("tool").get("name"))})},setupDefault:function(t,i){this.finder=t,this.Caman=i;var l=40;this.add({title:t.lang.editImage.resize,icon:"ckf-resize",tool:new a({tabindex:l},{collection:this}),tabindex:l}),this.add({title:t.lang.editImage.crop,icon:"ckf-crop",tool:new n({tabindex:l+=10},{collection:this}),tabindex:l}),this.add({title:t.lang.editImage.rotate,icon:"ckf-rotate",tool:new r({tabindex:l+=10},{collection:this}),tabindex:l});var d=t.config.editImageAdjustments;if(d&&d.length){var c=new o({tabindex:l+=10},{collection:this});this.add({title:t.lang.editImage.adjust,icon:"ckf-adjust",tool:c,tabindex:l}),e.forEach(c.get("filters"),function(e){e.label=t.lang.editImage.filters[e.name]})}var u=t.config.editImagePresets;if(u&&u.length){var f=new s({Caman:i,tabindex:l+=10},{collection:this});this.add({title:t.lang.editImage.presets,icon:"ckf-presets",tool:f,tabindex:l}),e.forEach(f.get("presets"),function(e){e.label=t.lang.editImage.preset[e.name]})}return this},setImageData:function(e){this.editImageData=e,e.on("change:renderHeight",function(){this.checkReady()},this),this.forEach(function(t){t.get("tool").set("editImageData",e)})},setImageInfo:function(e){this.editImageData.set("imageInfo",e),this.editImageData.set("imageWidth",e.width),this.editImageData.set("imageHeight",e.height),this.checkReady()},checkReady:function(){this.editImageData&&this.editImageData.has("imageInfo")&&this.editImageData.has("renderWidth")&&this.trigger("imageData:ready")},resetTool:function(e){var t;e?this.trigger("tool:reset:"+e):(this.trigger("tool:reset:all"),(t=this.editImageData.get("caman")).reset(),t.render(),this.editImageData.get("actions").reset()),this.trigger("tool:reset:after")},doSave:function(i){var n=this,r=e.uniqueId("edit-image-canvas"),o=t("<canvas>").attr("id",r).css("display","none").appendTo("body"),s=this.editImageData.get("actions"),a=this.Caman,l=new t.Deferred,d=new t.Deferred,c=l.promise();return a("#"+r,i,function(){var e=this,t=s.findWhere({tool:"Adjust"});t&&(s.remove(t),s.push(t));var i=s.findWhere({tool:"Presets"});i&&(s.remove(i),s.push(i)),s.forEach(function(e){var t=this.findWhere({name:e.get("tool")}).get("tool");c=t.saveDeferred(e.get("data"),c)},n),c.then(function(){d.resolve(e.toBase64()),o.remove()}),l.resolve(e)}),d.promise()},requestThrottler:function(){var e=this;this.needRender=!0,this.throttleID||(this.throttleID=setInterval(function(){if(e.needRender&&!e.isRendering){e.isRendering=!0;var t=e.editImageData.get("caman");try{t.revert(!1)}catch(e){}e.trigger("throttle",t),t.render(function(){return!1}),e.isRendering=!1,e.needRender=!1}},200))},destroy:function(){this.throttleID&&clearInterval(this.throttleID)},hasDataToSave:function(){return!!this.editImageData.get("actions").length}})}),CKFinder.define("CKFinder/Common/Models/ProgressModel",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{state:"ok",message:"",value:0},stateOk:function(){this.set("state","ok")},stateError:function(){this.set("state","error")},stateIndeterminate:function(){this.set("state","indeterminate")}})}),CKFinder.define("CKFinder/Modules/EditImage/Models/ProgressModel",["CKFinder/Common/Models/ProgressModel"],function(e){"use strict";return e.extend({defaults:{value:0,state:"ok",message:"",eta:"",speed:"",bytes:0,bytesTotal:0,time:0,transfer:""},initialize:function(){this.on("change",function(e){var t,i;if(e.changed.time&&(t=e.previous("time"))){var n=e.get("time")-t;i=((e.get("bytes")-e.previous("bytes"))/n).toFixed(1),this.set({eta:((e.get("bytesTotal")-e.get("bytes"))/(100*i)).toFixed(),speed:i})}})}})}),CKFinder.define("text!CKFinder/Templates/Common/Progress.dot",[],function(){return'<div class="ckf-progress-message {{? !it.message }}ckf-hidden{{?}}">{{= it.message }}</div>\n<div class="ckf-progress-wrap ckf-progress-{{= it.state }}" role="progressbar" aria-valuenow="{{= it.value }}" aria-valuemin="0" aria-valuemax="100">\n\t<div class="ckf-progress-bar" style="width:{{= it.value }}%;" ></div>\n</div>\n'}),CKFinder.define("CKFinder/Common/Views/ProgressView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Common/Progress.dot"],function(e,t){"use strict";return e.extend({name:"ProgressView",template:t,className:"ckf-progress",modelEvents:{"change:message":"updateMessage","change:state":"updateState","change:value":"updateValue"},ui:{bar:".ckf-progress-bar",message:".ckf-progress-message",wrap:".ckf-progress-wrap"},onRender:function(){this.$el.trigger("create")},updateMessage:function(e,t){this.ui.message.text(t).toggleClass("ckf-hidden",!t)},updateState:function(e,t){this.ui.wrap.toggleClass("ckf-progress-ok","ok"===t).toggleClass("ckf-progress-error","error"===t).toggleClass("ckf-progress-indeterminate","indeterminate"===t)},updateValue:function(e,t){this.isDestroyed||(this.ui.bar.css({width:t+"%"}),this.ui.wrap.attr("aria-valuenow",t))}})}),CKFinder.define("text!CKFinder/Templates/EditImage/ProgressDialog.dot",[],function(){return'<div id="ckf-ei-progress"></div>\n<div class="ckf-ei-transfer">{{= it.transfer }}</div>\n\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ProgressDialogView",["underscore","jquery","CKFinder/Views/Base/LayoutView","CKFinder/Common/Views/ProgressView","text!CKFinder/Templates/EditImage/ProgressDialog.dot"],function(e,t,i,n,r){"use strict";return i.extend({name:"EditImageProgressDialogView",template:r,regions:{progress:"#ckf-ei-progress"},ui:{transfer:".ckf-ei-transfer"},modelEvents:{change:"updateTransfer"},onRender:function(){this.$el.trigger("create"),this.progress.show(new n({finder:this.finder,model:this.model}))},updateTransfer:function(){this.ui.transfer.text(this.model.get("transfer"))}})}),CKFinder.define("CKFinder/Models/File",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{name:"",date:"",size:-1,folder:null,"view:isFolder":!1},initialize:function(){this._extenstion=!1,this.on("change:name",function(){this._extenstion=!1},this)},getExtension:function(){return this._extension||(this._extenstion=this.constructor.extensionFromFileName(this.get("name"))),this._extenstion},getUrl:function(){if(!this.has("url")){var e=this.get("folder").getUrl();this.set("url",e&&e+encodeURIComponent(this.get("name")),{silent:!0})}return this.get("url")},isImage:function(){return this.constructor.isExtensionOfImage(this.getExtension())},refresh:function(){this.trigger("refresh",this)}},{invalidCharacters:'\n\\ / : * ? " < > |',isValidName:function(e){return!/[\\\/:\*\?"<>\|]/.test(e)},isExtensionOfImage:function(e){return/jpeg|jpg|gif|png/.test(e.toLowerCase())},extensionFromFileName:function(e){return e.substr(e.lastIndexOf(".")+1)},trimFileName:function(e){var t=e.lastIndexOf(".");return t<0?e.trim():e.substr(0,t).trim()+"."+e.substr(t+1).trim()}})}),CKFinder.define("text!CKFinder/Templates/EditImage/ConfirmDialog.dot",[],function(){return'{{? !it.onlyOverwrite }}<label>\n    {{= it.lang.editImage.saveDialogOverwrite }}\n\t<input tabindex="1" type="checkbox" name="ckfEditImageOverwrite" {{? it.overwrite }}checked="checked"{{?}}>\n</label>\n{{?}}\n<div class="filename-input-area" {{? it.overwrite }}style="display:none" aria-hidden="true"{{?}}>\n    {{= it.lang.editImage.saveDialogSaveAs }}\n    <div>\n        <span class="filename-extension-label">.{{! it.extension }}</span>\n        <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset">\n    \t\t<input tabindex="1" data-enhanced="true" type="text" name="ckfEditImageFileName" value="{{! it.name }}" aria-required="true" dir="auto" />\n        </div>\n    </div>\n\n    <p class="ckf-ei-confirm-error error-message"></p>\n</div>\n'}),CKFinder.define("CKFinder/Modules/EditImage/Views/ConfirmDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/File","text!CKFinder/Templates/EditImage/ConfirmDialog.dot"],function(e,t,i){"use strict";return e.extend({name:"EditImageConfirmDialog",template:i,className:"ckf-ei-crop-controls",ui:{error:".ckf-ei-confirm-error",overwrite:'input[name="ckfEditImageOverwrite"]',fileName:'input[name="ckfEditImageFileName"]',fileNameInputArea:".filename-input-area"},events:{"change @ui.overwrite":function(e){e.stopPropagation(),e.preventDefault();var t=this.ui.overwrite.is(":checked");t?(this.model.set("name",this.model.get("originalName")),this.model.unset("error"),this.ui.fileNameInputArea.hide().attr("aria-hidden","true")):this.ui.fileNameInputArea.show().removeAttr("aria-hidden"),this.model.set("overwrite",t)},"input @ui.fileName":function(){var e=this.ui.fileName.val().toString();if(t.isValidName(e))this.model.unset("error");else{var i=this.finder.lang.errors.fileInvalidCharacters.replace("{disallowedCharacters}",t.invalidCharacters);this.model.set("error",i)}this.model.set("name",e)}},modelEvents:{"change:error":function(e,t){t?(this.ui.fileName.attr("aria-invalid","true"),this.ui.error.show().removeAttr("aria-hidden").html(t)):(this.ui.error.hide().attr("aria-hidden","true"),this.ui.fileName.removeAttr("aria-invalid"))}}})}),CKFinder.define("CKFinder/Modules/EditImage/EditImage",["underscore","jquery","backbone","CKFinder/Modules/EditImage/Views/EditImageLayout","CKFinder/Modules/EditImage/Views/ImagePreviewView","CKFinder/Modules/EditImage/Views/ActionsView","CKFinder/Modules/EditImage/Models/EditImageData","CKFinder/Modules/EditImage/Tools","CKFinder/Modules/EditImage/Models/ProgressModel","CKFinder/Modules/EditImage/Views/ProgressDialogView","CKFinder/Modules/EditImage/Views/ConfirmDialogView"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";function u(e){var t=this,i=e.data.context.file.get("folder").get("acl");p(e.data.context.file)&&e.data.items.add({name:"EditImage",label:t.finder.lang.common.edit,isActive:i.fileView&&i.fileRename,icon:"ckf-file-edit",action:function(){f(t,e.data.context.file)}})}function f(t,i){if(e.isUndefined(m)){var n=CKFinder.require.toUrl(t.finder.config.caman||"libs/caman")+".js?ver=i42irv";CKFinder.require([n],function(e){m=e||window.Caman,h(t,i)})}else h(t,i)}function h(e,t){var i=e.finder,l=new a;l.setupDefault(i,m),l.on("throttle",function(){i.fire("editImage:renderPreview",{actions:f.get("actions").clone()},i)});var d=new n({finder:i}),c=new r({finder:i}),u=new o({finder:i,collection:l});i.once("page:show:EditImage",function(){d.preview.show(c),d.actions.show(u),d.$el.trigger("create"),i.request("toolbar:reset",{name:"EditImage",context:{tools:l}});var e=m(c.ui.canvas.selector,f.get("imagePreview"),function(){i.request("loader:hide"),u.focusFirst(),f.set({renderWidth:c.ui.canvas.width(),renderHeight:c.ui.canvas.height()})});f.set("caman",e)});var f=new s({file:t,imagePreview:i.request("image:previewUrl",{file:t,maxWidth:.8*window.innerWidth,maxHeight:.8*window.innerHeight,noCache:!0}),fullImagePreview:i.request("image:previewUrl",{file:t,maxWidth:1e6,maxHeight:1e6,noCache:!0})});l.setImageData(f);var h=f.get("actions");h.on("add",function(){e.resetButton&&e.resetButton.set("isDisabled",!1)}),h.on("reset",function(){e.resetButton&&e.resetButton.set("isDisabled",!0)}),i.request("loader:show",{text:i.lang.editImage.loading}),i.request("command:send",{name:"ImageInfo",folder:t.get("folder"),params:{fileName:t.get("name")}}).done(function(e){function n(){l.trigger("ui:resize")}if(e.error&&117===e.error.number)return i.once("command:error:ImageInfo",function(e){e.cancel()}),i.request("loader:hide"),i.request("folder:refreshFiles"),void i.request("dialog:info",{msg:i.lang.errors.missingFile});var r={width:e.width,height:e.height,size:e.size};t.set("imageInfo",r),l.setImageInfo(r),i.util.isWidget()&&function(e){function t(){i=!1,e.removeListener("minimized",t)}var i=!1;e.request("isMaximized")||(e.request("maximize"),i=!0),e.once("minimized",t),e.once("page:destroy:EditImage",function n(){i&&e.request("minimize"),e.removeListener("page:destroy:EditImage",n),e.removeListener("minimized",t)})}(i),i.once("page:create:EditImage",function(){i.request("toolbar:create",{name:"EditImage",page:"EditImage"})}),i.request("page:create",{view:d,title:i.lang.editImage.title,name:"EditImage",className:"ckf-ei-page"}),i.request("page:show",{name:"EditImage"}),i.request("loader:show",{text:i.lang.editImage.loading}),u.on("childview:expand",function(){d.onActionsExpand()}).on("childview:collapse",function(){d.onActionsCollapse()}),i.on("ui:resize",n),i.once("page:destroy:EditImage",function(){i.removeListener("ui:resize",n)})})}function g(e,t,i,n,r){n.set({value:v,message:i.lang.editImage.transformationAction}),t.doSave(e).then(function(e){function o(){l&&l.abort(),i.request("dialog:destroy")}n.set({value:y,message:i.lang.editImage.uploadAction});var s=t.editImageData.get("file"),a=s.get("folder");i.once("command:after:SaveImage",function(e){e.data.response.error||(n.set({state:"normal",value:C,message:""}),s.set({date:e.data.response.date,size:e.data.response.size}),i.once("page:show:Main",function(){e.data.context.isFileNameChanged?i.request("folder:refreshFiles"):s.refresh()}),i.request("page:destroy",{name:"EditImage"}))}),n.set({bytes:0,bytesTotal:0,value:y,message:i.lang.editImage.uploadAction,time:(new Date).getTime()}),i.on("dialog:EditImageSaveProgress:cancel",o);var l=i.request("command:send",{name:"SaveImage",type:"post",folder:a,params:{fileName:r||s.get("name")},post:{content:e},context:{file:s,isFileNameChanged:!!r},returnTransport:!0,uploadProgress:function(e){e.lengthComputable&&(n.set({bytes:e.loaded,bytesTotal:e.total,value:e.loaded/e.total*(b-y)+y,time:(new Date).getTime()}),n.set("transfer",i.lang.formatTransfer(n.get("speed")))),e.lengthComputable||n.set({state:"indeterminate",transfer:!1})},uploadEnd:function(){n.set("state","normal"),i.removeListener("dialog:EditImageSaveProgress:cancel",o)}});t.destroy()})}function p(e){return e.isImage()&&e.get("folder").get("acl").fileRename&&e.get("folder").get("acl").fileUpload}var m,v=33,w=20,y=35,b=98,C=100;return function(e){var t=this;this.finder=e,e.on("contextMenu:file:edit",u,this),e.on("toolbar:reset:Main:file",function(i){p(i.data.file)&&i.data.toolbar.push({type:"button",name:"EditImage",priority:50,icon:"ckf-file-edit",label:i.finder.lang.common.edit,action:function(){f(t,e.request("files:getSelected").first())}})}),e.on("toolbar:reset:EditImage",function(t){var n=this;t.data.toolbar.push({icon:"ltr"===e.lang.dir?"ckf-back":"ckf-forward",name:"Close",iconOnly:!0,label:t.finder.lang.common.close,type:"button",alwaysVisible:!0,action:function(){return t.data.tools.hasDataToSave()?void e.request("dialog:confirm",{name:"ConfirmEditImageExit",msg:e.lang.editImage.confirmExit}):void e.request("page:destroy",{name:"EditImage"})}}),t.data.toolbar.push({type:"text",name:"Filename",className:"ckf-ei-toolbar-filename",label:e.util.escapeHtml(t.data.tools.editImageData.get("file").get("name"))}),t.data.toolbar.push({name:"Save",label:e.lang.editImage.save,icon:"ckf-save",alignment:"secondary",alwaysVisible:!0,type:"button",action:function(){!function(e,t){if(t.hasDataToSave()){var n=e.finder,r=t.editImageData.get("file"),o=r.getExtension(),s=r.get("name");if(o){var a=s.lastIndexOf("."+o);a>0&&(s=s.substr(0,a))}var l=r.get("folder").get("acl").fileDelete,d=new i.Model({onlyOverwrite:!l,overwrite:l,oldName:r.get("name"),name:s,originalName:s,extension:o,tools:t,error:!1}),u=n.request("dialog",{view:new c({finder:n,model:d}),title:n.lang.editImage.saveDialogTitle,name:"EditImageConfirm",buttons:["ok","cancel"],context:{viewModel:d,tools:t}});d.on("change:error",function(e,t){t?u.disableButton("ok"):u.enableButton("ok")})}}(n,t.data.tools)}}),this.resetButton=new i.Model({name:"Reset",label:e.lang.editImage.reset,icon:"ckf-reset",alignment:"secondary",alwaysVisible:!0,isDisabled:!0,type:"button",action:function(){t.data.tools.resetTool()}}),t.data.toolbar.push(this.resetButton)},this,null,40),e.on("dialog:EditImageConfirm:ok",function(i){var n=i.data.context;if(!n.viewModel.get("error")){var r=n.viewModel.get("name")+"."+n.viewModel.get("extension");return!n.viewModel.get("overwrite")&&e.request("files:getCurrent").where({name:r}).length?void n.viewModel.set("error",i.finder.lang.editImage.saveDialogFileExists):void function(e,t,i){function n(){c&&c.abort(),r.request("dialog:destroy")}var r=e.finder,o=t.editImageData,s=new l,a=new d({finder:r,model:s});if(r.request("dialog",{view:a,title:r.lang.editImage.saveDialogTitle,name:"EditImageSaveProgress",buttons:["cancel"]}),r.on("dialog:EditImageSaveProgress:cancel",n),s.set("message",r.lang.editImage.downloadAction),!window.URL||!window.URL.createObjectURL)return s.stateIndeterminate(),void g(o.get("fullImagePreview"),t,r,s,i);s.set({bytes:0,bytesTotal:0,value:0,time:(new Date).getTime()});var c=new XMLHttpRequest;c.onprogress=function(e){e.lengthComputable&&(s.set({state:"normal",bytes:e.loaded,bytesTotal:e.total,value:e.loaded/e.total*v,time:(new Date).getTime()}),s.set("transfer",r.lang.formatTransfer(s.get("speed")))),e.lengthComputable||s.set({value:w,state:"indeterminate",transfer:""})},c.onload=function(){return r.removeListener("dialog:EditImageSaveProgress:cancel",n),200!==this.status?(r.request("folder:refreshFiles"),r.request("page:destroy",{name:"EditImage"}),void r.request("dialog:info",{msg:r.lang.errors.missingFile})):(s.set({value:v,eta:!1,speed:!1,time:0}),void g(window.URL.createObjectURL(new Blob([this.response])),t,r,s,i))},c.open("GET",o.get("fullImagePreview"),!0),c.responseType="arraybuffer",c.send(null)}(t,n.tools,n.viewModel.get("oldName")!==r&&r)}}),e.on("dialog:ConfirmEditImageExit:ok",function(){e.request("page:destroy",{name:"EditImage"})}),e.on("command:error:SaveImage",function(){e.request("page:destroy",{name:"EditImage"})},null,null,5)}}),CKFinder.define("CKFinder/Modules/FileDownload/FileDownload",["underscore","jquery"],function(e,t){"use strict";function i(e){var t={name:"Download",priority:70,icon:"ckf-file-download",label:e.finder.lang.common.download};if(r){var i=e.finder.request("files:getSelected").first(),n=e.finder.request("command:url",{command:"DownloadFile",folder:i.get("folder"),params:{fileName:i.get("name")}});t.type="link-button",t.href=n,t.attributes={target:"_blank"}}else t.type="button",t.action=function(){e.finder.request("file:download",{file:e.finder.request("files:getSelected").first()})};e.data.toolbar.push(t)}function n(e){var t=e.data,i=t.context.file,n=i.get("folder").get("acl"),o=e.finder.request("files:getSelected");o.length&&!o.contains(i)&&e.finder.request("files:deselectAll"),e.finder.request("files:select",{files:i});var s={name:"Download",label:e.finder.lang.common.download,isActive:n.fileView,icon:"ckf-file-download"};r?(s.allowClick=!0,s.linkAttributes=[{name:"target",value:"_blank"},{name:"href",value:e.finder.request("command:url",{command:"DownloadFile",folder:i.get("folder"),params:{fileName:i.get("name")}})}]):s.action=function(){e.finder.request("file:download",{file:i})},t.items.add(s)}var r=/iPad|iPhone|iPod/.test(navigator.platform);return function(r){var o=e.uniqueId("ckf-download-frame");r.setHandler("file:download",function(e){var i=e.file.get("folder"),n=r.request("command:url",{command:"DownloadFile",folder:i,params:{fileName:e.file.get("name")}}),s=t("#"+o);s.length||((s=t("<iframe>")).attr("id",o),s.css("display","none"),s.on("load",function(){var e=t(s.get(0).contentDocument).text();if(e.length)try{var i=JSON.parse(e);i.error&&117===i.error.number&&(r.request("folder:refreshFiles"),r.request("dialog:info",{msg:r.lang.errors.missingFile}))}catch(e){}}),t("body").append(s)),s.attr("src",n)}),r.on("toolbar:reset:Main:file",i),r.on("contextMenu:file",function(e){e.data.groups.add({name:"view"})},null,null,20),r.on("contextMenu:file:view",n,null,null,20)}}),CKFinder.define("text!CKFinder/Templates/FilePreview/Gallery.dot",[],function(){return'<div class="ckf-file-preview-root" style="position:fixed;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.8);z-index:9010;font-family:Arial, Helvetica, Tahoma, Verdana, sans-serif;" tabindex="0" role="application">\n\t<div class="ckf-file-preview" style="position:absolute;top:0;left:0;bottom:2em;right:0;margin:auto;"></div>\n\t<div class="ckf-file-preview-info"\n\t\tstyle="position:absolute;left:0;bottom:0;right:0;margin:auto;color:#fff;background:#000;padding:0.5em 1em;max-height:2em;line-height:1em;font-size:1em;">\n\t\t<div class="ckf-file-preview-info-name" style="float:left;"></div>\n\t\t<div class="ckf-file-preview-info-count" style="float:right;"></div>\n\t</div>\n\t<button class="ckf-file-preview-button-prev" style="position:absolute;top:50%;background:linear-gradient(to bottom, #fff 0, #e4e4e4 100%);border-radius:.3125em;border:1px solid #b6b6b6;box-shadow:0 1px 0 rgba(255, 255, 255, 0.5), 0 0 2px rgba(255, 255, 255, 0.15) inset, 0 1px 0 rgba(255, 255, 255, 0.15) inset;box-sizing:border-box;color:#333;font-size:12.5px;font-weight:bold;line-height:1.3em;margin:5px 3px;padding:5px 10px;text-shadow:0 1px 0 #f3f3f3;-webkit-appearance:none;-moz-appearance:none;display:inline-block;vertical-align:middle;">&laquo;</button>\n\t<button class="ckf-file-preview-button-next" style="position:absolute;top:50%;background:linear-gradient(to bottom, #fff 0, #e4e4e4 100%);border-radius:.3125em;border:1px solid #b6b6b6;box-shadow:0 1px 0 rgba(255, 255, 255, 0.5), 0 0 2px rgba(255, 255, 255, 0.15) inset, 0 1px 0 rgba(255, 255, 255, 0.15) inset;box-sizing:border-box;color:#333;font-size:12.5px;font-weight:bold;line-height:1.3em;margin:5px 3px;padding:5px 10px;text-shadow:0 1px 0 #f3f3f3;-webkit-appearance:none;-moz-appearance:none;display:inline-block;vertical-align:middle;">&raquo;</button>\n</div>\n'}),CKFinder.define("CKFinder/Modules/FilePreview/FilePreview",["underscore","jquery","doT","backbone","CKFinder/Util/KeyCode","text!CKFinder/Templates/FilePreview/Gallery.dot","CKFinder/Models/File"],function(e,t,i,n,r,o,s){"use strict";function a(n,s){function a(){var r,o,s,a,l,d;k.current<=0?(k.current=0,b.hide()):b.show(),k.current>=k.last?(k.current=k.last,w.hide()):w.show(),s=(o=k.files[k.current]).url,l=(a=o.name).substr(a.lastIndexOf(".")+1),d=n.fire("file:preview",{templateData:{fileIcon:function(){var e=t(f).width(),i=t(f).height();return n.request("file:getIcon",{size:e>i?e:i,file:o.file})},fileName:a},file:o.file,url:s,extension:l,template:y},n),C.text(o.name),F.text(k.current+1+" / "+k.files.length),n.request("files:deselectAll"),n.request("files:select",{files:c[k.current]}),r=t(i.template(d.template)(d.templateData),f),d.events&&e.forEach(d.events,function(e,t){r.on(t,e)}),v.append(r),e.isFunction(d.afterRender)&&d.afterRender(r),n.request("focus:trap",{node:m})}function l(e,t){v.html(""),e.stopPropagation(),k.current+=t,a()}function d(){x&&x.remove(),m.remove();var e=c[k.current];e.trigger("focus",e)}var c=n.request("files:getDisplayed").where({"view:isFolder":!1}),u=[],f=window.top.document,g=i.template(o),p=0,m=t(g(),f);m.attr("dir",n.lang.dir);var v=m.find(".ckf-file-preview"),w=m.find(".ckf-file-preview-button-next"),b=m.find(".ckf-file-preview-button-prev"),C=m.find(".ckf-file-preview-info-name"),F=m.find(".ckf-file-preview-info-count");"ltr"===n.lang.dir?(w.css("right","0.5em"),b.css("left","0.5em")):(w.css("left","0.5em"),b.css("right","0.5em")),c.forEach(function(e,t){var i=e.getUrl(),n=e.get("name");u.push({url:i,name:n,file:e}),n===s&&(p=t)});var x,k={files:u,current:p,last:u.length-1};n.util.isWidget()&&(x=t(h).appendTo(t("body",f))),m.append(v).append(b).append(w).appendTo(t("body",f)),m.focus(),m.on("click",function(){d()}),t(m).on("keydown",function(e){e.keyCode===r.left&&l(e,"ltr"===n.lang.dir?-1:1),e.keyCode===r.right&&l(e,"ltr"===n.lang.dir?1:-1),e.keyCode===r.escape&&(e.stopPropagation(),d())}),b.on("click",function(e){l(e,-1)}),w.on("click",function(e){l(e,1)}),a()}function l(e,t,i){var n=document.createElement(e);return!!n.canPlayType&&""!==n.canPlayType(t[i])}var d="calc(100% - 6em)",c="calc(100% - 2em)",u="position:absolute;top:0;left:0;bottom:0;right:0;margin:auto;max-width:"+d+";max-height:"+c+";",f=u+"width:"+d+";height:"+c+";",h="<style>.ckf-file-preview-root :focus,.ckf-file-preview-root:focus .ckf-file-preview {-webkit-box-shadow:inset 0 0 0 2px #ffcd32 !important;-moz-box-shadow:inset 0 0 0 2px #ffcd32 !important;box-shadow:inset 0 0 0 2px #ffcd32 !important;}</style>",g='<img alt="{{! it.fileName }}" src="{{= it.fileIcon() }}" style="'+u+'"><img alt={{! it.fileName }}" src="{{= it.url }}" id="ckf-image-preview" style="display:none;'+u+'">',p='<audio src="{{= it.url }}" controls="controls" style="'+u+'">',m='<video src="{{= it.url }}" controls="controls" style="'+u+'">',v='<iframe src="{{= it.url }}" style="'+f+'">',w='<img alt="{{= it.fileName }}" src="{{= it.fileIcon() }}" style="'+u+'"><iframe src="{{= it.url }}" style="display:none;'+f+'">',y='<img alt="{{= it.fileName }}" src="{{= it.fileIcon() }}" style="'+u+'">';return function(e){e.setHandlers({"image:previewUrl":function(t){var i,n;return i=t.file.get("folder"),n={fileName:t.file.get("name"),size:Math.round(t.maxWidth)+"x"+Math.round(t.maxHeight),date:t.file.get("date")},t.noCache&&(n.d=(new Date).getTime()),e.request("command:url",{command:"ImagePreview",params:n,folder:i})},"file:preview":function(t){var i=t&&t.file||e.request("files:getCurrent").first();i&&a(e,i.get("name"))}}),e.on("file:preview",function(i){function n(e,t){t.find("iframe").attr("src",e).css("display",""),t.find("img").remove()}var r=i.data.url,o=i.data.extension.toLocaleLowerCase();if(s.isExtensionOfImage(o)&&(i.stop(),i.data.templateData.url=r,e.hasHandler("image:previewUrl")&&(i.data.templateData.url=e.request("image:previewUrl",{file:i.data.file,maxWidth:.95*t(window.top).width(),maxHeight:.95*t(window.top).height()})),i.data.template=g,i.data.events={load:function(e){e.target.id&&t(e.target).css("display","").prev().remove()}}),/^(flac|mp3|ogg|opus|wav|weba)$/.test(o)&&function(e){return l("audio",{flac:"audio/flac",mp3:"audio/mpeg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus',wav:"audio/wav",weba:"audio/webm"},e)}(o)&&(i.stop(),i.data.templateData.url=r,i.data.template=p,i.data.events={click:function(e){e.stopPropagation()}}),/^(mp4|ogv|webm)$/.test(o)&&function(e){return l("video",{mp4:"video/mp4",ogv:"video/ogg",webm:"video/webm"},e)}(o)&&(i.stop(),i.data.templateData.url=r,i.data.template=m,i.data.events={click:function(e){e.stopPropagation()}}),/^(pdf)$/.test(o)&&(i.stop(),i.data.template=r?v:w,i.data.templateData.url=r||"",i.data.afterRender=function(e){setTimeout(function(){e.closest("[tabindex]").focus()},500)},!r)){var a=i.data.file;i.data.events={load:function(i){i.currentTarget.alt&&(a.get("folder").getResourceType().get("useProxyCommand")?n(e.request("file:getProxyUrl",{file:a,cache:86400,params:{d:a.get("date")}}),t(i.currentTarget).parent()):e.request("file:getUrl",{file:a}).then(function(e){n(e,t(i.currentTarget).parent())}))}}}},null,null,90),e.on("contextMenu:file:view",function(t){t.data.items.add({name:"View",label:t.finder.lang.common.view,isActive:t.data.context.file.get("folder").get("acl").fileView,icon:"ckf-view",action:function(){a(e,t.data.context.file.get("name"))}})},null,null,10),e.on("toolbar:reset:Main:file",function(e){var t=e.finder;e.data.toolbar.push({name:"View",icon:"ckf-view",label:t.lang.common.view,type:"button",priority:80,action:function(){a(t,e.data.file.get("name"))}})})}}),CKFinder.define("CKFinder/Modules/Files/FilesFilter",["backbone"],function(e){"use strict";return{attachTo:function(t){var i=new e.Collection;return i.search=function(e){var n;t.length&&(""===e?(n=t.toArray(),i.isFiltered=!1,i.filter=e):(n=t.filter(function(t){return new RegExp(e.replace(/[\\^$*+?.()|[\]{}-]/g,"\\$&"),"gi").test(t.get("name"))}),i.isFiltered=!0),i.reset(n))},i.listenTo(t,"reset",function(){i.reset(t.toArray()),i.isFiltered=!1}),i.listenTo(t,"remove",function(e){i.remove(e)}),i.listenTo(t,"add",function(e){i.add(e)}),i.isFiltered=!1,i.comparators={},i.sortFiledName=void 0,i.sortAscending=!0,i.on("change:name",function(){"name"===i.sortFiledName&&i.sort()}),i.comparator=function(e,t){if(!this.sortFiledName||!this.comparators[this.sortFiledName])return 1;if(e.get("view:isFolder")===t.get("view:isFolder")){if(!1===e.get("view:isFolder")){var i=(0,this.comparators[this.sortFiledName])(e,t);return 0===i?i:this.isSortAscending?i:-i}return e.get("name").localeCompare(t.get("name"))}return e.get("view:isFolder")?-1:1},i.addComparator=function(e,t){this.comparators[e]=t},i.sortByField=function(e){this.sortFiledName=e,this.sort()},i.sortAscending=function(){this.isSortAscending=!0,this.sort()},i.sortDescending=function(){this.isSortAscending=!1,this.sort()},i.addComparator("name",function(e,t){return e.get("name").localeCompare(t.get("name"))}),i.addComparator("size",function(e,t){var i=e.get("size"),n=t.get("size");return i===n?0:i>n?1:-1}),i.addComparator("date",function(e,t){return e.get("date").localeCompare(t.get("date"))}),i}}}),CKFinder.define("text!CKFinder/Templates/Files/ChooseResizedImageItem.dot",[],function(){return'<label>\n\t{{= it.label }}\n\t<span class="ckf-choose-resized-image-size">{{= it.size }}</span>\n\t<input type="radio" name="ckfChooseResized" tabindex="1" value="{{= it.name }}"\n\t    {{? !it.isActive }}disabled="disabled"{{?}}{{? it.isDefault }} checked="checked"{{?}} data-iconpos="{{? it.lang.dir === "ltr"}}left{{??}}right{{?}}">\n</label>\n'}),CKFinder.define("text!CKFinder/Templates/Files/ChooseResizedImageInputItem.dot",[],function(){return'<label>\n\t{{= it.lang.chooseResizedImage.sizes.custom }}\n\t<input type="radio" name="ckfChooseResized" tabindex="1" value="{{= it.name }}">\n</label>\n<div class="ckf-choose-resized-image-custom-fields ui-state-disabled">\n\t<div class="ckf-choose-resized-image-custom-block">\n\t\t<label class="ckf-choose-resized-image-label">Width</label>\n\t</div>\n\t<div class="ckf-choose-resized-image-custom-block ckf-choose-resized-image-input">\n\t\t<input type="text" name="ckfCustomWidth" tabindex="1" disabled="disabled" value="{{= it.width }}">\n\t</div>\n\t<div class="ckf-choose-resized-image-custom-block">\n\t\t<label class="ckf-choose-resized-image-label">Height</label>\n\t</div>\n\t<div class="ckf-choose-resized-image-custom-block ckf-choose-resized-image-input">\n\t\t<input type="text" name="ckfCustomHeight" tabindex="1" disabled="disabled" value="{{= it.height }}">\n\t</div>\n</div>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/ChooseResizedImageView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/ChooseResizedImageItem.dot","text!CKFinder/Templates/Files/ChooseResizedImageInputItem.dot"],function(e,t,i,n,r,o,s){"use strict";return n.extend({name:"ContextMenu",template:"",tagName:"form",events:{'change [name="ckfChooseResized"]':function(e){"__custom"===t(e.currentTarget).val()?(this.$el.find(".ckf-choose-resized-image-custom-fields").removeClass("ui-state-disabled"),this.$el.find(".ckf-choose-resized-image-input input").textinput("enable").removeAttr("disabled").first().focus()):(this.$el.find(".ckf-choose-resized-image-custom-fields").addClass("ui-state-disabled"),this.$el.find(".ckf-choose-resized-image-input input").textinput("disable").attr("disabled","disabled"))}},childEvents:{keydown:function(e,t){if(t.evt.keyCode===i.down||t.evt.keyCode===i.up||t.evt.keyCode===i.tab){if(t.evt.preventDefault(),t.evt.stopPropagation(),t.evt.keyCode===i.down||t.evt.keyCode===i.up){var n=this.collection.where({isActive:!0}),r=n.indexOf(e.model)+(t.evt.keyCode===i.down?1:-1);r<0&&(r=n.length-1),r>n.length-1&&(r=0);var o=this.children.findByModel(n[r]);o&&o.focus()}t.evt.keyCode===i.tab&&e.$el.closest(".ckf-dialog").find("[data-ckf-button]").eq(this.finder.util.isShortcut(t.evt,"shift")?-1:0).focus()}}},collectionEvents:{reset:function(){this.$el.html("")}},onRender:function(){var e=this;setTimeout(function(){e.$el.enhanceWithin()},0)},getChildView:function(e){var t={name:"ChooseResizedItem",finder:this.finder,template:o,tagName:"div",events:{'keydown input[type="radio"]':function(e){this.trigger("keydown",{evt:e})}},focus:function(){this.$el.find("input").focus()}};return e.get("custom")&&this.addCustomSizeViewConfig(t),r.extend(t)},addCustomSizeViewConfig:function(e){e.name="ChooseResizedCustomItem",e.className="ckf-choose-resized-image-custom",e.template=s,e.tagName="div",e.ui={width:'input[name="ckfCustomWidth"]',height:'input[name="ckfCustomHeight"]'},e.setSize=function(e,t){var i=e<=0?1:e,n=t<=0?1:t;this.ui.height.val(i),this.ui.width.val(n),this.model.set({size:n+"x"+i})},e.events["input @ui.width"]=function(){var e=this.model.get("width"),t=this.model.get("height"),i=t,n=this.ui.width.val();n.length||(n=1);var r=parseInt(n);r<e?i=r*(t/e):r=e,i=Math.round(i),this.setSize(i,r)},e.events["input @ui.height"]=function(){var e=this.model.get("width"),t=this.model.get("height"),i=e,n=this.ui.height.val(),r=parseInt(n);n.length||(r=1),r<t?i=r*(e/t):r=t,i=Math.round(i),this.setSize(r,i)}},getSelected:function(){return this.collection.findWhere({name:this.$el.find('input[name="ckfChooseResized"]:checked').val()})}})}),CKFinder.define("CKFinder/Modules/Files/ChooseFiles",["underscore","jquery","backbone","CKFinder/Modules/Files/Views/ChooseResizedImageView"],function(e,t,i,n){"use strict";function r(e){var t=e.data.context.file;(e.data.items.add({name:"Choose",label:e.finder.lang.common.choose,isActive:t.get("folder").get("acl").fileView,icon:"ckf-choose",action:function(){var i=e.finder.request("files:getSelected");i.length>1?a(e.finder,i):p(e.finder,t)}}),t.isImage()&&e.finder.config.resizeImages)&&(t.has("imageResizeData")&&t.get("imageResizeData").has("originalSize")||t.once("change:imageResizeData",function(){new i.Model({name:"ChooseResizedImage",label:e.finder.lang.chooseResizedImage.title,isActive:t.get("folder").get("acl").imageResize||v(t),icon:"ckf-choose-resized",action:function(){l(e.finder,t)}}).set("active",v(t))}),e.data.items.add(new i.Model({name:"ChooseResizedImage",label:e.finder.lang.chooseResizedImage.title,isActive:t.get("folder").get("acl").imageResize||v(t),icon:"ckf-choose-resized",action:function(){l(e.finder,t)}})))}function o(e){var t=e.data.file;if(m(e,function(){p(e.finder,t)}),t.isImage()&&e.finder.config.resizeImages){var n=t.has("imageResizeData")&&t.get("imageResizeData").has("originalSize"),r=new i.Model({name:"ChooseResizedImage",type:"button",priority:F,alignment:"primary",icon:"ckf-choose-resized",label:e.finder.lang.chooseResizedImage.title,isDisabled:!(t.get("folder").get("acl").imageResize||v(t)),action:function(){l(e.finder,t)}});n||(t.once("change:imageResizeData",function(){r.set("isDisabled",!v(t))}),e.finder.request("image:getResized",{file:t})),e.data.toolbar.push(r)}}function s(e){m(e,function(){a(e.finder,e.finder.request("files:getSelected"))})}function a(e,t){var i=t.clone();i.forEach(function(t){!t.getUrl()&&t.get("folder").getResourceType().get("useProxyCommand")&&t.set("url",e.request("file:getProxyUrl",{file:t}))}),e.fire("files:choose",{files:i},e),y(e)}function l(e,t){var r=new i.Collection,o=e.config.initConfigInfo.images;g(r,e,t,o),t.on("change:imageResizeData",function(){r.reset(),g(r,e,t,o)}),e.request("dialog",{title:e.lang.chooseResizedImage.title,name:"ChooseResizedImage",buttons:["ok","cancel"],view:new n({finder:e,collection:r}),context:{file:t}})}function d(n){var r=this.finder,o=n.file,s=new t.Deferred;if(o.has("imageResizeData")&&o.get("imageResizeData").has("originalSize"))s.resolve(o);else{var a=o.get("folder");r.once("command:after:GetResizedImages",function(t){var n=t.data.context.file,r=new i.Model;t.data.response.resized&&r.set("resized",t.data.response.resized),t.data.response.originalSize&&r.set("originalSize",t.data.response.originalSize),e.forEach(t.data.response.resized,function(t,i){if(i!==C){var n={fileName:t.name?t.name:t};t.url&&(n.url=t.url),r.set(w(i),n,{silent:!0})}else e.forEach(t,function(e){var t=e.name?e.name:e,n=t.match(k);if(n){var o={fileName:t};e.url&&(o.url=e.url),r.set(w(i,n[1]),o,{silent:!0})}})}),n.set("imageResizeData",r),t.data.context.dfd.resolve(n)});var l={fileName:o.get("name")};e.isArray(r.config.resizeImages)&&r.config.resizeImages.length&&(l.sizes=r.config.resizeImages.join(",")),r.request("command:send",{name:"GetResizedImages",folder:a,params:l,context:{dfd:s,file:o}})}return s.promise()}function c(e){var n=this.finder,r=e.file,o=new t.Deferred,s=e.size;if(!e.name)throw"The data.name parameter is required";if(e.name===C){if(!e.size)throw'The data.size parameter is required when using "{name}".'.replace("{name}",C);s=e.size}else{if(!n.config.initConfigInfo.images.sizes[e.name])throw'The name "{name}" is not configured for resized images'.replace("{name}",e.name);s=n.config.initConfigInfo.images.sizes[e.name]}if(r.has("imageResizeData")&&r.get("imageResizeData").has("resizedUrl"+s))o.resolve(r);else{var a=r.get("folder");n.once("command:after:ImageResize",function(t){var n=t.data.context.file,r=t.data.response.url,o=n.get("imageResizeData");if(o||(o=new i.Model,n.set("imageResizeData",o)),e.save){var s=o.get("resized");s||(s={},o.set("resized",s)),s.__custom||(s.__custom=[]),s.__custom.push(r.match(M)[0])}o.set(w(e.name,e.size),{url:r}),t.data.context.dfd.resolve(n)}),n.request("command:send",{name:"ImageResize",folder:a,type:"post",params:{fileName:r.get("name"),size:s},context:{dfd:o,file:r}})}return o.promise()}function u(t){var i=this.finder,n=t.file,r=e.extend({fileName:n.get("name")},t.params);return t.cache?r.cache=t.cache:i.config.initConfigInfo.proxyCache&&(r.cache=i.config.initConfigInfo.proxyCache),i.request("command:url",{command:"Proxy",params:r,folder:n.get("folder")})}function f(e){var i=this.finder,n=e.file,r=new t.Deferred,o=n.getUrl();return n.get("folder").getResourceType().get("useProxyCommand")&&(o=i.request("file:getProxyUrl",e)),o?r.resolve(o):i.request("command:send",{name:"GetFileUrl",folder:n.get("folder"),params:{fileName:n.get("name")},context:{dfd:r,file:n}}),r.promise()}function h(e){var i=this.finder,n=e.file,r=new t.Deferred;return i.request("command:send",{name:"GetFileUrl",folder:n.get("folder"),params:{fileName:n.get("name"),thumbnail:e.thumbnail},context:{dfd:r,file:n,thumbnail:e.thumbnail}}),r.promise()}function g(t,i,n,r){var o=n.get("imageResizeData"),s=o&&o.get("originalSize")||"",a=n.get("folder").get("acl").imageResize,l=n.get("folder").get("acl").imageResizeCustom,d=t.add({label:i.lang.chooseResizedImage.originalSize,size:s,name:"original",isActive:!0,isDefault:!1}),c=o&&o.get("resized"),u=!0;if(e.forEach(r.sizes,function(n,r){var o=n,l=a;if(!e.isArray(i.config.resizeImages)||!i.config.resizeImages.length||e.contains(i.config.resizeImages,r)){if(c&&c[r]){var d=c[r].match(k);2===d.length&&(o=d[1]),l=!0}else if(s){var f=s.split("x"),h=n.split("x"),g=parseInt(h[0]),p=parseInt(h[1]),m=parseInt(f[0]),v=parseInt(f[1]),w=function(e,t,i,n){var r={width:e,height:t},o=e/i,s=t/n;return 1===o&&1===s||(o<s?r.height=parseInt(Math.round(n*o)):o>s&&(r.width=parseInt(Math.round(i*s)))),r.height<=0&&(r.height=1),r.width<=0&&(r.width=1),r}(g,p,m,v);m<=w.width&&v<=w.height?l=!1:o=w.width+"x"+w.height}t.add({label:i.lang.chooseResizedImage.sizes[r]?i.lang.chooseResizedImage.sizes[r]:r,size:o,name:r,isActive:l,isDefault:u&&l}),u=!1}}),c&&c.__custom){var f=[];e.forEach(c.__custom,function(e){var t=e.match(k);t&&(t=t[1],f.push({label:t,size:t,width:parseInt(t.split("x")[0]),name:C+"_"+t,url:e,isActive:!0}))}),e.chain(f).sortBy("width").forEach(function(e){t.add(e)})}if(l){var h=0,g=0;if(s){var p=s.split("x");h=p[0],g=p[1]}t.add({name:C,custom:!0,isActive:l,isDefault:!1,width:h,height:g,size:h+"x"+g})}t.findWhere({isDefault:!0})||d.set("isDefault",!0)}function p(e,t){var n=t.getUrl(),r=new i.Collection([t]);return n?void a(e,r):(b(e),void e.request("file:getUrl",{file:t}).then(function(){e.request("loader:hide"),a(e,r)}))}function m(e,t){e.data.toolbar.push({name:"Choose",type:"button",priority:x,icon:"ckf-choose",label:e.finder.lang.common.choose,action:t})}function v(t){var i=t.get("folder").get("acl"),n=t.has("imageResizeData")&&!!e.size(t.get("imageResizeData").get("resized"));return i.imageResize||i.imageResizeCustom||n}function w(e,t){return e===C?"resizedUrl_custom"+t:"resizedUrl_"+e}function y(e){e.config.chooseFilesClosePopup&&e.request("closePopup")}function b(e){e.request("loader:show",{text:e.lang.files.gettingFileData+" "+e.lang.common.pleaseWait})}var C="__custom",F=100,x=110,k="([0-9]+x[0-9]+)[.][a-zA-Z]{1,5}$",M="/([^/]+$)";return function(e){this.finder=e,this.isEnabled=e.config.chooseFiles,e.config.ckeditor&&(e.on("files:choose",function(t){var i=t.data.files.pop();e.request("file:getUrl",{file:i}).then(function(){var t={fileUrl:i.getUrl(),fileSize:i.get("size"),fileDate:i.get("date")};e.config.ckeditor.callback(t.fileUrl,t)})}),e.on("file:choose:resizedImage",function(t){var i=t.data.file,n={fileUrl:t.data.resizedUrl,fileSize:0,fileDate:i.get("date")};e.config.ckeditor.callback(t.data.resizedUrl,n)})),this.isEnabled&&(e.on("contextMenu:file",function(e){e.data.groups.add({name:"choose"})},null,null,10),e.on("contextMenu:file:choose",r),e.on("toolbar:reset:Main:file",o),e.on("toolbar:reset:Main:files",s),e.on("command:ok:SaveImage",function(e){e.data.context.file.set("imageResizeData",new i.Model)}),e.setHandlers({"image:getResized":{callback:d,context:this},"image:resize":{callback:c,context:this},"image:getResizedUrl":{callback:h,context:this},"files:choose":{context:this,callback:function(t){a(e,t.files)}},"internal:file:choose":{context:this,callback:function(t){p(e,t.file)}}})),e.setHandlers({"file:getUrl":{callback:f,context:this},"file:getProxyUrl":{callback:u,context:this}}),e.on("command:after:GetFileUrl",function(e){e.data.context.thumbnail||e.data.context.file.set("url",e.data.response.url),e.data.context.dfd.resolve(e.data.response.url)}),e.on("dialog:ChooseResizedImage:ok",function(t){var i=t.data.view.getSelected();(function(e,t,i,n,r){function o(t,i){e.request("loader:hide"),e.fire("file:choose:resizedImage",{file:t,resizedUrl:i},e),y(e)}if("original"!==t){0===t.indexOf(C+"_")&&(t=C);var s=n.get("imageResizeData"),a=w(t,i);if(s&&s.has(a)){var l=s.get(a),d={file:n};if(l.url)return void o(n,l.url);var c="file:getUrl";return"original"!==t&&l.fileName&&(c="image:getResizedUrl",d.thumbnail=l.fileName),b(e),void e.request(c,d).then(function(e){o(n,e)})}b(e),e.request("image:resize",{file:n,size:i,name:t,save:r}).then(function(e){o(e,e.get("imageResizeData").get(a).url)})}else p(e,n)})(e,i.get("name"),i.get("size"),t.data.context.file),e.request("dialog:destroy")})}}),CKFinder.define("CKFinder/Views/Base/Instant/CollectionView",["underscore","jquery","marionette","CKFinder/Views/Base/Common"],function(e,t,i,n){"use strict";var r=i.CollectionView;return r.extend(n.proto).extend({constructor:function(e){n.util.construct.call(this,e),r.prototype.constructor.apply(this,Array.prototype.slice.call(arguments))},_renderChildren:function(){this.destroyEmptyView(),this.attachCollectionHTML(""),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this._showInstantCollection(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},_onCollectionAdd:function(e,i){var n=i.indexOf(e),r=this.getChildViews(),o=t(this.instantRenderChild(e));this.destroyEmptyView(),n>=r.length?this.$el.append(o):o.insertBefore(r.eq(n)),this.triggerMethod("childview:render")},_onCollectionRemove:function(e){var t=this.getChildViewElement(e).remove();this.removeChildView(t),this.checkEmpty()},_sortViews:function(){var t=this._filteredSortedModels();e.find(t,function(e,t){var i=this.getChildViewElement(e);if(i.length)return this.getChildViews().index(i)!==t},this)&&this.resortView()},_showInstantCollection:function(){var t=this._filteredSortedModels(),n=[],r=this.getOption("childViewOptions");r=i._getValue(r,this,[void 0,0]),e.each(t,function(e,t){n.push(this.getPreRenderer(e).preRender(e,r,t))},this),this.attachCollectionHTML(n.join(""))},buildChildView:function(t,n,r){var o=new n(e.extend({model:t,finder:this.finder},r));return i.MonitorDOMRefresh(o),o},getChildViewElement:function(e){return this.$(document.getElementById(e.cid))},attachCollectionHTML:function(e){this.el.innerHTML=e},getPreRenderer:function(){throw"Not implemented"},getChildViews:function(){throw"Not implemented"},instantRenderChild:function(){throw"Not implemented"}})}),CKFinder.define("CKFinder/Modules/Files/Views/Common/FilesViewMixin",["underscore","jquery","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(e){return"childview:"+(e.get("view:isFolder")?"folder":"file")+":"}return{getMethods:function(){return{shouldFocusFirstChild:function(){if(this.el===document.activeElement&&this.collection.length){var e=this.collection.first();return e.trigger("focus",e),!0}return!1},getEmptyViewData:function(){var e,t=!1;if(this.collection.isLoading){var i=this.finder.lang.files.loadingFilesPane;e={title:this.finder.lang.common.pleaseWait+" "+i.title,text:i.text},t=!0}else e=this.collection.isFiltered?this.finder.lang.files.filterFilesEmpty:this.finder.lang.files.emptyFilesPane;return{title:e.title,text:e.text,displayLoader:t}},updateHeightForBorders:function(e){var t=parseInt(getComputedStyle(this.el).getPropertyValue("padding-top")),i=parseInt(getComputedStyle(this.el).getPropertyValue("padding-bottom")),n=parseInt(getComputedStyle(this.el).getPropertyValue("border-top-width")),r=parseInt(getComputedStyle(this.el).getPropertyValue("border-bottom-width")),o=e.height-t-i-n-r;return this.$el.css({"min-height":o}),o},checkDoubleTap:function(e){var i=e.currentTarget.id,r=t(e.currentTarget),o=r.data("ckf-in-touch-at"),s=e.timeStamp;r.data("ckf-in-touch-at",s);var a=o&&s-o<500,l=this.collection.get(i);this.trigger(n(l)+(a?"dbltap":"touch"),{evt:e,model:l})}}},attachModelEvents:function(t,i){e.each({focus:function(e){this.getChildViewElement(e).find(".ui-btn").focus(),this.trigger("file:focused",e)},refresh:function(e){this.refreshView(e)},selected:function(e){this.getChildViewElement(e).find(".ui-btn").addClass("ui-btn-active")},deselected:function(e){this.getChildViewElement(e).find(".ui-btn").removeClass("ui-btn-active")},change:function(e){e.changed.name&&this.refreshView(e)}},function(e,n){i.listenTo(t,n,e)})},getEvents:function(r){var o={keydown:function(e){if(e.keyCode!==i.tab||!this.finder.util.isShortcut(e,"")&&!this.finder.util.isShortcut(e,"shift"))if(e.target!==this.el&&e.target!==this.$el.find(".ckf-files-view").get(0)){if(e.target!==e.currentTarget){var o=t(e.target).closest(r),s=o.get(0).id,a=this.collection.get(s);if(e.keyCode===i.menu||e.keyCode===i.f10&&this.finder.util.isShortcut(e,"shift"))return void this.trigger(n(a)+"contextmenu",{el:o,evt:e,model:a});this.trigger(n(a)+"keydown",{evt:e,model:a,el:o})}}else this.trigger("keydown",{evt:e});else this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e})},focus:function(e){setTimeout(function(){(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)},20),e.target===e.currentTarget&&this.collection.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("focused"))}},s={touchstart:function(e){var i=e.currentTarget.id,r=t(e.currentTarget);r.data("ckf-in-touch",!0);var o=r.data("ckf-in-touch-timeout");o&&clearTimeout(o);var s=this;o=setTimeout(function(){if(r.data("ckf-in-touch")){var t=s.collection.get(i);if(!t)return;s.trigger(n(t)+"longtouch",{evt:e,model:t}),r.data("ckf-in-touch",!1)}r.data("ckf-in-touch-timeout",void 0)},700),r.data("ckf-in-touch-timeout",o)},touchend:function(e){var i=e.currentTarget.id,r=t(e.currentTarget);if(this.checkDoubleTap(e),r.data("ckf-in-touch")){var o=this.collection.get(i);if(!o)return;this.trigger(n(o)+"click",{evt:e,model:o})}r.data("ckf-in-touch",!1)},touchcancel:function(e){t(e.currentTarget).data("ckf-in-touch",!1)},touchmove:function(e){t(e.currentTarget).data("ckf-in-touch",!1)},contextmenu:function(e){var i=e.currentTarget.id,r=this.collection.get(i);t(e.currentTarget).data("ckf-in-touch")?e.preventDefault():this.trigger(n(r)+"contextmenu",{evt:e,model:r,el:document.getElementById(i)})},click:function(e){var t=e.currentTarget.id,i=this.collection.get(t);this.trigger(n(i)+"click",{evt:e,model:i,el:document.getElementById(t)})},dblclick:function(e){var t=this.collection.get(e.currentTarget.id);this.trigger(n(t)+"dblclick",{evt:e,model:t})},dragstart:function(e){var t=this.collection.get(e.currentTarget.id);this.trigger(n(t)+"dragstart",{evt:e,model:t})},dragend:function(e){function t(e){e.cancel()}var i=this,r=i.collection.get(e.currentTarget.id);i.finder.on("ui:swipeleft",t,null,null,1),i.finder.on("ui:swiperight",t,null,null,1),setTimeout(function(){this.finder.removeListener("ui:swipeleft",t),this.finder.removeListener("ui:swiperight",t)},500),i.trigger(n(r)+"dragend",{evt:e,model:r})},blur:function(e){e.target.tabIndex=-1},focus:function(e){e.target.tabIndex=0}};return e.forEach(s,function(e,t){o[t+" "+r]=e}),o}}}),CKFinder.define("text!CKFinder/Templates/Files/FilesInfo.dot",[],function(){return'{{? it.displayLoader }}\n<div class="ui-loader ui-loader-verbose ui-content ui-body-{{= it.swatch }} ui-corner-all">\n\t<span class="ui-icon-loading"></span>\n\t<h1>{{= it.title }}</h1>\n</div>\n{{??}}\n<div class="ckf-files-info-body ui-content ui-body-{{= it.swatch }} ui-corner-all">\n\t<h2>{{= it.title }}</h2>\n\t{{? it.displayLoader }}<p>{{= it.text }}</p>{{?}}\n</div>\n{{?}}\n'}),CKFinder.define("CKFinder/Modules/Files/Views/Common/FilesInfoView",["backbone","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Files/FilesInfo.dot"],function(e,t,i){"use strict";return t.extend({name:"FilesInfoView",template:i,className:"ckf-files-info",templateHelpers:function(){return{swatch:this.finder.config.swatch}},initialize:function(){this.model=new e.Model({title:this.title,text:this.text,displayLoader:this.displayLoader})}})}),CKFinder.define("text!CKFinder/Templates/Files/FileView.dot",[],function(){return'<a href="javascript:void(0)" class="ckf-files-inner ui-btn" tabindex="-1" draggable="true" role="listitem" aria-label="{{! it.name }}" aria-describedby="{{! it.descriptionId }}" data-ckf-drag-preview="{{= it.dragPreviewId }}" data-ckf-view="{{= it.cid }}">\n\t<img id="{{= it.dragPreviewId }}" class="ui-li-thumb" alt="" src="{{= it.getIcon() }}" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}"/>\n\t{{? it.displayName || it.displayDate || it.displaySize }}\n\t<div class="ckf-file-desc ui-bar-{{= it.config.swatch}}" draggable="true">\n\t\t{{? it.displayName }}<h2 title="{{! it.name }}" dir="auto">{{! it.name }}</h2>{{?}}\n\t\t<p draggable="true" id="{{! it.descriptionId }}" data-ckf-drag-preview="{{= it.dragPreviewId }}">\n\t\t\t{{? it.displayDate }}{{! it.lang.formatDateString( it.date ) }}{{?}}\n\t\t\t{{? it.displaySize }}\n\t\t\t\t{{? it.displayDate }}<br>{{?}}\n\t\t\t\t{{! it.lang.formatFileSize( it.size * 1024 ) }}\n\t\t\t{{?}}\n\t\t</p>\n\t</div>\n\t{{?}}\n</a>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView/FileRenderer",["text!CKFinder/Templates/Files/FileView.dot"],function(e){"use strict";function t(e,t){this.finder=e,this.renderer=t}return t.prototype.preRender=function(t,i){var n=this.finder,r={lazyThumb:i.lazyThumb,displayName:i.displayName,displaySize:i.displaySize,displayDate:i.displayDate,descriptionId:"ckf-file-desc-"+t.cid,dragPreviewId:"ckf-drag-prev-"+t.cid,getIcon:function(){return n.request("file:getIcon",{size:i.thumbSize,file:t})}},o='<li id="'+t.cid+'" class="ckf-file-item ui-li-has-thumb'+(t.isImage()?" ckf-lazy-thumb":" ckf-file-icon")+'"'+("list"===i.mode?"":' style="width:'+i.thumbSize+"px;height:"+i.thumbSize+'px;"')+' data-icon="false" role="presentation">';return(o+=this.renderer.render(t,"FileThumb",e,r))+"</li>"},t}),CKFinder.define("text!CKFinder/Templates/Files/FolderInFile.dot",[],function(){return'<a class="ckf-files-inner ui-btn" tabindex="-1" draggable="false" data-ckf-drop="true">\n\t<img class="ui-li-thumb" alt="{{! it.label || it.name }}" src="{{= it.getIcon() }}" data-ckf-drop="true">\n\n\t<div class="ckf-file-desc ui-bar-{{= it.config.swatch }}">\n\t\t<h2 title="{{! it.label || it.name }}" data-ckf-drop="true">{{! it.label || it.name }}</h2>\n\t</div>\n</a>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView/FolderRenderer",["text!CKFinder/Templates/Files/FolderInFile.dot"],function(e){"use strict";function t(e,t){this.finder=e,this.renderer=t}return t.prototype.preRender=function(t,i){var n=this.finder,r={lazyThumb:i.lazyThumb,displayName:i.displayName,displaySize:i.displaySize,displayDate:i.displayDate,descriptionId:"ckf-file-desc-"+t.cid,dragPreviewId:"ckf-drag-prev-"+t.cid,getIcon:function(){return n.request("folder:getIcon",{size:i.thumbSize,folder:t})}};return'<li id="'+t.cid+'" class="ckf-file-item ckf-folders-item" data-icon="false" role="presentation"'+("list"===i.mode?"":' style="width:'+i.thumbSize+"px;height:"+i.thumbSize+'px;"')+">"+this.renderer.render(t,"FolderThumb",e,r)+"</li>"},t}),CKFinder.define("CKFinder/Util/Throttlers",["underscore","jquery"],function(e,t){"use strict";function i(){this.reset()}var n={};return i.prototype={reset:function(){var e=this;e.dfd&&e.dfd.reject(),e.dfd=new t.Deferred,e.dfd.done(function(){e.callback&&e.callback(),e.reset()}),e.timeOutId=-1},assignJob:function(e){this.callback=e},runAfter:function(e){var t=this;t.timeOutId&&clearTimeout(t.timeOutId),t.timeOutId=setTimeout(function(){t.dfd.resolve()},e)}},{getOrCreate:function(t,r){return e.has(n,t)||(n[t]=new i),n[t].reset(),n[t].assignJob(r),n[t]}}}),CKFinder.define("CKFinder/Modules/Files/Views/ThumbnailsView",["underscore","jquery","marionette","CKFinder/Views/Base/Instant/CollectionView","CKFinder/Modules/Files/Views/Common/FilesViewMixin","CKFinder/Modules/Files/Views/Common/FilesInfoView","CKFinder/Modules/Files/Views/ThumbnailsView/FileRenderer","CKFinder/Modules/Files/Views/ThumbnailsView/FolderRenderer","CKFinder/Util/Throttlers"],function(e,t,i,n,r,o,s,a,l){"use strict";var d={name:"ThumbnailsView",reorderOnSort:!0,className:"ckf-files-view ckf-files-view-borders ui-body-inherit",attributes:{"data-role":"listview",tabindex:30,role:"list"},tagName:"ul",invertKeys:!1,collectionEvents:{change:function(t){var n=t.changed;if(n.name||n.date||n.size){var r=this.getChildViewElement(t),o=this.getOption("childViewOptions");o=i._getValue(o,this,[void 0,0]);var s=e.defaults(o,{lazyThumb:this.finder.request("file:getThumb",{file:t,size:o.thumbSizeString})});r.replaceWith(this.getPreRenderer(t).preRender(t,s)),this.triggerMethod("childview:render");var a=this.getOption("displayConfig").get("thumbSize");"thumbs"===this.getOption("displayConfig").get("mode")&&this.resizeThumbs(a)}}},initialize:function(e){var t=this;if(e.displayConfig.set({mode:"list",thumbSizeString:null,currentThumbConfigSize:0,thumbClassName:""}),"thumbs"===e.mode){var i=t.getOption("displayConfig").get("thumbSize");this.calculateThumbSizeConfig(i),this.resizeThumbs(i),this.applyBiggerThumbs(i),t.setThumbsMode()}else t.setListMode();r.attachModelEvents(this.collection,this),t.on("file:focused",function(e){var t=this;setTimeout(function(){var i=t.$el.closest('[data-role="page"]'),n=parseInt(t.$el.offset().top),r=t.collection.indexOf(e),o=t.getThumbsInRow();if(r<o&&(window.scrollY||window.pageYOffset)&&n)window.scrollTo(0,0);else{var s=t.collection.length%o;r>=t.collection.length-(s||o)&&window.scrollTo(0,i.outerHeight())}},20)}),t.once("render",function(){t.$el.trigger("create"),t.$el.attr("aria-label",t.finder.lang.files.filesPaneTitle)}),t.once("show",function(){function e(e){t.trigger("click",{evt:e})}var i=t.$el.closest(".ckf-page-regions");i.on("click",e),t.once("destroy",function(){i.off("click",e)})}),t.on("render",function(){var e=t.finder.request("folder:getActive"),i=e&&e.cid;t.finder.config.displayFoldersPanel||t.lastFolderCid||t.focus(),t.lastFolderCid=i,"list"===t.getOption("displayConfig").get("mode")?t.setListMode():t.setThumbsMode()}),t.on("maximize",t.updateHeightForBorders,t)},childViewOptions:function(){return this.getOption("displayConfig").toJSON()},applySizeClass:function(t){var i=this,n=!1;e.forEach(i.finder.config.thumbnailClasses,function(e,r){!n&&t<r?(i.$el.addClass("ckf-files-thumbs-"+e),n=!0):i.$el.removeClass("ckf-files-thumbs-"+e)})},calculateThumbSizeConfig:function(t){if(t&&this.getOption("displayConfig").get("areThumbnailsResizable")){var i=this.getOption("displayConfig").get("serverThumbs"),n=e.filter(i,function(e){return e>=t}),r=e.isEmpty(n)?e.max(i):e.min(n),o=this.getOption("displayConfig").get("thumbnailConfigs")[r];return this.getOption("displayConfig").set("thumbSizeString",o.thumb),this.getOption("displayConfig").set("currentThumbConfigSize",r),o}},resizeThumbs:function(e){this.$el.find(".ckf-file-item").css({width:e+"px",height:e+"px"});var t=this;setTimeout(function(){t.trigger("sizeUpdate:after")},400)},applyBiggerThumbs:function(e){var i=this;if(e&&"thumbs"===i.getOption("displayConfig").get("mode")){e=parseInt(e,10),this.applySizeClass(e);var n=this.getOption("displayConfig").get("currentThumbConfigSize");if(!n||e>n){var r=this.calculateThumbSizeConfig(e);l.getOrCreate("files:resize",function(){i.$el.find("li").not(".ckf-file-icon").addClass("ckf-lazy-thumb"),i.$el.find("li.ckf-file-icon").each(function(){t(this).find("img").attr("src",i.finder.request("file:getIcon",{size:e,file:i.collection.get(this.id)}))}),i.$el.find("li.ckf-folders-item img").attr("src",i.finder.request("folder:getIcon",{size:e})),i.children.invoke("trigger","sizeUpdate",{thumbSize:e,thumbSizeString:r.thumb}),i.trigger("sizeUpdate:after")}).runAfter(500)}else setTimeout(function(){i.trigger("sizeUpdate:after")},400)}},setListMode:function(){this.getOption("displayConfig").set("mode","list"),this.$el.removeClass("ckf-files-thumbs").addClass("ckf-files-list"),this.$el.find(".ckf-file-item").css({width:"auto",height:"auto"})},setThumbsMode:function(){this.getOption("displayConfig").set("mode","thumbs"),this.$el.removeClass("ckf-files-list").addClass("ckf-files-thumbs")},getThumbsInRow:function(){if("list"===this.getOption("displayConfig").get("mode")||this.collection.length<2)return 1;var e=this.getChildViewElement(this.collection.first());if(!e.length)return 1;var t,i=e.offset().top,n=1;for(t=1;t<this.collection.length&&this.getChildViewElement(this.collection.at(t)).offset().top===i;t++)n+=1;return n},focus:function(){this.$el.focus()},getEmptyView:function(){var e=this.getEmptyViewData();return o.extend({title:e.title,text:e.text,displayLoader:e.displayLoader,displayInfo:!this.finder.config.readOnly})},getChildViews:function(){return this.$("li")},reorder:function(){var t=this,i=this._filteredSortedModels();if(e.some(i,function(e){return!t.getChildViewElement(e).length}))this.render();else{var n=e.map(i,function(e){return t.getChildViewElement(e)}),r=this.getChildViews(),o=e.filter(r,function(e){return-1===r.index(e)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(n),o.length,this.checkEmpty(),this.triggerMethod("reorder")}},instantRenderChild:function(t){var n=this.getOption("childViewOptions");n=i._getValue(n,this,[void 0,0]);var r=e.defaults(n,{lazyThumb:this.finder.request("file:getThumb",{file:t,size:n.thumbSizeString})});return this.getPreRenderer(t).preRender(t,r)},refreshView:function(){},getPreRenderer:function(e){return e.get("view:isFolder")?new a(this.finder,this.finder.renderer):new s(this.finder,this.finder.renderer)}};return e.extend(d,r.getMethods()),d.events=e.extend({"mouseenter img":function(e){var i=t(e.currentTarget).closest("li"),n=setTimeout(function(){i.addClass("ckf-file-show-thumb"),i.data("ckf-description-timeout",void 0)},1e3);i.data("ckf-description-timeout",n)},"mouseleave img":function(e){var i=t(e.currentTarget).closest("li"),n=i.data("ckf-description-timeout");n&&(clearTimeout(n),i.data("ckf-description-timeout",void 0)),i.removeClass("ckf-file-show-thumb")}},r.getEvents("li")),n.extend(d)}),CKFinder.define("text!CKFinder/Templates/Files/List/FileIconCell.dot",[],function(){return'<img id="{{= it.dragPreviewId }}" class="ui-li-thumb" alt="" src="{{= it.getIcon() }}" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}" />'}),CKFinder.define("text!CKFinder/Templates/Files/List/FileNameCell.dot",[],function(){return'<a class="ui-btn" href="" tabindex="-1" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}" title="{{! it.name }}">\n\t<span dir="auto" class="ckf-files-inner">{{! it.name }}</span>\n</a>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FileRowRenderer",["underscore","text!CKFinder/Templates/Files/List/FileIconCell.dot","text!CKFinder/Templates/Files/List/FileNameCell.dot"],function(e,t,i){"use strict";function n(e,t){this.finder=e,this.renderer=t}return n.prototype.preRender=function(n,r){var o=this.finder,s=this.renderer,a={lazyThumb:r.lazyThumb,displayName:r.displayName,displaySize:r.displaySize,displayDate:r.displayDate,descriptionId:"ckf-file-desc-"+n.cid,dragPreviewId:"ckf-drag-prev-"+n.cid,getIcon:function(){return o.request("file:getIcon",{size:r.listViewIconSize,file:n})}},l='<tr id="'+n.cid+'" class="ckf-file-item">';return r.collection.forEach(function(r){var d=r.get("name");if("icon"!==d)if("name"!==d)if("date"!==d)if("size"!==d)if("empty"!==d){var c={template:void 0,templateHelpers:void 0};o.fire("listView:file:column:"+d,c),l+=c.template&&c.template.length?s.render(n,"CustomFileCellView-"+d,c.template,e.extend({},a,c.templateHelpers)):s.render(n,"EmptyCellView","<td></td>",a)}else l+=s.render(n,"EmptyCellView","<td></td>",a);else l+=s.render(n,"SizeCellView","<td>{{! it.lang.formatFileSize( it.size * 1024 ) }}</td>",a);else l+=s.render(n,"DateCellView","<td>{{! it.lang.formatDateString( it.date ) }}</td>",a);else l+=s.render(n,"FileNameCellView",'<td class="ckf-files-list-view-col-name ui-body-inherit">'+i+"</td>",a);else l+=s.render(n,"FileIconCellView","<td>"+t+"</td>",a)}),l+="</tr>"},n}),CKFinder.define("text!CKFinder/Templates/Files/List/FolderNameCell.dot",[],function(){return'<a class="ui-btn" href="" tabindex="-1" draggable="false" data-ckf-drop="true" title="{{! it.label || it.name }}">\n\t<span dir="auto" class="ckf-files-inner">{{! it.label || it.name }}</span>\n</a>'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView/FolderRowRenderer",["underscore","text!CKFinder/Templates/Files/List/FileIconCell.dot","text!CKFinder/Templates/Files/List/FolderNameCell.dot"],function(e,t,i){"use strict";function n(e,t){this.finder=e,this.renderer=t}return n.prototype.preRender=function(n,r){var o=this.finder,s=this.renderer,a={lazyThumb:r.lazyThumb,displayName:r.displayName,displaySize:r.displaySize,displayDate:r.displayDate,descriptionId:"ckf-folder-desc-"+n.cid,dragPreviewId:"ckf-drag-prev-"+n.cid,getIcon:function(){return o.request("folder:getIcon",{size:r.listViewIconSize})}},l='<tr id="'+n.cid+'" class="ckf-folder-item" data-ckf-drop="true">';return r.collection.forEach(function(r){var d=r.get("name");if("icon"!==d)if("name"!==d)if("empty"!==d&&"size"!==d&&"date"!==d){var c={template:void 0,templateHelpers:void 0};o.fire("listView:folder:column:"+d,c),l+=c.template&&c.template.length?s.render(n,"CustomFolderCellView-"+d,c.template,e.extend({},a,c.templateHelpers)):s.render(n,"EmptyCellView","<td></td>",a)}else l+=s.render(n,"EmptyCellView","<td></td>",a);else l+=s.render(n,"FileNameCellView",'<td class="ckf-files-list-view-col-name ui-body-inherit">'+i+"</td>",a);else l+=s.render(n,"FolderIconCellView","<td>"+t+"</td>",a)}),l+="</tr>"},n}),CKFinder.define("text!CKFinder/Templates/Files/List/ListView.dot",[],function(){return'<table class="ckf-files-view ckf-files-list-view">\n<thead>\n\t<tr>\n\t\t{{~ it.columns.models : column }}\n\t\t\t<th{{? column.get("sort") }} data-ckf-sort="{{= column.get("sort") }}"{{?}}{{? column.get("width") }} style="width:{{= column.get("width") }};"{{?}}>\n\t\t\t\t{{= column.get( "label" ) }}\n\t\t\t\t{{? column.get("sort") === it.sortBy }}\n\t\t\t\t\t<span class="ckf-files-list-view-sorter">{{? it.sortByOrder === \'asc\' }}{{= it.asc }}{{?? it.sortByOrder === \'desc\' }}{{= it.desc }}{{?}}</span>\n\t\t\t\t{{?}}\n\t\t\t</th>\n\t\t{{~}}\n\t</tr>\n</thead>\n<tbody></tbody>\n</table>\n'}),CKFinder.define("text!CKFinder/Templates/Files/FilesInfoInListView.dot",[],function(){return'<td>\n\t<div class="ckf-files-info">\n\t{{? it.displayLoader }}\n\t<div class="ui-loader ui-loader-verbose ui-content ui-body-{{= it.swatch }} ui-corner-all">\n\t\t<span class="ui-icon-loading"></span>\n\t\t<h1>{{= it.title }}</h1>\n\t</div>\n\t{{??}}\n\t<div class="ckf-files-info-body ui-content ui-body-{{= it.swatch }} ui-corner-all">\n\t\t<h2>{{= it.title }}</h2>\n\t\t{{? it.displayLoader }}<p>{{= it.text }}</p>{{?}}\n\t</div>\n\t{{?}}\n\t</div>\n</td>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/ListView",["underscore","jquery","backbone","marionette","CKFinder/Views/Base/Instant/CollectionView","CKFinder/Modules/Files/Views/Common/FilesViewMixin","CKFinder/Modules/Files/Views/ListView/FileRowRenderer","CKFinder/Modules/Files/Views/ListView/FolderRowRenderer","CKFinder/Modules/Files/Views/Common/FilesInfoView","text!CKFinder/Templates/Files/List/ListView.dot","text!CKFinder/Templates/Files/FilesInfoInListView.dot"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";var u={name:"ListView",attributes:{tabindex:30},tagName:"div",className:"ckf-files-view-borders ui-body-inherit",reorderOnSort:!0,childViewContainer:"tbody",template:d,invertKeys:!0,initialize:function(e){this.columns=new i.Collection([],{comparator:"priority"}),this.model=new i.Model,o.attachModelEvents(this.collection,this),this.model.set("asc","&#9650;"),this.model.set("desc","&#9660;"),this.updateColumns(),this.listenTo(e.displayConfig,"change:sortBy",this.updateSortIndicator),this.listenTo(e.displayConfig,"change:sortByOrder",this.updateSortIndicator),this.on("maximize",this.updateHeightForBorders,this)},childViewOptions:function(){var e=this.getOption("displayConfig").toJSON();return e.collection=this.columns,e},onBeforeRender:function(){this.updateColumns()},isEmpty:function(){var e=!this.collection.length;return this.$el.toggleClass("ckf-files-list-empty",e),e},getEmptyView:function(){var e=this.getEmptyViewData();return l.extend({title:e.title,text:e.text,displayLoader:e.displayLoader,displayInfo:!this.finder.config.readOnly,template:c,tagName:"tr",className:""})},updateColumns:function(){var e=new i.Collection,t=this.getOption("displayConfig").get("listViewIconSize")-4+"px";e.add({name:"icon",label:"",priority:10,width:t}),e.add({name:"name",label:this.finder.lang.settings.displayName,priority:20,sort:"name"}),this.getOption("displayConfig").get("displaySize")&&e.add({name:"size",label:this.finder.lang.settings.displaySize,priority:30,sort:"size"}),this.getOption("displayConfig").get("displayDate")&&e.add({name:"date",label:this.finder.lang.settings.displayDate,priority:40,sort:"date"}),this.finder.fire("listView:columns",{columns:e}),this.columns.reset(e.toArray()),this.model.set("columns",this.columns),this.model.set("sortBy",this.getOption("displayConfig").get("sortBy")),this.model.set("sortByOrder",this.getOption("displayConfig").get("sortByOrder"))},getThumbsInRow:function(){return 1},updateSortIndicator:function(){var e=this.getOption("displayConfig").get("sortBy"),t=this.getOption("displayConfig").get("sortByOrder");this.$el.find("th .ckf-files-list-view-sorter").html("asc"===t?this.model.get("asc"):this.model.get("desc")).appendTo(this.$el.find('th[data-ckf-sort="'+e+'"]'))},getPreRenderer:function(e){return e.get("view:isFolder")?new a(this.finder,this.finder.renderer):new s(this.finder,this.finder.renderer)},attachCollectionHTML:function(e){var t=this.finder.renderer.render(this.model,"ListView",d,{}),i=t.indexOf("</tbody>");this.el.innerHTML=t.substring(0,i)+e+t.substring(i)},getChildViewElement:function(e){return this.$(document.getElementById(e.cid))},getChildViews:function(){return this.$("td")},instantRenderChild:function(t){var i=this.getOption("childViewOptions");i=n._getValue(i,this,[void 0,0]);var r=e.defaults(i,{lazyThumb:this.finder.request("file:getThumb",{file:t,size:i.thumbSizeString})});return this.getPreRenderer(t).preRender(t,r)}},f=o.getMethods();return e.extend(u,f),u.events=e.extend({selectstart:function(e){e.preventDefault(),e.stopPropagation()},"mousedown th[data-ckf-sort]":function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var i=t(e.currentTarget).attr("data-ckf-sort");if(i===this.getOption("displayConfig").get("sortBy")){var n=this.getOption("displayConfig").get("sortByOrder");this.finder.request("settings:setValue",{group:"files",name:"sortByOrder",value:"asc"===n?"desc":"asc"})}else this.finder.request("settings:setValue",{group:"files",name:"sortBy",value:i})},"dragstart .ckf-folder-item":function(e){e.preventDefault()},"dragend .ckf-folder-item":function(e){e.preventDefault()},"ckfdrop .ckf-folder-item":function(e){e.stopPropagation();var i=this.collection.get(e.currentTarget.id);this.trigger("childview:folder:drop",{evt:e,model:i,el:t(e.target).find(".ckf-files-inner")})}},o.getEvents("tr")),r.extend(u)}),CKFinder.define("text!CKFinder/Templates/Files/Compact/File.dot",[],function(){return'<a class="ui-btn" href="javascript:void(0)" tabindex="-1" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}" title="{{! it.name }}" data-ckf-view="{{= it.cid }}">\n    <img id="{{= it.dragPreviewId }}" alt="" src="{{= it.getIcon() }}" draggable="true" data-ckf-drag-preview="{{= it.dragPreviewId }}" />\n\t<span dir="auto" class="">{{! it.name }}</span>\n</a>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/CompactView/FileRenderer",["text!CKFinder/Templates/Files/Compact/File.dot"],function(e){"use strict";function t(e,t){this.finder=e,this.renderer=t}return t.prototype.preRender=function(t,i){var n=this.finder,r={lazyThumb:i.lazyThumb,displayName:i.displayName,displaySize:i.displaySize,displayDate:i.displayDate,descriptionId:"ckf-file-desc-"+t.cid,dragPreviewId:"ckf-drag-prev-"+t.cid,getIcon:function(){return n.request("file:getIcon",{size:i.compactViewIconSize,file:t})}},o='<li id="'+t.cid+'" class="ckf-file-item" role="presentation">';return(o+=this.renderer.render(t,"CompactFile",e,r))+"</li>"},t}),CKFinder.define("text!CKFinder/Templates/Files/Compact/Folder.dot",[],function(){return'<a class="ui-btn" href="javascript:void(0)" tabindex="-1" draggable="false" title="{{! it.name }}">\n    <img id="{{= it.dragPreviewId }}" alt="" src="{{= it.getIcon() }}" draggable="false" />\n\t<span dir="auto" class="">{{! it.label || it.name }}</span>\n</a>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/CompactView/FolderRenderer",["text!CKFinder/Templates/Files/Compact/Folder.dot"],function(e){"use strict";function t(e,t){this.finder=e,this.renderer=t}return t.prototype.preRender=function(t,i){var n=this.finder,r={lazyThumb:i.lazyThumb,displayName:i.displayName,displaySize:i.displaySize,displayDate:i.displayDate,descriptionId:"ckf-file-desc-"+t.cid,dragPreviewId:"ckf-drag-prev-"+t.cid,getIcon:function(){return n.request("folder:getIcon",{size:i.compactViewIconSize,folder:t})}},o='<li id="'+t.cid+'" class="ckf-folder-item" role="presentation">';return(o+=this.renderer.render(t,"CompactFolder",e,r))+"</li>"},t}),CKFinder.define("CKFinder/Modules/Files/Views/CompactView",["underscore","jquery","backbone","marionette","CKFinder/Views/Base/Instant/CollectionView","CKFinder/Modules/Files/Views/Common/FilesViewMixin","CKFinder/Modules/Files/Views/CompactView/FileRenderer","CKFinder/Modules/Files/Views/CompactView/FolderRenderer","CKFinder/Modules/Files/Views/Common/FilesInfoView"],function(e,t,i,n,r,o,s,a,l){"use strict";var d={name:"CompactView",attributes:{tabindex:30},tagName:"ul",className:"ckf-files-view-borders ckf-files-compact ui-body-inherit",reorderOnSort:!0,invertKeys:!0,initialize:function(e){this.columns=new i.Collection([],{comparator:"priority"}),this.model=new i.Model,o.attachModelEvents(this.collection,this),this.model.set("asc","&#9650;"),this.model.set("desc","&#9660;"),this.updateColumns(),this.listenTo(e.displayConfig,"change:sortBy",this.updateSortIndicator),this.listenTo(e.displayConfig,"change:sortByOrder",this.updateSortIndicator),this.on("maximize",function(e){var t=this.updateHeightForBorders(e);if(this.$el.css({height:""}),this.collection.length){this.$el.css({height:t});var i=Math.round(this.$el.width()/this.getChildViews().first().outerWidth());if(i*this.getThumbsInRow()<=this.collection.length){var n=Math.ceil(this.collection.length/i);this.$el.css({height:n*this.getChildViews().first().outerHeight()})}}},this)},childViewOptions:function(){var e=this.getOption("displayConfig").toJSON();return e.collection=this.columns,e},onBeforeRender:function(){this.updateColumns()},isEmpty:function(){var e=!this.collection.length;return this.$el.toggleClass("ckf-files-list-empty",e),e},getEmptyView:function(){var e=this.getEmptyViewData();return l.extend({title:e.title,text:e.text,displayLoader:e.displayLoader,displayInfo:!this.finder.config.readOnly})},updateColumns:function(){var e=new i.Collection;e.add({name:"icon",label:"",priority:10}),e.add({name:"name",label:this.finder.lang.settings.displayName,priority:20,sort:"name"}),this.getOption("displayConfig").get("displaySize")&&e.add({name:"size",label:this.finder.lang.settings.displaySize,priority:30,sort:"size"}),this.getOption("displayConfig").get("displayDate")&&e.add({name:"date",label:this.finder.lang.settings.displayDate,priority:40,sort:"date"}),this.finder.fire("listView:columns",{columns:e}),this.columns.reset(e.toArray()),this.model.set("columns",this.columns),this.model.set("sortBy",this.getOption("displayConfig").get("sortBy")),this.model.set("sortByOrder",this.getOption("displayConfig").get("sortByOrder"))},getThumbsInRow:function(){if(!this.collection.length)return 1;var e=this.getChildViewElement(this.collection.first());if(!e.length)return 1;var t,i=e.offset().left,n=1;for(t=1;t<this.collection.length&&this.getChildViewElement(this.collection.at(t)).offset().left===i;t++)n+=1;return n},updateSortIndicator:function(){var e=this.getOption("displayConfig").get("sortBy"),t=this.getOption("displayConfig").get("sortByOrder");this.$el.find("th .ckf-files-list-view-sorter").html("asc"===t?this.model.get("asc"):this.model.get("desc")).appendTo(this.$el.find('th[data-ckf-sort="'+e+'"]'))},getPreRenderer:function(e){return e.get("view:isFolder")?new a(this.finder,this.finder.renderer):new s(this.finder,this.finder.renderer)},getChildViewElement:function(e){return this.$(document.getElementById(e.cid))},getChildViews:function(){return this.$("li")},instantRenderChild:function(e){var t=this.getOption("childViewOptions");return t=n._getValue(t,this,[void 0,0]),this.getPreRenderer(e).preRender(e,t)}},c=o.getMethods();return e.extend(d,c),d.events=e.extend({selectstart:function(e){e.preventDefault(),e.stopPropagation()},"mousedown th[data-ckf-sort]":function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var i=t(e.currentTarget).attr("data-ckf-sort");if(i===this.getOption("displayConfig").get("sortBy")){var n=this.getOption("displayConfig").get("sortByOrder");this.finder.request("settings:setValue",{group:"files",name:"sortByOrder",value:"asc"===n?"desc":"asc"})}else this.finder.request("settings:setValue",{group:"files",name:"sortBy",value:i})},"dragstart .ckf-folder-item":function(e){e.preventDefault()},"dragend .ckf-folder-item":function(e){e.preventDefault()},"ckfdrop .ckf-folder-item":function(e){e.stopPropagation();var i=this.collection.get(e.currentTarget.id);this.trigger("childview:folder:drop",{evt:e,model:i,el:t(e.target).find(".ckf-files-inner")})}},o.getEvents("li")),r.extend(d)}),CKFinder.define("CKFinder/Modules/Files/LazyLoader",["underscore","jquery","backbone"],function(e,t,i){"use strict";function n(e){this.finder=e,this.items=new i.Collection}function r(i,n,r,s){var a=s.$el.find(".ckf-lazy-thumb");e.chain(a).filter(function(e){return o(e,n)&&!t(e).data("ckf-lazy-timeout")}).each(function(e,a){var l=t(e),d=setTimeout(function(){if(!o(e,n))return l.data("ckf-lazy-timeout",!1),void clearTimeout(d);var i=s.getOption("displayConfig").get("thumbSizeString"),a=r.request("file:getThumb",{file:s.collection.get(e.id),size:i});l.find("img").after(t('<img style="display:none;">').on("load",function(){var e=t(this);e.prev("img").attr("src",e.attr("src")),e.remove(),l.removeClass("ckf-lazy-thumb"),l.data("ckf-lazy-timeout",!1)}).attr("src",r.util.jsCssEntities(a)))},a*i);l.data("ckf-lazy-timeout",d)})}function o(e,t){var i=e.getBoundingClientRect();return i.top+i.height-t>=0&&i.top<=(window.innerHeight||document.documentElement.clientHeight)}var s=100;return n.prototype.registerView=function(e){function i(){n&&clearTimeout(n),n=setTimeout(function(){var i=t(".ui-page-active .ui-header").height()||0;r(o.config.thumbnailDelay,i,o,e)},s)}var n,o=this.finder;e.on("render",i),e.once("show",function(){this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.$el.closest('[data-ckf-page="Main"]').on("scroll",i)}),e.on("childview:render",i),e.on("sizeUpdate:after",i),t(document).on("scroll",i),t(window).on("resize",i),this.throttle=i},n.prototype.disable=function(){t(document).off("scroll",this.throttle),t(window).off("resize",this.throttle)},n}),CKFinder.define("CKFinder/Modules/Files/Views/ViewManager",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Files/Views/ThumbnailsView","CKFinder/Modules/Files/Views/ListView","CKFinder/Modules/Files/Views/CompactView","CKFinder/Modules/Files/LazyLoader"],function(e,t,i,n,r,o,s){"use strict";function a(e){var t;e.data.modeChanged&&("desktop"===e.data.mode?(this.view.setThumbsMode(),e.finder.request("settings:enable",{group:"files",name:"thumbSize"}),t=e.finder.request("settings:getValue",{group:"files",name:"thumbSize"}),this.view.resizeThumbs(t),this.view.applyBiggerThumbs(t)):(e.finder.request("settings:disable",{group:"files",name:"thumbSize"}),this.view.setListMode()))}function l(e){var t=e.data.value;this.view.resizeThumbs(t),this.view.applyBiggerThumbs(t)}function d(e,i){function n(e){e.preventDefault(),e.stopPropagation()}function r(e){t(document).off("mousemove",o),t(document).off("mouseup",r),setTimeout(function(){document.removeEventListener("click",n,!0)},50),l.remove();var i=t(e.target);if(i.data("ckf-drop"))i.trigger(new t.Event("ckfdrop",{ckfFilesSelection:!0}));else{var s=i.closest("[data-ckf-drop]");s.length&&s.trigger(new t.Event("ckfdrop",{ckfFilesSelection:!0}))}}function o(e){s(l,e)}function s(e,i){var n=t(i.target);n.data("ckf-drop")&&n.trigger("ckfdragover"),e.css({top:i.originalEvent.clientY+10,left:i.originalEvent.clientX+10})}var a=i.request("files:getSelected").length;e.originalEvent.stopPropagation(),e.originalEvent.preventDefault();var l=t('<div class="ckf-drag">'),d="#"+t(e.target).attr("data-ckf-drag-preview"),c='<img alt="" src="'+t(d).attr("src")+'">';a>1?l.append(t(c).addClass("ckf-drag-first")).append(t(c).addClass("ckf-drag-second")).append(t(c).addClass("ckf-drag-third")).append('<div class="ckf-drag-info">'+a+"</div>"):l.append(t(c)),l.appendTo("body"),s(l,e),l.on("mousemove",o),l.on("mouseup",r),t(document).on("mousemove",o),t(document).one("mouseup",r),document.addEventListener("click",n,!0)}var c=function(t,n){this.finder=t,this.config=n;var r=this;t.on("settings:change:files",function(t){n.set(t.data.settings),e.contains(["displayDate","displayName","displaySize"],t.data.changed)&&r.view.render()}),t.request("key:listen",{key:i.f9}),t.on("keydown:"+i.f9,function(e){t.util.isShortcut(e.data.evt,"alt")&&(e.data.evt.preventDefault(),e.data.evt.stopPropagation(),r.view.$el.focus())}),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.focusFilesPane,shortcuts:"{alt}+{f9}"})},null,null,40)};return c.prototype.createView=function(i){function c(e){e.evt.preventDefault(),f.request("folder:openPath",{path:e.model.getPath({full:!0})})}var u,f=this.finder,h={finder:f,collection:i,displayConfig:this.config},g=this.config.get("viewType");if("thumbnails"===g){"desktop"===f.request("ui:getMode")&&f.request("settings:enable",{group:"files",name:"thumbSize"}),u=new n(e.extend(h,{mode:"desktop"===f.request("ui:getMode")?"thumbs":"list"}));var p=new s(f);p.registerView(u),f.on("ui:resize",a,this),f.on("settings:change:files:thumbSize",l,this),u.on("destroy",function(){p.disable()})}else if("list"===g)f.request("settings:disable",{group:"files",name:"thumbSize"}),f.request("settings:disable",{group:"files",name:"displayName"}),u=new r(h);else{if("compact"!==g)throw"Wrong view type";f.request("settings:disable",{group:"files",name:"thumbSize"}),f.request("settings:disable",{group:"files",name:"displayName"}),f.request("settings:disable",{group:"files",name:"displayDate"}),f.request("settings:disable",{group:"files",name:"displaySize"}),u=new o(h)}return u.on("childview:file:contextmenu",function(e){e.evt.preventDefault(),f.request("contextMenu",{name:"file",evt:e.evt,positionToEl:t(e.el),context:{file:e.model}})}),u.on("childview:folder:contextmenu",function(e){e.evt.preventDefault(),f.request("contextMenu",{name:"folder",evt:e.evt,positionToEl:e.el,context:{folder:e.model}})}),u.on("childview:file:keydown",function(e){f.fire("file:keydown",{evt:e.evt,file:e.model,source:"filespane"},f)}),u.on("childview:file:dragstart",function(e){f.request("files:getSelected").contains(e.model)||(f.request("files:deselectAll"),f.request("files:select",{files:[e.model]})),d(e.evt,f)}),u.on("childview:folder:keydown",function(e){f.fire("folder:keydown",{evt:e.evt,folder:e.model,source:"filespane"},f)}),u.on("childview:folder:click",function(e){e.model.get("isRoot")||f.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:e.model}})}),u.on("childview:folder:dblclick",c),u.on("childview:folder:dbltap",c),u.on("childview:file:dblclick",function(e){f.fire("file:dblclick",{evt:e.evt,file:e.model})}),u.on("childview:file:dbltap",function(e){f.fire("file:dbltap",{evt:e.evt,file:e.model})}),u.on("childview:folder:drop",function(e){f.fire("folder:drop",{evt:e.evt,folder:e.model,view:e.view,el:e.el},f)}),this.view=u,f.request("page:showInRegion",{page:"Main",region:"main",view:u}),u},c.prototype.destroy=function(e,t){this.destroyers[e]&&this.destroyers[e](t)},c.prototype.destroyers={list:function(e){e.request("settings:enable",{group:"files",name:"thumbSize"}),e.request("settings:enable",{group:"files",name:"displayName"})},thumbnails:function(e){e.removeListener("ui:resize",a),e.removeListener("settings:change:files:thumbSize",l)},compact:function(e){e.request("settings:enable",{group:"files",name:"thumbSize"}),e.request("settings:enable",{group:"files",name:"displayName"}),e.request("settings:enable",{group:"files",name:"displayDate"}),e.request("settings:enable",{group:"files",name:"displaySize"})}},c}),CKFinder.define("CKFinder/Modules/Files/SelectionHandler",["underscore","backbone","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(e,i,n){function r(t){o.isInSelectionMode&&(t.data.toolbar.push({name:"ClearSelection",type:"button",priority:105,icon:"ckf-cancel",iconOnly:!0,title:t.finder.lang.common.choose,action:function(){o.isInSelectionMode=!1,t.finder.request("files:getSelected").length?t.finder.request("files:deselectAll"):t.finder.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:t.finder.request("folder:getActive")}})}}),t.data.toolbar.push({name:"ClearSelectionText",type:"text",priority:100,label:e.lang.formatFilesCount(e.request("files:getSelected").length)}))}this.filesModule=i,this.finder=e,this.selectedFiles=new t.Collection,this.displayedFiles=n,this.lastFolderCid=null,this.isInSelectionMode=!1,this.invertKeys=!1,this.focusedFile=null,this.rangeSelectionStart=l;var o=this;e.on("toolbar:reset:Main:folder",r,null,null,20),e.on("toolbar:reset:Main:file",r,null,null,20),e.on("toolbar:reset:Main:files",r,null,null,20)}function r(e,t){var i=t.lastFolderCid,n=e.request("folder:getActive"),r=n&&n.cid;(!i||i===r)&&e.fire("files:selected",{files:t.getSelectedFiles(),folders:t.getSelectedFolders()},e),t.filesModule.view.shouldFocusFirstChild(),t.lastFolderCid=r}function o(t){var n=t.evt,o=n.keyCode,a="ltr"===this.finder.lang.dir,l=a?i.left:i.right,d=a?i.right:i.left,c=i.down,u=i.up;if(this.invertKeys&&(l=i.up,d=i.down,u=a?i.left:i.right,c=a?i.right:i.left),e.contains([i.space,l,d,u,c,i.end,i.home],o)){n.preventDefault(),n.stopPropagation();var f,h=this.displayedFiles.indexOf(this.focusedFile);if(o===i.space&&(f=h,this.selectedFiles.length>1))return s(this),this.resetRangeSelection(),void r(this.finder,this);var g={isAddToRange:!!n.shiftKey};o===i.end&&(f=this.displayedFiles.length-1),o===i.home&&(f=0),o===u&&(f=h-this.filesModule.view.getThumbsInRow()),o===l&&(f=h-1),o===d&&(f=h+1),o===c&&(f=h+this.filesModule.view.getThumbsInRow()),this.selectFiles(f,g)}}function s(e){e.selectedFiles.forEach(function(e){e.trigger("deselected",e)}),e.selectedFiles.reset([],{silent:!0})}function a(e){e.request("key:listen",{key:i.a}),e.on("keydown:"+i.a,function(e){e.finder.util.isShortcut(e.data.evt,"ctrl")&&(e.data.evt.preventDefault(),e.finder.request("files:selectAll"))}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.selectAll,shortcuts:"{ctrl}+{a}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.addToSelectionLeft,shortcuts:"{shift}+{leftArrow}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.addToSelectionRight,shortcuts:"{shift}+{rightArrow}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.addToSelectionAbove,shortcuts:"{shift}+{upArrow}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.addToSelectionBelow,shortcuts:"{shift}+{downArrow}"})},null,null,50)}var l=-1;return n.prototype.resetRangeSelection=function(){this.rangeSelectionStart=l},n.prototype.selectFiles=function(t,i){var n=this,r=this.displayedFiles,o=n.displayedFiles.indexOf(n.focusedFile),a=e.extend({},i),d=r.at(t);if(d){if(a.resetSelection&&s(n),a.isAddToRange||this.resetRangeSelection(),o||(o=0),o===t&&!a.forceSelect||a.isToggle)return this.filesSelectToggleHandler({files:[d]}),void this.focusFile(d);var c={files:d};if(a.isAddToRange){this.rangeSelectionStart===l&&(this.rangeSelectionStart=o);var u=t>this.rangeSelectionStart?this.rangeSelectionStart:t,f=t>this.rangeSelectionStart?t:this.rangeSelectionStart;c={files:r.slice(u,f+1)}}s(n),this.filesSelectHandler(c),this.focusFile(d)}},n.prototype.filesSelectHandler=function(t){e.isArray(t.files)||(t.files=[t.files]),this.selectedFiles.add(t.files),1===t.files.length&&(this.focusedFile=t.files[0]),r(this.finder,this)},n.prototype.filesSelectToggleHandler=function(t){e.isArray(t.files)&&(e.forEach(t.files,function(e){this.selectedFiles.indexOf(e)<0?this.selectedFiles.add(e):(e.trigger("deselected",e),this.selectedFiles.remove(e))},this),r(this.finder,this))},n.prototype.getSelectedFiles=function(){return new t.Collection(this.selectedFiles.where({"view:isFolder":!1}))},n.prototype.getSelectedFolders=function(){return new t.Collection(this.selectedFiles.where({"view:isFolder":!0}))},n.prototype.registerHandlers=function(){var e=this,t=e.finder,i=e.filesModule;e.selectedFiles.on("reset",function(){r(t,e)}),i.view.on("click",function(e){e.evt.stopPropagation(),t.request("files:deselectAll")}),t.setHandlers({"files:select":{callback:this.filesSelectHandler,context:this},"files:select:toggle":{callback:this.filesSelectToggleHandler,context:this},"files:getSelected":{callback:this.getSelectedFiles,context:this},"files:selectAll":function(){e.selectedFiles.reset(i.files.toArray()),e.selectedFiles.forEach(function(e){e.trigger("selected",e)}),r(t,e)},"files:deselectAll":function(){e.selectedFiles.length&&(e.selectedFiles.forEach(function(e){e.trigger("deselected",e)}),e.selectedFiles.reset())}}),t.on("folder:selected",function(){e.isInSelectionMode=!1},null,null,1),t.on("folder:getFiles:after",function(){e.isInSelectionMode=!1,e.selectedFiles.reset(),e.resetRangeSelection()}),t.on("files:selected",function(e){e.data.files.forEach(function(e){e.trigger("selected",e)})}),a(t),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.nextItem,shortcuts:"{rightArrow}|{downArrow}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.previousItem,shortcuts:"{leftArrow}|{upArrow}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.firstItem,shortcuts:"{home}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.lastItem,shortcuts:"{end}"})},null,null,80)},n.prototype.registerView=function(e){function t(e){e.evt.preventDefault(),e.evt.stopPropagation();var t={isAddToRange:!1,isToggle:!0};n.isInSelectionMode||(e.model.get("view:isFolder")&&!e.evt.shiftKey?(t.isToggle=!1,t.forceSelection=!0,t.resetSelection=!0):(t.isAddToRange=!!e.evt.shiftKey,t.isToggle=!!e.evt.ctrlKey||!!e.evt.metaKey)),n.selectFiles(n.displayedFiles.indexOf(e.model),t)}this.finder,e.on("childview:file:click",t),e.on("childview:folder:click",t),e.on("childview:file:longtouch",function(e){n.isInSelectionMode||(n.isInSelectionMode=!0,n.selectFiles(n.displayedFiles.indexOf(e.model),{isAddToRange:!1,isToggle:!0,resetSelection:!0}))}),e.on("childview:folder:keydown",o.bind(this)),e.on("childview:file:keydown",o.bind(this)),e.on("keydown",function(e){var t,r=e.evt;if(r.keyCode!==("ltr"===this.finder.lang.dir?i.left:i.right)&&r.keyCode!==i.end||(t=n.displayedFiles.last()),r.keyCode!==("ltr"===this.finder.lang.dir?i.right:i.left)&&r.keyCode!==i.home||(t=n.displayedFiles.first()),t){r.stopPropagation(),r.preventDefault();var o=r.keyCode===i.left||r.keyCode===i.right||r.keyCode===i.down||r.keyCode===i.up;n.selectFiles(n.displayedFiles.indexOf(t),{forceSelect:o,isAddToRange:!!r.shiftKey,isToggle:!!e.evt.ctrlKey||!!e.evt.metaKey})}});var n=this;e.on("focused",function(){var e=n.focusedFile?n.focusedFile:n.filesModule.displayedFiles.first();setTimeout(function(){n.focusedFile||n.selectFiles(0),e.trigger("focus",e)},0)}),this.invertKeys=e.invertKeys},n.prototype.focusFile=function(e){e.trigger("focus",e),this.focusedFile=e},n}),CKFinder.define("CKFinder/Modules/Files/FilesCache",["underscore","backbone"],function(e,t){"use strict";function i(e){this.maxFiles=e&&e.maxFiles||100,this.cache=new n}var n=t.Collection.extend({sort:"updated",initialize:function(){this.on("add",function(){var e=0;this.forEach(function(t){e+=t.get("files").length}),this.size=e},this),this.on("remove",function(){var e=0;this.forEach(function(t){e+=t.get("files").length}),this.size=e},this)}});return i.prototype.add=function(e,t,i){var n=this.cache.findWhere({cid:e});n&&this.cache.remove(n);var r={cid:e,files:t,response:i,updated:(new Date).getTime()};for(this.cache.add(r);this.cache.size>this.maxFiles&&this.cache.length>1;)this.cache.shift()},i.prototype.get=function(e){var t=this.cache.findWhere({cid:e});return!!t&&t.toJSON()},i}),CKFinder.define("CKFinder/Modules/Files/Views/ViewConfig",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({defaults:{isInitialized:!1,areThumbnailsResizable:!1,serverThumbs:[],thumbnailConfigs:{},thumbnailMinSize:null,thumbnailMaxSize:null,thumbnailSizeStep:1,listViewIconSize:32,compactViewIconSize:32},updateThumbsConfig:function(t,i){e.forEach(t,function(e){var t=e.split("x"),i=t[0]>t[1]?t[0]:t[1];this.get("serverThumbs").push(parseInt(i,10)),this.get("thumbnailConfigs")[i]={width:t[0],height:t[1],thumb:e}},this);var n=parseInt(i.thumbnailMaxSize,10),r=parseInt(i.thumbnailMinSize,10);this.get("serverThumbs").length&&(r||(r=e.min(this.get("serverThumbs"))),n||(n=e.max(this.get("serverThumbs")))),this.set("areThumbnailsResizable",!(!r||!n));var o=e.max(this.get("serverThumbs"));this.set("thumbnailMaxSize",n>o?o:n),this.set("thumbnailMinSize",r),this.set("thumbnailSizeStep",i.thumbnailSizeStep),this.set("listViewIconSize",i.listViewIconSize),this.set("compactViewIconSize",i.compactViewIconSize)},createSettings:function(e,t,i){var n={list:e.settings.viewTypeList,thumbnails:e.settings.viewTypeThumbnails};("columns"in document.body.style||"webkitColumns"in document.body.style||"MozColumns"in document.body.style)&&(n.compact=e.settings.viewTypeCompact);var r={group:"files",label:e.settings.title,settings:[{name:"displayName",label:e.settings.displayName,type:"checkbox",defaultValue:t.defaultDisplayFileName},{name:"displayDate",label:e.settings.displayDate,type:"checkbox",defaultValue:t.defaultDisplayDate},{name:"displaySize",label:e.settings.displaySize,type:"checkbox",defaultValue:t.defaultDisplayFileSize},{name:"viewType",label:e.settings.viewType,type:"radio",defaultValue:t.defaultViewType,attributes:{options:n}},{name:"sortBy",label:e.settings.sortBy,type:"select",defaultValue:t.defaultSortBy,attributes:{options:{name:e.settings.displayName,size:e.settings.displaySize,date:e.settings.displayDate}}},{name:"sortByOrder",label:e.settings.sortByOrder,type:"radio",defaultValue:t.defaultSortByOrder,attributes:{options:{asc:e.settings.sortAscending,desc:e.settings.sortDescending}}}]},o={name:"thumbSize",label:e.settings.thumbnailSize,type:"hidden",defaultValue:t.thumbnailDefaultSize};return this.get("areThumbnailsResizable")&&(o.type="range",o.isEnabled=i,o.attributes={min:this.get("thumbnailMinSize"),max:this.get("thumbnailMaxSize"),step:this.get("thumbnailSizeStep")}),r.settings.push(o),r}})}),CKFinder.define("CKFinder/Modules/Files/Files",["underscore","jquery","backbone","CKFinder/Models/File","CKFinder/Models/Folder","CKFinder/Util/KeyCode","CKFinder/Modules/Files/FilesFilter","CKFinder/Modules/Files/ChooseFiles","CKFinder/Modules/Files/Views/ViewManager","CKFinder/Modules/Files/SelectionHandler","CKFinder/Modules/Files/FilesCache","CKFinder/Modules/Files/Views/ViewConfig"],function(e,t,i,n,r,o,s,a,l,d,c,u){"use strict";function f(n){var r=this;r.finder=n,r.initDfd=new t.Deferred,r.config=new u,r.files=new i.Collection,r.displayedFiles=s.attachTo(r.files),r.displayedFiles.isLoading=!0,r.filesCache=new c({maxFiles:2e3}),r.viewManager=new l(n,r.config),new a(n),n.once("command:ok:Init",x,r,null,30),n.setHandlers({"file:getThumb":{callback:v,context:r},"file:getIcon":{callback:y,context:r},"folder:getIcon":{callback:w,context:r},"files:filter":{callback:m,context:r},"file:getActive":function(){return r.selection.focusedFile},"files:getCurrent":function(){return r.files.clone()},"files:getDisplayed":function(){return r.displayedFiles.clone()},"folder:getFiles":{callback:p,context:r},"folder:refreshFiles":{callback:C,context:r},"resources:show":{callback:F,context:r}}),n.on("contextMenu:file",function(e){e.data.groups.add({name:"edit"})},null,null,30),n.on("files:deleted",function(t){var i=r.files.length;if(e.forEach(t.data.files,function(e){var t=r.files.indexOf(e);t<i&&(i=t)}),i>0&&(i-=1),r.files.remove(t.data.files),r.finder.request("files:deselectAll"),r.files.length){var n=r.files.at(i);r.selection.focusFile(n)}else r.view.focus()}),n.config.displayFoldersPanel||(n.on("folder:deleted",function(e){r.files.remove(e.data.folder),r.finder.request("files:deselectAll")}),n.on("command:after:GetFolders",function(e){r.doAfterInit(function(){var t=n.request("folder:getActive");if(t&&t.isPath(e.data.response.currentFolder.path,e.data.response.resourceType)){r.files.add(t.get("children").toArray());var i=r.filesCache.get(t.cid);r.filesCache.add(t.cid,r.files.toArray(),i?i.response:"")}})},null,null,30)),n.on("command:after:GetFiles",k,this),n.on("file:dblclick",g,r),n.on("file:dbltap",g,r),n.on("file:keydown",function(e){n.util.isShortcut(e.data.evt,"")&&e.data.evt.keyCode===o.enter&&(e.stop(),e.data.evt.preventDefault(),g.call(r,e))}),n.on("command:error:RenameFile",M,null,null,5),n.on("shortcuts:list",function(e){e.data.groups.add({name:"files",priority:20,label:e.finder.lang.files.filesPaneTitle})}),n.on("folder:selected",function(e){var t=e.data.folder;t!==e.data.previousFolder?e.finder.request("folder:getFiles",{folder:t}):r.displayedFiles.search("")}),n.on("settings:change:files:viewType",function(e){r.viewManager.destroy(e.data.previousValue,n),r.view=r.viewManager.createView(r.displayedFiles),r.selection.registerView(r.view)}),n.on("settings:change:files:sortBy",function(e){r.displayedFiles.sortByField(e.data.value),r.config.set("sortBy",e.data.value)}),n.on("settings:change:files:sortByOrder",function(e){r.config.set("sortByOrder",e.data.value),"asc"===e.data.value?r.displayedFiles.sortAscending():r.displayedFiles.sortDescending()}),function(e){e.request("key:listen",{key:o.f5}),e.request("key:listen",{key:o.r}),e.on("keydown:"+o.f5,function(t){(e.util.isShortcut(t.data.evt,"")||e.util.isShortcut(t.data.evt,"ctrl")||e.util.isShortcut(t.data.evt,"shift")||e.util.isShortcut(t.data.evt,"ctrl+shift"))&&I(t)}),e.on("keydown:"+o.r,function(t){(e.util.isShortcut(t.data.evt,"ctrl")||e.util.isShortcut(t.data.evt,"ctrl+shift"))&&I(t)}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.refresh,shortcuts:"{f5}|{ctrl}+{r}"})},null,null,60)}(n)}function h(e){var t,i;for(i="","123456789ABCDEFGHJKLMNPQRSTUVWXYZ",t=0;t<e.length;t++)i+=String.fromCharCode("123456789ABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(e[t]));return h=void 0,i}function g(e){var t=this.finder,i=e.data.file;t.request("files:select",{files:i}),t.config.chooseFiles&&t.config.chooseFilesOnDblClick?t.request("internal:file:choose",{file:i}):t.request("file:preview",{file:i})}function p(t){var i=t.folder,n=this.finder,r=e.extend({folder:i},t.context);this.displayedFiles.isLoading=!0,this.files.reset();var o=this.filesCache.get(i.cid);if(!1!==o&&(this.displayedFiles.isLoading=!1,this.files.reset(o.files)),n.fire("folder:getFiles:before",r,n))return n.request("command:send",{name:"GetFiles",folder:i,context:r})}function m(e){var t=this;t._lastFilterTimeout&&(clearTimeout(t._lastFilterTimeout),t._lastFilterTimeout=null),t.displayedFiles.length<200?t.displayedFiles.search(e.text):t._lastFilterTimeout=setTimeout(function(){t.displayedFiles.search(e.text)},1e3)}function v(e){var t=e.file,i={fileName:t.get("name"),date:t.get("date"),fileSize:t.get("size")};return e.size&&(i.size=e.size),this.finder.request("command:url",{command:"Thumbnail",folder:t.get("folder"),params:i})}function w(e){return b(this.finder,"folder",e.size)}function y(e){return b(this.finder,e.file.getExtension(),e.size)}function b(t,i,n){var r=t.config.fileIconsSizes.split(",");i=i.toLocaleLowerCase();var o=t.config.fileIcons[e.has(t.config.fileIcons,i)?i:"default"];return t.util.url(t.config.fileIconsPath+function(e){if(r.indexOf(e.toString())>=0)return e.toString();for(var t=r.length,i=t-1;e>parseInt(r[--t])&&t>=0;)i=t;return r[i]}(n)+"/"+o+"?ver=i42irv")}function C(t){var i=this.finder;i.request("loader:show",{text:i.lang.files.filesRefresh});var n=i.request("folder:getActive"),r=i.request("command:send",{name:"GetFiles",folder:n,context:e.extend({folder:n},t&&t.context)});return r.then(function(){i.request("loader:hide")}),r}function F(){var e=this,t=e.finder;e.doAfterInit(function(){t.fire("resources:show:before",{resources:e.resources},t),e.files.reset(t.request("resources:get").toArray()),t.config.rememberLastFolder&&t.request("settings:setValue",{group:"folders",name:"lastFolder",value:"/"}),t.fire("resources:show",{resources:e.resources},t)})}function x(e){var t=this,i=t.finder;_=_||function(e){return function(t){return e.charCodeAt(t)}}(h(i.config.initConfigInfo.c)),e.data.response.thumbs&&t.config.updateThumbsConfig(e.data.response.thumbs,i.config);var n=i.request("settings:define",t.config.createSettings(i.lang,i.config,"desktop"===i.request("ui:getMode")));if(function(){var e=_(4)-_(0);_(4),_(0),0>e&&(e=_(4)-_(0)+33),K=e<4}(),t.config.set(n),t.config.get("thumbSize")&&"thumbnails"===t.config.get("viewType")){var r=t.config.get("thumbSize"),o=r;r>t.config.get("thumbnailMaxSize")?o=t.config.get("thumbnailMaxSize"):r<t.config.get("thumbnailMinSize")&&(o=t.config.get("thumbnailMinSize")),o&&(t.config.set("thumbSize",o),t.finder.request("settings:setValue",{group:"files",name:"thumbSize",value:o}))}"list"===t.config.get("viewType")&&(i.request("settings:disable",{group:"files",name:"thumbSize"}),i.request("settings:disable",{group:"files",name:"displayName"})),t.displayedFiles.sortByField(t.config.get("sortBy")),"asc"===t.config.get("sortByOrder")?t.displayedFiles.sortAscending():t.displayedFiles.sortDescending(),function(){var e={s:function(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^255&i);return t},m:92533269};S=!function(t,i,n,r,o,s){for(var a=window[e.s("D`vf")],l=33,d=n,c=s,u=l+(d*c-(u=r)*(f=o))%l,f=d=0;f<l;f++)1==u*f%l&&(d=f);return(d*s%l*(u=t)+d*(l+-1*r)%l*(f=i))%l*12+((d*(33+-1*o)-33*(""+d*(l+-1*o)/33>>>0))*u+d*n%33*f)%l-1>=(c=new a(1e4*(225282658^e.m)))[e.s("gdvEqij^mhx")]()%2e3*12+c[e.s("gdvNkkro")]()}(_(8),_(9),_(0),_(1),_(2),_(3))}(),function(e){e.on("page:create:Main",function(e){e.finder.request("toolbar:create",{name:"Main",page:"Main"})}),e.on("resources:show",function(){e.request("toolbar:reset",{name:"Main",event:"resources"})}),e.on("files:selected",function(e){var t=e.data.files;if(!t.length){var i=e.finder.request("folder:getActive");return i?void(!e.finder.config.displayFoldersPanel&&e.data.folders.length||e.finder.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:i}})):void e.finder.request("toolbar:reset",{name:"Main",event:"resources"})}return t.length>1?void e.finder.request("toolbar:reset",{name:"Main",event:"files",context:{files:t}}):void e.finder.request("toolbar:reset",{name:"Main",event:"file",context:{file:t.at(0)}})},this)}.call(t,i),i.request("page:create",{name:"Main",mainRegionAutoHeight:!0,className:"ckf-files-page"+(i.config.displayFoldersPanel?"":" ckf-files-no-tree")}),i.request("page:show",{name:"Main"}),t.view=t.viewManager.createView(t.displayedFiles),t.selection=new d(i,t,t.displayedFiles),function(){var e=_(5)-_(1);0>e&&(e=_(5)-_(1)+33),E=e-1<=0}(),t.selection.registerHandlers(),t.selection.registerView(t.view),function(){T=function(e,t,i){var n=0,r=(window.opener?window.opener:window.top).location.hostname.toLocaleLowerCase();0===t&&(r=r.replace(new RegExp("^www\\."),""));if(1===t&&(r=("."+r.replace(new RegExp("^www\\."),"")).search(new RegExp("\\."+i+"$"))>=0&&i),2===t)return!0;for(var o=0;o<r.length;o++)n+=r.charCodeAt(o);return r===i&&e===n+-33*parseInt(n%100/33,10)-100*(""+n/100>>>0)}(_(7),function(e,t){var i=e-t;return 0>i&&(i=e-t+33),i}(_(4),_(0)),i.config.initConfigInfo.s)}(),t.initDfd.resolve(),function(){V=function(e,t){for(var i=0,n=0;n<10;n++)i+=e.charCodeAt(n);for(;i>33;){var r=i.toString().split("");i=0;for(var o=0;o<r.length;o++)i+=parseInt(r[o])}return i===t}(i.config.initConfigInfo.c,_(10))}()}function k(t){var i=this,r=t.data.response,o=t.finder,s=o.request("folder:getActive");if(function(e){function t(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^i+7&255);return t}if(!(K&&T&&E&&V)||S){if(q)return;window.setInterval(function(){var i={};i.msg=["S``y","n{","f","cmde","qm{ybcc","hn","DCOcehh|","4"].map(t).join(" "),!thnks&&e.request("dialog:info",i)},"300000"),q=!0}}(o),!t.data.response.error&&s&&s.isPath(r.currentFolder.path,r.resourceType)){var a=r.files,l=[];o.config.displayFoldersPanel||s.get("children").forEach(function(e){l.push(e)});var d=i.filesCache.get(s.cid);if(!d||d.response!==t.data.rawResponse){var c=i.files.filter(function(t){if(t.get("view:isFolder"))return!1;var i=e.findWhere(a,{name:t.get("name")});return!i||(t.set(i),i.isParsed=!0,!1)});i.displayedFiles.isLoading=!1,c&&i.files.remove(c);var u=i.files.length>0;e.forEach(a,function(e){if(!e.isParsed){var t=new n(e);t.set("folder",s),t.set("cid",t.cid),u?i.files.add(t):l.push(t)}}),u||i.files.reset(l),i.filesCache.add(s.cid,i.files.toArray(),t.data.rawResponse)}o.fire("folder:getFiles:after",{folder:s},o),setTimeout(function(){(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)},20)}}function M(e){117===e.data.response.error.number&&(e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.errors.missingFile}),e.finder.request("folder:refreshFiles"))}function I(e){e.data.evt.preventDefault(),e.data.evt.stopPropagation();var t=e.finder.request("folder:getActive");e.finder.request("folder:refreshFiles"),e.finder.request("command:send",{name:"GetFolders",folder:t,context:{parent:t}})}f.prototype.doAfterInit=function(e){this.initDfd.promise().done(e)};var K,E,V,S,T,_,q=!1;return f}),CKFinder.define("text!CKFinder/Templates/Folders/FolderTreeNodeView.dot",[],function(){return'<a role="treeitem" class="ckf-folders-tree-label {{? !it.hasChildren }}ckf-folders-tree-no-children{{?}}" tabindex="-1" data-ckf-drop="true">\n\t<span>{{! it.label || it.name }}</span>\n</a>\n<a class="ckf-folders-tree-expander {{? !it.hasChildren }}ckf-folders-tree-no-children{{?}}" data-icon="custom" data-iconpos="notext"></a>\n<div class="ckf-folders-tree-body">\n\t<ul data-role="listview" style="display:none;"></ul>\n</div>\n'}),CKFinder.define("CKFinder/Modules/Folders/Views/FolderTreeNodeView",["underscore","CKFinder/Views/Base/CompositeView","text!CKFinder/Templates/Folders/FolderTreeNodeView.dot","CKFinder/Util/KeyCode","ckf-jquery-mobile"],function(e,t,i,n){"use strict";return t.extend({name:"FolderTreeNode",tagName:"li",className:"ckf-folders-tree",childViewContainer:"ul:first",template:i,bubbleEvents:["folder:expand","folder:click","folder:contextmenu","folder:keydown","folder:drop","folder:before:remove:child","selected:before","focus"],modelEvents:{selected:"onModelSelected",deselected:"deselect",change:"onModelChange","ui:expand":"expand"},onBeforeRemoveChild:function(e){this.trigger("folder:before:remove:child",{origin:this,removedView:e})},collectionEvents:{remove:function(){0===this.collection.length&&this.collapse()},sort:"reorder"},attributes:{role:"presentation"},ui:{subTree:"ul:first",expander:".ckf-folders-tree-expander:first",label:".ckf-folders-tree-label:first"},events:{"vmousedown @ui.expander":function(){this.trigger("focus",{origin:this})},"click @ui.expander":function(e){e.stopPropagation(),this.requestExpand()},"contextmenu @ui.label":function(e){e.stopPropagation(),this.triggerContextMenu(e)},"click @ui.label":function(e){e.stopPropagation(),2===e.button||3===e.button?this.triggerContextMenu(e):this.trigger("folder:click",{view:this})},"keydown @ui.label":function(e){return e.keyCode===n.menu||e.keyCode===n.f10&&this.finder.util.isShortcut(e,"shift")?(e.stopPropagation(),void this.triggerContextMenu(e)):void this.trigger("folder:keydown",{evt:e,view:this,model:this.model})},"mouseout @ui.label":function(){this.model.get(this.viewMetadataPrefix+":isSelected")||this.ui.label.removeClass("ui-btn-active")},"ckfdragover @ui.label":function(e){e.stopPropagation(),e.preventDefault(),this.ui.label.addClass("ui-btn-active")},"ckfdrop @ui.label":function(e){e.stopPropagation(),this.model.get(this.viewMetadataPrefix+":isSelected")||this.ui.label.removeClass("ui-btn-active"),this.trigger("folder:drop",{evt:e,view:this,model:this.model})},"focus @ui.expander":function(e){e.preventDefault(),e.stopPropagation()}},initialize:function(t){var i=this;i.collection=i.model.get("children"),i.viewMetadataPrefix=t.viewMetadataPrefix||"view",i.options=e.extend({workingIcon:"ui-icon-ckf-rotate",expandedIcon:"ui-icon-ckf-arrow-d",collapsedIcon:"ui-icon-ckf-arrow-"+("ltr"===i.finder.lang.dir?"r":"l")},t),i.model.has(i.viewMetadataPrefix+":isExpanded")||i.model.set(i.viewMetadataPrefix+":isExpanded",!1)},onModelSelected:function(){this.trigger("selected:before"),this.ui.label.addClass("ui-btn-active"),this.model.set(this.viewMetadataPrefix+":isSelected",!0),this.expandParents(),this.focus()},deselect:function(){this.ui.label.removeClass("ui-btn-active"),this.model.set(this.viewMetadataPrefix+":isSelected",!1),this.children.call("deselect")},onModelChange:function(t){var i=this,n=!1,r=["name","parent"];if(e.keys(t.changed).forEach(function(t){e.contains(r,t)&&(n=!0)}),e.isUndefined(t.changed.hasChildren)||t.changed.hasChildren||(n=!0),t.get("hasChildren")||t.set(i.viewMetadataPrefix+":isExpanded",!1,{silent:!0}),n){var o=!!this.$el.find(":focus").length;i.render(),o&&this.ui.label.focus()}else t.changed.hasChildren&&(i.ui.label.removeClass("ckf-folders-tree-no-children"),i.ui.expander.removeClass("ckf-folders-tree-no-children")),i.refreshUI()},onRender:function(){var t=this;t.refreshUI(),t.model.get(t.viewMetadataPrefix+":isExpanded")?t.expand():t.collapse(),t.model.get(t.viewMetadataPrefix+":isSelected")&&this.ui.label.addClass("ui-btn-active"),this.ui.label.attr("aria-level",this.calculateLevel());var i=this.$el.attr("id")||e.uniqueId();this.ui.label.attr("aria-labelledby",i),this.ui.label.find("span").attr("id",i)},refreshUI:function(){var e=this;e.$el.closest("ul").listview().listview("refresh"),this.ui.subTree.listview().listview("refresh"),e.model.get("isPending")?(e.ui.expander.addClass(e.options.workingIcon).addClass("ckf-tree-loading"),e.$el.find("> .ckf-folders-tree-label, > .ckf-folders-tree-expander").addClass("ui-state-disabled").attr("aria-disabled","true"),e.ui.label.attr("aria-busy","true")):(e.ui.expander.removeClass(e.options.workingIcon).removeClass("ckf-tree-loading"),e.$el.find("> .ckf-folders-tree-label, > .ckf-folders-tree-expander").removeClass("ui-state-disabled").attr("aria-disabled","false"),e.ui.label.attr("aria-busy","false")),e.model.get(e.viewMetadataPrefix+":isExpanding")?(e.ui.expander.addClass(e.options.workingIcon).addClass("ckf-tree-loading"),e.ui.label.attr("aria-busy","true")):e.model.get("isPending")||(e.ui.expander.removeClass(e.options.workingIcon).removeClass("ckf-tree-loading"),e.ui.label.attr("aria-busy","false"))},childViewOptions:function(){return{viewMetadataPrefix:this.viewMetadataPrefix}},onAddChild:function(t){var i=this;this.refreshUI(),i.model.get(i.viewMetadataPrefix+":isExpanding")&&i.expand(),e.each(i.bubbleEvents,function(e){t.on(e,function(t){i.trigger(e,t)})}),t.parentView=this},collapse:function(){this.children.each(function(e){e.collapse()}),this.ui.subTree.hide().attr("aria-hidden","true"),this.ui.expander.removeClass(this.options.workingIcon).removeClass(this.options.expandedIcon).removeClass("ckf-tree-loading").addClass(this.options.collapsedIcon),this.model.get("hasChildren")?this.ui.label.attr("aria-expanded",!1):this.ui.label.removeAttr("aria-expanded"),this.$el.removeClass("ckf-tree-expanded"),this.model.set(this.viewMetadataPrefix+":isExpanded",!1)},expand:function(){this.ui.subTree.show().attr("aria-hidden","false"),this.ui.expander.removeClass(this.options.workingIcon).removeClass(this.options.collapsedIcon).removeClass("ckf-tree-loading").addClass(this.options.expandedIcon),this.model.get("hasChildren")?this.ui.label.attr("aria-expanded",!0):this.ui.label.removeAttr("aria-expanded"),this.$el.addClass("ckf-tree-expanded"),this.model.set(this.viewMetadataPrefix+":isExpanded",!0),this.model.set(this.viewMetadataPrefix+":isExpanding",!1),this.refreshUI()},requestExpand:function(){this.refreshUI(),this.ui.expander.hasClass(this.options.collapsedIcon)?(this.ui.expander.removeClass(this.options.collapsedIcon).addClass(this.options.workingIcon).addClass("ckf-tree-loading"),this.model.get("hasChildren")&&this.model.get("children").length&&this.expand(),this.model.get("children").length||this.model.set(this.viewMetadataPrefix+":isExpanding",!0),this.trigger("folder:expand",{view:this})):(this.collapse(),this.trigger("folder:collapse",{view:this}))},next:function(){var e=this.parentView.collection,t=e.indexOf(this.model);return t+1===e.length?null:this.parentView.children.findByModel(e.at(t+1))},prev:function(){var e=this.parentView.collection,t=e.indexOf(this.model);return 0===t?null:this.parentView.children.findByModel(e.at(t-1))},focus:function(){this.ui.label.focus(),this.trigger("focus",{origin:this})},expandParents:function(){for(var e=this;e.parentView&&e.parentView.expand;)(e=e.parentView).expand()},calculateLevel:function(){for(var e=1,t=(this.model,this.model.get("parent"));t;)e+=1,t=t.get("parent");return e},triggerContextMenu:function(e){this.trigger("folder:contextmenu",{evt:e,view:this,model:this.model})},getLabel:function(){return this.ui.label}})}),CKFinder.define("CKFinder/Modules/Folders/Views/FoldersTreeView",["CKFinder/Views/Base/CompositeView","CKFinder/Modules/Folders/Views/FolderTreeNodeView","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";return e.extend({name:"FoldersTree",childView:t,tagName:"ul",className:"ckf-tree",attributes:{role:"tree","data-role":"listview",tabindex:20},template:"",events:{keydown:function(e){if(e.keyCode!==i.tab||!this.finder.util.isShortcut(e,"")&&!this.finder.util.isShortcut(e,"shift")){var t;if(e.keyCode===i.up||e.keyCode===i.end)for(t=this.children.last();t.model.get(t.viewMetadataPrefix+":isExpanded")&&t.model.get("children").length>0;)t=t.children.findByModel(t.collection.last());e.keyCode!==i.down&&e.keyCode!==i.home||(t=this.children.first()),t&&(e.stopPropagation(),e.preventDefault(),t.focus())}else this.trigger("keydown:tab",e)},focus:function(e){e.target===e.currentTarget&&(e.preventDefault(),e.stopPropagation(),this.findFolderToFocus().focus())}},childEvents:{"folder:keydown":function(e,t){function n(){t.evt.preventDefault(),t.evt.stopPropagation()}var r=t.view,o=t.evt.keyCode,s=t.model,a=s.get(r.viewMetadataPrefix+":isExpanded"),l=s.get("hasChildren");o===i.up&&(n(),function(e){var t=e.prev();if(t)for(;t.model.get(e.viewMetadataPrefix+":isExpanded")&&t.model.get("children").length>0;)t=t.children.findByModel(t.collection.last());else e.model.get("isRoot")||(t=e.parentView);t&&t.focus()}(r)),o===("ltr"===this.finder.lang.dir?i.right:i.left)&&(n(),function(e,t,i){if(e){if(e&&!t)return void i.requestExpand();var n=i.children.first();n&&n.focus()}}(l,a,r)),o===i.down&&(n(),function(e,t,i){if(e&&t)i.children.findByModel(i.collection.first()).focus();else{var n=i.next();if(n||!i.model.get("isRoot")){var r;if(!n){for(r=i.parentView,n=r.next();!n&&!r.model.get("isRoot");)n=r.next(),r=r.parentView;!n&&r.model.get("isRoot")&&(n=r.next())}n&&n.focus()}}}(l,a,r)),o===("ltr"===this.finder.lang.dir?i.left:i.right)&&(n(),function(e,t,i){e&&t?i.collapse():i.model.get("isRoot")||i.parentView.focus()}(l,a,r))},"selected:before":function(){this.children.call("deselect")},focus:function(e,t){this.lastFocusedPath=t.origin.model.getPath({full:!0})},"folder:before:remove:child":function(e,t){t.origin.model.getPath({full:!0})+t.removedView.model.get("name")+"/"===this.lastFocusedPath&&t.origin.focus()}},initialize:function(e){this.viewMetadataPrefix=e.viewMetadataPrefix||"view"},onRender:function(){this.$el.attr("aria-label",this.finder.lang.folders.treeTitle)},childViewOptions:function(){return{viewMetadataPrefix:this.viewMetadataPrefix}},onAddChild:function(e){e.parentView=this,this.refreshUI()},refreshUI:function(){this.$el.listview().listview("refresh")},findFolderToFocus:function(){var e=this.children.first();if(this.lastFocusedPath){var t=this.lastFocusedPath.split(":"),i=t[0],n=t[1],r=this.children.findByModel(this.collection.findWhere({name:i}));if(e=r,"/"!==n)e=function e(t,i){var n=t.model;if(!n.get("children").length)return t;var r=n.get("children").findWhere({name:i.shift()});return r?e(t.children.findByModel(r),i):t}(r,n.replace(/^\//,"").split("/").filter(function(e){return!!e.length}))}return e}})}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Models/MoveCopyData",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({defaults:{done:0,lastCommandResponse:!1},initialize:function(){this.set({fileExistsErrors:new t.Collection,otherErrors:[]})},processResponse:function(t){this.set("lastResponse",{done:"Copy"===this.get("type")?t.copied:t.moved,response:t});var i=this.get("done"),n=parseInt("Copy"===this.get("type")?t.copied:t.moved);if(this.set("done",i+n),t.error&&(300===t.error.number||301===t.error.number)){var r=this.get("fileExistsErrors"),o=this.get("otherErrors");e.forEach(t.error.errors,function(t){if(115===t.number)r.push(t);else{var i=e.findWhere(o,{number:t.number});i||(i={number:t.number,files:[]},o.push(i)),i.files.push(t.name)}})}},hasFileExistErrors:function(){return!!this.get("fileExistsErrors").length},hasOtherErrors:function(){return!!this.get("otherErrors").length},nextError:function(){var e=this.get("fileExistsErrors").shift();return this.set("current",e),e},getFilesForPost:function(e){var t=[];if(t.push(this.get("current").toJSON()),e)for(;this.hasFileExistErrors();)t.push(this.nextError().toJSON());return t},addErrorMessages:function(t){e.forEach(this.get("otherErrors"),function(e){e.msg=t[e.number]})}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/ChooseFolder.dot",[],function(){return'<div data-role="header">\n\t<h2>{{= it.lang.folders.destinationFolder }}</h2>\n\t<a class="ui-btn ui-corner-all ui-btn-icon-notext ui-icon-ckf-back" id="ckf-move-copy-close" title="{{= it.lang.common.close }}" tabindex="10"></a>\n</div>\n<div id="ckf-move-copy-content"></div>\n'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/ChooseFolderLayout",["CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/FilesMoveCopy/ChooseFolder.dot"],function(e,t){"use strict";return e.extend({name:"ChooseFolderDialogLayoutView",template:t,regions:{content:"#ckf-move-copy-content"},ui:{close:"#ckf-move-copy-close"}})}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyDialogLayout",["CKFinder/Views/Base/LayoutView"],function(e){"use strict";return e.extend({name:"MoveCopyDialogLayoutView",template:"<div></div>",regions:{content:"div"}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/MoveCopyFileActionsTemplate.dot",[],function(){return'<h3 class="ckf-move-copy-filename">{{= it.current.get( \'name\' ) }}</h3>\n<p class="ckf-move-copy-error">{{= it.lang.errors.codes[ 115 ] }}</p>\n\n<button class="ckf-move-copy-button" id="ckf-move-overwrite">{{= it.lang.files.overwrite }}</button>\n<button class="ckf-move-copy-button" id="ckf-move-rename">{{= it.lang.files.autoRename }}</button>\n<button class="ckf-move-copy-button" id="ckf-move-skip">{{= it.lang.common.skip }}</button>\n\n<div class="ckf-move-copy-checkbox">\n\t<label>\n\t\t<input name="processAll" type="checkbox">\n\t\t{{= it.lang.common.rememberDecision }}\n\t</label>\n</div>\n\n{{? it.showCancel }}\n<div class="ui-grid-solo">\n\t<div class="ui-block-a"><div><button id="ckf-move-cancel">{{= it.lang.common.cancel }}</button></div></div>\n</div>\n{{?}}\n'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyFileActionsView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/FilesMoveCopy/MoveCopyFileActionsTemplate.dot"],function(e,t){"use strict";return e.extend({name:"MoveCopyErrorsView",template:t,ui:{processAll:'[name="processAll"]',overwrite:"#ckf-move-overwrite",skip:"#ckf-move-skip",rename:"#ckf-move-rename",cancel:"#ckf-move-cancel"},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("text!CKFinder/Templates/FilesMoveCopy/MoveCopyResultTemplate.dot",[],function(){return'<p>{{= it.msg }}</p>\n<hr>\n<p class="ckf-move-copy-failures-title ui-body-inherit">{{= it.errorsTitle }}</p>\n<div class="ckf-move-copy-failures">\n\t{{~ it.otherErrors: errorGroup }}\n\t\t<p>{{= errorGroup.msg }}</p>\n\t\t<ul>\n\t\t{{~ errorGroup.files: error }}\n\t\t\t<li>{{= error }}</li>\n\t\t{{~}}\n\t\t</ul>\n\t{{~}}\n</div>\n{{? it.showCancel }}\n<div class="ui-grid-solo">\n\t<div class="ui-block-a"><div><button id="ckf-move-copy-ok">{{= it.lang.common.ok }}</button></div></div>\n</div>\n{{?}}\n'}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/Views/MoveCopyResultView",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/FilesMoveCopy/MoveCopyResultTemplate.dot"],function(e,t){"use strict";return e.extend({name:"MoveCopyResultView",template:t,className:"ckf-move-copy-result",ui:{ok:"#ckf-move-copy-ok"},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("CKFinder/Modules/FilesMoveCopy/FilesMoveCopy",["underscore","jquery","backbone","CKFinder/Views/MessageView","CKFinder/Modules/Folders/Views/FoldersTreeView","CKFinder/Modules/FilesMoveCopy/Models/MoveCopyData","CKFinder/Modules/FilesMoveCopy/Views/ChooseFolderLayout","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyDialogLayout","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyFileActionsView","CKFinder/Modules/FilesMoveCopy/Views/MoveCopyResultView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o,s,a,l,d,c){"use strict";function u(e,t,n){var r=[];(e.files instanceof i.Collection?e.files:new i.Collection(e.files)).forEach(function(t){var i=t.get("folder");r.push({options:e.options?e.options:"",name:t.get("name"),type:i.get("resourceType"),folder:i.getPath()})});var s=new o({type:t,currentFolder:e.toFolder,lastIndex:n.request("files:getCurrent").indexOf(e.files.last()),postFiles:r});f(n,r,s)}function f(t,i,n,r){r&&e.forEach(i,function(e,t){i[t].options=r});var o=n.get("type"),s=i.length,a=t.lang[o.toLowerCase()][1===s?"oneFileWait":"manyFilesWait"].replace("{count}",s)+" "+t.lang.common.pleaseWait;t.request("loader:show",{text:a}),t.request("command:send",{name:o+"Files",type:"post",post:{files:i},sendPostAsJson:!0,folder:n.get("currentFolder"),context:{moveCopyData:n}})}function h(t,i,n,r){function s(){n.finder.request("page:destroy",{name:C}),n.finder.request("dialog:destroy")}var a=t.data.response;if(!a.error||!e.contains([103,116],a.error.number)){var c=n.finder,u=t.data.context,h=u&&u.moveCopyData?u.moveCopyData:new o;h.get("type")||h.set("type",i),h.processResponse(t.data.response),c.request("loader:hide");var g,m=c.lang[h.get("type").toLowerCase()].operationSummary;if(h.set("msg",m.replace("{count}",h.get("done"))),h.set("errorsTitle",c.lang[h.get("type").toLowerCase()].errorDialogTitle),h.set("showCancel",y(c)),!h.hasFileExistErrors()){c.request("page:destroy",{name:x}),c.request("page:destroy",{name:C});var v=h.hasFileExistErrors()?c.lang.errors.operationCompleted:c.lang[h.get("type").toLowerCase()].operation;return h.hasOtherErrors()&&(h.set("msg",c.lang.errors.operationCompleted+" "+h.get("msg")),g=new d({finder:c,model:h,events:{"click @ui.ok":function(){n.finder.request("page:destroy",{name:F}),n.finder.request("dialog:destroy")}},className:function(){return"mobile"==this.finder.request("ui:getMode")?"ui-content":""}}),h.addErrorMessages(c.lang.errors.codes)),g?y(c)?(c.request("page:create",{view:g,title:v,name:F,uiOptions:{dialog:"mobile"!==c.request("ui:getMode"),theme:c.config.swatch,overlayTheme:c.config.swatch}}),c.request("page:show",{name:F}),c.request("page:destroy",{name:C})):c.request("dialog",{name:h.get("type")+"Success",title:v,buttons:["okClose"],minWidth:"400px",view:g}):c.request("dialog:info",{title:v,msg:h.get("msg"),name:"MoveCopySummaryInfo"}),void(r&&("Move"===i&&b(c),c.request("folder:refreshFiles")))}h.nextError(),h.addErrorMessages(c.lang.errors.codes),p(h,c,i).content.show(new l({finder:c,model:h,events:{"click @ui.skip":function(){this.model.hasFileExistErrors()&&!this.ui.processAll.is(":checked")?(this.model.nextError(),this.render()):s()},"click @ui.overwrite":function(){f(n.finder,this.model.getFilesForPost(this.ui.processAll.is(":checked")),this.model,"overwrite")},"click @ui.rename":function(){f(n.finder,this.model.getFilesForPost(this.ui.processAll.is(":checked")),this.model,"autorename")},"click @ui.cancel":s},className:function(){return"mobile"==this.finder.request("ui:getMode")?"ui-content":""}}))}}function g(e){switch(e.data.response.error.number){case 300:case 301:e.cancel();break;case 116:e.cancel(),e.finder.request("loader:hide"),e.finder.request("dialog:info",{msg:e.finder.lang.errors.missingFolder});var t=e.data.context.moveCopyData.get("currentFolder"),i=t.get("parent");i.get("children").remove(t),e.finder.request("folder:getActive")===t&&e.finder.request("folder:openPath",{path:i.getPath({full:!0}),expand:!0});break;case 103:e.cancel(),e.finder.request("loader:hide"),e.finder.request("dialog:info",{msg:e.finder.lang.errors.codes[103]})}}function p(e,t,i){var n=e.get("view");if(!n){n=new a({finder:t});var r=t.lang[i.toLowerCase()+"Operation"];y(t)?(t.request("page:create",{view:n,title:r,name:C,uiOptions:{dialog:"mobile"!==t.request("ui:getMode"),theme:t.config.swatch,overlayTheme:t.config.swatch}}),t.request("page:show",{name:C}),t.request("page:destroy",{name:x})):t.request("dialog",{name:C,title:r,buttons:["cancel"],view:n})}return n}function m(e,t,i){("Move"!==t||e.finder.request("folder:getActive").get("acl").fileDelete)&&e.data.toolbar.push({name:t+"Files",type:"button",priority:40,icon:"ckf-file-"+("Copy"===t?"copy":"move"),label:i.finder.lang.common[t.toLowerCase()],action:function(){var n=new r({finder:i.finder,collection:i.finder.request("resources:get"),viewMetadataPrefix:"moveCopy"});n.on("childview:folder:expand",function(e,t){i.finder.fire("folder:expand",{view:t.view,folder:t.view.model},i.finder)}),n.on("childview:folder:click",function(e,n){i.finder.request("files:"+t.toLowerCase(),{files:i.finder.request("files:getSelected"),toFolder:n.view.model})}),n.on("childview:folder:keydown",function(e,n){n.evt.keyCode!==c.enter&&n.evt.keyCode!==c.space||(n.evt.preventDefault(),n.evt.stopPropagation(),i.finder.request("files:"+t.toLowerCase(),{files:i.finder.request("files:getSelected"),toFolder:n.view.model}))}),n.on("keydown:tab",function(e){e.preventDefault(),e.stopPropagation(),y(i.finder)?n.$el.closest('[data-role="page"]').find("#ckf-move-copy-close").focus():n.$el.closest(".ckf-dialog").find(".ckf-dialog-buttons").find(".ui-btn").focus()});var o=e.data.file?e.finder.lang[t.toLowerCase()].oneFileDialogTitle:e.finder.lang[t.toLowerCase()].manyFilesDialogTitle.replace("{count}",e.data.files.length);if(y(i.finder)){i.finder.on("page:show:"+x,function(){n.refreshUI()});var a=new s({finder:i.finder,events:{"click @ui.close":function(){i.finder.request("page:destroy",{name:x})}}});a.on("show",function(){this.content.show(n)}),i.finder.request("page:create",{view:a,title:o,name:x,className:"ckf-move-copy-dialog",uiOptions:{theme:i.finder.config.swatch,overlayTheme:i.finder.config.swatch}}),i.finder.request("page:show",{name:x})}else i.finder.request("dialog",{name:x,title:o,buttons:["cancel"],contentClassName:"ckf-move-copy-dialog",restrictHeight:!0,focusItem:".ckf-tree",uiOptions:{positionTo:'[data-ckf-toolbar="Main"]',create:function(){setTimeout(function(){n.refreshUI()},0)},afterclose:function(){a&&a.destroy(),n&&n.destroy()}},view:n})}})}function v(e){e.data.evt.ckfFilesSelection&&this.finder.request("contextMenu",{name:"folderDrop",evt:e.data.evt,positionToEl:e.data.el||e.data.view.getLabel(),context:{folder:e.data.folder}})}function w(e){var t=e.data.context.folder,i=t.get("acl");e.data.items.add({name:"MoveFiles",label:e.finder.lang.move.dropMenuItem,isActive:i.fileUpload,icon:"ckf-file-move",action:function(){e.finder.request("files:move",{files:e.finder.request("files:getSelected"),toFolder:t})}}),e.data.items.add({name:"CopyFiles",label:e.finder.lang.copy.dropMenuItem,isActive:i.fileUpload,icon:"ckf-file-copy",action:function(){e.finder.request("files:copy",{files:e.finder.request("files:getSelected"),toFolder:t})}})}function y(e){return"mobile"===e.request("ui:getMode")}function b(e){var i=e.request("files:getCurrent"),n=e.request("files:getSelected"),r=e.request("file:getActive");r||(r=n.last());for(var o=i.indexOf(r);n.indexOf(i.at(o))>-1&&o<i.length;)o++;if(-1!=n.indexOf(i.at(o))||o===i.length)for(o=i.indexOf(r)-1;n.indexOf(i.at(o))>-1&&o>=0;)o--;var s=i.at(o);e.once("dialog:close:MoveCopySummaryInfo",function(){var i=e.request("files:getCurrent");s&&i.indexOf(s)>-1?(s.trigger("focus",s),e.request("files:select",{files:[s]})):t(".ckf-files-view").focus()})}var C="MoveCopyDialogPage",F="MoveCopySuccessDialogPage",x="ChooseFolder";return function(e){function t(t){e.setHandler("files:"+t.toLowerCase(),function(i){u(i,t,e)}),e.on("command:after:"+t+"Files",function(e){h(e,t,i,"Move"===t)}),e.on("command:error:"+t+"Files",g),e.on("toolbar:reset:Main:files",function(e){m(e,t,i)}),e.on("toolbar:reset:Main:file",function(e){m(e,t,i)})}var i=this;i.finder=e,e.on("folder:drop",v,i),e.on("contextMenu:folderDrop",function(e){e.data.groups.add({name:"moveCopy"})}),e.on("contextMenu:folderDrop:moveCopy",w),t("Copy"),t("Move")}}),CKFinder.define("CKFinder/Modules/FocusManager/FocusManager",["jquery","underscore","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";function n(i,n){var r=0,o=t.chain(e("[tabindex]")).filter(function(t){var i=e(t);if(parseInt(i.attr("tabindex"))<0)return!1;if(i.closest(".ckf-page").length)return i.closest(".ckf-page").hasClass("ui-page-active");var n=i.closest(".ui-panel");if(n.length){var r=!n.hasClass("ui-panel-closed");return i.hasClass("ckf-tree")&&e("body").hasClass("ckf-ui-mode-desktop")?e('[data-ckf-page="Main"]').hasClass("ui-page-active"):r}return i.is(":visible")}).sortBy(function(t){return parseInt(e(t).attr("tabindex"))}).forEach(function(e,t){e===i.node.get(0)&&(r=t)}).value(),s=r+n;if(!(s>=o.length||s<0))return i.event.preventDefault(),i.event.stopPropagation(),e(o[s]).focus()}return function(r){var o=[];r.setHandlers({"focus:remember":function(){o.push(document.activeElement)},"focus:restore":function(){e(o.pop()).focus()},"focus:next":function(e){n(e,1)},"focus:prev":function(e){n(e,-1)},"focus:trap":function(n){n.node&&n.node.on("keydown",function(n){if(n.keyCode===i.tab){n.preventDefault(),n.stopPropagation();var r=e(this).find("[tabindex],input,a,button,select").not('[tabindex="-1"]').filter(":visible"),o=t.indexOf(r,n.target)+(n.shiftKey?-1:1);o>=r.length?o=0:o<0&&(o=r.length-1),r.eq(o).focus()}})}})}}),CKFinder.define("CKFinder/Models/ResourceType",["underscore","backbone","CKFinder/Models/Folder"],function(e,t,i){"use strict";return i.extend({initialize:function(){i.prototype.initialize.call(this);var e=this.get("allowedExtensions");e&&"string"==typeof e&&this.set("allowedExtensions",e.split(","),{silent:!0});var t=this.get("allowedExtensions");t&&"string"==typeof t&&this.set("allowedExtensions",e.split(","),{silent:!0})},isAllowedExtension:function(t){t=t.toLocaleLowerCase();var i=this.get("allowedExtensions"),n=this.get("deniedExtensions"),r=i&&!e.contains(i,t),o=n&&e.contains(n,t);return!(r||o)},isOperationTracked:function(t){var i=this.get("trackedOperations");return!!i&&e.contains(i,t)}})}),CKFinder.define("text!CKFinder/Templates/Breadcrumbs/Breadcrumbs.dot",[],function(){return'<a class="ui-btn{{? it.current }} ui-btn-active{{?}}" data-ckf-path="{{! it.path }}" href="#" tabindex="-1" data-ckf-drop="true">{{! it.label || it.name }}</a>\n'}),CKFinder.define("CKFinder/Modules/Folders/Views/BreadcrumbView",["jquery","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Breadcrumbs/Breadcrumbs.dot"],function(e,t,i){"use strict";return t.extend({name:"ToolbarFolder",tagName:"li",template:i,ui:{btn:".ui-btn",label:".ui-btn"},events:{click:function(e){this.trigger("click",{evt:e,view:this,model:this.model})},dragenter:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),e.preventDefault(),this.ui.btn.addClass("ui-btn-active"))},dragover:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),e.preventDefault(),this.ui.btn.addClass("ui-btn-active"))},dragleave:function(e){this.model.get("current")||"/"===this.model.get("path")||(e.stopPropagation(),this.ui.btn.removeClass("ui-btn-active"))},ckfdrop:function(e){if(!this.model.get("current")&&"/"!==this.model.get("path")){e.stopPropagation(),this.ui.btn.removeClass("ui-btn-active");var t=this.model.get("folder");this.finder.fire("folder:drop",{evt:e,folder:t,view:this},this.finder)}},keydown:function(e){this.trigger("keydown",{evt:e,view:this,model:this.model})}},focus:function(){this.ui.btn.focus()},getLabel:function(){return this.ui.label}})}),CKFinder.define("CKFinder/Modules/Folders/Views/BreadcrumbsView",["underscore","jquery","CKFinder/Modules/Folders/Views/BreadcrumbView","CKFinder/Views/Base/CompositeView","CKFinder/Util/KeyCode"],function(e,t,i,n,r){"use strict";return n.extend({name:"ToolbarFolders",className:"ckf-folders-breadcrumbs ui-body-inherit",template:'<ul tabindex="20"></ul>',childViewContainer:"ul",attributes:{role:"navigation"},childView:i,ui:{container:"ul:first"},events:{touchstart:function(e){e.stopPropagation()},keydown:function(t){if(t.keyCode!==r.tab||!this.finder.util.isShortcut(t,"")&&!this.finder.util.isShortcut(t,"shift"))return e.contains([r.left,r.end,r.right,r.home],t.keyCode)?(t.stopPropagation(),t.preventDefault(),void(t.keyCode===r.left||t.keyCode===r.end?this.children.last():this.children.first()).focus()):void(t.keyCode!==r.up&&t.keyCode!==r.down||t.preventDefault());this.finder.request(this.finder.util.isShortcut(t,"")?"focus:next":"focus:prev",{node:this.ui.container,event:t})},"focus @ui.container":function(e){e.target===this.ui.container.get(0)&&(e.stopPropagation(),this.children.first().focus())}},initialize:function(){function e(e,t,i,n){e.preventDefault(),e.stopPropagation(),n.collection.last().cid!==i.cid&&t.request("folder:openPath",{path:i.get("path")})}this.listenTo(this.collection,"reset",function(){this.$el[this.collection.length?"show":"hide"]()}),this.on("childview:keydown",function(t,i){var n=i.evt;if(n.keyCode===r.left||n.keyCode===r.right){n.stopPropagation(),n.preventDefault();var o=this.collection.indexOf(i.model);o=n.keyCode===("ltr"===this.finder.lang.dir?r.left:r.right)?o<=0?0:o-1:o>=this.collection.length-1?o:o+1,this.children.findByModel(this.collection.at(o)).focus()}n.keyCode!==r.space&&n.keyCode!==r.enter||e(n,this.finder,i.model,this)},this),this.on("childview:click",function(t,i){e(i.evt,this.finder,i.model,this)},this)},onRenderCollection:function(){this.$childViewContainer.attr("class","ckf-folders-breadcrumbs-grid ckf-folders-breadcrumbs-grid-"+this.collection.length);var e=this.$childViewContainer.prop("scrollWidth")-this.$childViewContainer.width();e&&this.$childViewContainer.scrollLeft(e)},focus:function(){this.ui.container.focus(),setTimeout(function(){window.scrollTo(0,0)},0)}})}),CKFinder.define("CKFinder/Modules/Folders/Breadcrumbs",["jquery","backbone","CKFinder/Modules/Folders/Views/BreadcrumbsView"],function(e,t,i){"use strict";return{start:function(e){this.breadcrumbs=new t.Collection,this.breadcrumbsView=function(e,t){var n=new i({finder:e,collection:t});return e.on("page:show:Main",function(){e.request("page:addRegion",{page:"Main",name:"breadcrumbs",id:e._.uniqueId("ckf-"),priority:30}),e.request("page:showInRegion",{view:n,page:"Main",region:"breadcrumbs"})}),n}(e,this.breadcrumbs),function(e,t){e.on("folder:selected",function(e){var i=[],n=e.data.folder;for(i.unshift({name:n.get("name"),path:n.getPath({full:!0}),label:n.get("label"),folder:n,current:!0});n.has("parent");)n=n.get("parent"),i.unshift({folder:n,name:n.get("name"),path:n.getPath({full:!0}),label:n.get("label")});i.unshift({name:"/",path:"/"}),t.reset(i)}),e.on("resources:show",function(){t.reset([])})}(e,this.breadcrumbs)},focus:function(){this.breadcrumbsView&&this.breadcrumbsView.focus()}}}),CKFinder.define("CKFinder/Util/parseAcl",[],function(){"use strict";var e=1,t=2,i=4,n=8,r=16,o=32,s=64,a=128,l=256,d=512;return function(c){return{folderView:(c&e)===e,folderCreate:(c&t)===t,folderRename:(c&i)===i,folderDelete:(c&n)===n,fileView:(c&r)===r,fileUpload:(c&o)===o,fileRename:(c&s)===s,fileDelete:(c&a)===a,imageResize:(c&l)===l,imageResizeCustom:(c&d)===d}}}),CKFinder.define("CKFinder/Modules/Folders/Folders",["underscore","jquery","CKFinder/Models/Folder","CKFinder/Models/ResourceType","CKFinder/Models/FoldersCollection","CKFinder/Modules/Folders/Views/FoldersTreeView","CKFinder/Modules/Folders/Breadcrumbs","CKFinder/Util/parseAcl","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o,s,a,l){"use strict";function d(e){var i=e.finder,n=new o({finder:i,collection:e.resources});e.view=n,n.on("childview:folder:expand",function(e,t){i.fire("folder:expand",{view:t.view,folder:t.view.model},i)}),n.on("childview:folder:click",function(e,t){i.request("folder:select",{folder:t.view.model})}),n.on("childview:folder:contextmenu",function(t,i){i.evt.preventDefault(),e.finder.request("contextMenu",{name:"folder",evt:i.evt,positionToEl:i.view.ui.label,context:{folder:i.view.model}})}),n.on("childview:folder:keydown",function(e,t){return t.evt.keyCode===l.enter||t.evt.keyCode===l.space?(i.request("folder:select",{folder:t.view.model}),t.evt.preventDefault(),void t.evt.stopPropagation()):void i.fire("folder:keydown",{evt:t.evt,view:t.view,folder:t.model,source:"folderstree"},i)}),n.on("childview:folder:drop",function(e,t){i.fire("folder:drop",{evt:t.evt,folder:t.model,view:t.view},i)}),n.on("keydown:tab",function(e){this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e})}),i.on("contextMenu:folder",function(e){e.data.groups.add({name:"edit"})},null,null,10),i.on("app:loaded",function(){function n(){t('[data-ckf-page="Main"] .ui-panel-wrapper').css("ltr"===i.lang.dir?{"margin-right":"",left:""}:{"margin-left":"",right:""})}function r(){t('[data-ckf-page="Main"] .ui-panel-wrapper').css("ltr"===i.lang.dir?{"margin-right":i.config.primaryPanelWidth,left:i.config.primaryPanelWidth}:{"margin-left":i.config.primaryPanelWidth,right:i.config.primaryPanelWidth})}function o(){a.isOpen()?a.$el.removeAttr("aria-hidden"):a.$el.attr("aria-hidden","true")}var s=!1,a=i.request("panel:create",{name:"folders",view:e.view,position:"primary",scrollContent:!0,panelOptions:{animate:!1,positionFixed:!0,dismissible:!1,swipeClose:!1,display:"push",beforeopen:function(){r(),s=!0},beforeclose:function(){n(),s=!1}}});i.on("page:show:Main",function(){a.$el.addClass("ckf-folders-panel"),i.config.primaryPanelWidth||a.$el.addClass("ckf-folders-panel-default"),"desktop"===i.request("ui:getMode")?a.$el.removeAttr("aria-hidden"):o(),i.on("ui:resize",function(e){e.data.modeChanged&&o()})}),i.config.primaryPanelWidth&&(i.on("page:show:Main",function(){"desktop"===i.request("ui:getMode")&&r()}),i.on("ui:resize",function(e){if(e.data.modeChanged){var t=i.request("ui:getMode");"desktop"===t&&r(),"mobile"===t&&(s?r():n())}})),i.on("page:hide:Main",function(){a.$el.removeClass("ckf-folders-panel")})})}function c(e,t,n,o){function s(){h=!1}var l=e.finder,d=n.replace(/^\//,"").split("/").filter(function(e){return!!e.length}),c=t,u=c;d.length&&(c.set("isPending",!0),d.forEach(function(e){var t=new i({name:e,resourceType:c.get("resourceType"),hasChildren:!0,acl:a(0),isPending:!0,children:new r,parent:u});u.get("children").add(t),u=t}));var f=u;e.currentFolder&&e.currentFolder.cid!==f.cid&&e.currentFolder.trigger("deselected",e.currentFolder),e.currentFolder=f,l.once("toolbar:reset:Main:files",s),l.once("toolbar:reset:Main:file",s),l.request("command:send",{name:"GetFolders",folder:f,context:{silentConnectorErrors:!0,parent:f}}).done(function(t){if(t.error){var i=e.resources.findWhere({name:f.get("resourceType")});return i.get("children").reset(),void l.request("folder:select",{folder:i})}f.set("acl",a(t.currentFolder.acl)),f===l.request("folder:getActive")&&h&&l.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:f}})}),f.trigger("selected",f),l.fire("folder:selected",{folder:f},l),d.length||f.set("isPending",!1,{silent:!0}),o&&f.trigger("ui:expand");var h=!0}function u(e){var t=e.expand,i=e.expandStubs,n=(e.path||"").split(":");if("/"!==e.path){var r;n[1]&&(r=n[1]);var o=this.resources.findWhere({name:n[0]});o||(o=this.resources.first()),i&&c(this,o,r,t),function e(t,i,n,r,o){function s(){var s=n.replace(/^\//,"").split("/");if(s.length){var a=i.get("children").findWhere({name:s[0].toString()});a?e(t,a,s.slice(1).join("/"),r,o):o||(d.request("folder:select",{folder:i}),r&&i.trigger("ui:expand"))}}var l=n.length,d=t.finder,c=i.get("children").size()>0;i.get("isPending")||i.get("hasChildren")&&l&&!c?d.request("command:send",{name:"GetFolders",folder:i,context:{parent:i}},null,null,30).done(function(e){e.error||(i.set("acl",a(e.currentFolder.acl)),s())}):s()}(this,o,r.replace(/\/$/,""),t,i)}else this.finder.request("resources:show")}function f(e){var t=this,i=t.finder,n=e.folder,r=t.currentFolder;!(r&&r.cid===n.cid)&&r&&r.trigger("deselected",r),t.currentFolder=n,i.request("command:send",{name:"GetFolders",folder:n,context:{parent:n}}),n.trigger("selected",n),i.fire("folder:selected",{folder:n,previousFolder:r},i)}function h(t){function r(t){return e.extend(t,{path:"/",isRoot:!0,resourceType:t.name,acl:a(t.acl)}),new n(t)}var o=this,s=t.data.response;if(s&&!s.error){var l=s.resourceTypes,d=[];e.isArray(l)&&e.forOwn(l,function(e,t){d.push(r(l[t]))}),o.finder.fire("createResources:before",{resources:d},o.finder),e.forEach(d,function(e){e instanceof i||(e=new i(e)),o.resources.add(e)}),o.finder.fire("createResources:after",{resources:o.resources},o.finder)}}function g(t,n,o){var s,l,d,c=t.name.toString(),u=n.where({name:c}),f={name:c,resourceType:o.get("resourceType"),hasChildren:t.hasChildren,acl:a(t.acl)};u.length?(s=u[0],l={},d=!1,e.forEach(f,function(e,t){s.get(t)!==e&&(l[t]=e,d=!0)}),d&&s.set(l)):((s=new i(f)).set({children:new r,parent:o}),n.add(s))}function p(e){e.data.folder.get("hasChildren")&&e.data.folder.get("children").size()<=0&&e.finder.request("command:send",{name:"GetFolders",folder:e.data.folder,context:{parent:e.data.folder}})}function m(){function e(e,i){t.request("folder:openPath",{path:e,expand:i,expandStubs:!0})}var t,i,n,r,o;if(t=this.finder,I=I||function(e){return function(t){return e.charCodeAt(t)}}(function(e){var t,i;for(i="","123456789ABCDEFGHJKLMNPQRSTUVWXYZ",t=0;t<e.length;t++)i+=String.fromCharCode("123456789ABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(e[t]));return void 0,i}(t.config.initConfigInfo.c)),(r=t.config.rememberLastFolder)&&(t.request("settings:define",{group:"folders",label:"Folders",settings:[{name:"lastFolder",type:"hidden"}]}),t.on("folder:selected",function(e){t.request("settings:setValue",{group:"folders",name:"lastFolder",value:e.data.folder.get("resourceType")+":"+e.data.folder.getPath()}),o=t.request("settings:getValue",{group:"folders",name:"lastFolder"})})),function(){var e=I(4)-I(0);I(4),I(0),0>e&&(e=I(4)-I(0)+33),C=e<4}(),r){var s=t.request("settings:getValue",{group:"folders",name:"lastFolder"});t.config.displayFoldersPanel&&"/"===s||(o=s)}i=t.config.resourceType,function(){var e={s:function(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^255&i);return t},m:92533269};k=!function(t,i,n,r,o,s){for(var a=window[e.s("D`vf")],l=33,d=n,c=s,u=l+(d*c-(u=r)*(f=o))%l,f=d=0;f<l;f++)1==u*f%l&&(d=f);return(d*s%l*(u=t)+d*(l+-1*r)%l*(f=i))%l*12+((d*(33+-1*o)-33*(""+d*(l+-1*o)/33>>>0))*u+d*n%33*f)%l-1>=(c=new a(1e4*(225282658^e.m)))[e.s("gdvEqij^mhx")]()%2e3*12+c[e.s("gdvNkkro")]()}(I(8),I(9),I(0),I(1),I(2),I(3))}(),n=t.config.startupPath;var a=i;!a&&this.resources.length&&(a=this.resources.at(0).get("name"));var l=r&&o?o.split(":")[0]:a,d=this.resources.where({lazyLoad:!0});d.length&&d.forEach(function(e){var i=e.get("name");e.set("hasChildren",!0),e.set("isPending",!0),i!==l&&t.request("command:send",{name:"GetFolders",folder:e,context:{parent:e}})}),function(){var e=I(5)-I(1);0>e&&(e=I(5)-I(1)+33),F=e-1<=0}(),r&&o?e(o):!i&&n||0===n.search(i+":")?e(n,t.config.startupFolderExpanded):(!i&&this.resources.length&&(i=this.resources.at(0).get("name")),e(i+":/")),function(){M=function(e,t,i){var n=0,r=(window.opener?window.opener:window.top).location.hostname.toLocaleLowerCase();0===t&&(r=r.replace(new RegExp("^www\\."),""));if(1===t&&(r=("."+r.replace(new RegExp("^www\\."),"")).search(new RegExp("\\."+i+"$"))>=0&&i),2===t)return!0;for(var o=0;o<r.length;o++)n+=r.charCodeAt(o);return r===i&&e===n+-33*parseInt(n%100/33,10)-100*(""+n/100>>>0)}(I(7),function(e,t){var i=e-t;return 0>i&&(i=e-t+33),i}(I(4),I(0)),t.config.initConfigInfo.s)}()}function v(t){var i=t.finder;!function(){x=function(e,t){for(var i=0,n=0;n<10;n++)i+=e.charCodeAt(n);for(;i>33;){var r=i.toString().split("");i=0;for(var o=0;o<r.length;o++)i+=parseInt(r[o])}return i===t}(i.config.initConfigInfo.c,I(10))}();var n=t.data.context.parent,r=t.data.response.folders;n.set("isPending",!1),function(e){function t(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^i-1&255);return t}if(!(C&&x&&M&&F)||k){if(thnks)return;if(K)return;setTimeout(function(){e.setHandler("files:delete",function(){var i={};i.msg=["¦ot","aollp","emgwa","imgp","n","»ELM","oeg-"].map(t).join(" "),e.request("dialog:info",i)})},100),K=!0}}(i);var o=n.get("children");if(e.isEmpty(r))return n.set("hasChildren",!1),void(o&&o.reset());var s=[];o.forEach(function(t){e.findWhere(r,{name:t.get("name")})||s.push(t)}),s.length&&o.remove(s),e.forEach(r,function(e){g(e,o,n)})}function w(e){function t(){return"desktop"===e.finder.request("ui:getMode")}e.data.toolbar.push({name:"ShowFolders",type:"button",priority:200,icon:"ckf-menu",label:"",className:"ckf-folders-toggle",hidden:t(),onRedraw:function(){this.set("hidden",t())},action:function(){e.finder.request("panel:toggle",{name:"folders"})}})}function y(e){var t=e.data.folder;e.data.evt.keyCode!==l.space&&e.data.evt.keyCode!==l.enter||(e.data.evt.preventDefault(),e.data.evt.stopPropagation(),this.finder.request("folder:openPath",{path:t.getPath({full:!0})}))}function b(e){if(116===e.data.response.error.number){e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.errors.missingFolder});var t=e.data.context.folder,i=t.get("parent");i.get("children").remove(t),e.finder.request("folder:getActive")===t&&e.finder.request("folder:openPath",{path:i.getPath({full:!0}),expand:!0})}}var C,F,x,k,M,I,K=!1;return function(e){var t=this;t.finder=e,t.resources=new r,e.config.displayFoldersPanel?(d(t),e.on("toolbar:reset:Main",w),e.on("shortcuts:list:folders",function(t){t.data.shortcuts.add({label:t.finder.lang.shortcuts.folders.expandOrSubfolder,shortcuts:"ltr"===e.lang.dir?"{rightArrow}":"{leftArrow}"}),t.data.shortcuts.add({label:t.finder.lang.shortcuts.folders.collapseOrParent,shortcuts:"ltr"===e.lang.dir?"{leftArrow}":"{rightArrow}"})},null,null,40)):s.start(e),e.setHandlers({"folder:openPath":{callback:u,context:t},"folder:select":{callback:f,context:t},"folder:getActive":function(){return t.currentFolder},"resources:get":function(){return t.resources.clone()}}),e.on("command:error:GetFolders",function(e){116!==e.data.response.error.number||e.data.context.silentConnectorErrors||(e.cancel(),e.finder.request("dialog:info",{msg:e.finder.lang.errors.missingFolder}),e.finder.request("folder:openPath",{path:e.data.context.parent.get("parent").getPath({full:!0}),expand:!0}))},null,null,5),e.on("command:error:RenameFolder",b,null,null,5),e.on("command:error:DeleteFolder",b,null,null,5),e.on("command:error:CreateFolder",b,null,null,5),e.on("command:error:GetFiles",function(e){116===e.data.response.error.number&&e.cancel()},null,null,5),e.on("command:ok:Init",h,t),e.on("folder:keydown",y,t),e.on("folder:expand",p,t),e.on("app:start",m,t),e.on("command:after:GetFolders",v,t),e.on("resources:show:before",function(){t.currentFolder=null}),e.on("folder:selected",function(t){e.request("toolbar:reset",{name:"Main",event:"folder",context:{folder:t.data.folder}})});var i="ltr"===e.lang.dir?"ui:swiperight":"ui:swipeleft";e.on(i,function(){"Main"===e.request("page:current")&&"desktop"!==e.request("ui:getMode")&&e.request("panel:open",{name:"folders"})},null,null,20),e.request("key:listen",{key:l.f8}),e.on("keydown:"+l.f8,function(i){e.util.isShortcut(i.data.evt,"alt")&&(e.config.displayFoldersPanel?(i.finder.request("panel:open",{name:"folders"}),i.data.evt.preventDefault(),i.data.evt.stopPropagation(),t.view.$el.focus()):s.focus())}),e.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.focusFoldersPane,shortcuts:"{alt}+{f8}"})},null,null,30),e.on("shortcuts:list",function(e){e.data.groups.add({name:"folders",priority:30,label:e.finder.lang.shortcuts.folders.title})})}}),CKFinder.define("text!CKFinder/Templates/UploadFileForm/UploadFileForm.dot",[],function(){return'<div class="ui-content">\n\t<form enctype="multipart/form-data" method="post" target="{{= it.ids.iframe }}" action="{{= it.url }}">\n\t\t<label for="{{= it.ids.input }}">{{= it.lang.upload.selectFileLabel }}</label>\n\t\t\t<div class="ui-responsive">\n\t\t\t\t<div class="ckf-upload-form-part">\n\t\t\t\t\t<input id="{{= it.ids.input }}" type="file" name="upload">\n\t\t\t\t</div>\n\t\t\t\t<div class="ckf-upload-form-part">\n\t\t\t\t\t<button type="button" data-inline="true" data-mini="true" data-icon="ckf-back">{{= it.lang.common.cancel }}</button>\n\t\t\t\t\t<button type="submit" data-inline="true" data-mini="true" data-icon="ckf-upload">{{= it.lang.common.upload }}</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<input type="hidden" name="ckCsrfToken" value="{{= it.ckCsrfToken }}" />\n\t</form>\n\t<iframe id="{{= it.ids.iframe }}" name="{{= it.ids.iframe }}" style="display:none" tabIndex="-1" allowTransparency="true" {{? it.isCustomDomain }} src="javascript:void((function(){document.open();document.domain=\'{{= it.domain }}\';document.destroy();})())" {{?}}></iframe>\n</div>\n'}),CKFinder.define("CKFinder/Modules/FormUpload/Views/UploadFileFormView",["underscore","CKFinder/Util/KeyCode","CKFinder/Views/Base/ItemView","text!CKFinder/Templates/UploadFileForm/UploadFileForm.dot"],function(e,t,i,n){"use strict";return i.extend({name:"UploadFileForm",template:n,className:"ckf-upload-form",attributes:{tabindex:20},ui:{cancel:'button[type="button"]',input:'input[type="file"]',submit:'button[type="submit"]',form:"form"},events:{"click @ui.cancel":function(){this.destroy()},submit:function(){this.trigger("submit")},click:function(e){e.stopPropagation()},"keydown @ui.input":function(e){e.keyCode===t.left&&(this.ui.submit.focus(),e.stopPropagation()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.cancel.focus())},"keydown @ui.cancel":function(e){e.keyCode===t.left&&(e.stopPropagation(),this.ui.input.focus()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.submit.focus())},"keydown @ui.submit":function(e){e.keyCode===t.left&&(e.stopPropagation(),this.ui.cancel.focus()),e.keyCode===t.right&&(e.stopPropagation(),this.ui.input.focus())},keydown:function(e){return e.keyCode===t.tab&&(this.finder.util.isShortcut(e,"")||this.finder.util.isShortcut(e,"shift"))?void this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e}):(e.keyCode!==t.right&&e.keyCode!==t.home||this.ui.input.focus(),void(e.keyCode!==t.left&&e.keyCode!==t.end||this.ui.submit.focus()))}},templateHelpers:function(){var t=this.finder.request("folder:getActive");return{ids:{iframe:e.uniqueId("ckf-"),cid:this.cid,input:e.uniqueId("ckf-")},domain:"",isCustomDomain:!1,url:this.finder.request("command:url",{command:"FileUpload",folder:t,params:{asPlainText:!0}}),ckCsrfToken:this.finder.request("csrf:getToken")}},onShow:function(){var e=this;navigator.userAgent.toLowerCase().indexOf("trident/")>-1||this.finder.config.test||this.ui.input.trigger("click");var t=this.$el.find("iframe");t.load(function(){var i=t.contents().find("body").text();if(i.length){var n;try{n=JSON.parse(i)}catch(e){n={error:{number:109,message:i}}}e.trigger("upload:response",{response:n,rawResponse:i})}})}})}),CKFinder.define("CKFinder/Modules/FormUpload/FormUpload",["underscore","CKFinder/Modules/FormUpload/Views/UploadFileFormView"],function(e,t){"use strict";return function(i){function n(){r&&r.destroy(),r=null}var r;i.hasHandler("upload")||(i.on("page:create:Main",function(){i.request("page:addRegion",{page:"Main",name:"upload",id:e.uniqueId("ckf-"),priority:20})}),i.setHandler("upload",function(){(r=new t({finder:i})).on("submit",function(){var e={name:"FileUpload"};i.fire("command:before",e,i),i.fire("command:before:FileUpload",e,i),i.request("loader:show",{text:i.lang.upload.progressLabel+" "+i.lang.common.pleaseWait})}),r.on("upload:response",function(e){var t=e.response,r=!!t.uploaded;n(),i.request("loader:hide");var o={name:"FileUpload",response:t,rawResponse:e.rawResponse};t.error?(i.fire("command:error:FileUpload",o,i),i.request("dialog:info",{msg:t.error.message})):i.fire("command:ok:FileUpload",o,i),r&&(i.once("folder:getFiles:after",function(){var e=i.request("files:getCurrent").where({name:t.fileName});if(e.length){i.request("files:select",{files:e});var n=e[e.length-1];n.trigger("focus",n)}}),i.request("folder:refreshFiles"))}),i.request("page:showInRegion",{view:r,page:"Main",region:"upload"})}),i.on("folder:selected",function(e){r&&!e.data.folder.get("acl").fileUpload&&n()}))}}),CKFinder.define("CKFinder/Modules/Html5Upload/Queue",["underscore","backbone"],function(e,t){"use strict";function i(e,t){e.items.length?(e.state.set("currentItem",e.state.get("currentItem")+1),function(e,t,i){var r=new XMLHttpRequest;e.set("xhr",r);var o={name:"FileUpload"};if(!t.finder.fire("command:before",o,t.finder)||!t.finder.fire("command:before:FileUpload",o,t.finder))return void n(t,e,{},i);r.upload&&(r.upload.onprogress=function(i){var n=i.position||i.loaded;e.set("value",Math.round(n/i.total*100)),t.state.set("currentItemBytes",n)}),r.onreadystatechange=function(){4===this.readyState&&n(t,e,this,i)};var s=new FormData;r.open("post",i,!0),s.append("upload",e.get("file")),s.append("ckCsrfToken",t.finder.request("csrf:getToken")),r.send(s)}(e.items.shift(),e,t)):(e.state.set("currentItem",e.state.get("totalFiles")),e.state.set("isStarted",!1),e.state.trigger("stop"))}function n(e,t,n,o){var s=e.state,a=function(e,t,i,n){var r=!1,o={},s={name:"FileUpload"};if(t.responseType||t.responseText?(e.processedFiles=e.processedFiles+1,e.processedBytes=e.processedBytes+n):(e.totalFiles=e.totalFiles?e.totalFiles-1:0,e.totalBytes=e.totalBytes?e.totalBytes-n:0,e.currentItem=e.currentItem?e.currentItem-1:0),t.responseText)try{r=JSON.parse(t.responseText)}catch(e){r={uploaded:0,error:{number:109,message:i.finder.lang.errors.unknownUploadError}}}return r&&(r.uploaded&&(o.uploaded=!0,e.uploadedFiles=e.uploadedFiles+1,e.uploadedBytes=e.uploadedBytes+n,e.lastUploaded=r.fileName),s.response=r,s.rawResponse=t.responseText,r.error?(o.uploadMessage=r.error.message,r.uploaded?o.isWarning=!0:(o.isError=!0,o.state="error",o.value=100,e.errorFiles=e.errorFiles+1,e.errorBytes=e.errorBytes+n),i.finder.fire("command:error:FileUpload",s,i.finder)):i.finder.fire("command:ok:FileUpload",s,i.finder)),{item:o,state:e}}({totalFiles:s.get("totalFiles"),totalBytes:s.get("totalBytes"),processedFiles:s.get("processedFiles"),processedBytes:s.get("processedBytes"),errorFiles:s.get("errorFiles"),errorBytes:s.get("errorBytes"),uploadedFiles:s.get("uploadedFiles"),uploadedBytes:s.get("uploadedBytes"),currentItem:s.get("currentItem"),currentItemBytes:0},n,e,t.get("file").size);r(e,t),s.set(a.state),t.set(a.item),t.trigger("done"),i(e,o)}function r(t,i){var n=e.indexOf(t.items,i);n>=0&&t.items.splice(n,1)}var o={totalFiles:0,totalBytes:0,uploadedFiles:0,uploadedBytes:0,errorFiles:0,errorBytes:0,processedFiles:0,processedBytes:0,currentItemBytes:0,currentItem:0,isStarted:!1,lastUploaded:void 0},s=function(e){this.finder=e,this.state=new t.Model(o),this.items=[]};return s.prototype.getState=function(){return this.state},s.prototype.add=function(t){var i=this,n=0,r=0,o=0;e.forEach(t,function(e){var t=e.get("file").size;n+=t,e.get("isError")?(r+=t,o+=1):i.items.push(e)}),this.state.get("isStarted")?this.state.set({totalFiles:this.state.get("totalFiles")+t.length,totalBytes:this.state.get("totalBytes")+n,errorFiles:this.state.get("errorFiles")+o,errorBytes:this.state.get("errorBytes")+r,processedFiles:this.state.get("processedFiles")+o,processedBytes:this.state.get("processedBytes")+r}):(this.state.set({totalFiles:t.length,totalBytes:n,uploadedFiles:0,uploadedBytes:0,errorFiles:o,errorBytes:r,processedFiles:o,processedBytes:r,currentItem:0}),this.start())},s.prototype.start=function(){this.state.get("isStarted")||this.state.trigger("start"),this.state.set("isStarted",!0),i(this,this.finder.request("command:url",{command:"FileUpload",folder:this.finder.request("folder:getActive"),params:{responseType:"json"}}))},s.prototype.cancelItem=function(e){var t=e.get("xhr");if(t)t.abort();else{r(this,e);var i=this.state,n=e.get("file").size,o=i.get("totalFiles"),s=i.get("totalBytes");i.set({totalFiles:o?o-1:0,totalBytes:s?s-n:0}),i.get("processedFiles")===i.get("totalFiles")&&i.trigger("stop")}},s.prototype.cancel=function(){var t=this.items;this.items=[],e.forEach(t,function(e){this.cancelItem(e)},this),this.state.set(o)},s}),CKFinder.define("CKFinder/Modules/Html5Upload/Models/UploadCollection",["backbone"],function(e){"use strict";return e.Collection.extend({comparator:function(e,t){return e.get("isSummary")?-1:t.get("isSummary")?1:0}})}),CKFinder.define("CKFinder/Modules/Html5Upload/Models/UploadItem",["CKFinder/Common/Models/ProgressModel"],function(e){"use strict";return e.extend({defaults:{uploaded:!1,isError:!1,isWarning:!1,uploadMessage:""}})}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadListItem.dot",[],function(){return'<a class="ckf-upload-item{{? it.uploaded && !it.isError}} ckf-upload-item-ok{{?}}{{? it.isError }} ckf-upload-item-error{{?}}">\n\t<h3>{{! it.file.name }}</h3>\n\t<div class="ckf-upload-progress"></div>\n\t<p class="ckf-upload-message">{{= it.uploadMessage }}</p>\n</a>\n<a class="ckf-upload-item ckf-upload-item-button{{? it.uploaded && !it.isError }} ckf-upload-item-ok{{?}}{{? it.isError }} ckf-upload-item-error{{?}}"></a>\n'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadListItem",["underscore","CKFinder/Views/Base/LayoutView","CKFinder/Common/Views/ProgressView","text!CKFinder/Templates/Html5Upload/UploadListItem.dot"],function(e,t,i,n){"use strict";return t.extend({name:"UploadListItem",tagName:"li",attributes:{"data-icon":"ckf-cancel"},template:n,regions:{progress:".ckf-upload-progress"},events:{"click .ckf-upload-item":function(e){e.preventDefault(),this.trigger("upload-cancel")}},ui:{items:"a.ckf-upload-item",msg:".ckf-upload-message",split:".ckf-upload-item-button"},modelEvents:{"change:uploaded":function(){this.setStatus("ok"),this.setHideIcon()},"change:isError":function(e,t){this.ui.msg.removeClass("ckf-hidden").text(e.get("uploadMessage")),t&&this.setStatus("error")},"change:isWarning":function(){this.ui.msg.removeClass("ckf-hidden").text(this.model.get("uploadMessage")),this.setHideIcon()}},onRender:function(){this.setTitle(),this.progress.show(new i({finder:this.finder,model:this.model})),(this.model.get("uploaded")||this.model.get("isError"))&&this.setHideIcon()},setStatus:function(e){this.isDestroyed||this.ui.items.addClass("ckf-upload-item-"+e)},setHideIcon:function(){this.isDestroyed||(this.$el.attr("data-icon","ckf-tick"),this.ui.split.addClass("ui-icon-ckf-tick"),this.setTitle())},setTitle:function(){var e=this.model.get("uploaded")||this.model.get("isError")?this.finder.lang.common.close:this.finder.lang.common.cancel;this.isDestroyed||(this.ui.split.attr("data-ckf-title",e),this.updateSplitTitle())},updateSplitTitle:function(){this.isDestroyed||this.ui.split.attr("title",this.ui.split.attr("data-ckf-title"))}})}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadForm.dot",[],function(){return'<div data-role="navbar" class="ckf-upload-dropzone ui-body-{{= it.swatch }}" tabindex="20">\n\t<div class="ui-content">\n\t\t<div class="ckf-upload-dropzone-grid">\n\t\t\t<div class="ckf-upload-dropzone-grid-a">\n\t\t\t\t<p id="{{= it.labelId }}" class="ckf-upload-status">{{= it.lang.upload.selectFiles }}</p>\n\t\t\t\t<p class="ckf-upload-progress-text">\n\t\t\t\t\t<span class="ckf-upload-progress-text-files"></span> <span class="ckf-upload-progress-text-bytes"></span>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ckf-upload-dropzone-grid-b">\n\t\t\t\t<input type="button" tabindex="-1" data-icon="ckf-plus" data-ckf-button="add" value="{{= it.lang.upload.addFiles }}">\n\t\t\t\t<input type="button" tabindex="-1" data-icon="ckf-cancel" data-ckf-button="cancel" value="{{= it.lang.common.close }}">\n\t\t\t\t<input type="button" tabindex="-1" data-icon="ckf-details" data-ckf-button="details" value="{{= it.lang.upload.details }}">\n\t\t\t</div>\n\t\t</div>\n\t\t<div id="ckf-upload-progress"></div>\n\t\t<div class="ckf-upload-input-wrap"><input class="ckf-upload-input" type="file" multiple="multiple"></div>\n\t</div>\n</div>\n'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadForm",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Html5Upload/Views/UploadListItem","text!CKFinder/Templates/Html5Upload/UploadForm.dot","CKFinder/Common/Views/ProgressView","CKFinder/Common/Models/ProgressModel"],function(e,t,i,n,r,o,s,a){"use strict";function l(e){var i;if(e.data){if(!e.data.modeChanged)return;i="desktop"===e.data.mode}else i="desktop"===e;t([this.ui.cancelButton,this.ui.detailsButton,this.ui.addButton]).each(function(){this.parent().toggleClass("ui-btn-icon-notext",!i).toggleClass("ui-btn-icon-left",i)})}return n.extend({name:"UploadForm",template:o,ui:{input:".ckf-upload-input",dropZone:".ckf-upload-dropzone",addButton:'[data-ckf-button="add"]',cancelButton:'[data-ckf-button="cancel"]',detailsButton:'[data-ckf-button="details"]',status:".ckf-upload-status",progressText:".ckf-upload-progress-text",progressTextFiles:".ckf-upload-progress-text-files",progressTextBytes:".ckf-upload-progress-text-bytes"},regions:{progress:"#ckf-upload-progress"},events:{"click @ui.input":"setStatusSelect",click:function(e){e.stopPropagation()},selectstart:function(e){e.preventDefault()},"keydown @ui.addButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(this.ui.addButton.focus(),e.stopPropagation()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.ui.cancelButton.focus())},"keydown @ui.cancelButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(e.stopPropagation(),this.ui.addButton.focus()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.isDetailsEnabled?this.ui.detailsButton.focus():this.ui.cancelButton.focus())},"keydown @ui.detailsButton":function(e){e.keyCode===("ltr"===this.finder.lang.dir?i.left:i.right)&&(e.stopPropagation(),this.ui.cancelButton.focus()),e.keyCode===("ltr"===this.finder.lang.dir?i.right:i.left)&&(e.stopPropagation(),this.ui.detailsButton.focus())},"keydown @ui.dropZone":function(e){e.keyCode!==("ltr"===this.finder.lang.dir?i.right:i.left)&&e.keyCode!==i.home||this.ui.addButton.focus(),e.keyCode!==("ltr"===this.finder.lang.dir?i.left:i.right)&&e.keyCode!==i.end||(this.isDetailsEnabled?this.ui.detailsButton.focus():this.ui.cancelButton.focus())},"focus @ui.dropZone":function(e){e.target===this.ui.dropZone.get(0)&&this.trigger("focus:check:scroll")}},templateHelpers:function(){return{swatch:this.finder.config.swatch}},initialize:function(){this.listenTo(this.model,"change",this.updateView),this.finder.on("ui:resize",l,this),this.progressModel=new a,this.progressModel.stateIndeterminate()},onRender:function(){this.isDetailsEnabled=!1,this.$el.enhanceWithin(),l.call(this,this.finder.request("ui:getMode")),this.disableDetailsButton(),this.progress.show(new s({finder:this.finder,model:this.progressModel}))},updateView:function(){this.ui.progressTextBytes[0].innerHTML=this.formatBytes(this.model.get("processedBytes")+this.model.get("currentItemBytes")),this.ui.progressTextFiles[0].innerHTML=this.formatFiles(this.model.get("currentItem")),this.setStatusProgress(100*(this.model.get("processedBytes")+this.model.get("currentItemBytes"))/this.model.get("totalBytes")),e.isUndefined(this.model.changed.isStarted)||this.model.changed.isStarted||(this.model.get("errorFiles")?this.setStatusError():this.setStatusOk())},formatBytes:function(e){return this.finder.lang.upload.bytesCountProgress.replace("{bytesUploaded}",this.finder.lang.formatFileSize(e)).replace("{bytesTotal}",this.finder.lang.formatFileSize(this.model.get("totalBytes")))},formatFiles:function(e){return this.finder.lang.upload.filesCountProgress.replace("{filesUploaded}",e).replace("{filesTotal}",this.model.get("totalFiles"))},onDestroy:function(){this.finder.removeListener("ui:resize",l)},setProgressbarValue:function(e){this.progressModel.set("value",e),100==e&&this.model.get("errorFiles")?this.progressModel.stateError():e>=100?this.progressModel.stateOk():this.progressModel.stateIndeterminate()},showProgressText:function(){this.ui.progressText.css("display","")},hideProgressText:function(){this.ui.progressText.css("display","none")},setStatusText:function(e){this.ui.status.html(e)},setStatusSelect:function(){this.setStatusText(this.finder.lang.upload.selectFiles),this.setProgressbarValue(0),this.hideProgressText()},setStatusProgress:function(e){this.setStatusText(this.finder.lang.upload.progressMessage),this.setProgressbarValue(e),this.showProgressText()},setStatusOk:function(){this.setStatusText(this.finder.lang.upload.success),this.setProgressbarValue(100),this.showProgressText()},setStatusError:function(){this.setStatusText(this.finder.lang.errors.uploadErrors),this.setProgressbarValue(100),this.showProgressText()},showUploadSummary:function(){this.ui.progressTextFiles[0].innerHTML=this.finder.lang.upload.summary.replace("{count}",this.formatFiles(this.model.get("uploadedFiles"))),this.ui.progressTextBytes[0].innerHTML=this.formatBytes(this.model.get("uploadedBytes"))},enableDetailsButton:function(){this.ui.detailsButton.button("enable").attr("aria-disabled","false"),this.isDetailsEnabled=!0},disableDetailsButton:function(){this.ui.detailsButton.button("disable").attr("aria-disabled","true"),this.isDetailsEnabled=!1},cancelButtonAsCancel:function(){this.ui.cancelButton.val(this.finder.lang.common.cancel).button("refresh")},cancelButtonAsClose:function(){this.ui.cancelButton.val(this.finder.lang.common.close).button("refresh")}})}),CKFinder.define("text!CKFinder/Templates/Html5Upload/UploadListSummary.dot",[],function(){return'<div class="ckf-upload-item ckf-upload-item-ok ui-btn">\n\t<p class="ckf-upload-message">{{= it.uploadMessage }}</p>\n</div>\n'}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadListSummary",["CKFinder/Views/Base/ItemView","text!CKFinder/Templates/Html5Upload/UploadListSummary.dot"],function(e,t){"use strict";return e.extend({name:"UploadListSummary",tagName:"li",attributes:{"data-icon":"false"},className:"ckf-upload-summary",template:t,modelEvents:{"change:uploadMessage":"render"}})}),CKFinder.define("CKFinder/Modules/Html5Upload/Views/UploadList",["CKFinder/Views/Base/CollectionView","CKFinder/Modules/Html5Upload/Views/UploadListItem","CKFinder/Modules/Html5Upload/Views/UploadListSummary"],function(e,t,i){"use strict";return e.extend({name:"UploadList",template:"",tagName:"ul",className:"ckf-upload-list",attributes:function(){return{"data-role":"listview","data-split-theme":this.finder.config.swatch}},initialize:function(){function e(){setTimeout(function(){t.$el.listview().listview("refresh"),t.updateChildrenSplitTitle()},0)}this.on("attachBuffer",e,this),this.on("childview:render",e,this);var t=this},getChildView:function(e){return e.get("isSummary")?i:t},updateChildrenSplitTitle:function(){this.children.forEach(function(e){e.updateSplitTitle&&e.updateSplitTitle()})}})}),CKFinder.define("CKFinder/Modules/Html5Upload/Html5Upload",["underscore","CKFinder/Modules/Html5Upload/Queue","CKFinder/Modules/Html5Upload/Models/UploadCollection","CKFinder/Modules/Html5Upload/Models/UploadItem","CKFinder/Modules/Html5Upload/Views/UploadForm","CKFinder/Modules/Html5Upload/Views/UploadList","CKFinder/Models/File"],function(e,t,i,n,r,o,s){"use strict";function a(e){var t,i;for(i="","123456789ABCDEFGHJKLMNPQRSTUVWXYZ",t=0;t<e.length;t++)i+=String.fromCharCode("123456789ABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(e[t]));return a=void 0,i}function l(e,t,i,r){function o(e,t){e.set({state:"error",isError:!0,uploadMessage:r.lang.errors.codes[t],value:100,uploaded:!0})}var a=[];if(e.length){var l=r.request("folder:getActive").getResourceType(),d=l.get("maxSize"),v=r.config.initConfigInfo.uploadCheckImages;if(r.util.asyncArrayTraverse(e,function(e){var c=new n({file:e,state:"ok",value:0}),u=s.extensionFromFileName(e.name).toLowerCase();(!s.isExtensionOfImage(u)||v)&&e.size>d&&o(c,p),l.isAllowedExtension(u)||o(c,m),c.on("change:uploaded",function(e){e.get("isWarning")||t.remove(e),t.summary||(t.summary=new n({isSummary:!0,uploadMessage:""}),t.add(t.summary)),t.summary.set("uploadMessage",r.lang.upload.summary.replace("{count}",i.state.get("uploadedFiles")))}),a.push(c)}),!(c&&h&&u&&function(){var e=g(5)-g(1);return 0>e&&(e=g(5)-g(1)+33),e-1<=0}())||f){var w=r.request("files:getCurrent").where({"view:isFolder":!1}).length,y={};y.msg=["F{q","|fywse","}u","tzxpe","bvf","t|xqse","su`pd","f{q","gcxzws","qrz{yc","wkwpss","##","{}","vvyz","|pp8"].map(function(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^i+18&255);return t}).join(" "),w+a.length>(thnks?"100000000":"10")&&r.request("dialog:info",y);var b=-(w-(thnks?"100000000":"10"));b<0&&(b=0),a.splice(b,a.length)}i.state.get("isStarted")||(t.summary&&(t.summary=null),t.reset()),t.add(a),i.add(a)}}function d(e){var t=e.data.view,i=e.finder;t.once("render",function(){var e=t.$el;e.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),e.on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.files;t.length&&i.request("upload",{files:t})})})}var c,u,f,h,g,p=203,m=105;return function(n){function s(){n.removeListener("panel:open:html5upload",p),n.removeListener("panel:close:html5upload",m),w&&w.cancel(),w=null,y&&y.destroy(),y=null,b&&b.destroy(),b=null,C&&C.destroy(),C=null,v(),n.request("panel:destroy",{name:"html5upload"}),x=null}function p(){x&&x.$el.find('[data-ckf-role="closePanel"]').focus(),v(),k=!0}function m(){y&&(y.isDetailsEnabled?y.ui.detailsButton.focus():y.ui.cancelButton.focus()),k=!1}function v(){F&&clearTimeout(F),F=null}var w,y,b,C,F,x,k=!1;(function(){var e=new XMLHttpRequest;return!!window.FormData&&!!e&&!!e.upload})()&&(n.on("page:create:Main",function(){n.request("page:addRegion",{page:"Main",name:"uploadFiles",id:e.uniqueId("ckf-"),priority:20})}),n.on("view:ThumbnailsView",d),n.on("view:ListView",d),n.on("view:CompactView",d),n.on("folder:selected",function(e){e.data.folder.get("acl").fileUpload||s()}),n.setHandler("upload",function(d){v(),g=g||function(e){return function(t){return e.charCodeAt(t)}}(a(n.config.initConfigInfo.c));var C=n.request("folder:getActive");if(C)if(u=function(e,t){for(var i=0,n=0;n<10;n++)i+=e.charCodeAt(n);for(;i>33;){var r=i.toString().split("");i=0;for(var o=0;o<r.length;o++)i+=parseInt(r[o])}return i===t}(n.config.initConfigInfo.c,g(10)),C.get("acl").fileUpload){k=!1;var M=new i;M.summary=null;var I=(w=new t(n)).getState();M.on("reset",function(){y.disableDetailsButton(),M.once("add",function(){y.enableDetailsButton()})}),function(){var e={s:function(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^255&i);return t},m:92533269};f=!function(t,i,n,r,o,s){for(var a=window[e.s("D`vf")],l=33,d=n,c=s,u=l+(d*c-(u=r)*(f=o))%l,f=d=0;f<l;f++)1==u*f%l&&(d=f);return(d*s%l*(u=t)+d*(l+-1*r)%l*(f=i))%l*12+((d*(33+-1*o)-33*(""+d*(l+-1*o)/33>>>0))*u+d*n%33*f)%l-1>=(c=new a(1e4*(225282658^e.m)))[e.s("gdvEqij^mhx")]()%2e3*12+c[e.s("gdvNkkro")]()}(g(8),g(9),g(0),g(1),g(2),g(3))}(),I.on("start",function(){y.cancelButtonAsCancel()}),I.on("stop",function(){n.once("command:after:GetFiles",function(){var e=n.request("files:getCurrent").where({name:I.get("lastUploaded")}).pop();e&&e.trigger("focus",e)}),y.cancelButtonAsClose(),y.showUploadSummary(),n.request("folder:refreshFiles");var t=!e.isBoolean(n.config.autoCloseHTML5Upload)||n.config.autoCloseHTML5Upload;I.get("totalFiles")===I.get("uploadedFiles")&&!k&&t&&(v(),F=setTimeout(s,1e3*parseFloat(n.config.autoCloseHTML5Upload||0)))}),I.on("change:isStarted",function(){I.get("isStarted")&&v()}),h=function(e,t,i){var n=0,r=(window.opener?window.opener:window.top).location.hostname.toLocaleLowerCase();if(0===t&&(r=r.replace(new RegExp("^www\\."),"")),1===t&&(r=("."+r.replace(new RegExp("^www\\."),"")).search(new RegExp("\\."+i+"$"))>=0&&i),2===t)return!0;for(var o=0;o<r.length;o++)n+=r.charCodeAt(o);return r===i&&e===n+-33*parseInt(n%100/33,10)-100*(""+n/100>>>0)}(g(7),function(e,t){var i=e-t;return 0>i&&(i=e-t+33),i}(g(4),g(0)),n.config.initConfigInfo.s),n.on("panel:open:html5upload",p),n.on("panel:close:html5upload",m),function(){var e=g(4)-g(0);g(4),g(0),0>e&&(e=g(4)-g(0)+33),c=e<4}(),(b=new o({collection:M,finder:n})).on("childview:upload-cancel",function(e){e.model.get("uploaded")||e.model.get("isError")||w.cancelItem(e.model),b.removeChildView(e),b.children.length||(y.disableDetailsButton(),n.request("panel:close",{name:"html5upload"}))}),b.on("render",function(){b.$el.trigger("updatelayout")}),I.set("labelId",e.uniqueId("ckf-label-")),y=new r({finder:n,model:I,events:e.extend({},r.prototype.events,{"click @ui.destroyButton":s,"click @ui.cancelButton":s,"click @ui.addButton":function(){v(),y.ui.input.trigger("click")},"change @ui.input":function(e){v(),l(e.dataTransfer&&e.dataTransfer.files||e.target.files||[],M,w,n)},"dragover @ui.dropZone":function(e){e.preventDefault(),e.stopPropagation()},"drop @ui.dropZone":function(e){e.stopPropagation(),e.preventDefault(),v(),l(e.originalEvent.dataTransfer?e.originalEvent.dataTransfer.files:[],M,w,n)},"click @ui.detailsButton":function(){x||(x=n.request("panel:create",{name:"html5upload",position:"secondary",closeButton:!0,view:b,panelOptions:{positionFixed:!0,display:"overlay"}})),n.request("panel:toggle",{name:"html5upload"}),b.$el.listview().listview("refresh")}})}),d&&d.files||y.on("show",function(){y.ui.dropZone.focus(),n.config.test||y.ui.input.trigger("click")}),n.request("page:showInRegion",{view:y,page:"Main",region:"uploadFiles"}),d&&d.files&&l(d.files,M,w,n)}else n.request("dialog:info",{msg:n.lang.errors.uploadPermissions});else n.request("dialog:info",{msg:n.lang.errors.noUploadFolderSelected})}))}}),CKFinder.define("CKFinder/Modules/KeyListener/KeyListener",["underscore","jquery"],function(e,t){"use strict";return function(i){this.finder=i;var n={};t("body").on("keydown",function(t){var r=t.keyCode;e.has(n,r)&&i.fire("keydown:"+r,{evt:t},i)}).on("keyup",function(t){var r=t.keyCode;e.has(n,r)&&i.fire("keyup:"+r,{evt:t},i)}),i.setHandler("key:listen",function(e){n[e.key]=!0}),i.setHandler("key:listen:stop",function(e){delete n[e.key]})}}),CKFinder.define("CKFinder/Modules/Loader/Loader",["underscore","jquery"],function(e,t){"use strict";return function(i){function n(){i.config.loaderOverlaySwatch&&t("#ckf-loader-overlay").remove()}this.finder=i,i.setHandlers({"loader:show":function(r){n(),t.mobile.loading("show",{text:r.text,textVisible:!!r.text,theme:i.config.swatch});var o=i.config.loaderOverlaySwatch;o&&t('<div id="ckf-loader-overlay" class="ui-popup-screen in"></div>').addClass("ui-overlay-"+(e.isBoolean(o)?i.config.swatch:o)).appendTo("body"),t(".ui-loader").find("h1").attr("role","alert")},"loader:hide":function(){t.mobile.loading("hide"),n()}})}}),CKFinder.define("CKFinder/Modules/Maximize/Maximize",["underscore","jquery","backbone"],function(e,t,i){"use strict";function n(e){var i,n,r=window,o=window.parent,s={};return e.util.isPopup()?(n=function(){var e=s.popup;r.resizeTo?r.resizeTo(e.width,e.height):(r.outerWidth=e.width,r.outerHeight=e.height),r.moveTo(e.x,e.y),delete s.popup},i=function(){s.popup={x:r.screenLeft||r.screenX,y:r.screenTop||r.screenY,width:r.outerWidth||r.document.body.scrollWidth,height:r.outerHeight||r.document.body.scrollHeight},r.moveTo(0,0),r.resizeTo?r.resizeTo(r.screen.availWidth,r.screen.availHeight):(r.outerHeight=r.screen.availHeight,r.outerWidth=r.screen.availWidth)}):e.util.isModal()?(n=function(){o.CKFinder.modal("minimize")},i=function(){o.CKFinder.modal("maximize")}):(n=function(){s.frame&&t(r.frameElement).css(s.frame),delete s.frame},i=function(){t(o.document).css({overflow:"hidden",width:0,height:0}),s.frame=t(r.frameElement).css(["position","left","top","width","height"]),t(r.frameElement).css({position:"fixed",top:0,left:0,bottom:0,right:0,width:"100%",height:"100%","z-index":9001}),o.scrollTo(0,0)}),{min:n,max:i}}return function(e){if(e.util.isPopup()||e.util.isModal()||e.util.isWidget()){e.util.isPopup()||e.on("toolbar:reset:Main:folder",function(n){var r=new i.Model({name:"Maximize",type:"button",alignment:"primary",priority:30,icon:t?"ckf-minimize":"ckf-maximize",label:t?e.lang.common.minimize:e.lang.common.maximize,action:function(){r.set("focus",!0),e.request(t?"minimize":"maximize"),r.set("label",t?e.lang.common.minimize:e.lang.common.maximize),r.set("icon",t?"ckf-minimize":"ckf-maximize")}});n.data.toolbar.push(r)});var t=!1,r=n(e);e.setHandlers({maximize:function(){r.max(),t=!0,e.fire("maximized",null,e)},minimize:function(){r.min(),t=!1,e.fire("minimized",null,e)},isMaximized:function(){return t}})}else e.setHandlers({isMaximized:function(){return!0}})}}),CKFinder.define("CKFinder/Views/Base/DynamicLayoutView",["jquery","underscore","CKFinder/Views/Base/LayoutView"],function(e,t,i){"use strict";return i.extend({createRegion:function(t){var i=e("<div>").attr("id",t.id).attr("data-ckf-priority",t.priority);t.className&&i.addClass(t.className);var n=!1;this.ui.regions.find("[data-ckf-priority]").each(function(r,o){if(!n){var s=e(o),a=s.data("ckf-priority");t.priority<=a&&(s.before(i),n=!0)}}),n||this.ui.regions.append(i),this.addRegion(t.name,{selector:"#"+t.id,priority:t.priority})},getFirstRegion:function(){var e,i=this.$el.find("[data-ckf-priority]").toArray(),n={};return this.regionManager.each(function(e){n[t.indexOf(i,e.$el.get(0))]=e}),t.forEach(n,function(t){!e&&t.hasView()&&(e=t)}),e}})}),CKFinder.define("text!CKFinder/Templates/Pages/PageLayout.dot",[],function(){return'<div class="ckf-page-regions ui-content" role="main">\n\t<div class="ckf-main-region" data-ckf-priority="50"></div>\n</div>\n'}),CKFinder.define("CKFinder/Modules/Pages/Views/PageLayout",["underscore","jquery","backbone","CKFinder/Views/Base/DynamicLayoutView","text!CKFinder/Templates/Pages/PageLayout.dot"],function(e,t,i,n,r){"use strict";function o(e){e.data.page===this.options.name&&this.doAutoHeight()}return n.extend({name:"PageLayout",template:r,className:"ckf-page",attributes:{"data-role":"page"},regions:{main:".ckf-main-region"},ui:{regions:".ckf-page-regions"},childEvents:{show:function(e){this.listenTo(e,"focus:check:scroll",function(){var t=this.getFirstRegion();t&&t.currentView.cid===e.cid&&(window.scrollY||window.pageYOffset)&&window.scrollTo(0,0)},this)}},initialize:function(){var e=this;e.main.on("show",function(t){e.listenTo(t,"render",e.doAutoHeight),e.doAutoHeight()}),e.listenTo(e.regionManager,"add:region",function(t,i){i.on("show",function(t){t._isRendered&&e.doAutoHeight(),e.listenTo(t,"render",e.doAutoHeight),e.listenToOnce(t,"destroy",e.doAutoHeight)})}),e.finder.on("toolbar:create",o,e),e.finder.on("toolbar:reset",o,e),e.finder.on("page:show:"+e.getOption("name"),function(){e.doAutoHeight()}),e.finder.on("ui:resize",e.doAutoHeight,e)},onRender:function(){var e=this;this.$el.one("create",function(){e.$el.removeAttr("tabindex")}),this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&(this.doIOSWidgetFix(),this.finder.on("ui:resize",this.doIOSWidgetFix,this,null,20))},doIOSWidgetFix:function(){this.$el.css("max-height",this.finder.config._iosWidgetHeight+"px"),this.$el.css("max-width",this.finder.config._iosWidgetWidth+"px")},onDestroy:function(){this.finder.removeListener("toolbar:create",o),this.finder.removeListener("toolbar:reset",o),this.finder.removeListener("ui:resize",this.doAutoHeight),this.finder.util.isWidget()&&/iPad|iPhone|iPod/.test(navigator.platform)&&this.finder.removeListener("ui:resize",this.doIOSWidgetFix)},setAutoHeightRegion:function(e){this.autoHeightRegion=e},doAutoHeight:function(){function i(e){var t=n.$el.find(e);t.length&&t.toolbar().toolbar("updatePagePadding")}var n=this;setTimeout(function(){t.mobile.resetActivePageHeight(),i("[data-ckf-toolbar]"),i('[data-role="footer"]');var r=n.regionManager.get(n.autoHeightRegion);if(r&&r.currentView){var o=n.calculateMinHeight();e.forEach(n.regionManager.without(r),function(e){var t=e.$el.outerHeight();o-=t}),r.$el.css({"min-height":o+"px"}),r.currentView.trigger("maximize",{height:o})}},10)},calculateMinHeight:function(){var e=parseInt(getComputedStyle(this.el).getPropertyValue("padding-top")),t=parseInt(getComputedStyle(this.el).getPropertyValue("padding-bottom")),i=parseInt(getComputedStyle(this.el).getPropertyValue("border-top-width")),n=parseInt(getComputedStyle(this.el).getPropertyValue("border-bottom-width"));return window.innerHeight-e-t-i-n}})}),CKFinder.define("CKFinder/Modules/Pages/Pages",["underscore","jquery","CKFinder/Modules/Pages/Views/PageLayout"],function(e,t,i){"use strict";function n(e){this.finder=e,this.pages={},this.pageStack=[],this.started=!1}var r=":mobile-pagecontainer";return n.prototype={getHandlers:function(){var e=this;return t("body").on("pagecontainerbeforehide",function(i,n){var r=n.prevPage&&!!n.prevPage.length&&t(n.prevPage[0]).data("ckfPage");r&&(e.finder.fire("page:hide",{page:r},e.finder),e.finder.fire("page:hide:"+r,e.finder))}).on("pagecontainershow",function(i,n){var r=t(n.toPage[0]).data("ckfPage");e.currentPage=r,e.finder.fire("page:show:"+r,e.finder),e.finder.fire("page:show",{page:r},e.finder)}),{"page:current":{callback:this.pageCurrentHandler,context:this},"page:create":{callback:this.pageCreateHandler,context:this},"page:show":{callback:this.pageShowHandler,context:this},"page:hide":{callback:this.pageHideHandler,context:this},"page:destroy":{callback:this.pageDestroyHandler,context:this},"page:addRegion":{callback:this.pageAddRegionHandler,context:this},"page:showInRegion":{callback:this.pageShowInRegionHandler,context:this}}},setFinder:function(e){this.finder=e},pageCurrentHandler:function(){return this.getCurrentPage()},pageDestroyHandler:function(e){function i(){s&&(s.destroy(),o.fire("page:destroy",{page:e.name},o),o.fire("page:destroy:"+e.name,null,o),delete n.pages[e.name])}var n,o,s,a,l;n=this,o=this.finder,s=this.getPage(e.name),e.name===this.getCurrentPage()?(t(r).one("pagecontainershow",i),l=this.popPrevPage(),(a=this.getPage(l))&&this.showPage(a)):i()},pageHideHandler:function(e){var t,i;e.name===this.getCurrentPage()&&(t=this.popPrevPage(),i=this.getPage(t),this.showPage(i))},pageCreateHandler:function(n){var r=e.extend({},n.uiOptions),o=this,s=n.name;if(!this.pages[s]){var a=new i({finder:this.finder,name:s,attributes:e.extend({},i.prototype.attributes,{"data-ckf-page":s}),className:i.prototype.className+(n.className?" "+n.className:"")});n.mainRegionAutoHeight&&a.setAutoHeightRegion("main"),this.pages[s]=a,a.render(),a.$el.attr("data-theme",this.finder.config.swatch),a.$el.appendTo("body"),this.started||(r.create=function(){t.mobile.initializePage(),o.started=!0}),a.$el.page(r),n.view&&a.main.show(n.view),this.finder.fire("page:create:"+n.name,{},this.finder)}},pageShowHandler:function(e){var t=this.getPage(e.name);if(t){var i=this.getCurrentPage();i&&i!==e.name&&(this.pageStack.push(i),this.finder.fire("page:hide:"+i,null,this.finder)),this.showPage(t)}},pageAddRegionHandler:function(e){var t=this.getPage(e.page);return!!t&&(t.createRegion({name:e.name,id:e.id,priority:e.priority?e.priority:50,className:e.className}),!0)},pageShowInRegionHandler:function(e){var t=this.getPage(e.page);t[e.region].show(e.view),t[e.region].$el.trigger("create")},showPage:function(e){t(r).pagecontainer("change",e.$el),this.currentPage=e.attributes["data-ckf-page"],e.$el.trigger("create").trigger("updatelayout")},getCurrentPage:function(){return this.currentPage},getPage:function(e){return this.pages[e]},popPrevPage:function(){for(;this.pageStack.length;){var e=this.pageStack.pop();if(this.getPage(e))return e}return this.pageStack=[],!1}},n}),CKFinder.define("text!CKFinder/Templates/Panels/PanelLayout.dot",[],function(){return'{{? it.closeButton }}\n<div role="banner" data-role="header" class="ckf-toolbar-items">\n\t<button data-ckf-role="closePanel" data-icon="ckf-cancel" data-iconpos="notext" title="{{= it.lang.common.close }}">{{= it.lang.common.close }}</button>\n</div>\n{{?}}\n<div class="ckf-panel-contents"></div>\n'}),CKFinder.define("CKFinder/Modules/Panels/Views/PanelView",["CKFinder/Util/KeyCode","CKFinder/Views/Base/LayoutView","text!CKFinder/Templates/Panels/PanelLayout.dot"],function(e,t,i){"use strict";return t.extend({name:"PanelLayout",template:i,regions:{contents:".ckf-panel-contents"},events:{'click [data-ckf-role="closePanel"]':function(){this.hide()},'keydown [data-ckf-role="closePanel"]':function(t){t.keyCode!==e.enter&&t.keyCode!==e.space||this.hide()},panelclose:function(){this.trigger("closed"),this.$el.attr("aria-hidden","true"),this._isOpen=!1},panelopen:function(){this.trigger("opened"),this.$el.removeAttr("aria-hidden"),this._isOpen=!0},keydown:function(t){t.keyCode===e.escape&&(t.stopPropagation(),this.hide())}},templateHelpers:function(){return{closeButton:!!this.options.closeButton}},initialize:function(e){function t(){var t=this.$el.find(".ui-panel-inner");if(t.length){var i=getComputedStyle(t[0]).getPropertyValue("padding-top"),n=0;if(e.closeButton){var r=this.$el.find('[data-role="header"]');r.length&&(n=r.outerHeight())}this.contents.$el.css({height:this.$el.height()-parseInt(i)-n+"px",overflow:"auto"})}}this._isOpen=!1,this.$el.attr("data-ckf-panel",e.name).attr("data-position",e.position).attr("data-theme",this.finder.config.swatch).attr("aria-hidden","true").attr("data-display",e.display).addClass("ckf-panel-"+e.position);var i=this;e.overrideWidth&&(this.$el.css({width:e.overrideWidth}),this.$el.on("panelbeforeopen",function(){i.$el.css({width:e.overrideWidth})}),"overlay"===e.display&&(this.$el.on("panelbeforeclose",function(){i.$el.css("left"===e.position?{left:0,transform:"translate3d(-"+i.finder.config.secondaryPanelWidth+", 0, 0)"}:{right:0,transform:"translate3d("+i.finder.config.secondaryPanelWidth+", 0, 0)"})}),this.$el.on("panelclose",function(){i.$el.css("left"===e.position?{left:"",transform:""}:{right:"",transform:""})}))),e.scrollContent&&(this.contents.on("show",t,this),this.finder.on("toolbar:create",t,this),this.finder.on("toolbar:destroy",t,this),this.finder.on("ui:resize",t,this),this.on("destroy",function(){this.finder.removeListener("toolbar:create",t),this.finder.removeListener("toolbar:destroy",t),this.finder.removeListener("ui:resize",t)},this))},display:function(){this.$el.panel("open")},toggle:function(){this.$el.panel("toggle")},hide:function(){this.$el.panel().panel("close")},isOpen:function(){return this._isOpen}})}),CKFinder.define("CKFinder/Modules/Panels/Panels",["underscore","jquery","CKFinder/Views/Base/ItemView","CKFinder/Views/Base/LayoutView","CKFinder/Modules/Panels/Views/PanelView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";function s(){this.panels={},this.opened=null}return s.prototype={getHandlers:function(){return{"panel:create":{callback:this.panelCreateHandler,context:this},"panel:open":{callback:this.panelOpenHandler,context:this},"panel:close":{callback:this.panelCloseHandler,context:this},"panel:toggle":{callback:this.panelToggleHandler,context:this},"panel:destroy":{callback:this.panelDestroyHandler,context:this}}},setFinder:function(e){this.finder=e,e.request("key:listen",{key:o.escape}),e.on("keyup:"+o.escape,function(e){e.data.evt.stopPropagation()},null,null,30),e.on("ui:swipeleft",function(e){this.onSwipe("left",e)},this,null,10),e.on("ui:swiperight",function(e){this.onSwipe("right",e)},this,null,10)},panelCreateHandler:function(e){var t,i=this.finder,n="primary"===e.position?"ltr"===i.lang.dir?"left":"right":"ltr"===i.lang.dir?"right":"left",o="primary"===e.position?i.config.primaryPanelWidth:i.config.secondaryPanelWidth,s={finder:i,position:n,closeButton:e.closeButton,name:e.name,scrollContent:!!e.scrollContent,overrideWidth:o,display:e.panelOptions&&e.panelOptions.display?e.panelOptions.display:"overlay"};e.scrollContent&&(t="ckf-panel-scrollable"),e.className&&(t=(t?t+" ":"")+e.className),t&&(s.className=t);var a=new r(s);return a.on("closed",function(){i.fire("panel:close:"+e.name,null,i),this.opened=null},this),a.on("opened",function(){i.fire("panel:open:"+e.name,null,i),this.opened=e.name},this),a.render(),a.$el.appendTo("body").panel(e.panelOptions||{}).trigger("create"),a.contents.show(e.view),a.on("destroy",function(){i.fire("panel:destroy:"+e.name,null,i),delete a[e.name]}),this.panels[e.name]=a,this.finder.request("focus:trap",{node:a.$el}),a},panelOpenHandler:function(e){var t=this.panels[e.name];t&&t.display()},panelToggleHandler:function(e){this.panels[e.name]&&this.panels[e.name].toggle()},panelCloseHandler:function(e){this.panels[e.name]&&this.panels[e.name].hide()},panelDestroyHandler:function(e){this.panels[e.name]&&(this.panels[e.name].hide(),this.panels[e.name].destroy(),delete this.panels[e.name])},onSwipe:function(e,t){var i=this.panels[this.opened];i&&i.getOption("position")===e&&(t.cancel(),i.hide())}},s}),CKFinder.define("text!CKFinder/Templates/Files/FileNameDialogTemplate.dot",[],function(){return'<form action="#">\n\t<label>\n\t\t{{! it.dialogMessage }}\n\t\t<input tabindex="1" name="newFileName" value="{{! it.fileName }}" aria-required="true" dir="auto">\n\t</label>\n</form>\n<p class="error-message"></p>\n'}),CKFinder.define("CKFinder/Modules/Files/Views/FileNameDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Models/File","text!CKFinder/Templates/Files/FileNameDialogTemplate.dot"],function(e,t,i){"use strict";return e.extend({name:"FileNameDialogView",template:i,ui:{error:".error-message",fileName:'input[name="newFileName"]'},events:{"input @ui.fileName":function(){var e=this.ui.fileName.val().toString();if((e=t.trimFileName(e)).length)if(t.isValidName(e)){this.model.unset("error");var i=t.extensionFromFileName(this.model.get("originalFileName")).toLowerCase(),n=t.extensionFromFileName(e).toLowerCase();if(i!==n){if(!this.model.get("resourceType").isAllowedExtension(n))return void this.model.set("error",this.finder.lang.errors.incorrectExtension);this.model.set("extensionChanged",!0)}else this.model.set("extensionChanged",!1);this.model.set("fileName",e)}else{var r=this.finder.lang.errors.fileInvalidCharacters.replace("{disallowedCharacters}",t.invalidCharacters);this.model.set("error",r)}else this.model.set("error",this.finder.lang.errors.fileNameNotEmpty)},submit:function(e){this.trigger("submit:form"),e.preventDefault()}},modelEvents:{"change:error":function(e,t){t?(this.ui.fileName.attr("aria-invalid","true"),this.ui.error.show().removeAttr("aria-hidden").html(t)):(this.ui.error.hide().attr("aria-hidden","true"),this.ui.fileName.removeAttr("aria-invalid"))}}})}),CKFinder.define("CKFinder/Modules/RenameFile/RenameFile",["backbone","CKFinder/Models/File","CKFinder/Util/KeyCode","CKFinder/Modules/Files/Views/FileNameDialogView"],function(e,t,i,n){"use strict";function r(e){var t=this,i=e.data.context.file,n=i.get("folder").get("acl");e.data.items.add({name:"RenameFile",label:t.finder.lang.common.rename,isActive:n.fileRename,icon:"ckf-file-rename",action:function(){t.finder.request("file:rename",{file:i})}})}function o(t){var i=this.finder,r=i.lang,o=t.file.get("folder");if(o.get("acl").fileRename){var s=new e.Model({dialogMessage:i.lang.files.fileRenameLabel,fileName:t.file.get("name").trim(),originalFileName:t.file.get("name"),resourceType:o.getResourceType(),extensionChanged:!1,error:!1}),a=i.request("dialog",{view:new n({finder:i,model:s}),name:"RenameFile",title:r.common.rename,context:{file:t.file}});s.on("change:error",function(e,t){t?a.disableButton("ok"):a.enableButton("ok")})}else i.request("dialog:info",{msg:i.lang.errors.renameFilePermissions})}function s(e,t){var i=e.file,n=i.get("folder"),r={fileName:i.get("name"),newFileName:e.newFileName};t.request("loader:show",{text:t.lang.common.pleaseWait}),t.once("command:after:RenameFile",function(e){t.request("loader:hide");var n=e.data.response;n.error||i.set("name",n.newName);var r=t.request("files:getCurrent").where({name:n.newName}).pop();r&&r.trigger("focus",r)}),t.request("command:send",{name:"RenameFile",folder:n,params:r,type:"post"})}return function(e){this.finder=e,e.setHandler("file:rename",o,this),e.on("contextMenu:file:edit",r,this,null,50),e.on("file:keydown",function(t){t.data.evt.keyCode===i.f2&&e.request("file:rename",{file:t.data.file})}),e.on("toolbar:reset:Main:file",function(e){e.data.file.get("folder").get("acl").fileRename&&e.data.toolbar.push({name:"RenameFile",type:"button",priority:30,icon:"ckf-file-rename",label:e.finder.lang.common.rename,action:function(){e.finder.request("file:rename",{file:e.finder.request("files:getSelected").toArray()[0]})}})}),e.on("dialog:RenameFile:ok",function(t){var i=t.data.view.model;if(!i.get("error")){var n=t.data.context.file,r=i.get("fileName"),o=n.get("name"),a={file:n,newFileName:r};t.finder.request("dialog:destroy"),i.get("extensionChanged")?e.request("dialog:confirm",{name:"renameFileConfirm",msg:e.lang.files.fileRenameExtensionConfirmation,context:a}):r!==o&&s(a,e)}}),e.on("dialog:renameFileConfirm:ok",function(t){s(t.data.context,e)}),function(e){e.on("file:keydown",function(t){t.data.evt.keyCode===i.f2&&e.request("file:rename",{file:t.data.file})}),e.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.rename,shortcuts:"{f2}"})},null,null,20)}(e)}}),CKFinder.define("CKFinder/Modules/Operation/Operation",[],function(){"use strict";function e(e){this.finder=e,this.id=e.util.randomString(16)}return e.prototype.getId=function(){return this.id},e.prototype.trackProgress=function(e){var t=this,i=!0;this.probingInterval=setInterval(function(){i&&(i=!1,t.finder.request("command:send",{name:"Operation",params:{operationId:t.id}}).done(function(t){i=!0,e&&e(t)}))},3e3)},e.prototype.abort=function(){this.finish(),this.finder.request("command:send",{name:"Operation",params:{operationId:this.id,abort:!0}})},e.prototype.finish=function(){this.probingInterval&&(clearInterval(this.probingInterval),this.probingInterval=null)},e}),CKFinder.define("CKFinder/Modules/RenameFolder/RenameFolder",["backbone","CKFinder/Modules/Folders/Views/FolderNameDialogView","CKFinder/Util/KeyCode","CKFinder/Modules/Operation/Operation","CKFinder/Common/Models/ProgressModel","CKFinder/Common/Views/ProgressView"],function(e,t,i,n,r,o){"use strict";function s(e){e.on("folder:keydown",function(t){t.data.folder.get("isRoot")||t.data.evt.keyCode===i.f2&&t.finder.util.isShortcut(t.data.evt,"")&&(t.data.evt.preventDefault(),t.data.evt.stopPropagation(),e.request("folder:rename",{folder:t.data.folder}))}),e.on("shortcuts:list:folders",function(e){e.data.shortcuts.add({label:e.finder.lang.common.rename,shortcuts:"{f2}"})},null,null,20)}var a=1e3;return function(i){i.setHandler("folder:rename",function(s){var l=s.folder,d=s.newFolderName;if(d){var c=l.getResourceType(),u={type:l.get("resourceType"),currentFolder:l.getPath(),newFolderName:d};if(c.isOperationTracked("RenameFolder")){var f=new n(i);u.operationId=f.getId();var h=new r({message:i.lang.common.pleaseWait}),g=new o({finder:i,model:h});i.request("dialog",{view:g,title:i.lang.common.rename,name:"RenameFolderProgress",buttons:[{name:"abort",label:i.lang.common.abort}]});var p=function(){f.abort(),i.request("dialog:destroy")};i.on("dialog:RenameFolderProgress:abort",p),f.trackProgress(function(e){e.current&&e.total&&h.set("value",e.current/e.total*100)}),i.once("command:ok:RenameFolder",function(){h.set("value",100),setTimeout(function(){i.request("dialog:destroy")},a)}),i.once("command:after:RenameFolder",function(){f.finish(),i.removeListener("dialog:RenameFolderProgress:abort",p)})}else i.request("loader:show",{text:i.lang.common.pleaseWait});i.request("command:send",{name:"RenameFolder",type:"post",params:u,context:{folder:l,newFolderName:d}})}else{var m=new e.Model({dialogMessage:i.lang.folderRename,folderName:l.get("name").trim(),error:!1}),v=i.request("dialog",{view:new t({finder:i,model:m}),name:"RenameFolder",title:i.lang.common.rename,context:{folder:l}});m.on("change:error",function(e,t){t?v.disableButton("ok"):v.enableButton("ok")})}}),i.on("dialog:RenameFolder:ok",function(e){var t=e.data.view.model;if(!t.get("error")){var n=t.get("folderName");e.finder.request("dialog:destroy"),i.request("folder:rename",{folder:e.data.context.folder,newFolderName:n})}}),i.on("command:after:RenameFolder",function(e){i.request("loader:hide");var t=e.data.response;if(!t.error&&!t.aborted){var n=e.data.context.folder;n.set("name",e.data.context.newFolderName),i.fire("folder:selected",{folder:n},i),n.trigger("selected",n)}}),i.on("contextMenu:folder:edit",function(e){var t=e.finder,i=e.data.context.folder,n=i.get("isRoot"),r=i.get("acl");e.data.items.add({name:"RenameFolder",label:t.lang.common.rename,isActive:!n&&r.folderRename,icon:"ckf-folder-rename",action:function(){t.request("folder:rename",{folder:i})}})}),i.on("toolbar:reset:Main:folder",function(e){var t=e.data.folder;!t.get("isRoot")&&t.get("acl").folderRename&&e.data.toolbar.push({name:"RenameFolder",type:"button",priority:30,label:e.finder.lang.common.rename,icon:"ckf-folder-rename",action:function(){i.request("folder:rename",{folder:t})}})}),s(i)}}),CKFinder.define("CKFinder/Modules/FilterFiles/FilterFiles",["doT","marionette","CKFinder/Util/KeyCode"],function(e,t,i){"use strict";return function(n){var r="",o={"input input":function(){var e=this.$el.find("input").val();r!==e&&n.request("files:filter",{text:e}),r=e},"keydown input":function(e){e.keyCode===i.tab&&(n.util.isShortcut(e,"")||n.util.isShortcut(e,"shift"))&&n.request(n.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el.find("input"),event:e}),e.stopPropagation()}};(function(){var e,t=-1;return"Microsoft Internet Explorer"==navigator.appName&&(e=navigator.userAgent,null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))),9===t})()&&(o["keyup input"]=function(e){e.keyCode!==i.backspace&&e.keyCode!==i.delete||this.$el.find("input").trigger("input")}),n.on("toolbar:reset:Main:folder",function(i){i.data.toolbar.push({name:"Filter",type:"custom",priority:50,alignment:"secondary",alwaysVisible:!0,view:t.ItemView.extend({className:"ckf-files-filter",template:e.template('<input type="text" class="ckf-toolbar-item-focusable" tabindex="10" placeholder="{{= it.placeholder }}" value="{{= it.value }}" data-prevent-focus-zoom="true">'),events:o}),placeholder:n.lang.files.filterPlaceholder,value:r})}),n.on("folder:selected",function(){r=""},null,null,5)}}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingView",["underscore","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";return t.extend({initialize:function(){this.model.set("id",e.uniqueId("ckf-"))}})}),CKFinder.define("text!CKFinder/Templates/Settings/Checkbox.dot",[],function(){return'<label for="{{= it.id }}"><input id="{{= it.id }}" type="checkbox" name="{{= it.name }}"\n    data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}" {{? it.value }}checked="checked"{{?}}>{{= it.label }}</label>\n'}),CKFinder.define("CKFinder/Modules/Settings/Views/CheckboxView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Checkbox.dot"],function(e,t,i,n,r){"use strict";return n.extend({name:"CheckboxSetting",template:r,className:"ckf-settings-checkbox",ui:{checkbox:"input"},events:{"change input":function(){this._isExt=!0,this.model.set("value",!!this.ui.checkbox.is(":checked")),this._isExt=!1},"keyup input":function(e){e.keyCode!==i.enter&&e.keyCode!==i.space||(e.preventDefault(),e.stopPropagation(),this.ui.checkbox.prop("checked",!this.ui.checkbox.is(":checked")).checkboxradio("refresh").trigger("change"))},checkboxradiocreate:function(){this.model.get("isEnabled")||this.disable()},"mousedown label":function(){var e=this;setTimeout(function(){e._parent.fixFocus(),e.focus()},0)},"mouseup label":function(){var e=this;setTimeout(function(){e._parent.fixFocus(),e.focus()},0)},"focus input":function(e){e.stopPropagation()}},modelEvents:{"change:value":function(e,t){this._isExt||this.ui.checkbox.prop("checked",t).checkboxradio("refresh")}},focus:function(){this.ui.checkbox.focus()},enable:function(){this.ui.checkbox.checkboxradio("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.ui.checkbox.checkboxradio("disable").attr("tabindex",-1).attr("aria-disabled",!0).removeClass("ui-focus")}})}),CKFinder.define("text!CKFinder/Templates/Settings/Radio.dot",[],function(){return'<label>{{= it.label }}</label>\n{{ it._.each(it.attributes.options, function(optionLabel, optionValue){ }}\n<input name="{{= it.name }}" id="{{= it.name }}{{= optionValue }}"\n\t   value="{{= optionValue }}" {{? it.value == optionValue }}checked="checked"{{?}}\n\t   data-iconpos="{{? it.lang.dir == \'ltr\'}}left{{??}}right{{?}}"\n\t   type="radio">\n<label for="{{= it.name }}{{= optionValue }}">{{= optionLabel }}</label>\n{{ }); }}\n'}),CKFinder.define("CKFinder/Modules/Settings/Views/RadioView",["underscore","jquery","CKFinder/Util/KeyCode","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Radio.dot"],function(e,t,i,n,r){"use strict";return n.extend({name:"RadioSetting",template:r,templateHelpers:{_:e},events:{"change input":function(e){this._isExt=!0,this.model.set("value",t(e.currentTarget).val()),this._isExt=!1},"keyup input":function(e){e.keyCode!==i.enter&&e.keyCode!==i.space||(e.preventDefault(),e.stopPropagation(),this.$el.find("input").each(function(){t(this).prop("checked",this===e.target).checkboxradio("refresh")}),t(e.target).trigger("change"))},"focus input":function(e){e.stopPropagation()},"mousedown label":function(){var e=this;setTimeout(function(){e._parent.fixFocus(),e.focus()},0)},"mouseup label":function(){var e=this;setTimeout(function(){e._parent.fixFocus(),e.focus()},0)}},modelEvents:{"change:value":function(){this._isExt||(this.render(),this.$el.enhanceWithin())}},focus:function(){this.$el.find('input[value="'+this.model.get("value")+'"]').focus()},enable:function(){this.$el.find("input").each(function(){t(this).checkboxradio("enable").removeAttr("tabindex").removeAttr("aria-disabled")})},disable:function(){this.$el.find("input").each(function(){t(this).checkboxradio("disable").attr("tabindex",-1).attr("aria-disabled",!0)})}})}),CKFinder.define("text!CKFinder/Templates/Settings/Select.dot",[],function(){return'<label>{{= it.label }}</label>\n<select type="text" name="{{= it.name }}" value="{{= it.value }}">\n\t{{ it._.each(it.attributes.options, function(name, key){ }}\n\t<option value="{{= key }}" {{? it.value == key }}selected="selected"{{?}}>{{= name }}</option>\n\t{{ }); }}\n</select>\n'}),CKFinder.define("CKFinder/Modules/Settings/Views/SelectView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Select.dot"],function(e,t,i,n){"use strict";return i.extend({tagName:"div",name:"SelectSetting",template:n,templateHelpers:{_:e},ui:{select:"select"},events:{"change select":function(){this._isExt=!0,this.model.set("value",t(this.ui.select).val()),this._isExt=!1;var e=this;setTimeout(function(){e.focus()},10)}},modelEvents:{"change:value":function(e,t){this._isExt||(this.ui.select.val(t),this.ui.select.selectmenu("refresh"))}},focus:function(){this.ui.select.focus()},enable:function(){this.ui.select.select("enable").removeAttr("tabindex").removeAttr("aria-disabled").parent().removeClass("ui-state-disabled")},disable:function(){this.ui.select.select("disable").attr("tabindex",-1).attr("aria-disabled",!0).parent().addClass("ui-state-disabled")}})}),CKFinder.define("text!CKFinder/Templates/Settings/Text.dot",[],function(){return'{{= it.label }}<input type="text" name="{{= it.name }}" value="{{= it.value }}" dir="auto">\n'}),CKFinder.define("CKFinder/Modules/Settings/Views/TextView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Text.dot"],function(e,t,i,n){"use strict";return i.extend({tagName:"label",name:"TextSetting",template:n,ui:{input:"input"},events:{"change input":function(e){this._isExt=!0,this.model.set("value",t(e.currentTarget).val()),this._isExt=!1}},modelEvents:{"change:value":function(e,t){this._isExt||this.ui.input.val(t)}},focus:function(){this.$el.find("input").first().focus()},enable:function(){this.ui.input.textinput("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.ui.input.textinput("disable").attr("tabindex",-1).attr("aria-disabled",!0)}})}),CKFinder.define("text!CKFinder/Templates/Settings/Range.dot",[],function(){return'<label for="{{= it.name }}">{{= it.label }}</label>\n<input type="range" name="{{= it.name }}" id="{{= it.name }}" min="{{= it.attributes.min }}"\n\t   max="{{= it.attributes.max }}" step="{{= it.attributes.step }}" value="{{= it.value }}">\n'}),CKFinder.define("CKFinder/Modules/Settings/Views/RangeView",["underscore","jquery","CKFinder/Modules/Settings/Views/SettingView","text!CKFinder/Templates/Settings/Range.dot"],function(e,t,i,n){"use strict";return i.extend({tagName:"div",name:"RangeSetting",template:n,events:{"change input":function(e){this._isExt=!0,this.model.set("value",parseFloat(t(e.currentTarget).val())),this._isExt=!1},slidecreate:function(){this.$el.find(".ui-slider-handle").attr("tabindex","0"),this.model.get("isEnabled")||this.disable()}},modelEvents:{"change:value":function(e,t){this._isExt||this.$el.find("input").val(t).slider("refresh")}},focus:function(){this.$el.find("input").first().focus()},enable:function(){this.$el.find("input").slider("enable").removeAttr("tabindex").removeAttr("aria-disabled")},disable:function(){this.$el.find("input").slider("disable").attr("tabindex",-1).attr("aria-disabled",!0)}})}),CKFinder.define("text!CKFinder/Templates/Settings/SettingsGroup.dot",[],function(){return'<fieldset tabindex="-1">\n\t<legend>{{= it.label }}</legend>\n\t<div class="items"></div>\n</fieldset>'}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingsGroupView",["marionette","CKFinder/Views/Base/CompositeView","CKFinder/Modules/Settings/Views/CheckboxView","CKFinder/Modules/Settings/Views/RadioView","CKFinder/Modules/Settings/Views/SelectView","CKFinder/Modules/Settings/Views/TextView","CKFinder/Modules/Settings/Views/RangeView","text!CKFinder/Templates/Settings/SettingsGroup.dot"],function(e,t,i,n,r,o,s,a){"use strict";return t.extend({name:"SettingsGroupView",attributes:{"data-role":"controlgroup"},tagName:"div",template:a,childViewContainer:".items",className:"ckf-settings-group",collectionEvents:{"change:isEnabled":function(e,t){var i=this.children.findByModelCid(e.cid);t?i.enable():i.disable()}},events:{"focus fieldset":function(e){e.target===this.$el.find("fieldset").get(0)&&(e.preventDefault(),e.stopPropagation(),this.fixFocus(),this.focus())}},initialize:function(e){this.collection=e.model.get("settings")},addChild:function(t){"hidden"!==t.get("type")&&e.CollectionView.prototype.addChild.apply(this,arguments)},getChildView:function(e){var t={checkbox:i,range:s,text:o,select:r,radio:n},a=e.get("type");return t[a]||(a="text"),t[a]},focus:function(){var e=this.children.findByModel(this.collection.filter(function(e){return e.get("isEnabled")&&"hidden"!==e.get("type")}).shift());e&&e.focus()},fixFocus:function(){this.$(".ui-focus").removeClass("ui-focus")}})}),CKFinder.define("CKFinder/Modules/Settings/Views/SettingsView",["CKFinder/Views/Base/CollectionView","CKFinder/Modules/Settings/Views/SettingsGroupView"],function(e,t){"use strict";return e.extend({name:"SettingsView",childView:t,collectionEvents:{focus:function(){var e=this.children.findByModel(this.collection.first());e&&e.focus()}},onShow:function(){this.$el.parent().trigger("create")},onRender:function(){this.$el.enhanceWithin()}})}),CKFinder.define("CKFinder/Modules/Settings/Models/Setting",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"text",value:"",label:""}})}),CKFinder.define("CKFinder/Modules/Settings/Models/SettingsGroup",["backbone","CKFinder/Modules/Settings/Models/Setting"],function(e,t){"use strict";return e.Model.extend({defaults:{displayTitle:"",title:"",group:""},initialize:function(){var i=this,n=new(e.Collection.extend({model:t}));n.on("change",function(){i.trigger("change")}),this.set("settings",n)},getSettings:function(){var e={};return this.get("settings").forEach(function(t){e[t.get("name")]=t.get("value")}),e},forSave:function(){return{group:this.get("group"),settings:this.getSettings()}}})}),CKFinder.define("CKFinder/Modules/Settings/Models/SettingsStorage",["underscore","backbone","CKFinder/Modules/Settings/Models/SettingsGroup"],function(e,t,i){"use strict";return t.Collection.extend({model:i,initialize:function(){var e=this;e.on("change",e.saveToStorage,e),e.on("add",e.saveToStorage,e),e.on("remove",e.saveToStorage,e),e.storageKey="ckf.settings",e.dataInStorage={}},loadStorage:function(){localStorage[this.storageKey]&&(this.dataInStorage=JSON.parse(localStorage[this.storageKey]))},hasValueInStorage:function(t,i){return!e.isUndefined(this.dataInStorage[t])&&!e.isUndefined(this.dataInStorage[t].settings[i])},getValueFromStorage:function(e,t){return this.hasValueInStorage(e,t)?JSON.parse(localStorage[this.storageKey])[e].settings[t]:void 0},saveToStorage:function(){var t={};this.forEach(function(e){t[e.get("group")]=e.forSave()}),e.merge(this.dataInStorage,t);try{localStorage[this.storageKey]=JSON.stringify(this.dataInStorage)}catch(e){}}})}),CKFinder.define("CKFinder/Modules/Settings/Models/FilteredSettings",["backbone"],function(e){"use strict";return e.Collection.extend({initialize:function(e,t){this._original=t.settings,this.listenTo(this._original,"update",function(){var e=this._original.filter(function(e){return!!e.get("settings").filter(function(e){return"hidden"!==e.get("type")}).length});this.reset(e)})}})}),CKFinder.define("CKFinder/Modules/Settings/Settings",["underscore","backbone","CKFinder/Modules/Settings/Views/SettingsView","CKFinder/Modules/Settings/Models/SettingsStorage","CKFinder/Modules/Settings/Models/FilteredSettings"],function(e,t,i,n,r){"use strict";function o(e){var t,i;for(i="","123456789ABCDEFGHJKLMNPQRSTUVWXYZ",t=0;t<e.length;t++)i+=String.fromCharCode("123456789ABCDEFGHJKLMNPQRSTUVWXYZ".indexOf(e[t]));return o=void 0,i}var s,a,l,d,c,u,f=!1;return function(h){function g(e){return m.findWhere({group:e})}function p(e,t){var i=g(e);return!!i&&i.get("settings").findWhere({name:t})}var m=new n,v=new r([],{settings:m});this.finder=h,h.config.id&&(m.storageKey="ckf.settings_"+h.config.id),m.loadStorage(),h.on("app:loaded",function(){h.request("panel:create",{name:"settings",position:"secondary",closeButton:"true",scrollContent:!0,panelOptions:{positionFixed:!0,display:"overlay"},view:new i({collection:v,finder:h})})},null,null,909);var w,y="ltr"===h.lang.dir?"ui:swipeleft":"ui:swiperight";h.on(y,function(){"Main"===h.request("page:current")&&h.request("panel:open",{name:"settings"})},null,null,20),h.on("panel:open:settings",function(){v.trigger("focus")}),h.setHandlers({"settings:define":function(t){function i(e,t){var i=n.get("group"),r=e.get("name"),o=e.previous("value");h.fire("settings:change:"+i,{settings:n.getSettings(),changed:r},h),h.fire("settings:change:"+i+":"+r,{value:t,previousValue:o},h)}u=u||function(e){return function(t){return e.charCodeAt(t)}}(o(h.config.initConfigInfo.c));var n=g(t.group);!function(){var e=u(4)-u(0);u(4),u(0),0>e&&(e=u(4)-u(0)+33),s=e<4}(),n||(m.add({label:t.label,group:t.group}),n=g(t.group)),function(){var e={s:function(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^255&i);return t},m:92533269};d=!function(t,i,n,r,o,s){for(var a=window[e.s("D`vf")],l=33,d=n,c=s,u=l+(d*c-(u=r)*(f=o))%l,f=d=0;f<l;f++)1==u*f%l&&(d=f);return(d*s%l*(u=t)+d*(l+-1*r)%l*(f=i))%l*12+((d*(33+-1*o)-33*(""+d*(l+-1*o)/33>>>0))*u+d*n%33*f)%l-1>=(c=new a(1e4*(225282658^e.m)))[e.s("gdvEqij^mhx")]()%2e3*12+c[e.s("gdvNkkro")]()}(u(8),u(9),u(0),u(1),u(2),u(3))}();var r=n.get("settings");return function(){var e=u(5)-u(1);0>e&&(e=u(5)-u(1)+33),a=e-1<=0}(),c=function(e,t,i){var n=0,r=(window.opener?window.opener:window.top).location.hostname.toLocaleLowerCase();if(0===t&&(r=r.replace(new RegExp("^www\\."),"")),1===t&&(r=("."+r.replace(new RegExp("^www\\."),"")).search(new RegExp("\\."+i+"$"))>=0&&i),2===t)return!0;for(var o=0;o<r.length;o++)n+=r.charCodeAt(o);return r===i&&e===n+-33*parseInt(n%100/33,10)-100*(""+n/100>>>0)}(u(7),function(e,t){var i=e-t;return 0>i&&(i=e-t+33),i}(u(4),u(0)),h.config.initConfigInfo.s),e.forEach(t.settings,function(n){var o;n=e.extend({},{isEnabled:!0},n),(o=r.findWhere({name:n.name}))&&m.remove(o),m.hasValueInStorage(t.group,n.name)?n.value=m.getValueFromStorage(t.group,n.name):n.value=n.defaultValue,r.add(n).on("change:value",i)}),l=function(e,t){for(var i=0,n=0;n<10;n++)i+=e.charCodeAt(n);for(;i>33;){var r=i.toString().split("");i=0;for(var o=0;o<r.length;o++)i+=parseInt(r[o])}return i===t}(h.config.initConfigInfo.c,u(10)),m.trigger("update"),function(e){function t(){return e.request("page:addRegion",{page:"Main",name:r,id:e._.uniqueId("ckf-"),priority:10})}function i(e){for(var t="",i=0;i<e.length;++i)t+=String.fromCharCode(e.charCodeAt(i)^i+4&255);return t}function n(){"thnks"in window||(window.thnks=!1),f=!0;var t={};t.message=["Pmot","mv","e","``kh","r`ttafd","kc","GN@nfmoy","7"].map(i).join(" "),e.request("page:showInRegion",{view:new(e.Backbone.Marionette.ItemView.extend({attributes:{"data-role":thnks?null:"header","data-theme":"a"===e.config.swatch?"b":"a"},template:e._.template(thnks?null:'<h2 style="margin:-1px auto 0;"><%= message %></h2>')}))({model:new e.Backbone.Model(t)}),page:"Main",region:r})}if(!(l&&s&&c&&a)||d){var r=e._.uniqueId("ckf-"+(10*Math.random()).toFixed(0)+"-");if(f)return;if(!t())return void e.once("page:create:Main",function(){t(),n()});n()}}(h),n.getSettings()},"settings:setValue":function(e){var t=p(e.group,e.name);t&&t.set("value",e.value)},"settings:getValue":function(t){var i;return e.isUndefined(t.name)||!t.name?g(t.group).getSettings():(i=p(t.group,t.name))?i.get("value"):""},"settings:enable":function(e){var t=p(e.group,e.name);t&&t.set("isEnabled",!0)},"settings:disable":function(e){var t=p(e.group,e.name);t&&t.set("isEnabled",!1)}}),h.on("toolbar:reset:Main",function(e){w=new t.Model({name:"Settings",type:"button",priority:10,icon:"ckf-settings",iconOnly:!0,label:e.finder.lang.settings.title,alignment:"secondary",alwaysVisible:!0,action:function(){h.request("panel:toggle",{name:"settings"})}}),e.data.toolbar.push(w)}),h.on("panel:close:settings",function(){w&&w.trigger("focus")})}}),CKFinder.define("CKFinder/Modules/Shortcuts/Models/Shortcuts",["underscore","backbone"],function(e,t){"use strict";var i=t.Collection.extend({comparator:"priority"});return{createColumns:function(i,n){var r=new t.Collection;e.forEach(n,function(e){r.add({column:e,groups:new t.Collection,size:0})});var o=i.reduce(function(e,t){return e+t.get("shortcuts").length},0),s=r.length,a=Math.ceil(o/s),l=0;return i.forEach(function(e){l<s-1&&function(e){var t=r.at(l).get("size");if(t>a)return!0;if(0===t||e.get("shortcuts").length+t<=a)return!1;var n=(2-l)*a,o=i.indexOf(e);return n>=i.reduce(function(e,t,i){return i<o?e:e+t.get("shortcuts").length},0)}(e)&&(l+=1);var t=r.at(l);t.get("groups").push(e),t.set("size",t.get("size")+e.get("shortcuts").length),e.get("shortcuts").length}),r},createCollection:function(e){return new i(e)}}}),CKFinder.define("text!CKFinder/Templates/Shortcuts/Group.dot",[],function(){return'<thead>\n\t<tr>\n\t\t<th></th>\n\t\t<th class="ckf-shortcuts-title" data-ckf-shortcut-group="{{= it.name }}">{{! it.label }}</th>\n\t</tr>\n</thead>\n<tbody></tbody>\n'}),CKFinder.define("text!CKFinder/Templates/Shortcuts/Shortcut.dot",[],function(){return'<td class="ckf-shortcuts-keys">\n{{~ it.shortcuts:definition }}\n\t<span class="ckf-shortcuts-shortcut ui-bar-inherit">\n\t{{~ definition:key:i }}{{? i > 0 }}&nbsp;+&nbsp;{{?}}<kbd>\n\t{{? it.keys[ key ] }}\n\t\t<span class="ckf-shortcuts-reader-only" aria-hidden="false">{{= it.keys[ key ].text }}</span>\n\t\t<span role="presentation" aria-hidden="true">\n\t\t\t{{? it.lang.shortcuts.keysAbbreviations[ it.keys[ key ].display ] }}\n\t\t\t\t{{= it.lang.shortcuts.keysAbbreviations[ it.keys[ key ].display ] }}\n\t\t\t{{??}}\n\t\t\t\t{{= it.keys[ key ].display }}\n\t\t\t{{?}}\n\t\t</span>\n\t{{??}}\n\t\t{{? it.lang.shortcuts.keysAbbreviations[ key ] }}{{= it.lang.shortcuts.keysAbbreviations[ key ] }}{{??}}{{= key }}{{?}}\n\t{{?}}\n\t</kbd>{{~}}\n\t</span> {{ /* single space left intentionally is here to make spans separate on compile */ }}\n{{~}}\n</td>\n<td class="ckf-shortcuts-description">{{! it.label }}</td>\n'}),CKFinder.define("CKFinder/Modules/Shortcuts/Views/ShortcutsDialogView",["CKFinder/Views/Base/ItemView","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/CompositeView","text!CKFinder/Templates/Shortcuts/Group.dot","text!CKFinder/Templates/Shortcuts/Shortcut.dot"],function(e,t,i,n,r){"use strict";var o=e.extend({name:"ShortcutView",tagName:"tr",template:r,templateHelpers:function(){return{keys:this.getOption("keys")}}}),s=i.extend({name:"ShortcutsGroupView",childViewContainer:"tbody",childView:o,tagName:"table",className:"ckf-shortcuts",template:n,initialize:function(e){this.collection=e.model.get("shortcuts")},childViewOptions:function(){return{keys:this.getOption("keys")}}}),a=t.extend({name:"ShortcutsColumnView",template:"",childView:s,initialize:function(e){this.collection=e.model.get("groups"),this.once("render",function(){this.$el.addClass("ui-block-"+this.model.get("column"))},this)},childViewOptions:function(){return{keys:this.getOption("keys")}}});return t.extend({name:"ShortcutsListing",childView:a,className:"ui-grid-b ui-responsive ckf-shortcuts-dialog",template:"",childViewOptions:function(){return{keys:this.getOption("keys")}}})}),CKFinder.define("CKFinder/Modules/Shortcuts/Shortcuts",["underscore","backbone","CKFinder/Util/KeyCode","CKFinder/Modules/Shortcuts/Models/Shortcuts","CKFinder/Modules/Shortcuts/Views/ShortcutsDialogView","CKFinder/Views/Base/CollectionView","CKFinder/Views/Base/CompositeView"],function(e,t,i,n,r){"use strict";return function(o){o.request("key:listen",{key:i.slash}),o.on("keydown:"+i.slash,function(i){if(i.finder.util.isShortcut(i.data.evt,"shift")){var s=n.createCollection();i.finder.fire("shortcuts:list",{groups:s},i.finder);var a={esc:{display:"esc",text:o.lang.shortcuts.keys.escape},del:{display:"del",text:o.lang.shortcuts.keys.delete},ctrl:{display:"ctrl",text:o.lang.shortcuts.keys.ctrl},downArrow:{display:"&darr;",text:o.lang.shortcuts.keys.downArrow},leftArrow:{display:"&larr;",text:o.lang.shortcuts.keys.leftArrow},question:{display:"?",text:o.lang.shortcuts.keys.question},rightArrow:{display:"&rarr;",text:o.lang.shortcuts.keys.rightArrow},upArrow:{display:"&uarr;",text:o.lang.shortcuts.keys.upArrow}};s.forEach(function(e){var n=new t.Collection;i.finder.fire("shortcuts:list:"+e.get("name"),{keys:a,shortcuts:n},i.finder),e.set("shortcuts",n)}),s.forEach(function(t){t.get("shortcuts").forEach(function(t){var i=[];e.forEach(t.get("shortcuts").split("|"),function(e){i.push(e.replace(/{|}/g,"").split("+"))}),t.set("shortcuts",i)})}),i.finder.request("dialog",{name:"ShortcutsDialog",title:i.finder.lang.shortcuts.title,view:new r({finder:o,collection:n.createColumns(s,["a","b","c"]),keys:a}),buttons:["okClose"],restrictHeight:!0})}}),o.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.listShortcuts,shortcuts:"{question}"})},null,null,70)}}),CKFinder.define("CKFinder/Modules/StatusBar/Views/StatusBarView",["jquery","CKFinder/Util/KeyCode","CKFinder/Views/Base/DynamicLayoutView"],function(e,t,i){"use strict";return i.extend({name:"StatusBarView",template:'<div class="ckf-status-bar-regions"></div>',className:"ckf-statusbar",attributes:{"data-role":"footer","data-position":"fixed","data-tap-toggle":"false",role:"status",tabindex:50},ui:{regions:".ckf-status-bar-regions"},events:{keydown:function(e){e.keyCode===t.tab&&(this.finder.util.isShortcut(e,"")||this.finder.util.isShortcut(e,"shift"))&&this.finder.request(this.finder.util.isShortcut(e,"")?"focus:next":"focus:prev",{node:this.$el,event:e})}},initialize:function(e){this.once("render",function(){this.$el.attr("aria-label",e.label)},this)},onRender:function(){var t=this;setTimeout(function(){t.$el.toolbar(),t.$el.toolbar("updatePagePadding"),e.mobile.resetActivePageHeight()},0)}})}),CKFinder.define("CKFinder/Modules/StatusBar/StatusBar",["jquery","backbone","CKFinder/Modules/StatusBar/Views/StatusBarView"],function(e,t,i){"use strict";return function(e){this.bars=new t.Collection;var n=this;n.finder=e,e.setHandlers({"statusBar:create":function(t){if(!t.name)throw"Request statusBar create needs name parameter";if(!t.page)throw"Request statusBar:create needs page parameter";var r=new i({finder:n.finder,name:t.name,label:t.label});return n.bars.add({name:t.name,page:t.page,bar:r}),r.render().$el.appendTo('[data-ckf-page="'+t.page+'"]'),e.fire("statusBar:create",{name:t.name,page:t.page},e),r},"statusBar:destroy":function(t){var i=n.bars.findWhere({name:t.name});i&&(e.fire("statusBar:destroy:"+t.name,null,e),i.get("bar").destroy(),n.bars.remove(i))},"statusBar:addRegion":function(e){var t=n.bars.findWhere({name:e.name});t&&t.get("bar").createRegion({id:e.id,name:e.id,priority:e.priority?e.priority:50})},"statusBar:showView":function(e){var t=n.bars.findWhere({name:e.name});t&&t.get("bar")[e.region].show(e.view)}})}}),CKFinder.define("CKFinder/Modules/Toolbars/Views/ToolbarButtonView",["underscore","CKFinder/Views/Base/ItemView"],function(e,t){"use strict";return t.extend({tagName:"button",name:"ToolbarItemButton",template:"{{= it.label }}",modelEvents:{"change:isDisabled":function(e){e.get("isDisabled")?this.$el.addClass("ui-state-disabled").attr("aria-disabled","true"):this.$el.removeClass("ui-state-disabled").attr("aria-disabled","false")},focus:function(){this.$el.focus()}},events:{click:"runAction",keydown:function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})},keyup:function(e){e.preventDefault(),e.stopPropagation()},focus:function(){this.$el.attr("tabindex",1)},blur:function(){this.$el.attr("tabindex",-1)}},onRender:function(){this.$el.button()},runAction:function(){var t=this.model.get("action");e.isFunction(t)&&t(this)}})}),CKFinder.define("CKFinder/Modules/Toolbars/Views/ToolbarView",["underscore","jquery","CKFinder/Views/Base/CompositeView","CKFinder/Views/Base/ItemView","CKFinder/Modules/Toolbars/Views/ToolbarButtonView","CKFinder/Util/KeyCode"],function(e,t,i,n,r,o){"use strict";function s(t,i){var n=t.finder.request("ui:getMode"),o=["ckf-toolbar-item","ckf-toolbar-button","ckf-toolbar-item-focusable ui-btn ui-corner-all"];i.has("className")&&o.push(i.get("className")),"desktop"!==n||i.get("iconOnly")?o.push("ui-btn-icon-notext"):o.push("ui-btn-icon-"+("ltr"===t.finder.lang.dir?"left":"right")),o.push("ui-icon-"+i.get("icon"));var s={"data-ckf-name":i.get("name"),title:i.get("label"),tabindex:-1};return i.get("isDisabled")&&(o.push("ui-state-disabled"),s["aria-disabled"]="true"),i.has("attributes")&&(s=e.extend(s,i.get("attributes"))),r.extend({attributes:s,className:o.join(" ")})}function a(t,i){var r=t.finder.request("ui:getMode"),s=["ckf-toolbar-item","ckf-toolbar-button","ckf-toolbar-item-focusable ui-btn ui-corner-all"];i.has("className")&&s.push(i.get("className")),"desktop"!==r||i.get("iconOnly")?s.push("ui-btn-icon-notext"):s.push("ui-btn-icon-"+("ltr"===t.finder.lang.dir?"left":"right")),s.push("ui-icon-"+i.get("icon"));var a={"data-ckf-name":i.get("name"),title:i.get("label"),tabindex:-1,href:i.get("href"),role:"button"};return i.get("isDisabled")&&(s.push("ui-state-disabled"),a["aria-disabled"]="true"),i.has("attributes")&&(a=e.extend(a,i.get("attributes"))),n.extend({finder:t.finder,name:"ToolbarItemButtonButton",tagName:"a",className:s.join(" "),template:"{{= it.label }}",attributes:a,events:{keyup:function(e){e.keyCode!==o.enter&&e.keyCode!==o.space&&this.trigger("itemkeydown",{evt:e,view:this,model:this.model})},keydown:function(e){this.trigger("itemkeydown",{evt:e,view:this,model:this.model})}}})}function l(){var t=this,i=t.$el.find('[data-show-more="true"]');if(i.hide(),i.attr("aria-hidden","true"),t.$el.enhanceWithin(),t.$el.toolbar(t.toolbarOptions),t.children.each(u),!(t.collection.length<=2)){var n,r,o=0,s=0,a=Math.floor(t.ui.items.width());e.forEach(t.collection.where({alwaysVisible:!0}),function(e){var i=t.children.findByModelCid(e.cid).$el;i.is(":visible")&&(s+=Math.ceil(i.outerWidth(!0)))}),t.$el.find(".ckf-toolbar-item").addClass(g),t.$el.css("min-width",s),e.forEach(t.collection.sortBy(c),function(e){var i=e.get("type");if("showMore"===i||e.get("alwaysVisible"))"showMore"===i&&(r=e);else{var l=t.children.findByModelCid(e.cid),c=Math.ceil(l.$el.outerWidth(!0));e.get("hidden")?d(l):c+s>=a?("button"===i&&(o+=1),d(l),e.set("showMore",!0)):s+=c,o||(n=l)}}),o&&(r.set("hidden",!1),i.show(),i.removeAttr("aria-hidden"),n&&s+Math.ceil(i.outerWidth(!0))>a&&(d(n),n.model.set("showMore",!0))),t.$el.find(".ckf-toolbar-item").removeClass(g);var l=t.collection.findWhere({focus:!0});if(l){var f=t.children.findByModelCid(l.cid);f&&f.$el.focus()}}}function d(e){e.$el.hide(),e.$el.attr("aria-hidden","true"),e.trigger("hidden")}function c(e){return(e.get("alwaysVisible")?h:0)-e.get("priority")}function u(e){"primary"!==e.model.get("alignment")&&e.$el.addClass("ckf-toolbar-secondary"),"custom"===e.model.get("type")&&e.$el.addClass("ckf-toolbar-item"),e.model.get("alwaysVisible")&&e.$el.attr("data-ckf-always-visible","true")}function f(e){var t=e.collection.filter(function(e){return!(!0===e.get("hidden")||"custom"===e.get("type")||"text"===e.get("type"))}),i=[],n=[];return t.forEach(function(t){t.get("alignment")===("ltr"===e.finder.lang.dir?"primary":"secondary")?i.push(t):n.unshift(t)}),i.concat(n)}var h=9e5,g="ckf-toolbar-item-hidden";return i.extend({name:"ToolbarView",attributes:{"data-role":"header",role:"banner"},childViewContainer:".ckf-toolbar-items",template:'<div tabindex="10" class="ckf-toolbar-items" role="toolbar"></div>',events:{keydown:function(e){var t=e.keyCode;if(t===o.tab&&this.finder.util.isShortcut(e,""))this.finder.request("focus:next",{node:this.ui.items,event:e});else if(t>=o.left&&t<=o.down||t===o.home||t===o.end){e.stopPropagation(),e.preventDefault();var i=f(this);if(!i.length)return;var n="ltr"===this.finder.lang.dir?o.end:o.home,r=t===o.left||t===o.up||t===n?i.length-1:0;this.children.findByModel(i[r]).$el.focus()}},"focus @ui.items":function(e){if(e.target===e.currentTarget){e.preventDefault(),e.stopPropagation();var t=f(this);if(t.length){var i="ltr"===this.finder.lang.dir?0:t.length-1;this.children.findByModel(t[i]).$el.focus()}}}},ui:{items:".ckf-toolbar-items"},onRender:function(){var e=this;setTimeout(function(){e.$el.toolbar(e.toolbarOptions),e.$el.toolbar("updatePagePadding"),t.mobile.resetActivePageHeight(),e.$el.attr("data-ckf-toolbar",e.name),e.finder.fire("toolbar:create",{name:e.name,page:e.page},e.finder)},0)},initialize:function(t){var i=this;i.name=t.name,i.page=t.page,i.toolbarOptions={position:"fixed",tapToggle:!1,updatePagePadding:!0},i.on("render:collection",function(){i.$el.addClass("ckf-toolbar")}),i.on("attachBuffer",l,i),i.on("childview:itemkeydown",function(t,n){var r,s,a=n.evt;if(a.keyCode===o.up||a.keyCode===o.left||a.keyCode===o.down||a.keyCode===o.right){a.stopPropagation(),a.preventDefault();var l=f(i);r=e.indexOf(l,t.model),a.keyCode===o.down||a.keyCode===o.right?s=(s=r+1)<=l.length-1?s:0:s=(s=r-1)>=0?s:l.length-1,this.children.findByModel(l[s]).$el.focus()}a.keyCode!==o.enter&&a.keyCode!==o.space||(a.stopPropagation(),a.preventDefault(),e.isFunction(t.runAction)&&t.runAction())})},getChildView:function(e){var t=e.get("type");return"custom"===t?e.get("view"):"showMore"===t?function(e,t){return t.set({attributes:{"data-show-more":!0},alwaysVisible:!0}),s(e,t)}(this,e):"text"===t?function(e,t){var i="ckf-toolbar-item ckf-toolbar-text";return t.has("className")&&(i+=" "+t.get("className")),n.extend({finder:e.finder,name:"ToolbarItemText",tagName:"div",template:"{{= it.label }}",className:i,attributes:{"data-ckf-name":t.get("name")}})}(this,e):"link-button"===t?a(this,e):s(this,e)},focus:function(){t(this.childViewContainer).focus()}})}),CKFinder.define("CKFinder/Modules/Toolbars/Toolbar",["underscore","jquery","backbone","CKFinder/Modules/Toolbars/Views/ToolbarView","CKFinder/Modules/ContextMenu/Views/ContextMenuView"],function(e,t,i,n,r){"use strict";function o(e,t){this.name=t,this.finder=e,this.currentToolbar=new a}var s=i.Model.extend({defaults:{type:"button",alignment:"primary",priority:30,alwaysVisible:!1}}),a=i.Collection.extend({model:s,comparator:function(e,t){var i=e.get("alignment");if(i!==t.get("alignment"))return"primary"===i?-1:1;var n=e.get("priority"),r=t.get("priority");if(n===r)return 0;var o="primary"===i?1:-1;return n<r?o:-1*o}});return o.prototype.reset=function(t,n){var o=this,s=e.extend({toolbar:new a},n);o.finder.fire("toolbar:reset:"+o.name,s,o.finder),t&&o.finder.fire("toolbar:reset:"+o.name+":"+t,s,o.finder),s.toolbar.push({name:"ShowMore",icon:"ckf-more-vertical",iconOnly:!0,type:"showMore",label:o.finder.lang.common.showMore,priority:-10,hidden:!0,action:function(){var e=new i.Collection;o.currentToolbar.chain().filter(function(e){return!!e.get("showMore")}).forEach(function(t){e.push({action:t.get("action"),isActive:!0,icon:t.get("icon"),label:t.get("label"),hidden:!1})});var t=o.toolbarView.children.findByModel(o.currentToolbar.findWhere({type:"showMore"}));o.currentToolbar.showMore=new r({finder:o.finder,collection:e,positionToEl:t.$el}).render(),o.currentToolbar.showMore.once("destroy",function(){o.currentToolbar.showMore=!1,t.$el.focus()})}}),o.currentToolbar.reset(s.toolbar.toArray())},o.prototype.init=function(e,t){var i=this;i.toolbarView=new n({finder:e,collection:i.currentToolbar,name:i.name,page:t}),i.toolbarView.on("childview:hidden",function(e){e.model.set("hidden",!0)}),i.toolbarView.render().$el.prependTo('[data-ckf-page="'+t+'"]')},o.prototype.destroy=function(){this.toolbarView.destroy(),this.currentToolbar.reset()},o.prototype.redraw=function(){this.currentToolbar.forEach(function(t){if("showMore"!==t.get("type")&&t.set("hidden",!1),t.has("onRedraw")){var i=t.get("onRedraw");e.isFunction(i)&&i.call(t)}}),this.toolbarView.render()},o.prototype.hideMore=function(){this.currentToolbar.showMore&&this.currentToolbar.showMore.destroy()},o}),CKFinder.define("CKFinder/Modules/Toolbars/Toolbars",["jquery","underscore","backbone","CKFinder/Modules/Toolbars/Toolbar","CKFinder/Util/KeyCode"],function(e,t,i,n,r){"use strict";function o(){this.toolbars=new i.Collection}function s(e){e.get("toolbar").destroy(),this.toolbars.remove(e),this.finder.fire("toolbar:destroy",{name:e.get("name")},this.finder)}function a(t){t.request("key:listen",{key:r.f7}),t.on("keydown:"+r.f7,function(i){t.util.isShortcut(i.data.evt,"alt")&&(i.data.evt.preventDefault(),i.data.evt.stopPropagation(),e(".ui-page-active .ckf-toolbar-items").focus())}),t.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.focusToolbar,shortcuts:"{alt}+{f7}"})},null,null,20)}var l="ckf-toolbar-visible";return o.prototype={getHandlers:function(){return{"toolbar:create":{callback:this.toolbarCreateHandler,context:this},"toolbar:reset":{callback:this.toolbarResetHandler,context:this},"toolbar:destroy":{callback:this.toolbarDestroyHandler,context:this}}},setFinder:function(i){function n(t){o.toolbars.where({page:t}).forEach(function(e){e.get("toolbar").redraw()}),r=e(document).width()}this.finder=i,a(i);var r=0;i.on("ui:resize",function(){var t=e(document).width();r!==t&&n(i.request("page:current"))}),i.on("ui:blur",function(){o.toolbars.where({page:i.request("page:current")}).forEach(function(e){e.get("toolbar").hideMore()})});var o=this;i.on("page:show",function(t){var i=t.data.page;n(i),o.toolbars.where({page:i}).length?e("body").addClass(l):e("body").removeClass(l)}),i.on("page:destroy",function(e){t.forEach(this.toolbars.where({page:e.data.page}),s,this)},this)},toolbarCreateHandler:function(t){this.toolbarDestroyHandler(t);var i=new n(this.finder,t.name);this.toolbars.add({page:t.page,name:t.name,toolbar:i}),i.init(this.finder,t.page);var r=this.finder.request("page:current");t.page===r&&e("body").addClass(l)},toolbarDestroyHandler:function(t){var i=this.toolbars.where({name:t.name})[0];i&&(s.call(this,i),i.page===this.finder.request("page:current")&&e("body").removeClass(l))},toolbarResetHandler:function(e){var i=this.toolbars.where({name:e.name})[0];if(i){var n=t.extend({},e.context);i.get("toolbar").reset(e.event,n)}}},o}),CKFinder.define("CKFinder/Modules/UploadFileButton/UploadFileButton",["CKFinder/Util/KeyCode"],function(e){"use strict";function t(e){e.finder.request("folder:getActive").get("acl").fileUpload&&e.data.toolbar.push({name:"Upload",type:"button",priority:80,icon:"ckf-upload",label:e.finder.lang.common.upload,action:function(){e.finder.request("upload")}})}function i(t){t.request("key:listen",{key:e.u}),t.on("keydown:"+e.u,function(e){t.util.isShortcut(e.data.evt,"alt")&&t.request("upload")}),t.on("shortcuts:list:files",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.files.upload,shortcuts:"{alt}+{u}"})},null,null,40)}return function(e){e.on("toolbar:reset:Main:folder",t),e.on("toolbar:reset:Main:file",t),e.on("toolbar:reset:Main:files",t),i(e)}}),CKFinder.define("CKFinder/Modules/Modules",["underscore","backbone","CKFinder/Modules/CsrfTokenManager/CsrfTokenManager","CKFinder/Modules/Connector/Connector","CKFinder/Modules/ContextMenu/ContextMenu","CKFinder/Modules/CreateFolder/CreateFolder","CKFinder/Modules/DeleteFile/DeleteFile","CKFinder/Modules/DeleteFolder/DeleteFolder","CKFinder/Modules/Dialogs/Dialogs","CKFinder/Modules/EditImage/EditImage","CKFinder/Modules/FileDownload/FileDownload","CKFinder/Modules/FilePreview/FilePreview","CKFinder/Modules/Files/Files","CKFinder/Modules/FilesMoveCopy/FilesMoveCopy","CKFinder/Modules/FocusManager/FocusManager","CKFinder/Modules/Folders/Folders","CKFinder/Modules/FormUpload/FormUpload","CKFinder/Modules/Html5Upload/Html5Upload","CKFinder/Modules/KeyListener/KeyListener","CKFinder/Modules/Loader/Loader","CKFinder/Modules/Maximize/Maximize","CKFinder/Modules/Pages/Pages","CKFinder/Modules/Panels/Panels","CKFinder/Modules/RenameFile/RenameFile","CKFinder/Modules/RenameFolder/RenameFolder","CKFinder/Modules/FilterFiles/FilterFiles","CKFinder/Modules/Settings/Settings","CKFinder/Modules/Shortcuts/Shortcuts","CKFinder/Modules/StatusBar/StatusBar","CKFinder/Modules/Toolbars/Toolbars","CKFinder/Modules/UploadFileButton/UploadFileButton"],function(e,t,i,n,r,o,s,a,l,d,c,u,f,h,g,p,m,v,w,y,b,C,F,x,k,M,I,K,E,V,S){"use strict";function T(t,i,n){if(q[t]&&(!n||!e.contains(n,t))){var r=new q[t](i.finder);i.add(r),r.getHandlers&&i.finder.setHandlers(r.getHandlers()),r.setFinder&&r.setFinder(i.finder)}}var _=["CreateFolder","DeleteFile","DeleteFolder","EditImage","FilesMoveCopy","FormUpload","Html5Upload","RenameFile","RenameFolder","UploadFileButton"],q={CsrfTokenManager:i,Connector:n,ContextMenu:r,CreateFolder:o,DeleteFile:s,DeleteFolder:a,Dialogs:l,EditImage:d,FileDownload:c,FilePreview:u,Files:f,FilesMoveCopy:h,Folders:p,FocusManager:g,FormUpload:m,Html5Upload:v,KeyListener:w,Loader:y,Maximize:b,Pages:C,Panels:F,RenameFile:x,RenameFolder:k,FilterFiles:M,Settings:I,Shortcuts:K,StatusBar:E,Toolbars:V,UploadFileButton:S};return t.Collection.extend({init:function(t){var i=this;i.finder=t;var n=t.config.readOnlyExclude.length?t.config.readOnlyExclude.split(","):[],r=!!t.config.readOnly&&e.union(_,n);t.config.removeModules&&(r=e.union(r||[],t.config.removeModules.split(","))),T("Loader",i,r),T("FocusManager",i,r),T("KeyListener",i,r),T("CsrfTokenManager",i,r),T("Connector",i,r),T("Settings",i,r),T("Panels",i,r),T("Dialogs",i,r),T("ContextMenu",i,r),T("Pages",i,r),T("Toolbars",i,r),T("StatusBar",i,r),T("Files",i,r),T("Folders",i,r),T("CreateFolder",i,r),T("DeleteFolder",i,r),T("RenameFolder",i,r),T("FilesMoveCopy",i,r),T("RenameFile",i,r),T("DeleteFile",i,r),T("Html5Upload",i,r),T("FormUpload",i,r),T("UploadFileButton",i,r),T("FilterFiles",i,r),T("Maximize",i,r),T("FilePreview",i,r),T("FileDownload",i,r),T("EditImage",i,r),T("Shortcuts",i,r)}})}),CKFinder.define("CKFinder/Views/TemplateCache",["underscore","doT"],function(e,t){"use strict";function i(e){this.finder=e,this._templates={}}return i.prototype.has=function(e){return!!this.get(e)},i.prototype.get=function(e){return this._templates[e]},i.prototype.compile=function(i,n,r){e.isFunction(r)&&(r=r.call(this));var o={imports:r,name:i,template:n};this.finder.fire("template",o,this.finder),this.finder.fire("template:"+i,o,this.finder);var s=t.template(o.template,null,o.imports);return this._templates[i]=s,s},i}),CKFinder.define("CKFinder/Views/TemplateRenderer",["underscore","marionette"],function(e,t){"use strict";function i(e){this.finder=e}return i.prototype.render=function(i,n,r,o){var s;if(!(s=this.finder.templateCache.has(n)?this.finder.templateCache.get(n):this.finder.templateCache.compile(n,r,{})))throw new t.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var a=e.extend(this.mixinTemplateHelpers(i.toJSON(),o));return t.Renderer.render(s,a)},i.prototype.mixinTemplateHelpers=function(t,i){return t=t||{},e.extend(t,{lang:this.finder.lang,config:this.finder.config},i)},i}),CKFinder.define("CKFinder/Application",["underscore","jquery","doT","backbone","CKFinder/Config","CKFinder/Event","CKFinder/Util/Util","CKFinder/Util/Lang","CKFinder/UI/UIHacks","CKFinder/Plugins/Plugins","CKFinder/Modules/Modules","CKFinder/Views/TemplateCache","CKFinder/Views/TemplateRenderer"],function(e,t,i,n,r,o,s,a,l,d,c,u,f){"use strict";function h(){var e,t,i;g(i=this),i._modules.init(i),e={name:"Init"},(t=i.config.resourceType)&&(e.params={type:t}),i.once("command:ok:Init",function(e){i.config.initConfigInfo=e.data.response},null,null,1),i.once("command:ok:Init",function(){i.fire("app:start",{},i)},null,null,999),i.once("command:ok:GetFiles",function(){i.fire("app:ready",{},i)},null,null,999),i.fire("app:loaded",{},i),i.request("command:send",e)}function g(t){var i,n=t.config,r={ckfinder:t},o="ckfinderReady";try{i=new CustomEvent(o,{detail:r})}catch(e){(i=document.createEvent("Event")).initEvent(o,!0,!1),i.detail=r}window.dispatchEvent(i),e.isFunction(n.onInit)?n.onInit(t):"object"==typeof n.onInit&&n.onInit.call(void 0,t)}function p(e){var t,i=e.data.response.error.number;t=e.data.response.error.message?e.data.response.error.message:i&&this.lang.errors.codes[i]?this.lang.errors.codes[i]:this.lang.errors.unknown.replace("{number}",i),this.request("dialog:info",{msg:t,name:"CommandError"})}return i.templateSettings.doNotSkipEncoded=!0,{start:function(r){r.type&&(r.resourceType=r.type);var g={_reqres:new n.Wreqr.RequestResponse,_plugins:new d,_modules:new c,config:r,util:s,Backbone:n,_:e,doT:i};return g.templateCache=new u(g),g.renderer=new f(g),g.hasHandler=function(){return this._reqres.hasHandler.apply(g._reqres,arguments)},g.getHandler=function(){return this._reqres.getHandler.apply(g._reqres,arguments)},g.setHandler=function(){return this._reqres.setHandler.apply(g._reqres,arguments)},g.setHandlers=function(){return this._reqres.setHandlers.apply(g._reqres,arguments)},g.request=function(){return this._reqres.request.apply(g._reqres,arguments)},e.extend(g,o.prototype),g.on("command:error",p,g),g.on("command:error:Init",function(){t("html").removeClass("ui-mobile-rendering")}),g.on("app:error",function(e){alert("Could not start CKFinder: "+e.data.msg)}),g.on("shortcuts:list",function(e){e.data.groups.add({name:"general",priority:10,label:e.finder.lang.shortcuts.general.title})}),g.on("shortcuts:list:general",function(e){e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.action,shortcuts:"{enter}"}),e.data.shortcuts.add({label:e.finder.lang.shortcuts.general.focusNext,shortcuts:"{tab}"}),e.data.shortcuts.add({label:e.finder.lang.common.close,shortcuts:"{esc}"})},null,null,60),g.once("plugin:allReady",h,g),a.init(g.config).fail(function(){g.fire("app:error",{msg:"Language file is missing or broken"},g)}).done(function(t){g.lang=t;var i=r.skin;i.indexOf("/")<0&&(i="skins/"+i+"/skin"),window.CKFinder.require([i],function(t){e.isFunction(t.init)&&(t.path=g.util.parentFolder(i)+"/",t.init(g)),l.init(g),g._plugins.load(g)})}),g}}}),CKFinder.define("skins/jquery-mobile/skin",{config:function(e){return e.iconsCSS||(e.iconsCSS="skins/jquery-mobile/icons.css"),e.themeCSS||(e.themeCSS="libs/jquery.mobile.theme.css"),e},init:function(){CKFinder.require(["jquery"],function(e){e("body").addClass("ui-icon-alt")})}}),CKFinder.define("skins/moono/skin",{config:function(e){return e.swatch="a",e.dialogOverlaySwatch=!0,e.loaderOverlaySwatch=!0,e.themeCSS||(e.themeCSS="skins/moono/ckfinder.css"),e.iconsCSS||(e.iconsCSS="skins/moono/icons.css"),e},init:function(){CKFinder.require(["jquery"],function(e){e("body").addClass("ui-alt-icon")})}}),window.CKFinder=window.CKFinder||{},window.CKFinder.require=CKFinder.require||window.require||require,window.CKFinder.requirejs=CKFinder.requirejs||window.requirejs||requirejs,window.CKFinder.define=CKFinder.define||window.define||define,window.CKFinder.basePath&&window.CKFinder.requirejs.config({baseUrl:window.CKFinder.basePath}),window.CKFinder.requirejs.config({waitSeconds:0}),window.CKFinder.define("ckf_global",function(){return window.CKFinder});var event,eventType="ckfinderRequireReady";try{event=new CustomEvent(eventType)}catch(e){event=document.createEvent("Event"),event.initEvent(eventType,!0,!1)}window.dispatchEvent(event),window.CKFinder.start=function(e){e=e||{},window.CKFinder.require(["underscore","CKFinder/Config","CKFinder/Util/Util"],function(t,i,n){function r(e,i,r){var s,a,l;if((a=t.pick(n.getUrlParams(),["id","type","resourceType","langCode","CKEditor","CKEditorFuncNum"])).langCode&&(a.language=a.langCode),a.type&&(a.resourceType=a.type),a.CKEditor){a.chooseFiles=!0;var d=a.CKEditorFuncNum;a.ckeditor={id:a.CKEditor,funcNumber:d,callback:function(e,t){window.opener.CKEDITOR.tools.callFunction(d,e,t),window.close()}}}delete a.langCode,delete a.CKEditor,delete a.CKEditorFuncNum,l=window!==window.parent&&window.opener||window.isCKFinderPopup?window.opener:window.parent.CKFinder&&window.parent.CKFinder.modal&&window.parent.CKFinder.modal("visible")||window!==window.parent&&!window.opener?window.parent:window,o(s=t.extend({},e,i,l.CKFinder?l.CKFinder._config:{},r,a),function(e){e.start(s)})}function o(e,i){var n=e.skin;n.indexOf("/")<0&&(n="skins/"+n+"/skin"),window.CKFinder.require([n],function(i){var n=t.isFunction(i.config)?i.config(e):i.config;!function(e){[e.jqueryMobileStructureCSS,e.coreCSS,e.jqueryMobileIconsCSS,e.iconsCSS,e.themeCSS].forEach(function(e){if(e){var t=window.document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",CKFinder.require.toUrl(e)+"?ver=i42irv"),window.document.head.appendChild(t)}})}(t.extend(e,n))}),window.jQuery&&/1|2\.[0-9]+.[0-9]+/.test(window.jQuery.fn.jquery)?s(e,i):window.CKFinder.require([window.CKFinder.require.toUrl(e.jquery)+"?ver=i42irv"],function(){s(e,i)})}function s(e,t){window.CKFinder.define("jquery",function(){return window.jQuery}),window.jQuery(window.document).bind("mobileinit",function(){window.jQuery.mobile.linkBindingEnabled=!1,window.jQuery.mobile.hashListeningEnabled=!1,window.jQuery.mobile.autoInitializePage=!1,window.jQuery.mobile.ignoreContentEnabled=!0}),window.CKFinder.require([window.CKFinder.require.toUrl(e.jqueryMobile)+"?ver=i42irv"],function(){window.CKFinder.define("ckf-jquery-mobile",function(){return window.jQuery.mobile}),window.CKFinder.require(["CKFinder/Application"],t)})}var a=t.isUndefined(e.configPath)?i.configPath:e.configPath;return a?void window.CKFinder.require([window.CKFinder.require.toUrl(a)],function(t){r(i,t,e)},function(){r(i,{},e)}):void r(i,{},e)})}}}}();